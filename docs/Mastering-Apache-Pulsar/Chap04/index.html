<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Mastering Apache Pulsar/Mastering-Apache-Pulsar-Chap04">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kay Haw&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kay Haw&#39;s Blog Atom Feed">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-rh="true">Pulsar组件 | Kay Haw&#x27;s Blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kayhaw.github.io/docs/Mastering-Apache-Pulsar/Chap04"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Pulsar组件 | Kay Haw&#x27;s Blog"><meta data-rh="true" name="description" content="Mastering Apache Pulsar 第4章读书笔记"><meta data-rh="true" property="og:description" content="Mastering Apache Pulsar 第4章读书笔记"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kayhaw.github.io/docs/Mastering-Apache-Pulsar/Chap04"><link data-rh="true" rel="alternate" href="https://kayhaw.github.io/docs/Mastering-Apache-Pulsar/Chap04" hreflang="en"><link data-rh="true" rel="alternate" href="https://kayhaw.github.io/docs/Mastering-Apache-Pulsar/Chap04" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.932307e8.css">
<link rel="preload" href="/assets/js/runtime~main.a8170a08.js" as="script">
<link rel="preload" href="/assets/js/main.1794f536.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title text--truncate">Kay Haw&#x27;s Blog</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">读书笔记</a><a class="navbar__item navbar__link" href="/notes">学习笔记</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><aside class="theme-doc-sidebar-container docSidebarContainer_UQUJ"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">读书笔记</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/C++PrimerPlus/C++PrimerPlus-Chap04">C++PrimerPlus</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/EffectiveC++/Effective-C++-Chap1">EffectiveC++</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Java并发编程实战/Java-Concurrency-in-Practice-Chap02">Java并发编程实战</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/Learning-Akka/">Learning Akka</a><button aria-label="Toggle the collapsible sidebar category &#x27;Learning Akka&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/Mastering-Apache-Pulsar/">Mastering Apache Pulsar</a><button aria-label="Toggle the collapsible sidebar category &#x27;Mastering Apache Pulsar&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mastering-Apache-Pulsar/Chap02">事件流和事件代理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mastering-Apache-Pulsar/Chap03">Pulsar</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Mastering-Apache-Pulsar/Chap04">Pulsar组件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mastering-Apache-Pulsar/Chap05">消费者</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mastering-Apache-Pulsar/Chap06">生产者</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mastering-Apache-Pulsar/Chap07">Pulsar IO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mastering-Apache-Pulsar/Chap08">Pulsar Functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mastering-Apache-Pulsar/Chap09">分层存储</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mastering-Apache-Pulsar/Chap10">Pulsar SQL</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/Stream-Processing-with-Apache-Flink/">Stream Processing with Apache Flink</a><button aria-label="Toggle the collapsible sidebar category &#x27;Stream Processing with Apache Flink&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/深入理解Java虚拟机/UnderstandJVM-Chap07">深入理解Java虚拟机</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/高性能MySQL/HighPerformanceMySQL-Chap04">高性能MySQL</a></div></li></ul></nav></div></aside><main class="docMainContainer_uL0j"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_kU5B"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/Mastering-Apache-Pulsar/"><span itemprop="name">Mastering Apache Pulsar</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Pulsar组件</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Pulsar组件</h1></header><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p><em>Mastering Apache Pulsar</em> 第4章读书笔记</p></div></div><p>如下图所示，Pulsar内部组件包含：brokers、Apache BookKeeper和ZooKeeper。</p><p><img loading="lazy" alt="Pulsar Components" src="/assets/images/pulsar-components-1eda51c0ae4e0f88d9df6aa8b05e4510.png" width="952" height="390" class="img_E7b_"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="brokers">Brokers<a class="hash-link" href="#brokers" title="Direct link to heading">​</a></h2><p>Pulsar brokers负责如下内容：</p><ul><li>topic数据的临时存储管理(缓存)；</li><li>与BookKeeper/ZooKeeper通信；</li><li>模式校验；</li><li>与其他broker通信；</li><li>提供Pulsar Functions和Pulsar IO的运行时环境。</li></ul><p><img loading="lazy" alt="Pulsar Brokers" src="/assets/images/pulsar-brokers-fd362d08f2118a64e6c1209215077aac.png" width="402" height="486" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="消息缓存">消息缓存<a class="hash-link" href="#消息缓存" title="Direct link to heading">​</a></h3><p>与其他消息brokers不同，Pulsar brokers是<strong>无状态的</strong>：不保存消息处理时的任何数据。好处：存算分离，容错性更高；坏处：额外的状态管理系统，额外的抽象将Pulsar存储翻译成其他存储系统。</p><p>Pulsar依赖Apache BookKeeper进行存储，并在BookKeeper顶层抽象出managed ledger使用，Managed ledger是broker和BookKeeper ledger之间的桥梁。如下图所示一个典型的Pulsar topic拓扑图：broker1负责读写topic，写topic是将数据写入到每个BookKeeper实例，读topic是从leader节点读取数据。</p><p><img loading="lazy" alt="Bookies store Data from Topic" src="/assets/images/broker-topic-bookie-119c0317af678d7f48cac87b680303ce.png" width="601" height="566" class="img_E7b_"></p><p>在流环境下，每条消息都需要写到BookKeeper，此时broker将最新消息缓存发送给消费者而不是保存到BookKeeper然后再读取，如下图所示。</p><p><img loading="lazy" alt="Managed Ledger Cache" src="/assets/images/broker-cache-ledger-e03137a01d0b244c0bc21a1b9422bf0e.png" width="626" height="428" class="img_E7b_"></p><p>注意缓存是易失性的，不能作为永久存储。Broker对缓存数据有着生命周期限制，详见第5、6章。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="与bookkeeperzookeeper通信">与BookKeeper/ZooKeeper通信<a class="hash-link" href="#与bookkeeperzookeeper通信" title="Direct link to heading">​</a></h3><p>ZookKeeper保存所有Pulsar集群的相关元数据：哪个broker是leader节点，服务发现配置和其他管理信息。BookKeeper是Pulsar的存储引擎，保存所有消息数据。因此broker需要与BookKeeper/ZookKeeper通信。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="模式校验">模式校验<a class="hash-link" href="#模式校验" title="Direct link to heading">​</a></h3><p>模式校验确保发布给topic的消息符合预定规范，由broker执行。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="broker间通信">Broker间通信<a class="hash-link" href="#broker间通信" title="Direct link to heading">​</a></h3><p>Broker将元数据存储在ZooKeeper，当客户端请求读写的topic不在某个broker上，该broker负责将客户端指向到正确的broker，如下图所示：</p><p><img loading="lazy" alt="Inter-broker Communication" src="/assets/images/inter-broker-communication-151fe88e2e0c84ed52f2684daceed2ac.png" width="824" height="593" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="pulsar-function和pulsar-io">Pulsar Function和Pulsar IO<a class="hash-link" href="#pulsar-function和pulsar-io" title="Direct link to heading">​</a></h3><p>Broker是影响Pulsar吞吐量的主要因素，如果broker忙于处理Pulsar Function或者Pulsar IO，势必会影响系统整体性能。尽管大部分情况下这种性能退化问题不大，但是将Pulsar IO/Function放到其他集群将会改善性能，并且Pulsar提供相应机制。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="apache-bookkeeper">Apache BookKeeper<a class="hash-link" href="#apache-bookkeeper" title="Direct link to heading">​</a></h2><p><a href="https://www.splunk.com/en_us/blog/it/introduction-to-apache-bookkeeper.html" target="_blank" rel="noopener noreferrer">Apache BookKeeper</a>是一个通用型数据存储系统，架构如下图所示：由被称为bookie的服务器组成集群，每个bookie上包含称之为ledger的存储系统。</p><p><img loading="lazy" alt="BookKeeper Simple Architecture" src="/assets/images/bookkeeper-architecture-4a973a229860b8131cb21f0b1cacd6ac.png" width="603" height="395" class="img_E7b_"></p><p>Ledger是一种<strong>只能追加</strong>的日志，如下所示，一个ledger包含多个entry，一系列ledger被称为stream：</p><p><img loading="lazy" alt="BookKeeper Ledger Stream" src="/assets/images/ledger-stream-2c107d78ee284bfb8e0401902bd11a6c.png" width="1047" height="319" class="img_E7b_"></p><p>BookKeeper使用基于候选团的副本机制处理分布式数据存储，这里简化为3个参数：</p><ol><li><strong>E</strong>：Ensemble size，节点总数；</li><li><strong>Q_w</strong>：Quorum write，每个entry的副本数；</li><li><strong>Q_a</strong>：Quorum acknowledgment，每个entry的响应数。</li></ol><p>通常节点数量大于等于副本数量，响应数小于等于副本数。如下图所示E=3、Q_w=3、Q_a=3，表示一共3个节点，每个entry有3份副本，每个节点必须响应。</p><p><img loading="lazy" alt="Ledger Example1" src="/assets/images/ledger-example1-0f9099976521d5fbc767eb90a6840d5e.png" width="232" height="401" class="img_E7b_"></p><p>如下图所示E=5、Q_w=3、Q_a=3，表示一共5个节点，每个entry有3份副本，每个副本都需要响应。</p><p><img loading="lazy" alt="Ledger Example2" src="/assets/images/ledger-example2-ebba3a0e4189a5fda09d2477b103d330.png" width="390" height="401" class="img_E7b_"></p><p>实际上一个bookie节点包含一个ledger的一部分(fragment)，以fragment为单位bookie节点上复制，如下图所示。</p><p><img loading="lazy" alt="Ledger Fragment" src="/assets/images/ledger-fragment-d755baf7df117cdd38f537aa721ded30.png" width="1228" height="323" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="写前日志">写前日志<a class="hash-link" href="#写前日志" title="Direct link to heading">​</a></h3><p>写前日志(Write-Ahead Log，WAL)在数据库系统中用于提供原子性和持久性。如下图所示，数据库系统将执行的增删改操作写入日志中，然后根据日志检查是否完成操作。写前日志还用于变更数据捕获(Change Data Capture，CDC)，在Pulsar IO正是用数据库的写前日志来实现CDC，详见第7章。</p><p><img loading="lazy" alt="Write-Ahead Log" src="/assets/images/write-ahead-log-2ad2a99bdd4445438bf64cc32803e676.png" width="960" height="322" class="img_E7b_"></p><p>BookKeeper的持久性、容错性和扩展性使其成为实现WAL的选择之一。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="消息存储">消息存储<a class="hash-link" href="#消息存储" title="Direct link to heading">​</a></h3><p>对于Pulsar、Kafka和Pravega来说，消息持久化至关重要。而BookKeeper的ledger存储模型(只追加日志、高持久、易分布)是存储事件流的最佳方案，如下图所示，topic数据有序地存放在ledger中。</p><p><img loading="lazy" alt="BookKeeper Ledger" src="/assets/images/bookkeeper-ledger-63fe88a1fabd3aa0fc57733d3192c329.png" width="923" height="184" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="objectblob存储">Object/Blob存储<a class="hash-link" href="#objectblob存储" title="Direct link to heading">​</a></h3><p>BookKeeper通过BlobIt提供对象/二进制大对象的存储，支持容错并提供Amazon S3兼容API。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="pravega">Pravega<a class="hash-link" href="#pravega" title="Direct link to heading">​</a></h3><p>Pravega是类似Pulsar的分布式消息系统，由Dell公司开发。和Pulsar一样使用BookKeeper存储topic数据，如下图所示。值得注意的是，Pravega还可用于处理视频流和大文件流。</p><p><img loading="lazy" alt="Pravege Architecture" src="/assets/images/pravega-architecture-6a931427e5996d63415b11ecca71777b.png" width="779" height="261" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="majordodo">Majordodo<a class="hash-link" href="#majordodo" title="Direct link to heading">​</a></h3><p>Majordodo是处理集群工作调度的资源管理器，由Diennea公司开发。Majordodo使用BookKeeper ledger跟踪集群工作负载情况。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="apache-zookeeper">Apache ZooKeeper<a class="hash-link" href="#apache-zookeeper" title="Direct link to heading">​</a></h2><p>ZooKeeper由雅虎公司开发，基于谷歌工程师Mike Burrows的论文<em>The Chubby Lock Service for Loosely-Coupled Distributed Systems</em>而实现。ZooKeeper实现了Paxos和Raft分布式算法，以及两阶段提交协议(如下图所示)。</p><p><img loading="lazy" alt="ZooKeeper Two" src="/assets/images/zookkeeper-two-phase-commit-f90e728d62936599de0212bdcd0babbc.png" width="858" height="372" class="img_E7b_"></p><p>ZooKeeper使用场景包括：</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="命名服务">命名服务<a class="hash-link" href="#命名服务" title="Direct link to heading">​</a></h3><p>命名服务(Naming Service)将网络资源映射成对应地址，ZooKeeper保存每个节点状态以及leader、follower信息，当节点需要协调时使用ZooKeeper作为查找信息。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="配置管理">配置管理<a class="hash-link" href="#配置管理" title="Direct link to heading">​</a></h3><p>Pulsar有着约150个配置项，它们影响着Pulsar、BookKeeper和ZooKeeper的行为。Pulsar broker将配置项保存在ZooKeeper中，因为ZooKeeper也提供安全可靠的分布式存储。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="leader选举">Leader选举<a class="hash-link" href="#leader选举" title="Direct link to heading">​</a></h3><p>Leader选举指在分布式系统中选择承担某些责任的leader(主节点)，在Apache Pulsar中，一个broker就是某个topic的leader。基于命名服务和配置管理，ZooKeeper跟踪leader状态，在其失效后选择新leader。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="通知系统">通知系统<a class="hash-link" href="#通知系统" title="Direct link to heading">​</a></h3><p>ZooKeeper提供高质量的命名服务也意味着其是个出色的通知系统。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="apache-kafka">Apache Kafka<a class="hash-link" href="#apache-kafka" title="Direct link to heading">​</a></h3><p>Kafka使用ZooKeeper来进行配置管理和leader选举，如下图所示：</p><p><img loading="lazy" alt="Kafka with ZooKeeper" src="/assets/images/kafka-with-zookeeper-17af13252eca9f371f5ec80280ec8c76.png" width="346" height="243" class="img_E7b_"></p><p>但从v2.8开始，Kafka将ZooKeeper移除，由集群自身实现Raft一致性协议，如下图所示：</p><p><img loading="lazy" alt="Kafka without ZooKeeper" src="data:image/png;base64,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" width="118" height="365" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="apache-druid">Apache Druid<a class="hash-link" href="#apache-druid" title="Direct link to heading">​</a></h3><p>Apache Druid是由Metamarkets开发的实时分析数据库，使用ZooKeeper进行配置管和一致性管理。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="pulsar-proxy">Pulsar Proxy<a class="hash-link" href="#pulsar-proxy" title="Direct link to heading">​</a></h2><p>当在私有网络部署Pulsar时，需要Pulsar proxy作为网关来简化向外暴露brokers的过程，如下图所示：</p><p><img loading="lazy" alt="Pulsar on K8S" src="/assets/images/plusar-on-k8s-1e4b9c49414cc9a4de0bd2b238deb852.png" width="667" height="201" class="img_E7b_"></p><p><img loading="lazy" alt="Pulsar Proxy" src="/assets/images/pulsar-proxy-e227facb582af0509e0c8b8a02e5a03a.png" width="671" height="288" class="img_E7b_"></p><p>为了减轻proxy压力，需要proxy frontend专门处理来自集群边缘网络的流量。如下图所示，proxy更适合在brokers之间的路由，在其之上引入专门的前端(比如NGINX、HAProxy等)用来做外部请求的负载均衡。</p><p><img loading="lazy" alt="Proxy without Frontend" src="/assets/images/proxy-without-frontend-2cf1753e2b185efd943a8d2b3fbb5a6e.png" width="553" height="302" class="img_E7b_"></p><p><img loading="lazy" alt="Proxy with Frontend" src="/assets/images/proxy-with-frontend-560903b8e38066b7105c9c810a625da9.png" width="587" height="404" class="img_E7b_"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="jvm">JVM<a class="hash-link" href="#jvm" title="Direct link to heading">​</a></h2><p>本节介绍为什么Pulsar使用Java开发(这个节标题取得不太好😕)。回到启动开发Pulsar的2013年，雅虎经历着爆炸的用户增长，此时大数据技术以Hadoop生态为代表，而Hadoop生态技术都是用Java开发。Java各类场景库应有尽有，包含但不限于：</p><ul><li>Netty：网络服务；</li><li>Apache Spark：基于内存的分布式计算系统；</li><li>Apache Lucene：索引引擎。</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="总结">总结<a class="hash-link" href="#总结" title="Direct link to heading">​</a></h2><p>Pulsar系统由broker、BookKeeper和ZooKeeper组成：</p><ol><li>Broker提供消息读写以及缓存，模式校验以及Pulsar Functions和Pulsar IO的运行时；</li><li>BookKeeper负责消息存储，每个节点称为bookie，消息存储抽象为只读日志ledger；</li><li>BookKeeper依赖于ZooKeeper提供协调服务。</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/docs/tags/apache-pulsar">Apache Pulsar</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/docs/tags/reading-notes">ReadingNotes</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kayhaw/kayhaw.github.io/edit/master/website/docs/Mastering Apache Pulsar/03-Mastering-Apache-Pulsar-Chap04.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Mastering-Apache-Pulsar/Chap03"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Pulsar</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Mastering-Apache-Pulsar/Chap05"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">消费者</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#brokers" class="table-of-contents__link toc-highlight">Brokers</a><ul><li><a href="#消息缓存" class="table-of-contents__link toc-highlight">消息缓存</a></li><li><a href="#与bookkeeperzookeeper通信" class="table-of-contents__link toc-highlight">与BookKeeper/ZooKeeper通信</a></li><li><a href="#模式校验" class="table-of-contents__link toc-highlight">模式校验</a></li><li><a href="#broker间通信" class="table-of-contents__link toc-highlight">Broker间通信</a></li><li><a href="#pulsar-function和pulsar-io" class="table-of-contents__link toc-highlight">Pulsar Function和Pulsar IO</a></li></ul></li><li><a href="#apache-bookkeeper" class="table-of-contents__link toc-highlight">Apache BookKeeper</a><ul><li><a href="#写前日志" class="table-of-contents__link toc-highlight">写前日志</a></li><li><a href="#消息存储" class="table-of-contents__link toc-highlight">消息存储</a></li><li><a href="#objectblob存储" class="table-of-contents__link toc-highlight">Object/Blob存储</a></li><li><a href="#pravega" class="table-of-contents__link toc-highlight">Pravega</a></li><li><a href="#majordodo" class="table-of-contents__link toc-highlight">Majordodo</a></li></ul></li><li><a href="#apache-zookeeper" class="table-of-contents__link toc-highlight">Apache ZooKeeper</a><ul><li><a href="#命名服务" class="table-of-contents__link toc-highlight">命名服务</a></li><li><a href="#配置管理" class="table-of-contents__link toc-highlight">配置管理</a></li><li><a href="#leader选举" class="table-of-contents__link toc-highlight">Leader选举</a></li><li><a href="#通知系统" class="table-of-contents__link toc-highlight">通知系统</a></li><li><a href="#apache-kafka" class="table-of-contents__link toc-highlight">Apache Kafka</a></li><li><a href="#apache-druid" class="table-of-contents__link toc-highlight">Apache Druid</a></li></ul></li><li><a href="#pulsar-proxy" class="table-of-contents__link toc-highlight">Pulsar Proxy</a></li><li><a href="#jvm" class="table-of-contents__link toc-highlight">JVM</a></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">读书笔记</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.zhihu.com/people/xiao-ke-dou-7" target="_blank" rel="noopener noreferrer" class="footer__link-item">知乎<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 何轲(Kay Haw). Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a8170a08.js"></script>
<script src="/assets/js/main.1794f536.js"></script>
</body>
</html>