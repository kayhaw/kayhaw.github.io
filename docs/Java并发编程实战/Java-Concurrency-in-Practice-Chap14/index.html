<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.16">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kay Haw&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kay Haw&#39;s Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-rh="true">æ„å»ºè‡ªå®šä¹‰çš„åŒæ­¥å·¥å…· | Kay Haw&#x27;s Blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kayhaw.github.io/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap14"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="æ„å»ºè‡ªå®šä¹‰çš„åŒæ­¥å·¥å…· | Kay Haw&#x27;s Blog"><meta data-rh="true" name="description" content="ã€ŠJavaå¹¶å‘ç¼–ç¨‹ã€‹ç¬¬åå››ç« è¯»ä¹¦ç¬”è®°"><meta data-rh="true" property="og:description" content="ã€ŠJavaå¹¶å‘ç¼–ç¨‹ã€‹ç¬¬åå››ç« è¯»ä¹¦ç¬”è®°"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kayhaw.github.io/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap14"><link data-rh="true" rel="alternate" href="https://kayhaw.github.io/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap14" hreflang="en"><link data-rh="true" rel="alternate" href="https://kayhaw.github.io/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap14" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4bafb564.css">
<link rel="preload" href="/assets/js/runtime~main.b8f66f99.js" as="script">
<link rel="preload" href="/assets/js/main.a8d1eeac.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Kay Haw&#x27;s Blog</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">è¯»ä¹¦ç¬”è®°</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ğŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ğŸŒ</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">è¯»ä¹¦ç¬”è®°</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/C++PrimerPlus/C++PrimerPlus-Chap04">C++PrimerPlus</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/EffectiveC++/Effective-C++-Chap1">EffectiveC++</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap02">Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap02">çº¿ç¨‹å®‰å…¨æ€§</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap03">å¯¹è±¡çš„å…±äº«</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap04">å¯¹è±¡çš„ç»„åˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap05">åŸºç¡€æ„å»ºæ¨¡å—</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap06">ä»»åŠ¡æ‰§è¡Œ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap07">å–æ¶ˆä¸å…³é—­</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap08">çº¿ç¨‹æ± çš„ä½¿ç”¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap10">é¿å…æ´»è·ƒæ€§å±é™©</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap13">æ˜¾å¼é”</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap14">æ„å»ºè‡ªå®šä¹‰çš„åŒæ­¥å·¥å…·</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap15">åŸå­å˜é‡ä¸éé˜»å¡åŒæ­¥æœºåˆ¶</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap16">Javaå†…å­˜æ¨¡å‹</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/Learning Akka/LearningAkka-Chap01">Learning Akka</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/Stream-Processing-with-Apache-Flink/Chap01">Stream Processing with Apache Flink</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº/UnderstandJVM-Chap07">æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/é«˜æ€§èƒ½MySQL/HighPerformanceMySQL-Chap04">é«˜æ€§èƒ½MySQL</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">ğŸ </a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap14">æ„å»ºè‡ªå®šä¹‰çš„åŒæ­¥å·¥å…·</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>æ„å»ºè‡ªå®šä¹‰çš„åŒæ­¥å·¥å…·</h1></header><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>ã€ŠJavaå¹¶å‘ç¼–ç¨‹ã€‹ç¬¬åå››ç« è¯»ä¹¦ç¬”è®°</p></div></div><p>ä»‹ç»å®ç°çŠ¶æ€ä¾èµ–æ€§çš„å„ç§é€‰æ‹©ï¼Œä»¥åŠæä¾›çŠ¶æ€ä¾èµ–æ€§æœºåˆ¶æ—¶éœ€è¦éµå®ˆçš„è§„åˆ™ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="çŠ¶æ€ä¾èµ–æ€§çš„ç®¡ç†">çŠ¶æ€ä¾èµ–æ€§çš„ç®¡ç†<a class="hash-link" href="#çŠ¶æ€ä¾èµ–æ€§çš„ç®¡ç†" title="Direct link to heading">â€‹</a></h2><p>åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒåŸºäºçŠ¶æ€çš„å‰ææ¡ä»¶æœªå¾—åˆ°æ»¡è¶³ï¼Œé‚£è¯¥æ¡ä»¶æ°¸è¿œæ— æ³•æˆçœŸï¼Œæ­¤æ—¶ç¨‹åºè¡Œä¸ºæŒ‰ç…§å¤±è´¥å¤„ç†ã€‚è€Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯èƒ½ç»è¿‡å‡ æ¡æŒ‡ä»¤åå‰ææ¡ä»¶åˆæ”¹å˜äº†ã€‚å› æ­¤ï¼Œä¾èµ–çŠ¶æ€çš„æ“ä½œå¯ä»¥ä¸€ç›´é˜»å¡åˆ°å‰ææ¡ä»¶ä¸ºçœŸå†ç»§ç»­æ‰§è¡Œï¼Œè¿™æ¯”è®©å®ƒä»¬å…ˆå¤±è´¥å†å®ç°èµ·æ¥æ›´æ–¹ä¾¿ã€‚å¯é˜»å¡çš„çŠ¶æ€ä¾èµ–ä¼ªä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">è·å–å¯¹è±¡çŠ¶æ€çš„é”</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">çŠ¶æ€çš„å‰ææ¡ä»¶ä¸ºå‡</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  é‡Šæ”¾é”</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ç­‰åˆ°å‰ææ¡ä»¶ä¸ºçœŸ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  å½“è¢«ä¸­æ–­æˆ–è€…è¶…æ—¶å¯ä»¥é€‰æ‹©å¤±è´¥é€€å‡º</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  é‡æ–°ä¸Šé”</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ‰§è¡Œæ“ä½œ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">é‡Šæ”¾é”</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>é¦–å…ˆæ„æˆå‰ææ¡ä»¶çš„çŠ¶æ€å˜é‡ç”±é”ä¿æŠ¤(ç¡®ä¿åˆ¤æ–­æ—¶æ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹çŠ¶æ€)ï¼Œåœ¨è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸ºçœŸåˆ™æ‰§è¡Œæ“ä½œç„¶åé‡Šæ”¾é”ï¼Œå¦‚æœä¸ºå‡åˆ™å…ˆé‡Šæ”¾é”å†ç­‰å¾…å‰ææ¡ä»¶ä¸ºçœŸï¼Œåœ¨å†æ¬¡æµ‹è¯•å‰ææ¡ä»¶ä¹‹å‰éƒ½å¿…é¡»é‡æ–°ä¸Šé”ã€‚</p><p>æ¥ä¸‹æ¥ä»¥æœ‰ç•Œç¼“å­˜çš„ä¸åŒå®ç°æ¥ä»‹ç»å¦‚ä½•å¤„ç†å‰ææ¡ä»¶å¤±è´¥çš„é—®é¢˜ã€‚é¦–å…ˆç»™å‡ºåŸºç±»BaseBoundBufferä»£ç å®ç°ï¼Œè¯¥ç±»å®ç°äº†ä¸€ä¸ªåŸºäºæ•°ç»„çš„å¾ªç¯ç¼“å­˜ï¼Œå„ä¸ªçŠ¶æ€å˜é‡éƒ½ç”±å†…ç½®é”ä¿æŠ¤ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">abstract</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">BaseBoundedBuffer</span><span class="token plain"> </span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">V</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> tail</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> head</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token class-name">BaseBoundedBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">buf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">V</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">capacity</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doPut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">V</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">tail</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">++</span><span class="token plain">tail </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tail </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">V</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doTake</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">V</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">head</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">head</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">++</span><span class="token plain">head </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            head </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isFull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç¤ºä¾‹å°†å‰ææ¡ä»¶çš„å¤±è´¥ä¼ é€’ç»™è°ƒç”¨è€…">ç¤ºä¾‹ï¼šå°†å‰ææ¡ä»¶çš„å¤±è´¥ä¼ é€’ç»™è°ƒç”¨è€…<a class="hash-link" href="#ç¤ºä¾‹å°†å‰ææ¡ä»¶çš„å¤±è´¥ä¼ é€’ç»™è°ƒç”¨è€…" title="Direct link to heading">â€‹</a></h3><p>å½“ä½¿ç”¨ç¼“å­˜æ—¶ï¼Œå¿…é¡»éµå®ˆâ€œç¼“å­˜ä¸ºç©ºä¸èƒ½è·å–ï¼Œç¼“å­˜å·²æ»¡ä¸èƒ½æ·»åŠ â€çš„å‰æè§„åˆ™ï¼Œå½“å‰æè§„åˆ™ä¸æ»¡è¶³æ—¶ï¼Œä¸€ç§ç®€å•æ–¹æ³•æ˜¯ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">GrumpyBoundedBuffer</span><span class="token plain"> </span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">BaseBoundedBuffer</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">GrumpyBoundedBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">GrumpyBoundedBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">V</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">BufferFullException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">isFull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">BufferFullException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">doPut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token class-name">V</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">take</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">BufferEmptyException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">BufferEmptyException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doTake</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>æ­¤æ—¶ï¼Œæ¯æ¬¡è°ƒç”¨ç¼“å­˜æ“ä½œçš„ä»£ç å¿…é¡»å¤„ç†æœªæ£€æŸ¥å¼‚å¸¸å¹¶ä¸”é‡å¤æ“ä½œç›´åˆ°æˆåŠŸï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain"> item </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">take</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// use item</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BufferEmptyException</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SLEEP_GRANULARITY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ä¼‘çœ ä¼šé™ä½ç¨‹åºå“åº”æ€§ï¼Œç¬¬äºŒç§æ–¹å¼ä¸è®©è°ƒç”¨è¿›å…¥ä¼‘çœ ï¼Œè€Œæ˜¯ç›´æ¥é‡æ–°è°ƒç”¨takeæ–¹æ³•ï¼Œç§°ä¹‹ä¸º<strong>å¿™ç­‰å¾…</strong>æˆ–è€…<strong>è‡ªæ—‹ç­‰å¾…</strong>ï¼Œä½†ä¼šé€ æˆCPUæ—¶é—´æµªè´¹ã€‚ç¬¬ä¸‰ç§æ–¹å¼æ˜¯é€šè¿‡Thread.yieldæ–¹æ³•è®©å‡ºCPUæ—¶é—´ç‰‡ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç¤ºä¾‹é€šè¿‡è½®è¯¢ä¸ä¼‘çœ æ¥å®ç°ç®€å•çš„é˜»å¡">ç¤ºä¾‹ï¼šé€šè¿‡è½®è¯¢ä¸ä¼‘çœ æ¥å®ç°ç®€å•çš„é˜»å¡<a class="hash-link" href="#ç¤ºä¾‹é€šè¿‡è½®è¯¢ä¸ä¼‘çœ æ¥å®ç°ç®€å•çš„é˜»å¡" title="Direct link to heading">â€‹</a></h3><p>ä¸ºäº†å…å»è°ƒç”¨è€…ä¸€ç›´ç”¨while-trueå¾ªç¯æ¥å®ç°é‡è¯•é€»è¾‘ï¼Œæ”¹å†™putå’Œtakeæ–¹æ³•ï¼Œå°†å‰ææ¡ä»¶çš„éªŒè¯ç®¡ç†å°è£…èµ·æ¥ä»è€Œç®€åŒ–ä½¿ç”¨ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">V</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token function" style="color:#d73a49">isFull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">doPut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SLEEP_GRANULARITY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">V</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">take</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doTake</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SLEEP_GRANULARITY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>é€šè¿‡synchronizedåŒæ­¥å—ï¼Œç¡®ä¿éªŒè¯å‰ææ¡ä»¶æ—¶æ”¶åˆ°é”ä¿æŠ¤ã€‚è‹¥éªŒè¯å¤±è´¥åˆ™é‡Šæ”¾é”å¹¶ä¼‘çœ ä¸€æ®µæ—¶é—´ï¼Œä»è€Œç¡®ä¿å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿè®¿é—®ç¼“å­˜ã€‚ä»è°ƒç”¨è€…è§’åº¦çœ‹ï¼Œæ“ä½œè¦ä¹ˆç«‹å³æ‰§è¡Œï¼Œè¦ä¹ˆé˜»å¡ã€‚ä½†è¿™ç§æ–¹å¼éœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š</p><ul><li>åˆé€‚çš„ä¼‘çœ æ—¶é—´ï¼Œé—´éš”æ—¶é—´è¶Šå°å“åº”æ€§è¶Šé«˜ä½†æ˜¯CPUæ¶ˆè€—ä¹Ÿæ›´å¤§</li><li>å¤„ç†InterruptedExceptionï¼Œå½“ç­‰å¾…é˜»å¡æ–¹æ³•è¿”å›æ—¶ï¼Œé€šè¿‡ä¸­æ–­æ¥å–æ¶ˆæ–¹æ³•æ‰§è¡Œ</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ¡ä»¶é˜Ÿåˆ—">æ¡ä»¶é˜Ÿåˆ—<a class="hash-link" href="#æ¡ä»¶é˜Ÿåˆ—" title="Direct link to heading">â€‹</a></h3><p>é€šè¿‡è½®åºå’Œä¼‘çœ å¯ä»¥å®ç°é˜»å¡æ“ä½œï¼Œä½†ä¸€ç§æ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨æ¡ä»¶é˜Ÿåˆ—ã€‚æ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªé”ï¼Œæ‰€æœ‰ç­‰å¾…è¯¥é”çš„çº¿ç¨‹å½¢æˆä¸€ä¸ªæ¡ä»¶é˜Ÿåˆ—ï¼Œè€ŒObjectç±»çš„waitã€notifyå’ŒnotifyAllæ–¹æ³•æ„æˆè¯¥é˜Ÿåˆ—çš„APIã€‚å¦‚ä¸‹ä»£ç é€šè¿‡waitå’ŒnotifyAllæ–¹æ³•å®ç°ä¸€ä¸ªæœ‰ç•Œç¼“å­˜ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">V</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">isFull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">doPut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">notifyAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token class-name">V</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">take</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">V</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doTake</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">notifyAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>é€šè¿‡æ¡ä»¶é˜Ÿåˆ—ï¼Œåœ¨å‰ææ¡ä»¶ä¸ºå‡æ—¶ä½¿ç”¨waitæŒ‚èµ·çº¿ç¨‹ï¼Œå½“å‰ææ¡ä»¶ä¸ºçœŸæ˜¯ä½¿ç”¨notifyAllå”¤é†’çº¿ç¨‹ï¼Œè¿™æ¯”ä½¿ç”¨ä¼‘çœ çš„æœ‰ç•Œç¼“å­˜æ›´åŠ ç®€å•é«˜æ•ˆã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ä½¿ç”¨æ¡ä»¶é˜Ÿåˆ—">ä½¿ç”¨æ¡ä»¶é˜Ÿåˆ—<a class="hash-link" href="#ä½¿ç”¨æ¡ä»¶é˜Ÿåˆ—" title="Direct link to heading">â€‹</a></h2><p>æ¡ä»¶é˜Ÿåˆ—è®©æ„å»ºé«˜å“åº”æ€§çš„çŠ¶æ€ä¾èµ–ç±»æ›´åŠ å®¹æ˜“ï¼Œä½†å®ƒä¹Ÿä¼šè¢«é”™è¯¯ä½¿ç”¨ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ¡ä»¶è°“è¯">æ¡ä»¶è°“è¯<a class="hash-link" href="#æ¡ä»¶è°“è¯" title="Direct link to heading">â€‹</a></h3><p>æ¡ä»¶è°“è¯æ˜¯ä½¿æŸä¸ªæ“ä½œæˆä¸ºçŠ¶æ€ä¾èµ–æ“ä½œçš„å‰ææ¡ä»¶ï¼Œå®ƒå’Œé”ã€waitæ–¹æ³•ç»„æˆæ¡ä»¶ç­‰å¾…çš„ä¸‰è¦ç´ ã€‚æ¡ä»¶è°“è¯åŒ…å«å¤šä¸ªçŠ¶æ€å˜é‡ï¼Œæ¯ä¸ªçŠ¶æ€å˜é‡å¿…é¡»ç”±ä¸€ä¸ªé”æ¥ä¿æŠ¤ï¼Œå¹¶ä¸”é”å¯¹è±¡å’Œæ¡ä»¶é˜Ÿåˆ—å¯¹è±¡(è°ƒç”¨waitã€notifyç­‰æ–¹æ³•çš„å¯¹è±¡)å¿…é¡»ç›¸åŒã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="è¿‡æ—©å”¤é†’">è¿‡æ—©å”¤é†’<a class="hash-link" href="#è¿‡æ—©å”¤é†’" title="Direct link to heading">â€‹</a></h3><p>ç”±äºå†…ç½®æ¡ä»¶é˜Ÿåˆ—å¯ä»¥ä¸å¤šä¸ªæ¡ä»¶è°“è¯ä¸€èµ·ä½¿ç”¨ï¼Œwaitæ–¹æ³•è¿”å›æ—¶å¹¶ä¸ä¸€å®šæ„å‘³ç€å®ƒæ‰€ç­‰å¾…çš„æ¡ä»¶è°“è¯ä¸ºçœŸ(ä¾‹å¦‚ä¸€ä¸ªçº¿ç¨‹ç”±äºnotifyAllè€Œé†’æ¥æ—¶ï¼Œwaitæ–¹æ³•å‡è£…è¿”å›)ã€‚åŸºäºè¿™äº›åŸå› ï¼Œçº¿ç¨‹ä»waitä¸­å”¤é†’æ—¶éƒ½å¿…é¡»å†æ¬¡æµ‹è¯•æ¡ä»¶è°“è¯ï¼Œå³æ ‡å‡†çš„æ¡ä»¶ç­‰å¾…ä»£ç æ¨¡æ¿å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">stateDependentMethod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token function" style="color:#d73a49">conditionPredicate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// æ“ä½œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ä½¿ç”¨æ¡ä»¶ç­‰å¾…æ€»ç»“ï¼š</p><ol><li>é€šè¿‡æ¡ä»¶è°“è¯æµ‹è¯•</li><li>åœ¨è°ƒç”¨waitå‰ï¼Œä»waitè¿”å›åéƒ½æµ‹è¯•</li><li>åœ¨whileå¾ªç¯ä¸­è°ƒç”¨wait</li><li>ä½¿ç”¨æ¡ä»¶å¯¹è±¡ç›¸å…³é”ä¿æŠ¤çŠ¶æ€å˜é‡</li><li>è°ƒç”¨waitã€notifyæˆ–è€…notifyAllæ—¶ä¸€å®šè¦æŒæœ‰ä¸æ¡ä»¶é˜Ÿåˆ—ç›¸å…³çš„é”</li><li>æ£€æŸ¥æ¡ä»¶è°“è¯åå’Œå¼€å§‹æ“ä½œå‰ï¼Œéƒ½ä¸è¦é‡Šæ”¾é”</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä¿¡å·ä¸¢å¤±">ä¿¡å·ä¸¢å¤±<a class="hash-link" href="#ä¿¡å·ä¸¢å¤±" title="Direct link to heading">â€‹</a></h3><p>ä¿¡å·ä¸¢å¤±å±äºä¸€ç§æ´»è·ƒæ€§æ•…éšœï¼šçº¿ç¨‹ç­‰å¾…å·²ç»ä¸ºçœŸçš„æ¡ä»¶ï¼Œä½†æ˜¯å¼€å§‹ç­‰å¾…ä¹‹å‰æ²¡æœ‰æ£€æŸ¥æ¡ä»¶è°“è¯ã€‚ä¾‹å¦‚åœ¨waitæ–¹æ³•ä¹‹å‰æ²¡æœ‰æ£€æµ‹æ¡ä»¶è°“è¯ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="é€šçŸ¥">é€šçŸ¥<a class="hash-link" href="#é€šçŸ¥" title="Direct link to heading">â€‹</a></h3><p>å½“å…¶ä»–çº¿ç¨‹ç­‰å¾…æ¡ä»¶æ—¶ï¼Œä¸€å®šè¦ç¡®ä¿æ¡ä»¶è°“è¯ä¸ºçœŸåé€šè¿‡æŸç§æ–¹å¼å‘å‡ºé€šçŸ¥ï¼Œå¯¹äºæ¡ä»¶é˜Ÿåˆ—æ¥è¯´å°±æ˜¯notifyå’ŒnotifyAllæ–¹æ³•ã€‚notifyæ–¹æ³•éšæœºå”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œè€ŒnotifyAllæ–¹æ³•å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚ç”±äºå¤šä¸ªçº¿ç¨‹å¯ä»¥åŸºäºä¸åŒæ¡ä»¶è°“è¯ç­‰å¾…ï¼Œä½¿ç”¨notifyå°†å¯¼è‡´<strong>ä¿¡å·åŠ«æŒé—®é¢˜</strong>ï¼šPBæˆçœŸï¼ŒåŒæ—¶çº¿ç¨‹Cæ‰§è¡Œnotifyæ“ä½œï¼Œå”¤é†’ç­‰å¾…PAçš„çº¿ç¨‹Aï¼ŒAå‘ç°PAä¸ºå‡ç»§ç»­ç­‰å¾…ï¼Œè€Œç­‰å¾…PBçš„çº¿ç¨‹Bæœ¬è¯¥æ‰§è¡Œä½†è¿˜æ˜¯ç­‰å¾…ã€‚å› æ­¤ï¼Œåªæœ‰<strong>åŒæ—¶æ»¡è¶³</strong>ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ‰èƒ½ä½¿ç”¨notifyè€Œä¸æ˜¯notifyAllï¼š</p><ol><li>æ‰€æœ‰ç­‰å¾…çº¿ç¨‹çš„ç±»å‹ç›¸åŒï¼šåªæœ‰ä¸€ä¸ªæ¡ä»¶è°“è¯ï¼Œæ‰§è¡Œæ“ä½œç›¸åŒ</li><li>å•è¿›å•å‡ºï¼šé€šçŸ¥æ¯æ¬¡æœ€å¤šå”¤èµ·ä¸€ä¸ªçº¿ç¨‹</li></ol><p>å¤§éƒ¨åˆ†ç±»ä¸æ»¡è¶³è¿™ä¸¤ç‚¹è¦æ±‚ï¼Œä¼˜å…ˆä½¿ç”¨notifyAllé€šçŸ¥å”¤é†’ä»¥ç¡®ä¿ç±»è¡Œä¸ºæ­£ç¡®ã€‚ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<strong>æ¡ä»¶é€šçŸ¥</strong>ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">alternatePut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">V</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">isFull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> wasEmpty </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">doPut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wasEmpty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">notifyAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>å•æ¬¡é€šçŸ¥å’Œæ¡ä»¶é€šçŸ¥å¯ä»¥ä¼˜åŒ–é€šçŸ¥æ€§èƒ½ï¼Œä½†æ˜¯è¦éµå®ˆâ€œå…ˆè®©ç¨‹åºæ­£ç¡®æ‰§è¡Œï¼Œå†è®©ç¨‹åºé«˜æ•ˆæ‰§è¡Œâ€çš„åŸåˆ™ä½¿ç”¨ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç¤ºä¾‹é˜€é—¨ç±»">ç¤ºä¾‹ï¼šé˜€é—¨ç±»<a class="hash-link" href="#ç¤ºä¾‹é˜€é—¨ç±»" title="Direct link to heading">â€‹</a></h3><p>åœ¨ç¬¬5ç« ä¸­çš„TestHarnessç±»ä¸­ä½¿ç”¨äºŒå…ƒé—­é”æ¥æ§åˆ¶çº¿ç¨‹å¼€å§‹æ‰§è¡Œçš„æ—¶åˆ»ï¼Œä½†é—­é”å­˜åœ¨ç¼ºé™·ï¼šå®ƒä»¬æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œé˜€é—¨æ‰“å¼€åå°±æ— æ³•å…³é—­ã€‚å¦‚ä¸‹ä»£ç é€šè¿‡æ¡ä»¶ç­‰å¾…å®ç°ä¸€ä¸ªå¯é‡æ–°å…³é—­çš„ThreadGateç±»ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ThreadGate</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// CONDITION-PREDICATE: opened-since(n) (isOpen || generation&gt;n)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> isOpen</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> generation</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isOpen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰“å¼€é˜€é—¨ï¼Œé€šçŸ¥æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">generation</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isOpen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">notifyAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// BLOCKS-UNTIL: opened-since(generation on entry)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">await</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> arrivalGeneration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> generation</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">isOpen </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> arrivalGeneration </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> generation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>åœ¨awaitæ–¹æ³•ä¸­çš„æ¡ä»¶è°“è¯ç¨å¾®å¤æ‚äº›ï¼šå¦‚æœåªæ£€æŸ¥isOpenï¼Œå½“é˜€é—¨å¿«é€Ÿå¼€å¯åˆå…³é—­æ—¶ï¼Œæ‰€æœ‰çº¿ç¨‹å¯èƒ½éƒ½æ— æ³•é‡Šæ”¾ã€‚é€šè¿‡generationè®¡æ•°å™¨æ£€æŸ¥ï¼Œæ¯å½“é˜€é—¨å¼€å¯ä¸€æ¬¡ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½èƒ½å¤Ÿé€šè¿‡awaitã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å­ç±»çš„å®‰å…¨é—®é¢˜">å­ç±»çš„å®‰å…¨é—®é¢˜<a class="hash-link" href="#å­ç±»çš„å®‰å…¨é—®é¢˜" title="Direct link to heading">â€‹</a></h3><p>å¯¹äºçŠ¶æ€ä¾èµ–ç±»ï¼Œè¦ä¹ˆå°†å…¶ç­‰å¾…å’Œé€šçŸ¥ç­‰åè®®å®Œå…¨å‘å­ç±»å…¬å¼€ï¼Œè¦ä¹ˆå®Œå…¨é˜»æ­¢å­ç±»å‚ä¸åˆ°ç­‰å¾…å’Œé€šçŸ¥è¿‡ç¨‹ã€‚å‰è€…è‡³å°‘éœ€è¦å…¬å¼€æ¡ä»¶é˜Ÿåˆ—å’Œé”ï¼Œå¹¶å°†æ¡ä»¶è°“è¯å’ŒåŒæ­¥ç­–ç•¥å†™å…¥æ–‡æ¡£ã€‚åè€…å¯ä»¥éšè—æ¡ä»¶é˜Ÿåˆ—ã€é”å’ŒçŠ¶æ€å˜é‡(å£°æ˜ä¸ºprivate)ï¼Œæˆ–è€…ç›´æ¥å°†ç±»å£°æ˜ä¸ºfinalã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å°è£…æ¡ä»¶é˜Ÿåˆ—">å°è£…æ¡ä»¶é˜Ÿåˆ—<a class="hash-link" href="#å°è£…æ¡ä»¶é˜Ÿåˆ—" title="Direct link to heading">â€‹</a></h3><p>é€šå¸¸éœ€è¦æŠŠæ¡ä»¶é˜Ÿåˆ—å°è£…èµ·æ¥ï¼Œå¦åˆ™è°ƒç”¨è€…ä¼šæ»¥ç”¨æ¡ä»¶é˜Ÿåˆ—ã€‚ç„¶è€Œè¿™ç§åšæ³•ä¸çº¿ç¨‹å®‰å…¨ç±»çš„è®¾è®¡æ¨¡å¼å†²çªï¼Œè¯¥æ¨¡å¼å»ºè®®ä½¿ç”¨å¯¹è±¡çš„å†…ç½®é”ä¿æŠ¤å¯¹è±¡è‡ªèº«çš„çŠ¶æ€ï¼Œä¾‹å¦‚BoundedBufferã€‚å¯ä»¥å°†BoundedBufferé‡æ–°è®¾è®¡ä¸ºä½¿ç”¨ç§æœ‰é”å¯¹è±¡å’Œæ¡ä»¶é˜Ÿåˆ—ï¼Œæ­¤æ—¶å®ƒä¸å†æ”¯æŒå®¢æˆ·ç«¯åŠ é”ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å…¥å£åè®®ä¸å‡ºå£åè®®">å…¥å£åè®®ä¸å‡ºå£åè®®<a class="hash-link" href="#å…¥å£åè®®ä¸å‡ºå£åè®®" title="Direct link to heading">â€‹</a></h3><p>å…¥å£åè®®å’Œå‡ºå£åè®®æ˜¯waitå’Œnotifyæ–¹æ³•æ­£ç¡®ä½¿ç”¨çš„è§„èŒƒã€‚å¯¹äºæ¯æ¬¡ä¾èµ–çŠ¶æ€çš„æ“ä½œï¼Œå…¥å£åè®®æ˜¯è¯¥æ“ä½œçš„æ¡ä»¶è°“è¯ï¼Œå‡ºå£åè®®åŒ…æ‹¬ï¼Œæ£€æŸ¥è¯¥æ“ä½œä¿®æ”¹çš„æ‰€æœ‰çŠ¶æ€å˜é‡ï¼Œç¡®è®¤å®ƒä»¬æ˜¯å¦æ”¹å˜å…¶ä»–æ¡ä»¶è°“è¯ï¼Œå¦‚æœæ˜¯åˆ™é€šçŸ¥ç›¸å…³æ¡ä»¶é˜Ÿåˆ—ã€‚åœ¨AbstractQueuedSynchronizerä¸­ä½¿ç”¨å‡ºå£åè®®ï¼Œè¯¥ç±»å¹¶ä¸æ˜¯ç”±åŒæ­¥å™¨è‡ªè¡Œæ‰§è¡Œé€šçŸ¥ï¼Œè€Œæ˜¯è¦æ±‚åŒæ­¥å™¨æ–¹æ³•è¿”å›ä¸€ä¸ªå€¼æ¥è¡¨ç¤ºè¯¥ç±»çš„æ“ä½œæ˜¯å¦è§£é™¤äº†ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹çš„é˜»å¡ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ˜¾å¼çš„conditionå¯¹è±¡">æ˜¾å¼çš„Conditionå¯¹è±¡<a class="hash-link" href="#æ˜¾å¼çš„conditionå¯¹è±¡" title="Direct link to heading">â€‹</a></h2><p>å†…ç½®æ¡ä»¶é˜Ÿåˆ—å­˜åœ¨ä¸€äº›ç¼ºé™·ï¼šæ¯ä¸ªå†…ç½®é”åªèƒ½æœ‰ä¸€ä¸ªç›¸å…³è”çš„æ¡ä»¶é˜Ÿåˆ—ã€‚å› æ­¤å¤šä¸ªçº¿ç¨‹å¯èƒ½åœ¨åŒä¸€ä¸ªæ¡ä»¶é˜Ÿåˆ—ä¸Šç­‰å¾…ä¸åŒçš„æ¡ä»¶è°“è¯ï¼Œå¹¶ä¸”å¸¸è§åŠ é”æ¨¡å¼ä¼šå…¬å¼€æ¡ä»¶é˜Ÿåˆ—ï¼Œè¿™äº›å› ç´ éƒ½æ— æ³•æ»¡è¶³ä½¿ç”¨notifyAllæ—¶æ‰€æœ‰ç­‰å¾…çº¿ç¨‹éƒ½æ˜¯åŒä¸€ç±»å‹çš„éœ€æ±‚ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨æ˜¾ç¤ºçš„Lockå’ŒConditionã€‚</p><p>æ­£å¦‚æ¡ä»¶é˜Ÿåˆ—å’Œå†…ç½®é”ç›¸å…³è”ï¼ŒConditionå’ŒLockå…³è”åœ¨ä¸€èµ·ï¼Œé€šè¿‡Lock.newConditionæ–¹æ³•å¾—åˆ°Conditionå¯¹è±¡ï¼Œå¹¶ä¸”æ¯æ¬¡Lockå¯ä»¥æ‹¥æœ‰ä»»æ„æ•°é‡çš„Coditionå¯¹è±¡ã€‚å¦‚ä¸‹æ‰€ç¤ºä»£ç é€šè¿‡ä¸¤ä¸ªConditionç»™å‡ºæœ‰ç•Œç¼“å­˜çš„å¦ä¸€ç§å®ç°ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ConditionBoundedBuffer</span><span class="token plain"> </span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">T</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Lock</span><span class="token plain"> lock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ReentrantLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// CONDITION PREDICATE: notFull (count &lt; items.length)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Condition</span><span class="token plain"> notFull </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newCondition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// CONDITION PREDICATE: notEmpty (count &gt; 0)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Condition</span><span class="token plain"> notEmpty </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newCondition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> BUFFER_SIZE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> items </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">BUFFER_SIZE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> tail</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> head</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// BLOCKS-UNTIL: notFull</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">T</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> items</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                notFull</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">await</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            items</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">tail</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">++</span><span class="token plain">tail </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> items</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                tail </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            notEmpty</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">signal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// BLOCKS-UNTIL: notEmpty</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">take</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                notEmpty</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">await</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">T</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> items</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">head</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            items</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">head</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">++</span><span class="token plain">head </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> items</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                head </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            notFull</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">signal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ä½¿ç”¨Lockå’ŒConditionæ—¶ä¹Ÿå¿…é¡»æ»¡è¶³é”ã€æ¡ä»¶è°“è¯å’Œæ¡ä»¶å˜é‡çš„ä¸‰å…ƒå…³ç³»ï¼Œå½“éœ€è¦ä½¿ç”¨å…¬å¹³çš„é˜Ÿåˆ—æ“ä½œæˆ–è€…æ¯ä¸ªé”å¯¹åº”å¤šä¸ªç­‰å¾…çº¿ç¨‹é˜Ÿåˆ—ç­‰é«˜çº§åŠŸèƒ½ï¼Œä¼˜å…ˆè€ƒè™‘Conditionè€Œä¸æ˜¯å†…ç½®æ¡ä»¶é˜Ÿåˆ—ã€‚</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>æ³¨æ„</h5></div><div class="admonition-content"><p>åœ¨Conditionå¯¹è±¡ä¸­ï¼Œä¸waitã€notifyå’ŒnotifyAllå¯¹åº”çš„æ–¹æ³•åˆ†åˆ«æ—¶awaitã€signalå’ŒsignalAllï¼ŒåŒæ—¶Conditionä¹Ÿç»§æ‰¿Objectï¼Œæ‰€ä»¥ä¹Ÿæœ‰waitç­‰æ–¹æ³•ï¼Œä½†æ˜¯è¦è°ƒç”¨æ­£ç¡®çš„awaitæ–¹æ³•ã€‚</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="synchronizerå‰–æ">Synchronizerå‰–æ<a class="hash-link" href="#synchronizerå‰–æ" title="Direct link to heading">â€‹</a></h2><p>ReentrantLockå’ŒSemaphoreä½œä¸ºåŒæ­¥å·¥å…·å­˜åœ¨è®¸å¤šå…±åŒç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºä»£ç ç”¨ReentrantLockå®ç°äº†Semaphoreï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">SemaphoreOnLock</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Lock</span><span class="token plain"> lock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ReentrantLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// CONDITION PREDICATE: permitsAvailable (permits &gt; 0)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Condition</span><span class="token plain"> permitsAvailable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newCondition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">permits</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">SemaphoreOnLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> initialPermits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">permits</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> initialPermits</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// BLOCKS-UNTIL: permitsAvailable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">acquire</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">permits</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                permitsAvailable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">await</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">--</span><span class="token keyword" style="color:#00009f">permits</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">release</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">++</span><span class="token keyword" style="color:#00009f">permits</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            permitsAvailable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">signal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>åä¹‹ä½¿ç”¨Semaphoreå®ç°ReentrantLockä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†å®é™…ä¸Šå®ƒä»¬éƒ½åŸºäºAbstractQueuedSynchronizer(AQS)ç±»å®ç°ï¼Œè¯¥ç±»ä¹Ÿæ˜¯JUCä¸‹å…¶ä»–åŒæ­¥å·¥å…·ç±»çš„å®ç°åŸºç¡€ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="abstractqueuedsynchronizer">AbstractQueuedSynchronizer<a class="hash-link" href="#abstractqueuedsynchronizer" title="Direct link to heading">â€‹</a></h2><p>å¼€å‘æ—¶ä¸ä¼šç›´æ¥ä½¿ç”¨AQSï¼Œå› ä¸ºæ ‡å‡†åŒæ­¥å·¥å…·ç±»èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†æƒ…å†µã€‚åŸºäºAQSçš„åŒæ­¥å·¥å…·ç±»ä¸­ï¼Œæœ€åŸºç¡€çš„æ˜¯å„ç§å½¢å¼çš„è·å–æ“ä½œå’Œé‡Šæ”¾æ“ä½œã€‚è·å–æ“ä½œæ—¶ä¸€ç§ä¾èµ–çŠ¶æ€çš„æ“ä½œï¼Œé€šå¸¸ä¼šé˜»å¡ï¼Œé‡Šæ”¾æ“ä½œä¸ä¼šé˜»å¡ï¼Œé‡Šæ”¾åæ‰€æœ‰è¯·æ±‚æ—¶è¢«é˜»å¡çš„çº¿ç¨‹éƒ½ä¼šå¼€å§‹æ‰§è¡Œï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">acquire</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">å½“å‰çŠ¶æ€ä¸å…è®¸è·å–æ“ä½œ</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">éœ€è¦é˜»å¡è·å–æ“ä½œ</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            å¦‚æœå½“å‰çº¿ç¨‹ä¸åœ¨é˜Ÿåˆ—ä¸­ï¼Œå°†å…¶åŠ å…¥é˜Ÿåˆ—</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            é˜»å¡å½“å‰çº¿ç¨‹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            è¿”å›</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å¯èƒ½æ›´æ–°åŒæ­¥å™¨çŠ¶æ€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    çº¿ç¨‹ä½äºé˜Ÿåˆ—ä¸­ï¼Œå°†å…¶ç§»é™¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    è¿”å›</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">release</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    æ›´æ–°åŒæ­¥å™¨çŠ¶æ€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">æ–°çŠ¶æ€å…è®¸æŸä¸ªè¢«é˜»å¡çš„çº¿ç¨‹è·å–æˆåŠŸ</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è§£é™¤é˜Ÿåˆ—ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹çš„é˜»å¡çŠ¶æ€</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>AQSç±»ç®¡ç†ä¸€ä¸ªæ•´æ•°ï¼Œç”¨äºè¡¨ç¤ºä»»æ„çŠ¶æ€ã€‚æ¯”å¦‚ReentrantLockç”¨å®ƒæ¥è¡¨ç¤ºæ‰€æœ‰è€…çº¿ç¨‹å·²ç»é‡å¤è·å–è¯¥é”çš„æ¬¡æ•°ï¼ŒSemaphoreç”¨å®ƒæ¥è¡¨ç¤ºå‰©ä½™çš„è®¸å¯æ•°é‡ï¼ŒFutureTaskç”¨å®ƒè¡¨ç¤ºä»»åŠ¡çŠ¶æ€(æœªå¼€å§‹ã€æ­£åœ¨è¿è¡Œã€å·²å®Œæˆå’Œå·²å–æ¶ˆ)ã€‚å¦‚ä¸‹æ‰€ç¤ºä»£ç ä½¿ç”¨AQSå®ç°ä¸€ä¸ªäºŒå…ƒé—­é”ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">OneShotLatch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Sync</span><span class="token plain"> sync </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Sync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">signal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sync</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">releaseShared</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">await</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sync</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">acquireSharedInterruptibly</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Sync</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">AbstractQueuedSynchronizer</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tryAcquireShared</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> ignored</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Succeed if latch is open (state == 1), else fail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tryReleaseShared</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> ignored</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Latch is now open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Other threads may now be able to acquire</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>oneSlotLatchä¹Ÿå¯ä»¥ä½¿ç”¨ç»§æ‰¿AQSçš„æ–¹å¼å®ç°ï¼Œä½†å¹¶ä¸æ¨èï¼Œå› ä¸ºå®ƒä¼šæš´éœ²AQSçš„å…¬å…±æ–¹æ³•ï¼Œè°ƒç”¨è€…å¯èƒ½ä¼šä½¿ç”¨è¿™äº›å…¬å…±æ–¹æ³•ç ´åé—­é”çŠ¶æ€ã€‚JUCä¸‹çš„å·¥å…·ç±»ä¹Ÿéƒ½æ²¡æœ‰ç›´æ¥æ‰©å±•AQSï¼Œè€Œæ˜¯å°†åŠŸèƒ½å§”æ‰˜ç»™ç§æœ‰çš„AQSå­ç±»ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="jucåŒæ­¥å™¨ç±»ä¸­çš„aqs">JUCåŒæ­¥å™¨ç±»ä¸­çš„AQS<a class="hash-link" href="#jucåŒæ­¥å™¨ç±»ä¸­çš„aqs" title="Direct link to heading">â€‹</a></h2><p>ç®€å•ä»‹ç»ReentrantLockã€Semaphoreã€CountDownLatchç­‰åŒæ­¥å™¨ç±»æ˜¯å¦‚ä½•ä½¿ç”¨AQS</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="reentrantlock">ReentrantLock<a class="hash-link" href="#reentrantlock" title="Direct link to heading">â€‹</a></h3><p>ReentrantLockåªæ”¯æŒç‹¬å æ–¹å¼çš„è·å–æ“ä½œï¼Œå› æ­¤å®ç°äº†tryAcquireã€tryReleaseå’ŒisHeldExclusivelyæ–¹æ³•ã€‚å¦‚ä¸‹ä»£ç æ˜¯éå…¬å¹³ç‰ˆæœ¬çš„tryAcquirefangfaæ–¹æ³•ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tryAcquire</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> ignored</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Thread</span><span class="token plain"> current </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentThread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ²¡æœ‰çº¿ç¨‹å æœ‰ï¼Œå°è¯•è·å–é”</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ä½¿ç”¨CASä¿®æ”¹çŠ¶æ€ï¼Œå¹¶è¿”å›æˆåŠŸ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">compareAndSetState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            owner </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> current</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å½“å‰çº¿ç¨‹å æœ‰ï¼ŒçŠ¶æ€è®¡æ•°å™¨åŠ 1ï¼Œè¿”å›æˆåŠŸ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> owner</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="semaphoreå’Œcountdownlatch">Semaphoreå’ŒCountDownLatch<a class="hash-link" href="#semaphoreå’Œcountdownlatch" title="Direct link to heading">â€‹</a></h3><p>Semaphoreå°†AQSä¸­çš„åŒæ­¥çŠ¶æ€ç”¨äºä¿å­˜å½“å‰å¯ç”¨è®¸å¯è¯çš„æ•°é‡ï¼Œå½“è®¸å¯è¯æ•°é‡remainingå°äº0è¿”å›è¯¥å€¼ï¼Œå¦åˆ™ä½¿ç”¨CASæ›´æ–°è®¸å¯è¯æ•°é‡ã€‚CountDownLatchä½¿ç”¨AQSçš„æ–¹å¼ä¸Semaphoreç›¸ä¼¼ï¼Œåªä¸è¿‡é€»è¾‘ç›¸åï¼šcountDownæ–¹æ³•è°ƒç”¨AQSçš„releaseæ–¹æ³•ï¼Œå¯¼è‡´è®¡æ•°å™¨é€’å‡ï¼Œawaitæ–¹æ³•è°ƒç”¨AQSçš„acquireæ–¹æ³•ï¼Œå½“è®¡æ•°å™¨ä¸ºé›¶æ—¶ç«‹å³è¿”å›ï¼Œå¦åˆ™é˜»å¡ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tryAcquireShared</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> acquires</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> available </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> remaining </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> available </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> acuqires</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å‰©ä½™æ•°é‡å°äº0ï¼Œç›´æ¥è¿”å›è¡¨ç¤ºè·å–å¤±è´¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å¦åˆ™å°è¯•ä¿®æ”¹state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">remaining </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">compareAndSetState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">available</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> remaining</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> remaining</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tryReleaseShared</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> releases</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// whileå¾ªç¯æ›´æ–°stateï¼Œå¢åŠ è®¸å¯è¯æ•°é‡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> p </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">compareAndSetState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="futuretask">FutureTask<a class="hash-link" href="#futuretask" title="Direct link to heading">â€‹</a></h3><p>FutureTaskçš„getæ–¹æ³•ç±»ä¼¼é—­é”ï¼šæŸä¸ªäº‹ä»¶(ä»»åŠ¡å®Œæˆæˆ–å–æ¶ˆ)å‘ç”Ÿæ—¶ï¼Œè°ƒç”¨è€…çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™å°†åœç•™åœ¨é˜Ÿåˆ—ä¸­ç›´åˆ°è¯¥äº‹ä»¶å‘ç”Ÿã€‚åœ¨FutureTaskä¸­ï¼ŒAQSçš„stateç”¨äºè¡¨ç¤ºä»»åŠ¡çŠ¶æ€ï¼Œæ­¤å¤–FutureTaskä¹Ÿè¦ç»´æŠ¤è®¡ç®—ä»»åŠ¡æŠ›å‡ºçš„å¼‚å¸¸æˆ–è€…ç»“æœã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="reentrantreadwritelock">ReentrantReadWriteLock<a class="hash-link" href="#reentrantreadwritelock" title="Direct link to heading">â€‹</a></h3><p>ReentrantReadWriteLockå¹¶æ²¡æœ‰ä½¿ç”¨ä¸¤ä¸ªAQSå¯¹è±¡æ¥å®ç°è¯»é”å’Œå†™é”ï¼Œè€Œæ˜¯ç”¨å•ä¸ªAQSå¯¹è±¡åŒæ—¶ç®¡ç†è¯»é”å’Œå†™é”ï¼šstateçš„16ä½è¡¨ç¤ºå†™é”çš„æŠ€æœ¯ï¼Œå¦å¤–16ä½è¡¨ç¤ºè¯»é”çš„è®¡æ•°ã€‚åœ¨è¯»é”ä¸Šä½¿ç”¨å…±äº«çš„è·å–å’Œé‡Šæ”¾æ–¹æ³•ï¼Œåœ¨å†™é”ä¸Šä½¿ç”¨ç‹¬å çš„è·å–å’Œé‡Šæ”¾æ–¹æ³•ã€‚</p><p>AQSåœ¨å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œè®°å½•è¯·æ±‚çº¿ç¨‹æ˜¯ç‹¬å è¿˜æ˜¯å…±äº«è®¿é—®ã€‚å½“é”å¯ç”¨æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—å¤´æ˜¯å†™å…¥çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœé˜Ÿåˆ—å¤´æ˜¯è¯»å–çº¿ç¨‹ï¼Œé˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªå†™çº¿ç¨‹ä¹‹å‰çš„è¯»çº¿ç¨‹éƒ½å°†ä¼šè·å¾—é”ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><ol><li>Lockç›¸æ¯”äºå†…ç½®é”å¯ä»¥æä¾›å…¬å¹³æ€§é€‰æ‹©(å…¬å¹³é”æ€§èƒ½å¼±äºéå…¬å¹³é”ï¼Œä¸€èˆ¬ç”¨ä¸ä¸Š)ï¼Œæä¾›ç­‰å¾…çº¿ç¨‹åˆ†ç±»ç®¡ç†(é€šè¿‡Condition)ç­‰æ‰©å±•åŠŸèƒ½</li><li>ä½¿ç”¨Conditionæ—¶æ³¨æ„ä¸è¦è°ƒç”¨Objectçš„waitã€notifyå’ŒnotifyAllæ–¹æ³•</li><li>å®ç°çŠ¶æ€ä¾èµ–ç±»çš„æœ€å¥½æ–¹å¼æ˜¯ä½¿ç”¨ç°æœ‰åº“ä¸­çš„åŒæ­¥å·¥å…·ç±»ï¼Œå¦‚æœåŠŸèƒ½è¿˜ä¸èƒ½æ»¡è¶³ä½¿ç”¨AQSæ¥æ„å»ºè‡ªå®šä¹‰åŒæ­¥å™¨</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/docs/tags/java-concurrency">Java Concurrency</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/docs/tags/reading-notes">ReadingNotes</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kayhaw/kayhaw.github.io/edit/master/website/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap14.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap13"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">æ˜¾å¼é”</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap15"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">åŸå­å˜é‡ä¸éé˜»å¡åŒæ­¥æœºåˆ¶</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#çŠ¶æ€ä¾èµ–æ€§çš„ç®¡ç†" class="table-of-contents__link toc-highlight">çŠ¶æ€ä¾èµ–æ€§çš„ç®¡ç†</a><ul><li><a href="#ç¤ºä¾‹å°†å‰ææ¡ä»¶çš„å¤±è´¥ä¼ é€’ç»™è°ƒç”¨è€…" class="table-of-contents__link toc-highlight">ç¤ºä¾‹ï¼šå°†å‰ææ¡ä»¶çš„å¤±è´¥ä¼ é€’ç»™è°ƒç”¨è€…</a></li><li><a href="#ç¤ºä¾‹é€šè¿‡è½®è¯¢ä¸ä¼‘çœ æ¥å®ç°ç®€å•çš„é˜»å¡" class="table-of-contents__link toc-highlight">ç¤ºä¾‹ï¼šé€šè¿‡è½®è¯¢ä¸ä¼‘çœ æ¥å®ç°ç®€å•çš„é˜»å¡</a></li><li><a href="#æ¡ä»¶é˜Ÿåˆ—" class="table-of-contents__link toc-highlight">æ¡ä»¶é˜Ÿåˆ—</a></li></ul></li><li><a href="#ä½¿ç”¨æ¡ä»¶é˜Ÿåˆ—" class="table-of-contents__link toc-highlight">ä½¿ç”¨æ¡ä»¶é˜Ÿåˆ—</a><ul><li><a href="#æ¡ä»¶è°“è¯" class="table-of-contents__link toc-highlight">æ¡ä»¶è°“è¯</a></li><li><a href="#è¿‡æ—©å”¤é†’" class="table-of-contents__link toc-highlight">è¿‡æ—©å”¤é†’</a></li><li><a href="#ä¿¡å·ä¸¢å¤±" class="table-of-contents__link toc-highlight">ä¿¡å·ä¸¢å¤±</a></li><li><a href="#é€šçŸ¥" class="table-of-contents__link toc-highlight">é€šçŸ¥</a></li><li><a href="#ç¤ºä¾‹é˜€é—¨ç±»" class="table-of-contents__link toc-highlight">ç¤ºä¾‹ï¼šé˜€é—¨ç±»</a></li><li><a href="#å­ç±»çš„å®‰å…¨é—®é¢˜" class="table-of-contents__link toc-highlight">å­ç±»çš„å®‰å…¨é—®é¢˜</a></li><li><a href="#å°è£…æ¡ä»¶é˜Ÿåˆ—" class="table-of-contents__link toc-highlight">å°è£…æ¡ä»¶é˜Ÿåˆ—</a></li><li><a href="#å…¥å£åè®®ä¸å‡ºå£åè®®" class="table-of-contents__link toc-highlight">å…¥å£åè®®ä¸å‡ºå£åè®®</a></li></ul></li><li><a href="#æ˜¾å¼çš„conditionå¯¹è±¡" class="table-of-contents__link toc-highlight">æ˜¾å¼çš„Conditionå¯¹è±¡</a></li><li><a href="#synchronizerå‰–æ" class="table-of-contents__link toc-highlight">Synchronizerå‰–æ</a></li><li><a href="#abstractqueuedsynchronizer" class="table-of-contents__link toc-highlight">AbstractQueuedSynchronizer</a></li><li><a href="#jucåŒæ­¥å™¨ç±»ä¸­çš„aqs" class="table-of-contents__link toc-highlight">JUCåŒæ­¥å™¨ç±»ä¸­çš„AQS</a><ul><li><a href="#reentrantlock" class="table-of-contents__link toc-highlight">ReentrantLock</a></li><li><a href="#semaphoreå’Œcountdownlatch" class="table-of-contents__link toc-highlight">Semaphoreå’ŒCountDownLatch</a></li><li><a href="#futuretask" class="table-of-contents__link toc-highlight">FutureTask</a></li><li><a href="#reentrantreadwritelock" class="table-of-contents__link toc-highlight">ReentrantReadWriteLock</a></li></ul></li><li><a href="#æ€»ç»“" class="table-of-contents__link toc-highlight">æ€»ç»“</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">è¯»ä¹¦ç¬”è®°</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.zhihu.com/people/xiao-ke-dou-7" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>çŸ¥ä¹<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitee.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 ä½•è½²(Kay Haw). Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b8f66f99.js"></script>
<script src="/assets/js/main.a8d1eeac.js"></script>
</body>
</html>