<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kay Haw&#39;s Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kay Haw&#39;s Blog Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">çº¿ç¨‹æ± çš„ä½¿ç”¨ | Kay Haw&#x27;s Blog</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://kayhaw.github.io/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap08"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="çº¿ç¨‹æ± çš„ä½¿ç”¨ | Kay Haw&#x27;s Blog"><meta data-react-helmet="true" name="description" content="ã€ŠJavaå¹¶å‘ç¼–ç¨‹ã€‹ç¬¬å…«ç« è¯»ä¹¦ç¬”è®°"><meta data-react-helmet="true" property="og:description" content="ã€ŠJavaå¹¶å‘ç¼–ç¨‹ã€‹ç¬¬å…«ç« è¯»ä¹¦ç¬”è®°"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://kayhaw.github.io/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap08"><link data-react-helmet="true" rel="alternate" href="https://kayhaw.github.io/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap08" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://kayhaw.github.io/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap08" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.0138175c.css">
<link rel="preload" href="/assets/js/runtime~main.7de17fe8.js" as="script">
<link rel="preload" href="/assets/js/main.00935a8a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Kay Haw&#x27;s Blog</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">è¯»ä¹¦ç¬”è®°</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/intro">è¯»ä¹¦ç¬”è®°</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">C++PrimerPlus</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">EffectiveC++</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Learning Akka</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap02">çº¿ç¨‹å®‰å…¨æ€§</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap03">å¯¹è±¡çš„å…±äº«</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap04">å¯¹è±¡çš„ç»„åˆ</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap05">åŸºç¡€æ„å»ºæ¨¡å—</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap06">ä»»åŠ¡æ‰§è¡Œ</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap07">å–æ¶ˆä¸å…³é—­</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap08">çº¿ç¨‹æ± çš„ä½¿ç”¨</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap10">é¿å…æ´»è·ƒæ€§å±é™©</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap13">æ˜¾å¼é”</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">é«˜æ€§èƒ½MySQL</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>çº¿ç¨‹æ± çš„ä½¿ç”¨</h1></header><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>ã€ŠJavaå¹¶å‘ç¼–ç¨‹ã€‹ç¬¬å…«ç« è¯»ä¹¦ç¬”è®°</p></div></div><p>ä»‹ç»çº¿ç¨‹æ± é…ç½®å’Œè°ƒä¼˜çš„é«˜çº§é€‰é¡¹ï¼Œä»¥åŠä½¿ç”¨æ—¶éœ€è¦æ³¨æ„çš„åœ°æ–¹</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="åœ¨ä»»åŠ¡ä¸æ‰§è¡Œç­–ç•¥ä¹‹é—´çš„éšæ€§è€¦åˆ"></a>åœ¨ä»»åŠ¡ä¸æ‰§è¡Œç­–ç•¥ä¹‹é—´çš„éšæ€§è€¦åˆ<a class="hash-link" href="#åœ¨ä»»åŠ¡ä¸æ‰§è¡Œç­–ç•¥ä¹‹é—´çš„éšæ€§è€¦åˆ" title="Direct link to heading">#</a></h2><p>Executoræ¡†æ¶å°†ä»»åŠ¡çš„æäº¤ä¸æ‰§è¡Œç­–ç•¥è§£è€¦ï¼Œä½†æ˜¯å¹¶éæ‰€æœ‰ä»»åŠ¡éƒ½èƒ½é€‚ç”¨æ‰€æœ‰çš„æ‰§è¡Œç­–ç•¥ï¼Œä»¥ä¸‹ç±»å‹ä»»åŠ¡éœ€è¦æ˜ç¡®åœ°æŒ‡å®šæ‰§è¡Œç­–ç•¥ï¼š</p><ul><li>ä¾èµ–æ€§ä»»åŠ¡ï¼šå½“æäº¤ä»»åŠ¡ä¾èµ–å…¶ä»–ä»»åŠ¡æ—¶ï¼Œç»™æ‰§è¡Œç­–ç•¥å¸¦æ¥äº†éšå«çš„é™åˆ¶</li><li>ä½¿ç”¨çº¿ç¨‹å°é—­çš„ä»»åŠ¡ï¼šä½¿ç”¨çº¿ç¨‹å°é—­çš„ä»»åŠ¡è¦æ±‚Executoræ˜¯å•çº¿ç¨‹ï¼Œå¦åˆ™ä¼šå¤±å»çº¿ç¨‹å®‰å…¨æ€§</li><li>å“åº”æ—¶é—´æ•æ„Ÿçš„ä»»åŠ¡ï¼šå¦‚GUIç¨‹åº</li><li>ä½¿ç”¨ThreadLocalçš„ä»»åŠ¡ï¼šåªæœ‰å½“çº¿ç¨‹æœ¬åœ°å€¼ç”Ÿå‘½å‘¨æœŸå—é™äºä»»åŠ¡ç”Ÿå‘½å‘¨æœŸï¼Œä½¿ç”¨ThreadLocalæ‰æœ‰æ„ä¹‰ï¼Œè€Œåœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸ç¬¦åˆè¿™ç‚¹</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="çº¿ç¨‹é¥¥é¥¿æ­»é”"></a>çº¿ç¨‹é¥¥é¥¿æ­»é”<a class="hash-link" href="#çº¿ç¨‹é¥¥é¥¿æ­»é”" title="Direct link to heading">#</a></h3><p>å½“çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡éœ€è¦æ— é™æœŸåœ°ç­‰å¾…æ± ä¸­å…¶ä»–ç­‰å¾…ä»»åŠ¡æä¾›çš„èµ„æºæ—¶ï¼Œå°†å‘ç”Ÿçº¿ç¨‹é¥¥é¥¿æ­»é”(Thread Starvation Deadlock)ï¼Œå¦‚ä¸‹æ‰€ç¤ºä»£ç æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public class ThreadDeadlock {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ExecutorService exec = Executors.newSingleThreadExecutor();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class RenderPageTask implements Callable&lt;String&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public String call() throws Exception {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            Future&lt;String&gt; header, footer;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            header = exec.submit(new LoadFileTask(&quot;header.html&quot;));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            footer = exec.submit(new LoadFileTask(&quot;footer.html&quot;));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            String page = renderBody();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Will deadlock -- task waiting for result of subtask</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return header.get() + page + footer.get();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å½“ä½¿ç”¨å•çº¿ç¨‹çš„Executorä¼šå¯¼è‡´ThreadDeadlockå‘ç”Ÿæ­»é”ï¼Œç±»ä¼¼åœ°ï¼Œå½“çº¿ç¨‹æ± ä¸å¤Ÿå¤§ï¼Œé€šè¿‡æ …æ æœºåˆ¶ååŒçš„ä»»åŠ¡ä¹Ÿä¼šå‡ºç°æ­»é”ã€‚é™¤äº†æ˜¾å¼çš„çº¿ç¨‹æ± å¤§å°å¯¼è‡´æ­»é”ï¼Œè¿˜å¯èƒ½å­˜åœ¨å…¶ä»–èµ„æºçº¦æŸéšå¼åœ°å¯¼è‡´æ­»é”ï¼Œæ¯”å…¥JDBCè¿æ¥æ± å€¼åŒ…å«10ä¸ªè¿æ¥ï¼Œæ­¤æ—¶çº¿ç¨‹æ± å¤§å°ä¹Ÿè¡¨ç°å¾—é™äº10ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹éœ€è¦è·å¾—JDBCè¿æ¥ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="è¿è¡Œæ—¶é—´è¾ƒé•¿çš„ä»»åŠ¡"></a>è¿è¡Œæ—¶é—´è¾ƒé•¿çš„ä»»åŠ¡<a class="hash-link" href="#è¿è¡Œæ—¶é—´è¾ƒé•¿çš„ä»»åŠ¡" title="Direct link to heading">#</a></h3><p>å¦‚æœçº¿ç¨‹æ± å¤§å°è¿œå°äºåœ¨ç¨³å®šçŠ¶æ€ä¸‹æ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„ä»»åŠ¡æ•°é‡ï¼Œæœ€åå¯èƒ½æ‰€æœ‰çº¿ç¨‹éƒ½è¿è¡Œè¿™äº›è€—æ—¶é•¿çš„ä»»åŠ¡ï¼Œå½±å“æ€»ä½“çš„å“åº”æ€§ã€‚ä¸€ç§ç¼“è§£æ–¹å¼æ˜¯é™å®šç­‰å¾…èµ„æºçš„æ—¶é—´ï¼Œç­‰å¾…è¶…æ—¶åå¯ä»¥ç»ˆæ­¢ä»»åŠ¡æˆ–è€…é‡æ–°æ”¾å›é˜Ÿåˆ—ã€‚å½“çº¿ç¨‹æ± æ€»æ˜¯å……æ»¡è¢«é˜»å¡çš„çº¿ç¨‹æ—¶ï¼Œä¹Ÿå¯èƒ½æ˜¯çº¿ç¨‹æ± è§„æ¨¡è¿‡å°ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="è®¾ç½®çº¿ç¨‹æ± "></a>è®¾ç½®çº¿ç¨‹æ± <a class="hash-link" href="#è®¾ç½®çº¿ç¨‹æ± " title="Direct link to heading">#</a></h2><p>çº¿ç¨‹æ± å¤§å°ä¸èƒ½åœ¨ä»£ç ä¸­å›ºå®šï¼Œåº”è¯¥ç”±é…ç½®æœºåˆ¶æ¥æä¾›ï¼Œæˆ–è€…æ ¹æ®CPUæ•°é‡æ¥åŠ¨æ€è®¡ç®—ã€‚å¯¹äºè®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œé€šå¸¸è®¾ç½®çº¿ç¨‹æ± å¤§å°ä¸º<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mrow><mi>c</mi><mi>p</mi><mi>u</mi></mrow></msub><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">N_{cpu}+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span></span></span></span></span>ï¼Œå¯¹äºIOå¯†é›†å‹ä»»åŠ¡ï¼Œç»™å‡ºå¦‚ä¸‹å®šä¹‰ï¼š</p><ul><li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mrow><mi>c</mi><mi>p</mi><mi>u</mi></mrow></msub></mrow><annotation encoding="application/x-tex">N_{cpu}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span></span></span></span></span>ï¼šCPUæ•°é‡</li><li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mrow><mi>c</mi><mi>p</mi><mi>u</mi></mrow></msub></mrow><annotation encoding="application/x-tex">U_{cpu}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span></span></span></span></span>ï¼šç›®æ ‡CPUåˆ©ç”¨ç‡</li><li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>W</mi><mi>C</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{W}{C}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em">C</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em">W</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>ï¼šç­‰å¾…æ—¶é—´/è®¡ç®—æ—¶é—´</li></ul><p>è¦è¾¾åˆ°ç›®æ ‡åˆ©ç”¨ç‡ï¼Œçº¿ç¨‹æ± çš„å¤§å°åº”è®¾ç½®ä¸ºï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mrow><mi>t</mi><mi>h</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></mrow></msub><mo>=</mo><msub><mi>N</mi><mrow><mi>c</mi><mi>p</mi><mi>u</mi></mrow></msub><mo>âˆ—</mo><msub><mi>U</mi><mrow><mi>c</mi><mi>p</mi><mi>u</mi></mrow></msub><mo>âˆ—</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mfrac><mi>W</mi><mi>C</mi></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N_{threads}=N_{cpu}*U_{cpu}*(1+\frac{W}{C})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight" style="margin-right:0.02778em">r</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em">C</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em">W</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span>ï¼Œå…¶ä¸­CPUæ•°é‡å¯ä»¥é€šè¿‡<code>Runtime.getRuntime().availableProcessors()</code>å¾—åˆ°ã€‚CPUå‘¨æœŸå¹¶ä¸å½±å“çº¿ç¨‹æ± å¤§å°çš„å”¯ä¸€å› ç´ ï¼Œä¾‹å¦‚ä¸ŠèŠ‚æåˆ°çš„JDBè¿æ¥æ± ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="é…ç½®threadpoolexecutor"></a>é…ç½®ThreadPoolExecutor<a class="hash-link" href="#é…ç½®threadpoolexecutor" title="Direct link to heading">#</a></h2><p>ThreadPoolExecutoræ„é€ å™¨æä¾›äº†7ä¸ªå‚æ•°ï¼Œé€šè¿‡è¿™äº›å‚æ•°æ¥å®šåˆ¶åŒ–ThreadPoolExecutorï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public ThreadPoolExecutor(int corePoolSize,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                          int maximumPoolSize,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                          long keepAliveTime,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                          TimeUnit unit,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                          ThreadFactory threadFactory,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                          RejectedExecutionHandler handler)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="çº¿ç¨‹çš„åˆ›å»ºä¸é”€æ¯"></a>çº¿ç¨‹çš„åˆ›å»ºä¸é”€æ¯<a class="hash-link" href="#çº¿ç¨‹çš„åˆ›å»ºä¸é”€æ¯" title="Direct link to heading">#</a></h3><p>åŸºæœ¬å¤§å°(corePoolSize)æ˜¯çº¿ç¨‹æ± åœ¨æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶çš„å¤§å°ï¼Œæœ€å¤§å¤§å°(maximumPoolSize)æ˜¯åŒæ—¶æ´»åŠ¨çº¿ç¨‹æ•°é‡çš„ä¸Šé™ã€‚å¦‚æœæŸä¸ªçº¿ç¨‹çš„ç©ºé—²æ—¶é—´è¶…è¿‡keepAliveTimeï¼Œå®ƒå°†è¢«æ ‡è®°ä¸ºå¯å›æ”¶çš„ï¼Œå¹¶ä¸”çº¿ç¨‹å¤§å°è¶…è¿‡åŸºæœ¬å¤§å°æ—¶ï¼Œçº¿ç¨‹å°†ä¼šè¢«ç»ˆæ­¢ã€‚çº¿ç¨‹æ± å„ä¸ªå·¥å‚æ–¹æ³•é…ç½®çš„ç­–ç•¥ï¼š</p><ul><li>newFixedThreadPoolï¼šåŸºæœ¬å¤§å°=æœ€å¤§å¤§å°=ä¼ å…¥å‚æ•°å€¼ï¼ŒkeepAliveTime=0ï¼Œæ— ç•Œé˜Ÿåˆ—</li><li>newCachedThreadPoolï¼šåŸºæœ¬å¤§å°=0ï¼Œæœ€å¤§å¤§å°=Integer.MAX_VALUEï¼Œè¶…æ—¶æ—¶é—´=60sï¼ŒSynchronousQueue</li><li>newSingleThreadPoolï¼šåŸºæœ¬å¤§å°=æœ€å¤§å¤§å°=1ï¼ŒkeepAliveTime=0ï¼Œæ— ç•Œé˜Ÿåˆ—</li><li>newScheduledThreadPoolï¼šåŸºæœ¬å¤§å°=ç»™å®šå€¼ï¼Œæœ€å¤§å¤§å°=Integer.MAX_VALUEï¼ŒkeepAliveTime=0ï¼ŒDelayedWorkQueue</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ç®¡ç†é˜Ÿåˆ—ä»»åŠ¡"></a>ç®¡ç†é˜Ÿåˆ—ä»»åŠ¡<a class="hash-link" href="#ç®¡ç†é˜Ÿåˆ—ä»»åŠ¡" title="Direct link to heading">#</a></h3><p>çº¿ç¨‹æ± é€šè¿‡é˜»å¡é˜Ÿåˆ—workQueueä¿å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¯åˆ†ä¸º3ç±»ï¼šæ— ç•Œé˜Ÿåˆ—ã€æœ‰ç•Œé˜Ÿåˆ—å’ŒåŒæ­¥ç§»äº¤(synchronous handoff)ã€‚newFixedThreadPoolå’ŒnewSingleThreadExecutoré»˜è®¤ä½¿ç”¨å¤§å°ä¸ºInteger.MAX_VALUEçš„LinkedBlockingQueue(æ— ç•Œé˜Ÿåˆ—)ï¼Œä¸ºäº†é¿å…èµ„æºè€—å°½ï¼Œåº”è¯¥ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—(ArrayBlockingQueueã€æœ‰ç•ŒLinkedBlockingQueueã€PriorityBlockingQueue)ï¼Œå¹¶ä¸”æ³¨æ„é˜Ÿåˆ—å¤§å°å’Œçº¿ç¨‹æ± å¤§å°åŒæ—¶è°ƒèŠ‚ã€‚</p><p>å¯¹äºéå¸¸å¤§æˆ–è€…æ— ç•Œçš„çº¿ç¨‹æ± ï¼Œä½¿ç”¨SynchronousQueueæ¥é¿å…ä»»åŠ¡æ’é˜Ÿï¼Œå®ƒå¹¶ä¸æ˜¯çœŸæ­£çš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯ä¸€ç§åœ¨çº¿ç¨‹ä¹‹é—´ç§»äº¤çš„æœºåˆ¶ã€‚åªæœ‰å½“çº¿ç¨‹æ± æ˜¯æ— ç•Œçš„æˆ–è€…å¯ä»¥æ‹’ç»ä»»åŠ¡æ—¶ï¼ŒSynchronousQueueæ‰æœ‰ä»·å€¼ï¼Œåœ¨newCachedThreadPoolå°±ä½¿ç”¨åˆ°äº†å®ƒã€‚</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>åªæœ‰å½“çº¿ç¨‹äº’ç›¸ç‹¬ç«‹æ—¶ï¼Œä¸ºçº¿ç¨‹æ± æˆ–å·¥ä½œé˜Ÿåˆ—è®¾ç½®ç•Œé™æ‰æ˜¯åˆç†çš„ï¼Œå¦åˆ™ä¼šå‡ºç°çº¿ç¨‹é¥¥é¥¿æ­»é”é—®é¢˜</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="é¥±å’Œç­–ç•¥"></a>é¥±å’Œç­–ç•¥<a class="hash-link" href="#é¥±å’Œç­–ç•¥" title="Direct link to heading">#</a></h3><p>å½“æœ‰ç•Œé˜Ÿåˆ—è¢«å¡«æ»¡åï¼Œç”±é¥±å’Œç­–ç•¥handleræ¥å¤„ç†æäº¤çº¿ç¨‹ã€‚Javaç±»åº“å®ç°çš„é¥±å’Œç­–ç•¥æœ‰ï¼š</p><ol><li>AbortPolicyï¼šæ‹’ç»ä»»åŠ¡ï¼ŒæŠ›å‡ºæœªæ£€æŸ¥çš„RejectedException</li><li>DiscardPolicyï¼šæ‚„å’ªå’ªåœ°æŠ›å¼ƒä»»åŠ¡</li><li>DiscardOldestPolicyï¼šæŠ›å¼ƒä¸‹ä¸€ä¸ªå°†è¢«æ‰§è¡Œä»»åŠ¡ï¼Œç„¶åé‡æ–°æäº¤æ–°ä»»åŠ¡ï¼Œé¿å…å’Œä¼˜å…ˆçº§é˜Ÿåˆ—ä¸€åŒä½¿ç”¨</li><li>CallerRunsPolicyï¼šå°†ä»»åŠ¡å›é€€ç»™è°ƒç”¨è€…</li></ol><p>é™¤äº†ä½¿ç”¨ç°æœ‰çš„é¥±å’Œç­–ç•¥å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡Semaphoreæ¥é™åˆ¶ä»»åŠ¡çš„æäº¤ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public class BoundedExecutor {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final Executor exec;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final Semaphore semaphore;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BoundedExecutor(Executor exec, int bound) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.exec = exec;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.semaphore = new Semaphore(bound);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void submitTask(final Runnable command)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            throws InterruptedException {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        semaphore.acquire();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            exec.execute(new Runnable() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                public void run() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    try {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        command.run();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    } finally {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        semaphore.release();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (RejectedExecutionException e) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            semaphore.release();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>BoundExecutorä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼Œå¹¶è®¾ç½®ä¿¡å·é‡ä¸Šç•Œä¸ºçº¿ç¨‹æ± å¤§å°åŠ ä¸Šå¯æ’é˜Ÿä»»åŠ¡æ•°é‡ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="çº¿ç¨‹å·¥å‚"></a>çº¿ç¨‹å·¥å‚<a class="hash-link" href="#çº¿ç¨‹å·¥å‚" title="Direct link to heading">#</a></h3><p>çº¿ç¨‹æ± é€šè¿‡çº¿ç¨‹å·¥å‚æ¥åˆ›å»ºçº¿ç¨‹ï¼ŒExecutorsæŒ‡å®šçš„DefaultThreadFactoryå®ç°äº†ThreadFactoryæ¥å£ï¼Œå®ƒè¿”å›ä¸€ä¸ªæ–°çš„éå®ˆæŠ¤çº¿ç¨‹ï¼Œå¹¶æ²¡æœ‰åŒ…å«å…¶ä»–ç‰¹æ®Šé…ç½®ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// çº¿ç¨‹å·¥å‚æ¥å£å®šä¹‰</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface ThreadFactory {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Thread newThread(Runnable r);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// Executorsçš„é™æ€å†…éƒ¨ç±»DefaultThreadFactory</span></span><span class="token-line" style="color:#393A34"><span class="token plain">static class DefaultThreadFactory implements ThreadFactory {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final AtomicInteger poolNumber = new AtomicInteger(1);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final ThreadGroup group;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final AtomicInteger threadNumber = new AtomicInteger(1);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final String namePrefix;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    DefaultThreadFactory() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        SecurityManager s = System.getSecurityManager();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        group = (s != null) ? s.getThreadGroup() :</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                Thread.currentThread().getThreadGroup();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        namePrefix = &quot;pool-&quot; +</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        poolNumber.getAndIncrement() +</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;-thread-&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Thread newThread(Runnable r) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        Thread t = new Thread(group, r,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                namePrefix + threadNumber.getAndIncrement(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                0);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (t.isDaemon())</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            t.setDaemon(false);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (t.getPriority() != Thread.NORM_PRIORITY)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            t.setPriority(Thread.NORM_PRIORITY);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return t;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>åœ¨è®¸å¤šæƒ…å†µä¸‹éœ€è¦å®šåˆ¶çº¿ç¨‹å·¥å‚ï¼Œæ¯”å¦‚ï¼šå®šåˆ¶UncaughtExceptionHandlerã€è®¾ç½®ä¼˜å…ˆçº§ã€è®¾ç½®çº¿ç¨‹åç§°ç­‰ã€‚å¦‚ä¸‹æ‰€ç¤ºä»£ç ç»™å‡ºäº†ä¸€ä¸ªç¤ºä¾‹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public class MyThreadFactory implements ThreadFactory {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final String poolName;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public MyThreadFactory(String poolName) { this.poolName = poolName; }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Thread newThread(Runnable runnable) { return new MyAppThread(runnable, poolName);}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MyAppThread extends Thread {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String DEFAULT_NAME = &quot;MyAppThread&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static volatile boolean debugLifecycle = false;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final AtomicInteger created = new AtomicInteger();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final AtomicInteger alive = new AtomicInteger();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Logger log = Logger.getAnonymousLogger();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public MyAppThread(Runnable r) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        this(r, DEFAULT_NAME);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public MyAppThread(Runnable runnable, String name) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        super(runnable, name + &quot;-&quot; + created.incrementAndGet());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        setUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            public void uncaughtException(Thread t, Throwable e) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                log.log(Level.SEVERE, &quot;UNCAUGHT in thread &quot; + t.getName(), e);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void run() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Copy debug flag to ensure consistent value throughout.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean debug = debugLifecycle;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (debug) log.log(Level.FINE, &quot;Created &quot; + getName());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            alive.incrementAndGet();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            super.run();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        } finally {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            alive.decrementAndGet();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (debug) log.log(Level.FINE, &quot;Exiting &quot; + getName());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... ä¸€äº›getterå’Œsetter</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>MyAppThreadå¯ä»¥å®šåˆ¶çº¿ç¨‹åç§°ä¾¿äºåŒºåˆ†ï¼Œç»´æŠ¤åˆ›å»ºçº¿ç¨‹ã€å­˜æ´»çº¿ç¨‹ä¸ªæ•°ç­‰ç»Ÿè®¡ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œè‹¥éœ€è¦åˆ©ç”¨å®‰å…¨ç­–ç•¥æ§åˆ¶å¯¹ä»£ç åº“çš„è®¿é—®æƒé™ï¼Œè¿˜å¯ä»¥é€šè¿‡Executorsçš„PrivilegedThreadFactoryæ¥å®šåˆ¶çº¿ç¨‹å·¥å‚ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="æ„é€ åå®šåˆ¶threadpoolexecutor"></a>æ„é€ åå®šåˆ¶ThreadPoolExecutor<a class="hash-link" href="#æ„é€ åå®šåˆ¶threadpoolexecutor" title="Direct link to heading">#</a></h3><p>åœ¨è°ƒç”¨å®ŒThreadPoolExecutoræ„é€ å‡½æ•°åï¼Œä»å¯ä»¥é€šè¿‡setterä¿®æ”¹æ„é€ å‚æ•°å€¼ã€‚é™¤äº†newSingleThreadExecutorå¤–ï¼ŒExecutorsçš„å…¶ä»–å·¥å‚æ–¹æ³•éƒ½å¯ä»¥å°†è¿”å›å¯¹è±¡è½¬ä¸ºThreadPoolExecutoræ¥ä¿®æ”¹é…ç½®ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ExecutorService exec = Executors.newCachedThreadPool();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">if(exec instanceof ThreadPoolExecutor)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ((ThreadPoolExecutor) exec).setCorePoolSize(10);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw new AssertionError(&quot;Oops, bad assumption&quot;);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Executorsè¿˜æä¾›é™æ€æ–¹æ³•unconfigurableExecutorServiceï¼Œå°†ExecutorServiceåŒ…è£…æˆä¸å¯ä¿®æ”¹é…ç½®çš„DelegatedExecutorServiceã€‚ç”±äºnewSingleThreadExecutorè¿”å›çš„DelegatedScheduledExecutorServiceå¯¹è±¡ç»§æ‰¿äºDelegatedExecutorServiceï¼Œå› æ­¤å®ƒæ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="æ‰©å±•threadpoolexecutor"></a>æ‰©å±•ThreadPoolExecutor<a class="hash-link" href="#æ‰©å±•threadpoolexecutor" title="Direct link to heading">#</a></h2><p>ThreadPoolExecutorçš„æ‰©å±•é€šè¿‡åœ¨å­ç±»é‡å†™beforeExecuteã€afterExecuteå’Œterminatedå®ç°ã€‚å¦‚æœä»»åŠ¡æ‰§è¡Œå®Œæˆæˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼ŒafterExecuteä»ä¼šæ‰§è¡Œ(ä»»åŠ¡æŠ›å‡ºé”™è¯¯é™¤å¤–)ï¼Œå½“beforeExecuteæ‰§è¡ŒæŠ›å‡ºRuntimeExceptionï¼Œåˆ™ä»»åŠ¡å’ŒafterExecuteéƒ½ä¸ä¼šæ‰§è¡Œã€‚çº¿ç¨‹æ± å®Œæˆå…³é—­åè°ƒç”¨terminatedæ–¹æ³•ï¼Œå³æ‰€æœ‰ä»»åŠ¡å®Œæˆå¹¶ä¸”å·¥ä½œçº¿ç¨‹å·²ç»å…³é—­åï¼Œterminatedæ–¹æ³•å¯ä»¥ç”¨äºé‡Šæ”¾Executorä¸­åˆ†é…çš„èµ„æºã€‚</p><p>å¦‚ä¸‹æ‰€ç¤ºä»£ç é€šè¿‡è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œæ·»åŠ æ—¥å¿—è®°å½•å’Œç»Ÿè®¡ä¿¡æ¯æ”¶é›†ã€‚beforeExecuteæ–¹æ³•å°†ä»»åŠ¡å¼€å§‹æ—¶é—´ä¿å­˜åœ¨ThreadLocalä¸­ï¼Œç”±afterExecuteæ–¹æ³•è¯»å–æ¥è®¡ç®—ä»»åŠ¡è¿è¡Œæ—¶é—´ï¼Œå¹¶é€šè¿‡AtomicLongæ¥ç»Ÿè®¡å·²å¤„ç†ä»»åŠ¡å’Œæ€»å¤„ç†æ—¶é—´ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public class TimingThreadPool extends ThreadPoolExecutor {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public TimingThreadPool() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        super(1, 1, 0L, TimeUnit.SECONDS, null);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final ThreadLocal&lt;Long&gt; startTime = new ThreadLocal&lt;Long&gt;();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final Logger log = Logger.getLogger(&quot;TimingThreadPool&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final AtomicLong numTasks = new AtomicLong();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final AtomicLong totalTime = new AtomicLong();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void beforeExecute(Thread t, Runnable r) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        super.beforeExecute(t, r);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.fine(String.format(&quot;Thread %s: start %s&quot;, t, r));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        startTime.set(System.nanoTime());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void afterExecute(Runnable r, Throwable t) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            long endTime = System.nanoTime();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            long taskTime = endTime - startTime.get();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            numTasks.incrementAndGet();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            totalTime.addAndGet(taskTime);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.fine(String.format(&quot;Thread %s: end %s, time=%dns&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    t, r, taskTime));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        } finally {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            super.afterExecute(r, t);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void terminated() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(String.format(&quot;Terminated: avg time=%dns&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    totalTime.get() / numTasks.get()));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        } finally {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            super.terminated();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="é€’å½’ç®—æ³•çš„å¹¶è¡ŒåŒ–"></a>é€’å½’ç®—æ³•çš„å¹¶è¡ŒåŒ–<a class="hash-link" href="#é€’å½’ç®—æ³•çš„å¹¶è¡ŒåŒ–" title="Direct link to heading">#</a></h2><p>å½“ä¸²è¡Œå¾ªç¯ä¸­çš„å„ä¸ªè¿­ä»£æ“ä½œä¹‹é—´å½¼æ­¤<strong>ç‹¬ç«‹</strong>ï¼Œå¹¶ä¸”æ¯ä¸ªè¿­ä»£æ“ä½œå·¥ä½œé‡å¤§äºç®¡ç†æ–°ä»»åŠ¡çš„ï¼Œæ­¤æ—¶è¯¥ä¸²è¡Œå¾ªç¯å°±é€‚åˆå¹¶è¡ŒåŒ–ï¼Œä¾‹å¦‚ç¬¬6ç« ä¸­çš„Rendererã€‚åœ¨ä¸€äº›é€’å½’è®¾è®¡ä¸­åŒæ ·å¯ä»¥ä½¿ç”¨ç›¸åŒæ–¹æ³•ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public &lt;T&gt; void sequentialRecursive(List&lt;Node&lt;T&gt;&gt; nodes,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        Collection&lt;T&gt; results) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (Node&lt;T&gt; n : nodes) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        results.add(n.compute());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        sequentialRecursive(n.getChildren(), results);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public &lt;T&gt; void parallelRecursive(final Executor exec,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    List&lt;Node&lt;T&gt;&gt; nodes,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    final Collection&lt;T&gt; results) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (final Node&lt;T&gt; n : nodes) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        exec.execute(new Runnable() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            public void run() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                results.add(n.compute());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        parallelRecursive(exec, n.getChildren(), results);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ç”±äºæ¯ä¸ªè¿­ä»£æ“ä½œä¸ä¾èµ–åç»­é€’å½’è¿­ä»£çš„ç»“æœï¼Œå› æ­¤å¯ä»¥å¹¶è¡ŒåŒ–ã€‚ä¸ºäº†è·å–æœ€ç»ˆç»“æœï¼Œé€šè¿‡shutdownã€awaitTerminationæ–¹æ³•å®ç°ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public &lt;T&gt; Collection&lt;T&gt; getParallelResults(List&lt;Node&lt;T&gt;&gt; nodes)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        throws InterruptedException {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ExecutorService exec = Executors.newCachedThreadPool();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Queue&lt;T&gt; resultQueue = new ConcurrentLinkedQueue&lt;T&gt;();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    parallelRecursive(exec, nodes, resultQueue);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exec.shutdown();        // å‘å‡ºå…³é—­æ‰§è¡Œï¼Œå¹¶æ— é™æœŸç­‰å¾…æ‰€æœ‰ä»»åŠ¡ç»“æŸ</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exec.awaitTermination(Long.MAX_VALUE, TimeUnit.SECONDS);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return resultQueue;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ç¤ºä¾‹è°œé¢˜æ¡†æ¶"></a>ç¤ºä¾‹ï¼šè°œé¢˜æ¡†æ¶<a class="hash-link" href="#ç¤ºä¾‹è°œé¢˜æ¡†æ¶" title="Direct link to heading">#</a></h3><p>ä¸²è¡Œé€’å½’å¹¶è¡ŒåŒ–çš„ä¸€é¡¹é‡è¦åº”ç”¨å°±æ˜¯è§£å†³è¿™æ ·ä¸€äº›è°œé¢˜ï¼šæ‰¾å‡ºä¸€ç³»åˆ—æ“ä½œä»åˆå§‹çŠ¶æ€è½¬æ¢åˆ°ç›®æ ‡çŠ¶æ€ã€‚é—®é¢˜å®šä¹‰ä¸ºï¼šä¸€ä¸ªåˆå§‹ä½ç½®ï¼Œä¸€ä¸ªç›®æ ‡ä½ç½®ä»¥åŠåˆ¤æ–­æ˜¯å¦æœ‰æ•ˆç§»åŠ¨çš„è§„åˆ™é›†(åŒ…å«æŒ‡å®šä½ç½®å¤„çš„åˆæ³•ç§»åŠ¨ä»¥åŠæ¯æ¬¡ç§»åŠ¨çš„ç»“æœä½ç½®)ã€‚ä»¥â€œæ¬ç®±å­â€</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public interface Puzzle &lt;P, M&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    P initialPosition();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean isGoal(P position);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;M&gt; legalMoves(P position);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    P move(P position, M move);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public class PuzzleNode &lt;P, M&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    final P pos;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    final M move;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    final PuzzleNode&lt;P, M&gt; prev;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public PuzzleNode(P pos, M move, PuzzleNode&lt;P, M&gt; prev) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.pos = pos;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.move = move;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.prev = prev;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // å°†ä¹‹å‰æ‰€æœ‰ç§»åŠ¨æ“ä½œä½œä¸ºåˆ—è¡¨è¿”å›</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;M&gt; asMoveList() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;M&gt; solution = new LinkedList&lt;M&gt;();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (PuzzleNode&lt;P, M&gt; n = this; n.move != null; n = n.prev)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            solution.add(0, n.move);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return solution;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä»¥ä¸‹searchæ–¹æ³•ç»™å‡ºè°œé¢˜æ¡†æ¶çš„ä¸²è¡ŒåŒ–è§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡æ·±åº¦ä¼˜å…ˆæœç´¢æ‰¾åˆ°è§£å†³æ–¹æ¡ˆ(ä¸ä¸€å®šæ˜¯æœ€ä¼˜æ–¹æ¡ˆ)ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public class SequentialPuzzleSolver &lt;P, M&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final Puzzle&lt;P, M&gt; puzzle;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final Set&lt;P&gt; seen = new HashSet&lt;P&gt;();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SequentialPuzzleSolver(Puzzle&lt;P, M&gt; puzzle) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.puzzle = puzzle;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;M&gt; solve() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        P pos = puzzle.initialPosition();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return search(new PuzzleNode&lt;P, M&gt;(pos, null, null));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;M&gt; search(PuzzleNode&lt;P, M&gt; node) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!seen.contains(node.pos)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            seen.add(node.pos);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (puzzle.isGoal(node.pos))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                return node.asMoveList();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (M move : puzzle.legalMoves(node.pos)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                P pos = puzzle.move(node.pos, move);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                PuzzleNode&lt;P, M&gt; child = new PuzzleNode&lt;P, M&gt;(pos, move, node);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                List&lt;M&gt; result = search(child);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (result != null)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return result;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å¦‚ä¸‹ä»£ç æ‰€ç¤ºç»™å‡ºå¹¶å‘çš„è°œé¢˜è§£ç­”å™¨ã€‚åœ¨ä¸²è¡Œç‰ˆæœ¬ä¸­é€šè¿‡Setæ¥ä¿å­˜å·²ç»æœç´¢è¿‡çš„ä½ç½®ï¼Œé¿å…æ— é™å¾ªç¯ï¼Œåœ¨å¹¶å‘ç‰ˆæœ¬ä¸­ä½¿ç”¨ConcurrentHashMapæ¥æ›¿ä»£ï¼Œå› ä¸ºè¦ç¡®ä¿Put-If-Absentæ“ä½œçº¿ç¨‹å®‰å…¨æ€§ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public class ConcurrentPuzzleSolver &lt;P, M&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final Puzzle&lt;P, M&gt; puzzle;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final ExecutorService exec;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final ConcurrentMap&lt;P, Boolean&gt; seen;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected final ValueLatch&lt;PuzzleNode&lt;P, M&gt;&gt; solution = new ValueLatch&lt;PuzzleNode&lt;P, M&gt;&gt;();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ConcurrentPuzzleSolver(Puzzle&lt;P, M&gt; puzzle) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.puzzle = puzzle;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.exec = initThreadPool();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.seen = new ConcurrentHashMap&lt;P, Boolean&gt;();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (exec instanceof ThreadPoolExecutor) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ThreadPoolExecutor tpe = (ThreadPoolExecutor) exec;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tpe.setRejectedExecutionHandler(new ThreadPoolExecutor.DiscardPolicy());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ExecutorService initThreadPool() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Executors.newCachedThreadPool();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;M&gt; solve() throws InterruptedException {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            P p = puzzle.initialPosition();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            exec.execute(newTask(p, null, null));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // getValueé˜»å¡ç›´åˆ°æ‰¾åˆ°ç­”æ¡ˆ</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            PuzzleNode&lt;P, M&gt; solnPuzzleNode = solution.getValue();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return (solnPuzzleNode == null) ? null : solnPuzzleNode.asMoveList();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        } finally {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // æŸä¸ªçº¿ç¨‹æ‰¾åˆ°ç­”æ¡ˆååˆgetValueæ”¾è¡Œï¼Œæ­¤æ—¶å¯ä»¥å…³é—­çº¿ç¨‹æ± </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            exec.shutdown();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected Runnable newTask(P p, M m, PuzzleNode&lt;P, M&gt; n) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new SolverTask(p, m, n);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected class SolverTask extends PuzzleNode&lt;P, M&gt; implements Runnable {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        SolverTask(P pos, M move, PuzzleNode&lt;P, M&gt; prev) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            super(pos, move, prev);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void run() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (solution.isSet()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    || seen.putIfAbsent(pos, true) != null)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                return; // æ‰¾åˆ°ç­”æ¡ˆæˆ–è€…éå†è¿‡è¯¥ä½ç½®</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (puzzle.isGoal(pos))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                solution.setValue(this);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            else</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (M m : puzzle.legalMoves(pos))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    exec.execute(newTask(puzzle.move(pos, m), m, this));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä¸ºäº†åœ¨æ‰¾åˆ°ä¸€ä¸ªç­”æ¡ˆååœæ­¢ï¼Œå®ç°å¸¦ç»“æœçš„é—­é”ValueLatchï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public class ValueLatch &lt;T&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private T value = null;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final CountDownLatch done = new CountDownLatch(1);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean isSet() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (done.getCount() == 0);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // setValueæ˜¯åŒæ­¥çš„ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè®¾ç½®æ“ä½œ</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public synchronized void setValue(T newValue) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!isSet()) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            value = newValue;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            done.countDown();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public T getValue() throws InterruptedException {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        done.await();       // ä¸»çº¿ç¨‹è°ƒç”¨getValueä¼šè¢«é˜»å¡</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        synchronized (this) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return value;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>åœ¨solveæ–¹æ³•çš„finallyå—ä¸­ï¼Œç¬¬ä¸€ä¸ªæ‰¾åˆ°ç­”æ¡ˆçš„çº¿ç¨‹ä¼šå…³é—­çº¿ç¨‹æ± ï¼Œç»ˆæ­¢æ‰€æœ‰ä»»åŠ¡çš„åŒæ—¶ä¹Ÿé˜»æ­¢æ–°çš„ä»»åŠ¡è¢«æäº¤ã€‚ä¸ºäº†é¿å…å¤„ç†RejectedExcutionExceptionï¼Œå°†æ‹’ç»ç­–ç•¥è®¾ç½®ä¸ºæŠ›å¼ƒå·²æäº¤ä»»åŠ¡ã€‚è€Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡éƒ½ä¼šå¤±è´¥ä½¿å¾—Executorç»“æŸã€‚</p><p>å¦‚æœä¸å­˜åœ¨ç­”æ¡ˆï¼Œé‚£ä¹ˆgetSolutionæ–¹æ³•æ°¸è¿œé˜»å¡ã€‚ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µï¼Œä¸€ç§æ–¹å¼æ˜¯è®°å½•æ´»åŠ¨ä»»åŠ¡æ•°é‡ï¼Œåœ¨è¯¥å€¼ä¸ºé›¶æ—¶å°†ç­”æ¡ˆè®¾ç½®ä¸ºnullï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public class PuzzleSolver &lt;P,M&gt; extends ConcurrentPuzzleSolver&lt;P, M&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PuzzleSolver(Puzzle&lt;P, M&gt; puzzle) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        super(puzzle);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final AtomicInteger taskCount = new AtomicInteger(0);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected Runnable newTask(P p, M m, PuzzleNode&lt;P, M&gt; n) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new CountingSolverTask(p, m, n);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    class CountingSolverTask extends SolverTask {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        CountingSolverTask(P pos, M move, PuzzleNode&lt;P, M&gt; prev) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            super(pos, move, prev);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            taskCount.incrementAndGet();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void run() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                super.run();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            } finally {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (taskCount.decrementAndGet() == 0)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    solution.setValue(null);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>é™¤æ­¤ä¹‹å¤–ï¼Œè®¡ç®—æ—¶é—´å¯èƒ½å¾ˆé•¿ï¼Œæ­¤æ—¶å¯ä»¥åŠ ä¸Šæ—¶é—´é™åˆ¶ï¼šåœ¨ValueLatchä¸­å®ç°ä¸€ä¸ªé™æ—¶çš„getValue(å³ä½¿ç”¨é™æ—¶ç‰ˆæœ¬çš„awaitæ–¹æ³•)ï¼Œå½“getValueè¶…æ—¶ï¼Œé‚£ä¹ˆå…³é—­çº¿ç¨‹æ± å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚è¿˜å¯ä»¥åŸºäºå…¶ä»–ç­–ç•¥å…³é—­çº¿ç¨‹æ± ï¼Œæ¯”å¦‚åªæœç´¢ç‰¹å®šæ•°é‡çš„ä½ç½®ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="æ€»ç»“"></a>æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">#</a></h2><ol><li>ThreadPoolExecutorå‚æ•°è®¾ç½®(æ„é€ å‰å‚æ•°æŒ‡å®šï¼Œæ„é€ åsetXxx)</li><li>å®šåˆ¶åŒ–çº¿ç¨‹å·¥å‚</li><li>beforeExecuteã€afterExecuteã€terminatedæ–¹æ³•æ‰©å±•ThreadPoolExecutor</li><li>é€’å½’ç®—æ³•å¹¶è¡ŒåŒ–çš„ä»£ç å®ç°</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/docs/tags/java-concurrency">Java Concurrency</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/docs/tags/reading-notes">ReadingNotes</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kayhaw/kayhaw.github.io/edit/master/website/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜\Java-Concurrency-in-Practice-Chap08.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap07"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« å–æ¶ˆä¸å…³é—­</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap10"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">é¿å…æ´»è·ƒæ€§å±é™© Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#åœ¨ä»»åŠ¡ä¸æ‰§è¡Œç­–ç•¥ä¹‹é—´çš„éšæ€§è€¦åˆ" class="table-of-contents__link">åœ¨ä»»åŠ¡ä¸æ‰§è¡Œç­–ç•¥ä¹‹é—´çš„éšæ€§è€¦åˆ</a><ul><li><a href="#çº¿ç¨‹é¥¥é¥¿æ­»é”" class="table-of-contents__link">çº¿ç¨‹é¥¥é¥¿æ­»é”</a></li><li><a href="#è¿è¡Œæ—¶é—´è¾ƒé•¿çš„ä»»åŠ¡" class="table-of-contents__link">è¿è¡Œæ—¶é—´è¾ƒé•¿çš„ä»»åŠ¡</a></li></ul></li><li><a href="#è®¾ç½®çº¿ç¨‹æ± " class="table-of-contents__link">è®¾ç½®çº¿ç¨‹æ± </a></li><li><a href="#é…ç½®threadpoolexecutor" class="table-of-contents__link">é…ç½®ThreadPoolExecutor</a><ul><li><a href="#çº¿ç¨‹çš„åˆ›å»ºä¸é”€æ¯" class="table-of-contents__link">çº¿ç¨‹çš„åˆ›å»ºä¸é”€æ¯</a></li><li><a href="#ç®¡ç†é˜Ÿåˆ—ä»»åŠ¡" class="table-of-contents__link">ç®¡ç†é˜Ÿåˆ—ä»»åŠ¡</a></li><li><a href="#é¥±å’Œç­–ç•¥" class="table-of-contents__link">é¥±å’Œç­–ç•¥</a></li><li><a href="#çº¿ç¨‹å·¥å‚" class="table-of-contents__link">çº¿ç¨‹å·¥å‚</a></li><li><a href="#æ„é€ åå®šåˆ¶threadpoolexecutor" class="table-of-contents__link">æ„é€ åå®šåˆ¶ThreadPoolExecutor</a></li></ul></li><li><a href="#æ‰©å±•threadpoolexecutor" class="table-of-contents__link">æ‰©å±•ThreadPoolExecutor</a></li><li><a href="#é€’å½’ç®—æ³•çš„å¹¶è¡ŒåŒ–" class="table-of-contents__link">é€’å½’ç®—æ³•çš„å¹¶è¡ŒåŒ–</a><ul><li><a href="#ç¤ºä¾‹è°œé¢˜æ¡†æ¶" class="table-of-contents__link">ç¤ºä¾‹ï¼šè°œé¢˜æ¡†æ¶</a></li></ul></li><li><a href="#æ€»ç»“" class="table-of-contents__link">æ€»ç»“</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">è¯»ä¹¦ç¬”è®°</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.zhihu.com/people/xiao-ke-dou-7" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>çŸ¥ä¹<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitee.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ä½•è½²(Kay Haw). Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.7de17fe8.js"></script>
<script src="/assets/js/main.00935a8a.js"></script>
</body>
</html>