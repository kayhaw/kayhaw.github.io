<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.16">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kay Haw&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kay Haw&#39;s Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-rh="true">æ˜¾å¼é” | Kay Haw&#x27;s Blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kayhaw.github.io/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap13"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="æ˜¾å¼é” | Kay Haw&#x27;s Blog"><meta data-rh="true" name="description" content="ã€ŠJavaå¹¶å‘ç¼–ç¨‹ã€‹ç¬¬åä¸‰ç« è¯»ä¹¦ç¬”è®°"><meta data-rh="true" property="og:description" content="ã€ŠJavaå¹¶å‘ç¼–ç¨‹ã€‹ç¬¬åä¸‰ç« è¯»ä¹¦ç¬”è®°"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kayhaw.github.io/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap13"><link data-rh="true" rel="alternate" href="https://kayhaw.github.io/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap13" hreflang="en"><link data-rh="true" rel="alternate" href="https://kayhaw.github.io/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap13" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4bafb564.css">
<link rel="preload" href="/assets/js/runtime~main.b8f66f99.js" as="script">
<link rel="preload" href="/assets/js/main.a8d1eeac.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Kay Haw&#x27;s Blog</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">è¯»ä¹¦ç¬”è®°</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ğŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ğŸŒ</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">è¯»ä¹¦ç¬”è®°</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/C++PrimerPlus/C++PrimerPlus-Chap04">C++PrimerPlus</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/EffectiveC++/Effective-C++-Chap1">EffectiveC++</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap02">Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap02">çº¿ç¨‹å®‰å…¨æ€§</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap03">å¯¹è±¡çš„å…±äº«</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap04">å¯¹è±¡çš„ç»„åˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap05">åŸºç¡€æ„å»ºæ¨¡å—</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap06">ä»»åŠ¡æ‰§è¡Œ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap07">å–æ¶ˆä¸å…³é—­</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap08">çº¿ç¨‹æ± çš„ä½¿ç”¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap10">é¿å…æ´»è·ƒæ€§å±é™©</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap13">æ˜¾å¼é”</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap14">æ„å»ºè‡ªå®šä¹‰çš„åŒæ­¥å·¥å…·</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap15">åŸå­å˜é‡ä¸éé˜»å¡åŒæ­¥æœºåˆ¶</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap16">Javaå†…å­˜æ¨¡å‹</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/Learning Akka/LearningAkka-Chap01">Learning Akka</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/Stream-Processing-with-Apache-Flink/Chap01">Stream Processing with Apache Flink</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº/UnderstandJVM-Chap07">æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/é«˜æ€§èƒ½MySQL/HighPerformanceMySQL-Chap04">é«˜æ€§èƒ½MySQL</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">ğŸ </a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap13">æ˜¾å¼é”</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>æ˜¾å¼é”</h1></header><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>ã€ŠJavaå¹¶å‘ç¼–ç¨‹ã€‹ç¬¬åä¸‰ç« è¯»ä¹¦ç¬”è®°</p></div></div><p>Java 5.0æ–°å¢äº†ReentrantLockï¼Œä½œä¸ºå†…ç½®é”(synchronizedã€volatile)çš„ä¸€ç§æ›¿ä»£å“ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="lockä¸reentrantlock">Lockä¸ReentrantLock<a class="hash-link" href="#lockä¸reentrantlock" title="Direct link to heading">â€‹</a></h2><p>Lockæ¥å£ä¸­å®šä¹‰çš„é”ç›¸å…³æ“ä½œå¦‚ä¸‹æ‰€ç¤ºã€‚ä¸å†…ç½®åŠ é”ä¸åŒï¼ŒLockæä¾›<strong>æ— æ¡ä»¶çš„ã€å¯è½®è¯¢çš„ã€å®šæ—¶çš„ä»¥åŠå¯ä¸­æ–­çš„é”è·å–æ“ä½œ</strong>ã€‚è€ŒReentrantLockå®ç°äº†Lockæ¥å£ï¼Œæä¾›äº†ä¸synchronizedä¸€æ ·çš„äº’æ–¥æ€§å’Œå†…å­˜å¯è§æ€§ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">Lock</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">lock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åŠ é”ï¼Œé˜»å¡æœŸé—´å¯è¢«ä¸­æ–­</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">lockInterruptibly</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åŠ é”ï¼Œå¤±è´¥ç«‹å³è¿”å›falseè€Œä¸æ˜¯é˜»å¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tryLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åœ¨ç»™å®šæ—¶é—´å†…åŠ é”</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tryLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">TimeUnit</span><span class="token plain"> unit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// è§£é”</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">Condition</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">newCondition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>å†…ç½®é”å­˜åœ¨å±€é™æ€§ï¼Œä¾‹å¦‚æ— æ³•ä¸­æ–­ç­‰å¾…è·å–é”çš„çº¿ç¨‹ï¼Œæ— æ³•è¯·æ±‚é”æ—¶æ— é™æœŸç­‰å¾…ï¼Œæ— æ³•å®ç°éé˜»å¡çš„åŠ é”è§„åˆ™ã€‚è€ŒLockåŠ é”æœºåˆ¶æ›´åŠ çµæ´»ï¼Œä½¿ç”¨Lockçš„æ ‡å‡†å½¢å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token class-name">Lock</span><span class="token plain"> lock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ReentrantLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ›´æ–°å¯¹è±¡çŠ¶æ€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ•è·å¼‚å¸¸</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸€å®šä¸è¦å¿˜è®°åœ¨finallyå—ä¸­é‡Šæ”¾é”</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="è½®è¯¢é”ä¸å®šæ—¶é”">è½®è¯¢é”ä¸å®šæ—¶é”<a class="hash-link" href="#è½®è¯¢é”ä¸å®šæ—¶é”" title="Direct link to heading">â€‹</a></h3><p>tryLockæ–¹æ³•å®ç°å¯å®šæ—¶çš„ä¸å¯è½®è¯¢çš„åŠ é”æ¨¡å¼ï¼Œå®ƒç›¸æ¯”äºæ— æ¡ä»¶çš„åŠ é”æ¨¡å¼å…·æœ‰æ›´åŠ å®Œå–„çš„é”™è¯¯æ¢å¤æœºåˆ¶ï¼Œä»è€Œé¿å…æ­»é”çš„å‘ç”Ÿã€‚å¦‚ä¸‹æ‰€ç¤ºä»£ç ä½¿ç”¨æ— å‚çš„tryLockæ¥è§£å†³ç¬¬10ç« ä¸­çš„åŠ¨æ€é¡ºåºæ­»é”é—®é¢˜ï¼šå½“è·å–é”å¤±è´¥å°±å›é€€ç„¶åé‡æ–°å°è¯•ï¼Œé€šè¿‡éšæœºæ—¶é•¿ä¼‘çœ é¿å…æ´»é”ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">transferMoney</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Account</span><span class="token plain"> fromAcct</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             </span><span class="token class-name">Account</span><span class="token plain"> toAcct</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             </span><span class="token class-name">DollarAmount</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> timeout</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             </span><span class="token class-name">TimeUnit</span><span class="token plain"> unit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InsufficientFundsException</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> fixedDelay </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getFixedDelayComponentNanos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> randMod </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getRandomDelayModulusNanos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> stopTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">nanoTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> unit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNanos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fromAcct</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">tryLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">toAcct</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">tryLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fromAcct</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBalance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">compareTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">InsufficientFundsException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            fromAcct</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            toAcct</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">credit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        toAcct</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                fromAcct</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">nanoTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> stopTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NANOSECONDS</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fixedDelay </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> rnd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">nextLong</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> randMod</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¯ä¸­æ–­çš„é”è·å–æ“ä½œ">å¯ä¸­æ–­çš„é”è·å–æ“ä½œ<a class="hash-link" href="#å¯ä¸­æ–­çš„é”è·å–æ“ä½œ" title="Direct link to heading">â€‹</a></h3><p>ç”±äºå†…ç½®é”ä¸å¯ä¸­æ–­çš„é˜»å¡æœºåˆ¶ï¼Œä½¿å¾—å®ç°å¯å–æ¶ˆä»»åŠ¡å˜å¾—å¤æ‚ã€‚è€ŒlockInterruptiblyæ–¹æ³•èƒ½åœ¨è·å–é”çš„åŒæ—¶å“åº”ä¸­æ–­ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">InterruptibleLocking</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Lock</span><span class="token plain"> lock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ReentrantLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sendOnSharedLine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lockInterruptibly</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cancellableSendOnSharedLine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cancellableSendOnSharedLine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* send something */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>lockInterruptiblyå’Œå¸¦å®šæ—¶å‚æ•°çš„tryLockéƒ½å¯å“åº”ä¸­æ–­ï¼Œå› æ­¤ä½¿ç”¨å®ƒä»¬çš„ä»»åŠ¡éƒ½æ˜¯å¯å–æ¶ˆçš„ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="éå—ç»“æ„çš„åŠ é”">éå—ç»“æ„çš„åŠ é”<a class="hash-link" href="#éå—ç»“æ„çš„åŠ é”" title="Direct link to heading">â€‹</a></h3><p>å†…ç½®é”çš„è·å–å’Œé‡Šæ”¾æ˜¯å¤„äºåŒä¸€ä¸ªä»£ç å—çš„ï¼Œä½†Lockèƒ½å¤Ÿæä¾›æ›´åŠ çµæ´»çš„åŠ é”è§„åˆ™(é”è€¦åˆï¼šé“¾è¡¨nextèŠ‚ç‚¹åŠ é”åé‡Šæ”¾preèŠ‚ç‚¹é”)ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€§èƒ½è€ƒè™‘å› ç´ ">æ€§èƒ½è€ƒè™‘å› ç´ <a class="hash-link" href="#æ€§èƒ½è€ƒè™‘å› ç´ " title="Direct link to heading">â€‹</a></h2><p>å½“åœ¨Java 5.0ä¸­å¼•å…¥ReentrantLockï¼Œç¡®å®æ¯”å†…ç½®é”æä¾›äº†æ›´å¥½çš„ç«äº‰æ€§èƒ½ï¼šæ›´å°‘çš„ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚åœ¨Java 6.0ä¸­å¯¹å†…ç½®é”è¿›è¡Œæ”¹è¿›ï¼Œæ­¤æ—¶ä¸¤è€…ååé‡å·²éå¸¸æ¥è¿‘ã€‚</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>å†…ç½®é”æ€§èƒ½ä½äºæ˜¾ç¤ºé”(Lock)å·²ç»æˆä¸ºè¿‡å»å¼ï¼Œæ€§èƒ½ä¸æ˜¯ä¸æ–­å˜åŒ–çš„æŒ‡æ ‡ã€‚</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="å…¬å¹³æ€§">å…¬å¹³æ€§<a class="hash-link" href="#å…¬å¹³æ€§" title="Direct link to heading">â€‹</a></h2><p>ReenLockæ„é€ æ–¹æ³•é€šè¿‡booleanç±»å‹å‚æ•°fairæ¥æä¾›ä¸¤ç§å…¬å¹³æ€§é€‰æ‹©(é»˜è®¤false)ï¼š</p><ul><li>trueï¼šåˆ›å»ºå…¬å¹³é”ï¼Œçº¿ç¨‹æŒ‰ç…§å‘å‡ºè¯·æ±‚çš„é¡ºåºæ¥è·å–é”</li><li>falseï¼šåˆ›å»ºéå…¬å¹³é”ï¼Œå…è®¸â€œæ’é˜Ÿâ€ï¼šä¸€ä¸ªçº¿ç¨‹è·å–è¯·æ±‚é”æ—¶ï¼Œæ°å¥½é”å¯ç”¨ï¼Œæ­¤æ—¶å®ƒç›´æ¥è·å–é”è€Œä¸æ’é˜Ÿ</li></ul><p>ä¸ºä»€ä¹ˆé»˜è®¤éå…¬å¹³é”ï¼Ÿå…¬å¹³é”åœ¨æŒ‚èµ·å’Œæ¢å¤çº¿ç¨‹æ—¶å­˜åœ¨å¼€é”€é™ä½æ€§èƒ½ï¼Œå®é™…ä¸­ç¡®ä¿è¢«é˜»å¡çš„çº¿ç¨‹èƒ½è·å–é”å°±å¤Ÿäº†ã€‚åŸä¹¦ç»™å‡ºçš„ä¸€ä¸ªæ€§èƒ½æµ‹è¯•è¯æ˜ï¼Œä½¿ç”¨å…¬å¹³é”å°†æ€§èƒ½é™ä½äº†ä¸¤ä¸ªæ•°é‡çº§ã€‚å¦ä¸€ä¸ªé‡è¦åŸå› ï¼šæ¢å¤è¢«æŒ‚èµ·çš„çº¿ç¨‹ä¸è¯¥çº¿ç¨‹çœŸæ­£å¼€å§‹æ‰§è¡Œå­˜åœ¨ä¸¥é‡å»¶è¿Ÿã€‚åœ¨è¿™æ®µå¯åŠ¨å»¶æ—¶ä¸­è®©å¦ä¸€ä¸ªè¯·æ±‚é”çš„æ´»è·ƒçº¿ç¨‹ç›´æ¥ä½¿ç”¨ã€é‡Šæ”¾è¿™ä¸ªé”ï¼Œä¹Ÿæ²¡æœ‰è€½æåŸæœ‰è·å–é”çš„çº¿ç¨‹ï¼Œå¯ä»¥è¾¾åˆ°ä¸€ç§åŒèµ¢å±€é¢ï¼Œæé«˜ååé‡ã€‚è€Œå½“æŒæœ‰é”æ—¶é—´è¾ƒé•¿ï¼Œæˆ–è€…è¯·æ±‚æ‰€çš„å¹³å‡æ—¶é—´é—´éš”è¾ƒé•¿ï¼Œåº”è¯¥ä½¿ç”¨å…¬å¹³é”ã€‚</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>å†…ç½®é”ä¹Ÿæ˜¯éå…¬å¹³çš„ï¼ŒJavaè§„èŒƒå¹¶æ²¡æœ‰è¦æ±‚ä½¿ç”¨å…¬å¹³æ–¹å¼å®ç°å†…ç½®é”ã€‚</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="åœ¨synchronizedå’Œreentrantlockä¹‹é—´é€‰æ‹©">åœ¨synchronizedå’ŒReentrantLockä¹‹é—´é€‰æ‹©<a class="hash-link" href="#åœ¨synchronizedå’Œreentrantlockä¹‹é—´é€‰æ‹©" title="Direct link to heading">â€‹</a></h2><p>å½“éœ€è¦ä¸€äº›é«˜çº§åŠŸèƒ½æ—¶æ‰è€ƒè™‘ä½¿ç”¨ReentrantLockï¼Œè¿™ä¸ªé«˜çº§åŠŸèƒ½åŒ…æ‹¬ï¼šå¯å®šæ—¶çš„ã€å¯è½®è¯¢çš„ã€å¯ä¸­æ–­çš„é”è·å–æœºåˆ¶ï¼Œå…¬å¹³é˜Ÿåˆ—ï¼Œéå—ç»“æ„çš„é”ã€‚åœ¨Java 5.0ä¸­ï¼Œå¯¹äºå†…ç½®é”ï¼Œå¯ä»¥åœ¨çº¿ç¨‹dumpä¸­å¯ä»¥çœ‹åˆ°å“ªäº›è°ƒç”¨å¸§ä¸­è·å¾—é”è¯·æ±‚ï¼Œä»¥åŠæ£€æµ‹è¯†åˆ«æ­»é”ï¼Œè€ŒReentrantLockçš„éå—ç»“æ„æ„å‘³ç€è·å–é”æ“ä½œä¸èƒ½ä¸ç‰¹å®šæ ˆå¸§å…³è”ï¼Œä½†è¿™ä¸ªé—®é¢˜åœ¨Java 6.0ä¸­å·²ç»è§£å†³ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå› ä¸ºsynchronizedæ˜¯JVMå†…ç½®ç‰¹æ€§ï¼Œå®ƒèƒ½æ‰§è¡Œä¸€äº›ä¼˜åŒ–ï¼šæ¯”å¦‚é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€‚</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>é™¤éç‰¹æ®Šéœ€è¦ï¼Œåº”è¯¥é€‰æ‹©synchronizedè€Œä¸æ˜¯ReentrantLock</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="è¯»å†™é”">è¯»å†™é”<a class="hash-link" href="#è¯»å†™é”" title="Direct link to heading">â€‹</a></h2><p>ReentrantLockå®ç°äº†æ ‡å‡†çš„äº’æ–¥é”ï¼Œä½†å½“å¤§å¤šæ•°æ“ä½œéƒ½æ˜¯è¯»å–æ•°æ®æ—¶ï¼Œæ­¤æ—¶å¯ä»¥æ”¾å®½åŠ é”éœ€æ±‚ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œæå‡ç¨‹åºæ€§èƒ½ã€‚æ¥å£ReadWriteLockæš´éœ²ä¸¤ä¸ªLockå¯¹è±¡ï¼Œåˆ†åˆ«ç”¨äºè¯»å†™æ“ä½œã€‚å°½ç®¡çœ‹èµ·æ¥ä¸¤ä¸ªé”äº’ç›¸ç‹¬ç«‹ï¼Œä½†å®ƒä»¬æ˜¯è¯»-å†™å¯¹è±¡çš„ä¸åŒè§†å›¾ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">ReadWriteLock</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Lock</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Lock</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">writeLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>åœ¨è¯»é”å’Œå†™é”ä¹‹é—´å¯ä»¥é‡‡ç”¨å¤šç§å®ç°æ–¹å¼ï¼š</p><ul><li>é‡Šæ”¾ä¼˜å…ˆï¼šå†™é”é‡Šæ”¾æ—¶ï¼Œç­‰å¾…é˜Ÿåˆ—åŒæ—¶å­˜åœ¨è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹ï¼Œé‚£ä¹ˆé€‰æ‹©è¯»çº¿ç¨‹ã€å†™çº¿ç¨‹è¿˜æ˜¯æœ€å…ˆå‘å‡ºè¯·æ±‚çš„çº¿ç¨‹ï¼Ÿ</li><li>è¯»çº¿ç¨‹æ’é˜Ÿï¼šé”ç”±è¯»çº¿ç¨‹æŒæœ‰ï¼Œä½†æœ‰å†™çº¿ç¨‹ç­‰å¾…ï¼Œæ–°åˆ°çš„è¯»çº¿ç¨‹èƒ½å¦è·å¾—è®¿é—®æƒï¼Œè¿˜æ˜¯åœ¨å†™çº¿ç¨‹åé¢ç­‰å¾…ï¼Ÿå¦‚æœå…è®¸è¯»çº¿ç¨‹æ’é˜Ÿï¼Œèƒ½æé«˜å¹¶å‘æ€§ä½†æ˜¯å¯èƒ½é€ æˆçº¿ç¨‹é¥¥é¥¿</li><li>é‡å…¥æ€§ï¼šè¯»é”å’Œå†™é”æ˜¯å¦å¯é‡å…¥ï¼Ÿ</li><li>é™çº§ï¼šå†™çº¿ç¨‹èƒ½å¦åœ¨ä¸é‡Šæ”¾è¯¥é”çš„è¯·æ±‚ä¸‹è·å¾—è¯»å–é”ï¼Ÿ</li><li>å‡çº§ï¼šè¯»é”èƒ½å¦ä¼˜äºå…¶ä»–è¯»å†™çº¿ç¨‹å‡çº§ä¸ºä¸€ä¸ªå†™é”ï¼Ÿå¤§å¤šæ•°è¯»å†™é”å®ç°ä¸æ”¯æŒï¼Œå› ä¸ºä¼šé€ æˆæ­»é”ã€‚</li></ul><p>å¯¹äºä»¥ä¸Šé—®é¢˜ï¼ŒReentrantReadWriteLockä½œä¸ºä¸€ç§è¯»å†™é”å®ç°ç»™å‡ºçš„ç­”æ¡ˆï¼š</p><ul><li>è¯»é”å’Œå†™é”éƒ½æ˜¯å¯é‡å…¥çš„</li><li>å®ç°å…¬å¹³ç­–ç•¥æ—¶ï¼Œç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹ä¼˜å…ˆè·å¾—é”ï¼Œå¦‚æœè¿™ä¸ªé”ç”±è¯»çº¿ç¨‹æŒæœ‰è€Œå¦ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™é”ï¼Œå…¶ä»–è¯»çº¿ç¨‹è¢«é˜»å¡ç›´åˆ°å†™çº¿ç¨‹ä½¿ç”¨å®Œå¹¶é‡Šæ”¾å†™é”</li><li>å®ç°éå…¬å¹³ç­–ç•¥æ—¶ï¼Œçº¿ç¨‹è·å–è®¿é—®é¡ºåºä¸ç¡®å®š</li><li>å†™é”é™çº§ä¸ºè¯»é”å¯ä»¥ï¼Œä½†å‡çº§ä¸å¯ä»¥</li></ul><p>å¦‚ä¸‹æ‰€ç¤ºçš„ReadWriteMapé€šè¿‡ReentrantReadWriteLockå¯¹Mapè¿›è¡ŒåŒ…è£…ï¼Œä»è€Œè®©å®ƒèƒ½åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´è¢«å®‰å…¨åœ°å…±äº«ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ReadWriteMap</span><span class="token plain"> </span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">ReadWriteLock</span><span class="token plain"> lock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Lock</span><span class="token plain"> r </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">readLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Lock</span><span class="token plain"> w </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">writeLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">ReadWriteMap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">map </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ... removeç­‰ä¿®æ”¹æ–¹æ³•å’Œputæ–¹æ³•ç±»ä¼¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">V</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">K</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">V</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...å…¶ä»–è¯»å–æ–¹æ³•ç±»ä¼¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">V</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Object</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><ul><li>åªæœ‰åœ¨synchronizedæ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œæ‰åº”è¯¥ä½¿ç”¨ReentrantLock</li><li>è¯»å†™é”åœ¨è¯»æ“ä½œä¸ºä¸»æ—¶èƒ½æä¾›ç¨‹åºå¯ä¼¸ç¼©æ€§</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/docs/tags/java-concurrency">Java Concurrency</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/docs/tags/reading-notes">ReadingNotes</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kayhaw/kayhaw.github.io/edit/master/website/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap13.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap10"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">é¿å…æ´»è·ƒæ€§å±é™©</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜/Java-Concurrency-in-Practice-Chap14"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">æ„å»ºè‡ªå®šä¹‰çš„åŒæ­¥å·¥å…·</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lockä¸reentrantlock" class="table-of-contents__link toc-highlight">Lockä¸ReentrantLock</a><ul><li><a href="#è½®è¯¢é”ä¸å®šæ—¶é”" class="table-of-contents__link toc-highlight">è½®è¯¢é”ä¸å®šæ—¶é”</a></li><li><a href="#å¯ä¸­æ–­çš„é”è·å–æ“ä½œ" class="table-of-contents__link toc-highlight">å¯ä¸­æ–­çš„é”è·å–æ“ä½œ</a></li><li><a href="#éå—ç»“æ„çš„åŠ é”" class="table-of-contents__link toc-highlight">éå—ç»“æ„çš„åŠ é”</a></li></ul></li><li><a href="#æ€§èƒ½è€ƒè™‘å› ç´ " class="table-of-contents__link toc-highlight">æ€§èƒ½è€ƒè™‘å› ç´ </a></li><li><a href="#å…¬å¹³æ€§" class="table-of-contents__link toc-highlight">å…¬å¹³æ€§</a></li><li><a href="#åœ¨synchronizedå’Œreentrantlockä¹‹é—´é€‰æ‹©" class="table-of-contents__link toc-highlight">åœ¨synchronizedå’ŒReentrantLockä¹‹é—´é€‰æ‹©</a></li><li><a href="#è¯»å†™é”" class="table-of-contents__link toc-highlight">è¯»å†™é”</a></li><li><a href="#æ€»ç»“" class="table-of-contents__link toc-highlight">æ€»ç»“</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">è¯»ä¹¦ç¬”è®°</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.zhihu.com/people/xiao-ke-dou-7" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>çŸ¥ä¹<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitee.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 ä½•è½²(Kay Haw). Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b8f66f99.js"></script>
<script src="/assets/js/main.a8d1eeac.js"></script>
</body>
</html>