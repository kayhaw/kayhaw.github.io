<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Stream Processing with Apache Flink/Stream-Processing-with-Apache-Flink-Chap09">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kay Haw&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kay Haw&#39;s Blog Atom Feed">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-rh="true">部署Flink环境 | Kay Haw&#x27;s Blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kayhaw.github.io/docs/Stream-Processing-with-Apache-Flink/Chap09"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="部署Flink环境 | Kay Haw&#x27;s Blog"><meta data-rh="true" name="description" content="Stream Processing with Apache Flink 第9章读书笔记"><meta data-rh="true" property="og:description" content="Stream Processing with Apache Flink 第9章读书笔记"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kayhaw.github.io/docs/Stream-Processing-with-Apache-Flink/Chap09"><link data-rh="true" rel="alternate" href="https://kayhaw.github.io/docs/Stream-Processing-with-Apache-Flink/Chap09" hreflang="en"><link data-rh="true" rel="alternate" href="https://kayhaw.github.io/docs/Stream-Processing-with-Apache-Flink/Chap09" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.932307e8.css">
<link rel="preload" href="/assets/js/runtime~main.a8170a08.js" as="script">
<link rel="preload" href="/assets/js/main.1794f536.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title text--truncate">Kay Haw&#x27;s Blog</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">读书笔记</a><a class="navbar__item navbar__link" href="/notes">学习笔记</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><aside class="theme-doc-sidebar-container docSidebarContainer_UQUJ"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">读书笔记</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/C++PrimerPlus/C++PrimerPlus-Chap04">C++PrimerPlus</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/EffectiveC++/Effective-C++-Chap1">EffectiveC++</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Java并发编程实战/Java-Concurrency-in-Practice-Chap02">Java并发编程实战</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/Learning-Akka/">Learning Akka</a><button aria-label="Toggle the collapsible sidebar category &#x27;Learning Akka&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/Mastering-Apache-Pulsar/">Mastering Apache Pulsar</a><button aria-label="Toggle the collapsible sidebar category &#x27;Mastering Apache Pulsar&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/Stream-Processing-with-Apache-Flink/">Stream Processing with Apache Flink</a><button aria-label="Toggle the collapsible sidebar category &#x27;Stream Processing with Apache Flink&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Stream-Processing-with-Apache-Flink/Chap01">状态流处理简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Stream-Processing-with-Apache-Flink/Chap02">流处理基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Stream-Processing-with-Apache-Flink/Chap03">Apache Flink架构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Stream-Processing-with-Apache-Flink/Chap05">DataStream API(v.14.0)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Stream-Processing-with-Apache-Flink/Chap06">Time-Based and Window Operators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Stream-Processing-with-Apache-Flink/Chap07">Stateful Operators and Applications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Stream-Processing-with-Apache-Flink/Chap08">读写外部系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Stream-Processing-with-Apache-Flink/Chap09">部署Flink环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Stream-Processing-with-Apache-Flink/Chap10">运维Flink和流应用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Stream-Processing-with-Apache-Flink/Chap11">何去何从</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/深入理解Java虚拟机/UnderstandJVM-Chap07">深入理解Java虚拟机</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/高性能MySQL/HighPerformanceMySQL-Chap04">高性能MySQL</a></div></li></ul></nav></div></aside><main class="docMainContainer_uL0j"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_kU5B"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/Stream-Processing-with-Apache-Flink/"><span itemprop="name">Stream Processing with Apache Flink</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">部署Flink环境</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>部署Flink环境</h1></header><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p><em>Stream Processing with Apache Flink</em> 第9章读书笔记</p></div></div><p>本章介绍部署Flink的不同方式以及如何配置，包括最重要的JobManager和TaskManager配置。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="部署模式">部署模式<a class="hash-link" href="#部署模式" title="Direct link to heading">​</a></h2><p>本节介绍如何在不同环境下配置和启动Flink，包括standalone集群、Docker、Apache Hadoop YARN和Kubernetes。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="standalone集群">Standalone集群<a class="hash-link" href="#standalone集群" title="Direct link to heading">​</a></h3><p>如下图所示，standalone集群至少包含一个master进程和至少一个TaskManager进程。</p><img loading="lazy" style="width:60%;height:60%" src="/img/doc/Stream-Processing-with-Apache-Flink/chap09/Starting-a-Standalone-Flink-Cluster.png" title="Starting a Standalone Flink Cluster" class="img_E7b_"><p>master进程以分隔的线程运行Dispatcher和ResourceManager，随后TaskManager将自己登记到ResourceManager。下图展示一个作业是如何提交到standalone集群上的：</p><p>Submitting-an-Application-to-a-Flink-Standalone-Cluster</p><img loading="lazy" style="width:60%;height:60%" src="/img/doc/Stream-Processing-with-Apache-Flink/chap09/Submitting-an-Application-to-a-Flink-Standalone-Cluster.png" title="Submitting an Application to a Flink Standalone Cluster" class="img_E7b_"><p>当客户端向Dispatcher提交任务，Dispatcher新建一个JobManager线程并提供运行执行的JobGraph。JobManager向ResourceManager请求到slot资源后执行任务。</p><p><strong>在standalone模式下，master和workre不会在遇到故障时自动重启</strong>，单一worker故障可以通过其他slot恢复，但是master故障恢复需要配置高可用模式。</p><p>配置standalone十分简单：在官网下载压缩包<code>flink-${flink版本号}-bin-scala_${scala版本号}.tgz</code>并解压，记解压后Flink目录路径为<code>${FLINK_HOME}</code>。进入<code>${FLINK_HOME}/bin</code>目录运行start-cluster.sh脚本即启动集群，Flink预配置为都在本机运行的一个master和一个TaskManager，通过<code>http://localhost:8081</code>访问Flink Web UI。Java环境通过系统环境变量<code>JAVA_HOME</code>或者<code>${FLINK_HOME}/conf/flink-conf.yaml</code>文件中的<code>env.java.home</code>配置项设置。</p><p>要想将配置运行在多个机器上的Flink集群，需要按如下步骤调整默认配置：</p><ul><li>将添加的TaskManager运行机器ip添加到<code>${FLINK_HOME}/conf/slaves</code>文件；</li><li>对所有TaskManager机器配置免密SSH</li><li><strong>所有机器的${FLINK_HOME}必须相同</strong>，一会常见实现方式是在每个机器上挂载网络共享的Flink目录</li><li>通过flink-conf.yaml文件的<code>jobmanager.rpc.address</code>项配置运行master的机器ip</li></ul><p>以上步骤完成后，重新执行start-cluster.sh脚本启动集群，此时本地会启动一个JobManager进程，并且slaves中配置的每个机器都会运行一个TaskManager进程。通过<code>stop-cluster.sh</code>脚本关闭集群。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="docker">Docker<a class="hash-link" href="#docker" title="Direct link to heading">​</a></h3><p>Docker是一种以容器形式打包和运行应用的平台，Flink社区在Docker Hub上提供了Flink各版本镜像。在Docker中运行Flink十分简单，只需要启动2种容器：运行Dispatcher和ResourceManager的master容器、运行TaskManager的worker容器。对应的启动命令如下所示：</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">// start master process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d --name flink-jobmanager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#36acaa">JOB_MANAGER_RPC_ADDRESS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jobmanager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p </span><span class="token number" style="color:#36acaa">8081</span><span class="token plain">:8081 flink:1.7 jobmanager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// start worker process </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">adjust the name to start </span><span class="token function" style="color:#d73a49">more</span><span class="token plain"> than one TM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d --name flink-taskmanager-1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --link flink-jobmanager:jobmanager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#36acaa">JOB_MANAGER_RPC_ADDRESS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jobmanager flink:1.7 taskmanager</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上命令通过JOB_MANAGER_RPC_ADDRESS环境变量设置JobManager地址，通过<code>-p 8081:8081</code>参数将master容器8081端口映射到宿主机的8081端口，这样宿主机可以访问Flink Web UI来上传应用JAR包并执行应用，也可以通过<code>${FLINK_HOME}/bin/flink</code>命令提交管理应用。</p><p>除了手动的启动多个容器来部署Flink集群，也可以创建Docker Compose配置文件来自动配置和启动Flink集群，但需要注意指定网络配置，详见Flink文档。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="apache-hadoop-yarn">Apache Hadoop YARN<a class="hash-link" href="#apache-hadoop-yarn" title="Direct link to heading">​</a></h3><p>YARN是Apache Hadoop体系的资源管理组件，它以容器的形式分配资源运行应用。Flink在YARN上以2种模式运行：job模式和session模式。</p><p>Job模式下Flink作业执行流程如下图所示。YARN启动一个Flink集群来运行一个作业，当作业终止后，YARN会停止Flink集群并回收所有资源。</p><img loading="lazy" style="width:80%;height:80%" src="/img/doc/Stream-Processing-with-Apache-Flink/chap09/Starting-a-Flink-Cluster-on-YARN-in-Job-Mode.png" title="Starting a Flink Cluster on YARN in Job Mode" class="img_E7b_"><p>Session模式则会启动一个长期运行的Flink集群，该集群可以运行多个作业且需要手动停止。下图所示为空闲时的Flink Session模式：</p><img loading="lazy" style="width:50%;height:50%" src="/img/doc/Stream-Processing-with-Apache-Flink/chap09/Starting-a-Flink-Cluster-on-YARN-in-Session-Mode.png" title="Starting a Flink Cluster on YARN in Session Mode" class="img_E7b_"><p>如下图所示为Session模式下Flink作业执行流程。当slot数量不足时，Flink的ResourceManager向YARN ResourceManager请求分配容器资源来启动TaskManager。</p><img loading="lazy" style="width:80%;height:80%" src="/img/doc/Stream-Processing-with-Apache-Flink/chap09/Submitting-a-Job-to-a-Flink-YARN-Session-Cluster.png" title="Submitting a Job to a Flink YARN Session Cluster" class="img_E7b_"><p>无论是Job模式还是Session模式，运行失败的TaskManager都会被ResourceManager重启，而恢复master进程失败需要<a href="/docs/Stream-Processing-with-Apache-Flink/Chap03/#%E9%AB%98%E5%8F%AF%E7%94%A8%E8%AE%BE%E7%BD%AE">配置高可用</a>。另外，需要<a href="#%E9%9B%86%E6%88%90hadoop%E7%BB%84%E4%BB%B6">配置Hadoop依赖</a>。</p><p>当配置好YARN和HDFS后，使用命令以job模式运行作业：</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">./bin/flink run -m yarn-cluster ./path/to/job.jar</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以session模式运行作业，首先要执行<code>./bin/yarn-session.sh</code>命令开启Flink YARN session，然后通过<code>./bin/flink run ./path/to/job.jar</code>运行作业。注意此时不需要提供连接信息，因为Flink记住了在YARN上运行的Flink会话的连接详情。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="kubernetes">Kubernetes<a class="hash-link" href="#kubernetes" title="Direct link to heading">​</a></h3><p>Kubernetes(K8S)是用于自动部署、缩放及管理容器化应用的平台，先介绍几个K8S术语：</p><ul><li><strong>pod</strong>：Process Domain的缩写，表示K8S管理的容器</li><li><strong>deployment</strong>：指定特定数量pod的配置，K8S确保所有pod保持运行并自动重启失败pod，deployment可以扩大或缩小pod数量</li><li><strong>service</strong>：定义一组pod的访问策略，维护pod路由</li></ul><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小贴士</h5></div><div class="admonition-content"><p>可以使用Minikube代替K8S，但部署Flink时需要运行命令<code>minikube ssh &#x27;sudo ip link set docker0 promisc on&#x27;</code></p></div></div><p>使用K8S部署Flink需要两个deployment，分别用于运行master进程和worker进程。其中master deployment配置如下所示：</p><div class="language-yaml codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_YYkX">master-deployment.yaml</div><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-yaml codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> extensions/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flink</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flink</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">component</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flink</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> jobmanager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rpc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6124</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> blob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6125</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> JOB_MANAGER_RPC_ADDRESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flink</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该deployment指定运行一个master容器(<code>replicas: 1</code>)，运行Flink镜像版本为1.7(<code>image: flink:1.7</code>)，通过参数启动master进程(<code>args: - jobmanager</code>)，并且配置了4个端口分别用于RPC通信、BLOB管理(交换大文件)、状态查询服务、Web UI REST接口。而worker pod配置如下：</p><div class="language-yaml codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_YYkX">worker-deployment.yaml</div><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-yaml codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> extensions/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flink</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flink</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">component</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flink</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> taskmanager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6121</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6122</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rpc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6125</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> JOB_MANAGER_RPC_ADDRESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flink</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>参数基本和master类似，只不过部署2个副本，镜像相同但是启动参数不同，并且设置master deployment的service名称，该service配置如下：</p><div class="language-yaml codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_YYkX">master-service.yaml</div><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-yaml codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flink</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rpc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> blob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6124</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6125</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flink</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">component</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> master</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将如上配置分别保存为master-deployment.yaml、worker-deployment.yaml和master-service.yaml文件，通过如下命令注册到K8S容器：</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f master-deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f worker-deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f master-service.yaml</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过<code>kubectl get deployments</code>命令获取所有deployment状态。由于上述配置并没有对外暴露任何端口，需要通过<code>kubectl port-forward deployment/flink-master 8081:8081</code>命令开启端口转发，然后通过<a href="http://localhost:8081" target="_blank" rel="noopener noreferrer">http://localhost:8081</a>访问Flink Web UI。</p><p>由于K8S会自动重启故障的worker pod，再配合检查点就可以实现应用故障恢复。而当master pod发生故障，需要配置高可用(见下一小节)来恢复。通过如下命令关闭Flink集群：</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -f master-deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -f worker-deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -f master-service.yaml</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</h5></div><div class="admonition-content"><p>通过官方提供的Flink Docker镜像来定制Flink部署配置是不可行的，需要自定义build脚本来创建所需的Flink Docker镜像。</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="高可用设置">高可用设置<a class="hash-link" href="#高可用设置" title="Direct link to heading">​</a></h2><p>大多数流应用在理想情况下一直执行，因此需要能自动地从故障中恢复。Worker故障由ResourceManager处理，而JobManager故障需要配置高可用(Highly Available, HA)。</p><p>JobManager持有应用的元数据，如应用JAR包、JobGraph、保存检查点的指针等，这些信息需要从master故障中恢复。Flink的HA模式依赖于Apache ZooKeeper和持久化存储服务(HDFS、NFS、或S3等)，详见<a href="/docs/Stream-Processing-with-Apache-Flink/Chap03/#%E9%AB%98%E5%8F%AF%E7%94%A8%E8%AE%BE%E7%BD%AE">高可用配置</a>。为了方便用户调试，Flink提供<code>${FLINK_HOME}/bin/start-zookeeper-quorum.sh</code>脚本快速启动ZooKeeper集群，前提是在<code>${FLINK_HOME}/conf/zoo.cfg</code>中配置好ZooKeeper的地址和端口号。</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</h5></div><div class="admonition-content"><p>别直接在生产环境中使用Flink提供的ZooKeeper脚本，而是另外维护一个ZooKeeper集群。</p></div></div><p>在<code>${FLINK_HOME}/conf/flink-conf.yaml</code>通过如下参数配置高可用模式：</p><div class="language-yaml codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-yaml codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 必填项，使用ZooKeeper开启高可用模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">high-availability</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> zookeeper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 必填项，ZooKeeper仲裁server地址列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">high-availability.zookeeper.quorum</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> address1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">2181</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">addressX</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2181</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 必填项，元数据存放路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">high-availability.storageDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hdfs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">///flink/recovery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 推荐项，ZooKeeper中Flink集群基础路径，将Flink和其他使用ZooKeeper的框架隔离</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">high-availability.zookeeper.path.root</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /flink</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="高可用standalone模式设置">高可用Standalone模式设置<a class="hash-link" href="#高可用standalone模式设置" title="Direct link to heading">​</a></h3><p>Standalone模式不依赖资源提供方如YARN或者K8S，所有进程都是手动开启且没有监控、重启它们的组件，因此Flink standalone集群需要备用的Dispatcher和TaskManager进程来接管失败进程。</p><p>除了启动备用TaskManager外，standalone部署不需要其他额外配置来让TaskManager从故障中恢复。所有启动的TaskManager登记到ResourceManager，通过备用TaskManager弥补故障TaskManager来恢复应用。</p><p>当配置高可用后，所有Dispatcher登记到ZooKeeper并且由ZooKeeper选举leader Dispatcher来运行应用。当master进程发生故障，由ZooKeeper重新选举新的leader Dispatcher进行故障恢复。</p><p>除了之前提到的配置外，开启高可用standalone模式配置需要在<code>${FLINK_HOME}/conf/flink-conf.yaml</code>中设置如下参数：</p><div class="language-yaml codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-yaml codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 推荐项，设置ZooKeeper中Flink集群的路径，区分不同的Flink集群</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 如果多个Flink集群使用同一个ZooKeeper实例时必须设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">high-availability.cluster-id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /cluster</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接着在<code>${FLINK_HOME}/conf/master</code>文件中添加主机和端口，然后使用<code>start.sh</code>脚本启动高可用standalone集群。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="高可用yarn设置">高可用YARN设置<a class="hash-link" href="#高可用yarn设置" title="Direct link to heading">​</a></h3><p>YARN是一种集群资源和容器的管理器，默认重启失败的容器，因此不需要运行备用的进程来实现高可用。Flink的master进程作为YARN ApplicationMater启动，YARN自动重启失败的ApplicationMater但但需要配置重启的最大次数来防止无限重启，这通过修改<code>yarn-site.xml</code>文件实现：</p><div class="language-xml codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-xml codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">yarn.resourcemanager.am.max-attempts</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    The maximum number of application master execution attempts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Default value is 2, i.e., an application is restarted at most once.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此外，还需要修改flink-conf.yaml中应用重启次数参数，该参数必须小于等于yarn-site.xml配置的重启次数，如下所示：</p><div class="language-yaml codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-yaml codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 重启应用最多3次(包含初始化启动1次)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">yarn.application-attempts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>YARN只统计由于应用失败导致的重启次数，其他情况如抢占、硬件故障或者主机重启导致都不会计算到重启次数中。当使用YARN 2.6+版本，Flink还会自动配置一个有效尝试间隔参数：只有在间隔时间内达到重启次数才会完全取消应用。Flink将间隔参数设置为和conf.yaml文件中的akka.ask.timeout参数相同，默认10s。</p><p>在配置好YARN和Flink后，执行<code>${FLINK_HOME}/bin/flink run -m yarn-cluster</code>命令以job模式启动Flink集群，或者通过<code>${FLINK_HOME}/bin/yarn-session.sh</code>以session模式启动Flink集群。<strong>当以session模式启动Flink集群，需要为每个集群指定不同的id，而job模式下集群id自动设置为应用id，因此不会重复。</strong></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="高可用k8s设置">高可用K8S设置<a class="hash-link" href="#高可用k8s设置" title="Direct link to heading">​</a></h3><p>在按照<a href="#kubernetes">Kubernetes</a>一节部署运行Flink集群后，K8S会自动重启故障容器，这足以处理worker故障恢复，而处理master故障需要额外配置。正如之前提到的，需要修改Flink一些配置信息，比如ZooKeeper节点地址，持久化存储路径和集群id。并且官方提供的Flink镜像不能自定义配置，需要自己构建镜像。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="集成hadoop组件">集成Hadoop组件<a class="hash-link" href="#集成hadoop组件" title="Direct link to heading">​</a></h2><p>Flink可以轻松地集成Hadoop组件如YARN、HDFS以及Hadoop生态组件如HBase，此时Flink需要其类路径上存在这些Hadoop依赖，有3种方式可以为Flink提供Hadoop依赖：</p><ol><li>使用Flink官方为特定版本Hadoop构建的二进制发行版</li><li>自行为特定版本Hadoop构建Flink</li></ol><p>可能官方提供的发行版不能适配当前部署的Hadoop时，比如Hadoop版本不一致，或者当前使用其他发行商版本的Hadoop(例如Cloudera的CDH)。此时需要下载源码自行编译Flink自行编译，然后进入源码目录执行如下命令之一：</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">// 为特定版本的Apache Hadoop构建Flink</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mvn clean </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -DskipTests -Dhadoop.version</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2.6</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 为特定版本的其他发行商Hadoop构建Flink</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mvn clean </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -DskipTests -Pvendor-repos -Dhadoop.version</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2.6</span><span class="token plain">.1-cdh5.0.0</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>构建好的二进制文件在<code>build-target</code>目录下。</p><ol start="3"><li>使用Hadoop无关的Flink发行版，然后手动配置<code>HADOOP_CLASSPATH</code>环境变量，比如<code>export HADOOP_CLASSPATH=`hadoop classpath` </code></li></ol><p>处理配置Hadoop依赖路径外，<strong>还需要提供Hadoop配置文件路径</strong>，通过<code>HADOOP_CONF_DIR</code>(❤️优先)或者<code>HADOOP_CONF_PATH</code>环境变量指定，这样Flink可以连接到YARN和HDFS服务。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="文件系统设置">文件系统设置<a class="hash-link" href="#文件系统设置" title="Direct link to heading">​</a></h2><p>Flink在许多情况下都用到文件系统：比如文件系统source连接器、应用检查点保存、分发应用JAR包等。由于其分布式特性，Flink也要求文件系统能够全局访问，常用的有HDFS、S3和NFS。Flink使用<code>org.apache.flink.core.fs.FileSystem</code>类表示文件系统，它提供通用的文件操作：读写文件、创建文件夹、列出文件夹内容列表等。每个JobManager或TaskManger实例化一个FileSystem对象然后共享给本地所有任务，以此确保约束配置(如对打开连接数量的限制)生效。</p><p>Flink提供了如下常用文件系统的实现：</p><ol><li><strong>本地文件系统</strong>：Flink内置支持本地文件系统，包括本地挂载的网络文件系统(NFS或SAN等)，不需要额外配置，访问路径格式为<code>file://&lt;URI&gt;</code>；</li><li><strong>Hadoop HDFS</strong>：需要配置Hadoop依赖，见上一小节，访问路径格式为<code>hdfs://&lt;URI&gt;</code>;</li><li><strong>Amazon S3</strong>：Flink基于Apache Hadoop和Presto实现了2种访问S3的连接器，需要将位于opt文件夹下的<code>flink-s3-fs-hadoop-${version}.jar</code>和<code>flink-s3-fs-presto-${version}.jar</code>移到lib文件夹中，访问格式为<code>s3://&lt;URI&gt;</code>；</li><li><strong>OpenStack Swift FS</strong>：Flink基于Apache Hadoop实现Swift FS连接器，需要将opt文件夹下的<code>flink-swift-fs-hadoop-${version}.jar</code>移到lib文件夹中，访问格式为<code>swift://&lt;URI&gt;</code>。</li></ol><p>对于其他未列出的文件系统，通过正确配置，Flink可以委托HDFS连接器来访问，这也是为什么Flink能支持所有HCFS(Hadoop-compatible file systems)。在conf.yaml中可配置的文件系统相关参数如下表所示：</p><table><thead><tr><th>参数名</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>fs.default-scheme</code></td><td><code>file://</code></td><td>默认文件系统前缀</td></tr><tr><td><code>fs.&lt;scheme&gt;.limit.total</code></td><td>无</td><td>特定scheme文件系统的连接总数限制，0或-1表示无限制</td></tr><tr><td><code>fs.&lt;scheme&gt;.limit.input</code></td><td>无</td><td>特定scheme文件系统的读连接数限制，0或-1表示无限制</td></tr><tr><td><code>fs.&lt;scheme&gt;.limit.output</code></td><td>无</td><td>特定scheme文件系统的写连接数限制，0或-1表示无限制</td></tr><tr><td><code>fs.&lt;scheme&gt;.limit.timeout</code></td><td>无</td><td>特定scheme文件系统的连接超时限制，单位毫秒，0表示无限制</td></tr><tr><td><code>fs.&lt;scheme&gt;.limit.stream-timeout</code></td><td>无</td><td>特定scheme文件系统的限制时间限制，单位毫秒，0表示无限制</td></tr></tbody></table><p>自定义文件系统实现详见官方文档<a href="https://nightlies.apache.org/flink/flink-docs-stable/docs/deployment/filesystems/overview/#adding-a-new-pluggable-file-system-implementation" target="_blank" rel="noopener noreferrer">Adding a new pluggable File System implementation</a>。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="系统配置">系统配置<a class="hash-link" href="#系统配置" title="Direct link to heading">​</a></h2><p>Flink提供了许多参数来配置行为和调整性能，所有参数在<code>${FLINK_HOME}/conf/flink-conf.yaml</code>中以键值对的形式设置。该配置文件会被不同组件使用，比如集群启动脚本<code>/bin/start-cluster.sh</code>会读取JVM参数配置，CLI客户端<code>/bin/flink</code>会读取连接到master进程的连接信息，<strong>修改配置文件需要重启Flink集群</strong>。</p><p>为了让Flink开箱即用，flink-conf.yaml文件预配置为本地启动Flink，在分布式环境下需要调整配置。本节介绍搭建Flink集群需要的配置，更多配置见<a href="https://nightlies.apache.org/flink/flink-docs-stable/docs/deployment/config/" target="_blank" rel="noopener noreferrer">官方文档</a>。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="java环境和类加载">Java环境和类加载<a class="hash-link" href="#java环境和类加载" title="Direct link to heading">​</a></h3><p>Flink默认从<code>PATH</code>环境变量中找到java程序来启动进程，如果<code>PATH</code>环境变量中不存在Java或者想要换个Java版本，可以通过<code>JAVA_HOME</code>环境变量或者flink-conf.yaml中的<code>env.java.home</code>参数指定。除此之外，可以通过<code>env.java.opts</code>、<code>env.java.opts.jobmanager</code>以及<code>env.java.opts.taskmanager</code>设置启动进程的JVM参数。</p><p>当运行带有外部依赖的作业时，类加载问题并不少见。Flink将每个作业的依赖类登记到分隔的用户加载器中，确保作业之间的依赖互不影响，也不影响Flink运行时，当作业结束后用户加载器也会被销毁。Flink系统加载器从<code>${FLINK_HOME}/lib</code>文件夹中加载所有JAR包，而用户类加载器派生自系统加载器。</p><p>Flink加载类顺序由参数<code>classloader.resolve-order</code>指定，默认为<code>child-first</code> ，即Flink先通过用户类加载器解析依赖类然后通过系统加载器解析，避免应用使用和Flink相同的依赖但是版本不同的冲突。将该参数设置为<code>parent-first</code>，则顺序相反。</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</h5></div><div class="admonition-content"><p>由<code>classloader.parent-first-patterns.default</code>指定的类总是由系统类加载器解析，通过<code>classloader.parent-first-patterns.additional</code>来添加更多这样的类</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="cpu">CPU<a class="hash-link" href="#cpu" title="Direct link to heading">​</a></h3><p>Flink并不会主动限制其CPU资源使用，但会通过slot来控制任务数量。每个槽可以执行应用算子的一个并行任务，因此一个应用所需要的slot数量至少等于其所有算子的最大并行度。任务在TaskManager进程内以线程形式执行，并且尽量占用其所获得的资源。</p><p>通过参数<code>taskmanager.numberOfTaskSlots</code>设置每个TaskManager提供的slot数量，默认为1。<strong>slot数量通常只需要在standalone模式下配置，在集群资源管理器上运行Flink时可以启动很容易地在每个节点上穹顶多个TaskManager(slot数量为1)。</strong></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="内存和网络缓冲">内存和网络缓冲<a class="hash-link" href="#内存和网络缓冲" title="Direct link to heading">​</a></h3><p>Flink的master和worker进程有着不同的内存需求，前者管理计算资源并协调应用执行，而后者处理潜在的大量数据。因此，master进程的内存消耗处于中等，通过<code>jobmanager.heap.size</code>配置其堆内存(默认1GB)。</p><p>Worker进程的内存设置更加复杂，最重要的堆大小通过<code>taskmanager.heap.size</code>参数设置。使用堆的对象包括TaskManager运行时、算子和函数以及传输的数据。注意一个task可能就耗光整个JVM堆内存，如果应用依赖许多包也会造成非堆内存的显著消耗。</p><p>除了JVM外，Flink的网络栈也是内存消耗大户。Flink的网络栈基于Netty，它使用本地内存作为网络缓冲区。缓冲区的数量依赖于算子任务的连接方式和并发度，当缓冲区数量不够时作业提交后会抛出<code>java.io.IOException: Insufficient number of network buffers</code>异常。通过参数<code>taskmanager.network.memory.segment-size</code>指定网络缓冲区大小。</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</h5></div><div class="admonition-content"><p>原书提到的<code>taskmanager.network.memory.fraction</code>、<code>taskmanager.network.memory.min</code>和<code>taskmanager.network.memory.max</code>参数已经删除，详见<a href="https://nightlies.apache.org/flink/flink-docs-release-1.14/docs/deployment/config/#full-taskmanageroptions" target="_blank" rel="noopener noreferrer">Full TaskManagerOptions</a></p></div></div><p>当使用RocksDB作为状态后端时，<strong>Flink会为每个task的键控算子创建一个单独的RocksDB实例</strong>，默认配置下每个column族会消耗200MB到240MB的堆外内存，可以通过RocksDB的配置调整性能。</p><p>当配置TaskManager的内存时，需要调整堆内存大小以便留有充足的堆外内存。<strong>注意，一些资源管理器(如YARN)会在容器超出内存分配时立即终止容器。</strong></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="磁盘存储">磁盘存储<a class="hash-link" href="#磁盘存储" title="Direct link to heading">​</a></h3><p>Flink worker进程在很多情况下使用本地文件系统存储数据，比如接收应用JAR包、写日志、状态维护等，相关的文件路径参数如下表所示：</p><table><thead><tr><th>参数</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>io.tmp.dirs</code></td><td><code>java.io.tmpdir</code>系统变量</td><td>在Linux和MacOS系统上默认为<code>/tmp</code>，该目录会被定时清理，建议重新社会</td></tr><tr><td><code>env.log.dir</code></td><td><code>${FLINK_HOME}/log</code></td><td>TaskManager存储日志路径</td></tr><tr><td><code>blob.storage.directory</code></td><td>无</td><td>Blob server存储路径，用于交换大文件</td></tr><tr><td><code>state.backend.rocksdb.localdir</code></td><td><code>io.tmp.dirs</code></td><td>RocksDB存储状态路径</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_mojV" id="检查点和状态后端">检查点和状态后端<a class="hash-link" href="#检查点和状态后端" title="Direct link to heading">​</a></h3><p>所有检查点和状态后端的配置都可以通过代码执行，详见<a href="/docs/Stream-Processing-with-Apache-Flink/Chap10/#%E8%B0%83%E6%95%B4%E6%A3%80%E6%9F%A5%E7%82%B9%E5%92%8C%E6%95%85%E9%9A%9C%E6%81%A2%E5%A4%8D">调整检查点和故障恢复</a>，在配置文件中可设置的相关参数如下表所示：</p><table><thead><tr><th>参数</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>state.backend</code></td><td>无</td><td>状态后端类型，可选jobmanager，filesystem，rocksdb或者CheckpointStorageFactory工厂类名</td></tr><tr><td><code>state.backend.async</code></td><td><code>${FLINK_HOME}/log</code></td><td>TaskManager存储日志路径</td></tr><tr><td><code>state.backend.incremental</code></td><td>false</td><td>是否开启增量检查点，不支持增量检查点的状态后端会忽略该配置</td></tr><tr><td><code>state.checkpoints.dir</code></td><td>无</td><td>检查点数据保存目录</td></tr><tr><td><code>state.savepoints.dir</code></td><td>无</td><td>保存点数据保存目录</td></tr><tr><td><code>state.backend.local-recovery</code></td><td>false</td><td>是否开启本地状态恢复，本地恢复目前只覆盖键控状态后端</td></tr><tr><td><code>taskmanager.state.local.root-dirs</code></td><td>无</td><td>本地状态副本文件保存目录，用于本地状态恢复</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_mojV" id="安全">安全<a class="hash-link" href="#安全" title="Direct link to heading">​</a></h3><p>在安全方面，Flink支持Kerberos认证以及通过SSL加密所有网络通信。Flink将Kerberos认证集成到Hadoop及其生态组件，如YARN、HDFS、HBase等，并支持2种认证模式：keytabs和Hadoop授权token。推荐使用keytabs，因为token有时效会导致作业运行失败。<strong>注意证书是和Flink集群绑定而不是某个运行作业</strong>，想要使用不同的证书应该新开一个Flink集群，详见<a href="https://nightlies.apache.org/flink/flink-docs-release-1.14/docs/deployment/security/security-kerberos/" target="_blank" rel="noopener noreferrer">Kerberos Authentication Setup and Configuration</a>。</p><p>Flink内部组件之间使用SSL互相认证通信，而Flink与外部系统的通信通过REST/HTTP端点实现，也可以用SSL加密对外通信，但推荐设置一个专门的代理服务。目前还不支持状态查询服务的加密和认证。默认SSL认证未开启，开启步骤详见<a href="https://nightlies.apache.org/flink/flink-docs-release-1.14/docs/deployment/security/security-ssl/#configuring-ssl" target="_blank" rel="noopener noreferrer">Configuring SSL </a>。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="总结">总结<a class="hash-link" href="#总结" title="Direct link to heading">​</a></h2><ol><li>Flink部署模式分为Standalone、K8S和YARN这3种；</li><li>Worker故障由Flink自行处理，但master故障恢复需要配置高可用；</li><li>集成Hadoop组件有直接下载官方包、自行编译或者手动引入依赖3种方法；</li><li>使用HDFS等文件系统需要将opt目录下对应jar包移到lib目录开启使用；</li><li>Flink详细的系统配置见<a href="https://nightlies.apache.org/flink/flink-docs-stable/docs/deployment/config/" target="_blank" rel="noopener noreferrer">Configuration</a>。</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/docs/tags/stream-processing">Stream Processing</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/docs/tags/apache-flink">Apache Flink</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/docs/tags/reading-notes">ReadingNotes</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kayhaw/kayhaw.github.io/edit/master/website/docs/Stream Processing with Apache Flink/Stream-Processing-with-Apache-Flink-Chap09.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Stream-Processing-with-Apache-Flink/Chap08"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">读写外部系统</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Stream-Processing-with-Apache-Flink/Chap10"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">运维Flink和流应用</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#部署模式" class="table-of-contents__link toc-highlight">部署模式</a><ul><li><a href="#standalone集群" class="table-of-contents__link toc-highlight">Standalone集群</a></li><li><a href="#docker" class="table-of-contents__link toc-highlight">Docker</a></li><li><a href="#apache-hadoop-yarn" class="table-of-contents__link toc-highlight">Apache Hadoop YARN</a></li><li><a href="#kubernetes" class="table-of-contents__link toc-highlight">Kubernetes</a></li></ul></li><li><a href="#高可用设置" class="table-of-contents__link toc-highlight">高可用设置</a><ul><li><a href="#高可用standalone模式设置" class="table-of-contents__link toc-highlight">高可用Standalone模式设置</a></li><li><a href="#高可用yarn设置" class="table-of-contents__link toc-highlight">高可用YARN设置</a></li><li><a href="#高可用k8s设置" class="table-of-contents__link toc-highlight">高可用K8S设置</a></li></ul></li><li><a href="#集成hadoop组件" class="table-of-contents__link toc-highlight">集成Hadoop组件</a></li><li><a href="#文件系统设置" class="table-of-contents__link toc-highlight">文件系统设置</a></li><li><a href="#系统配置" class="table-of-contents__link toc-highlight">系统配置</a><ul><li><a href="#java环境和类加载" class="table-of-contents__link toc-highlight">Java环境和类加载</a></li><li><a href="#cpu" class="table-of-contents__link toc-highlight">CPU</a></li><li><a href="#内存和网络缓冲" class="table-of-contents__link toc-highlight">内存和网络缓冲</a></li><li><a href="#磁盘存储" class="table-of-contents__link toc-highlight">磁盘存储</a></li><li><a href="#检查点和状态后端" class="table-of-contents__link toc-highlight">检查点和状态后端</a></li><li><a href="#安全" class="table-of-contents__link toc-highlight">安全</a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">读书笔记</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.zhihu.com/people/xiao-ke-dou-7" target="_blank" rel="noopener noreferrer" class="footer__link-item">知乎<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 何轲(Kay Haw). Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a8170a08.js"></script>
<script src="/assets/js/main.1794f536.js"></script>
</body>
</html>