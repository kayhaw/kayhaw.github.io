"use strict";(self.webpackChunkkayhaw_github_io=self.webpackChunkkayhaw_github_io||[]).push([[244],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var u=r.createContext({}),l=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(u.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,u=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=l(n),m=o,f=d["".concat(u,".").concat(m)]||d[m]||s[m]||a;return n?r.createElement(f,c(c({ref:t},p),{},{components:n})):r.createElement(f,c({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,c=new Array(a);c[0]=d;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i.mdxType="string"==typeof e?e:o,c[1]=i;for(var l=2;l<a;l++)c[l]=n[l];return r.createElement.apply(null,c)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6016:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return u},metadata:function(){return l},assets:function(){return p},toc:function(){return s},default:function(){return m}});var r=n(7462),o=n(3366),a=(n(7294),n(3905)),c=["components"],i={title:"FlinkX\u6e90\u7801\u5256\u6790(2)",author:"\u4f55\u8f72",author_title:"Never settle down",author_url:"https://github.com/kayhaw",author_image_url:"https://avatars.githubusercontent.com/u/16892835?v=4",tags:["FlinkX","Source code dissection"],description:"FlinkX\u6e90\u7801\u5256\u6790(2)",hide_table_of_contents:!1},u=void 0,l={permalink:"/blog/2022/01/17/FlinX-Source-Code-Dissection-02",editUrl:"https://github.com/kayhaw/kayhaw.github.io/edit/master/website/blog/blog/2022-01-17-FlinX-Source-Code-Dissection-02.md",source:"@site/blog/2022-01-17-FlinX-Source-Code-Dissection-02.md",title:"FlinkX\u6e90\u7801\u5256\u6790(2)",description:"FlinkX\u6e90\u7801\u5256\u6790(2)",date:"2022-01-17T00:00:00.000Z",formattedDate:"January 17, 2022",tags:[{label:"FlinkX",permalink:"/blog/tags/flink-x"},{label:"Source code dissection",permalink:"/blog/tags/source-code-dissection"}],readingTime:2.06,truncated:!0,authors:[{name:"\u4f55\u8f72",title:"Never settle down",url:"https://github.com/kayhaw",imageURL:"https://avatars.githubusercontent.com/u/16892835?v=4"}],prevItem:{title:"Hadoop 3.x\u5b66\u4e60\u7b14\u8bb0(1)",permalink:"/blog/2022/01/29/Learning-Hadoop3.x-01"},nextItem:{title:"\u9879\u76ee\u5347\u7ea7BUG\u603b\u7ed3",permalink:"/blog/2022/01/16/\u9879\u76ee\u5347\u7ea7BUG\u603b\u7ed3"}},p={authorsImageUrls:[void 0]},s=[{value:"Source\u7b97\u5b50\u7684\u6784\u9020",id:"source\u7b97\u5b50\u7684\u6784\u9020",children:[{value:"JdbcInputFormatBuilder",id:"jdbcinputformatbuilder",children:[]},{value:"RowConverter",id:"rowconverter",children:[]},{value:"\u521b\u5efa\u8f93\u51fa\u6d41",id:"\u521b\u5efa\u8f93\u51fa\u6d41",children:[]}]},{value:"DtInputFormatSourceFunction",id:"dtinputformatsourcefunction",children:[{value:"BaseRichInputFormat.open\u65b9\u6cd5",id:"baserichinputformatopen\u65b9\u6cd5",children:[]}]}],d={toc:s};function m(e){var t=e.components,n=(0,o.Z)(e,c);return(0,a.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"\ud83d\udcddFlinkX\u6e90\u7801\u5256\u6790(2)\uff1a\u57fa\u4e8eJDBC\u7684Source\u548cSink\u7b97\u5b50\u6784\u9020\u6d41\u7a0b\u3002\u4ee3\u7801\u6ce8\u91ca\u89c1",(0,a.kt)("a",{parentName:"p",href:"https://github.com/kayhaw/flinkx/tree/1.12_release_dissection"},(0,a.kt)("img",{parentName:"a",src:"https://img.shields.io/badge/flinkx-1.12__release__dissection-blue",alt:"FlinkX Dissection"})),"\u3002"),(0,a.kt)("h2",{id:"source\u7b97\u5b50\u7684\u6784\u9020"},"Source\u7b97\u5b50\u7684\u6784\u9020"),(0,a.kt)("p",null,"\u4e0a\u4e00\u7bc7\u6587\u7ae0\u5206\u6790\u5230\uff0cFlinkX\u901a\u8fc7",(0,a.kt)("inlineCode",{parentName:"p"},"SourceFactory.createSource()"),"\u6765\u521b\u5efasource\u7b97\u5b50\u5e76\u8fd4\u56deDataStream<RowData",">","\u3002\u7531\u4e8eSourceFactory\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u5e76\u4e14createSource\u65b9\u6cd5\u662f\u4e00\u4e2a\u62bd\u8c61\u65b9\u6cd5\uff0c\u56e0\u6b64\u5fc5\u5b9a\u7531SourceFactory\u7684\u5177\u4f53\u5b50\u7c7b\u6765\u5b9e\u73b0createSource\u65b9\u6cd5(\u6bd4\u5982MysqlSourceFactory)\u3002\u5b9e\u9645\u4e0a\uff0c\u51e0\u4e4e\u6240\u6709\u5173\u7cfb\u578b\u6570\u636e\u5e93\u90fd\u7ee7\u627f\u81eaJdbcSourceFactory\u5e76\u590d\u7528\u5176\u65b9\u6cd5\uff0c\u63a5\u4e0b\u6765\u5177\u4f53\u5206\u6790JdbcSourceFactory\u6e90\u7801(\u5982Kafka\u548cHDFS\u7b49Source\u5176\u4ed6\u7b97\u5b50\u4e4b\u540e\u518d\u770b)\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="com/dtstack/flinkx/connector/jdbc/source/JdbcSourceFactory.java"',title:'"com/dtstack/flinkx/connector/jdbc/source/JdbcSourceFactory.java"'},"public DataStream<RowData> createSource() {\n    JdbcInputFormatBuilder builder = getBuilder();\n\n    // fetchSize\u548cqueryTimeOut\u4e0d\u53ef\u4ee5\u4e3a0\uff0c\u5426\u5219\u7528\u9ed8\u8ba4\u8bbe\u7f6e\u66ff\u6362\n    int fetchSize = jdbcConf.getFetchSize();\n    jdbcConf.setFetchSize(fetchSize == 0 ? getDefaultFetchSize() : fetchSize);\n\n    int queryTimeOut = jdbcConf.getQueryTimeOut();\n    jdbcConf.setQueryTimeOut(queryTimeOut == 0 ? DEFAULT_QUERY_TIMEOUT : queryTimeOut);\n\n    // \u7ed9builder\u8bbe\u7f6ejdbcConf\u3001jdbcDialect\u548crowConverter\n    builder.setJdbcConf(jdbcConf);\n    builder.setJdbcDialect(jdbcDialect);\n\n    AbstractRowConverter rowConverter = null;\n    if (!useAbstractBaseColumn) {\n        checkConstant(jdbcConf);\n        final RowType rowType =\n                TableUtil.createRowType(jdbcConf.getColumn(), getRawTypeConverter());\n        rowConverter = jdbcDialect.getRowConverter(rowType);\n    }\n    builder.setRowConverter(rowConverter);\n\n    return createInput(builder.finish());\n}\n")),(0,a.kt)("p",null,"createSource\u7684\u903b\u8f91\u53ef\u4ee5\u5206\u4e3a3\u6b65\uff1a1.\u8bbe\u7f6eJdbcInputFormatBuilder.\u8bbe\u7f6eRowConverter\uff1b3.\u521b\u5efa\u8f93\u51fa\u6d41\u3002"),(0,a.kt)("h3",{id:"jdbcinputformatbuilder"},"JdbcInputFormatBuilder"),(0,a.kt)("p",null,"\u4ece\u5176\u540d\u79f0\u540e\u7f00\u53ef\u4ee5\u770b\u51fa\uff0cJdbcInputFormatBuilder\u662fJdbcInputFormat\u7684\u6784\u9020\u7c7b\uff0c\u5373FlinkX\u4f7f\u7528Builder\u8bbe\u8ba1\u6a21\u5f0f\u6765\u521b\u5efaJdbcInputFormat\u5bf9\u8c61\u3002getBuilder\u65b9\u6cd5\u5982\u4e0b\u6240\u793a\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"protected JdbcInputFormatBuilder getBuilder() {\n    return new JdbcInputFormatBuilder(new JdbcInputFormat());\n}\n")),(0,a.kt)("p",null,"JdbcSourceFactory\u7684\u5b50\u7c7b\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199getBuilder\u65b9\u6cd5\u6765\u8fd4\u56de\u81ea\u5b9a\u4e49\u7684JdbcInputFormat\uff0c\u6bd4\u5982Db2SourceFactory\u3002\u800cJdbcInputFormat\u7ee7\u627f\u81eaBaseRichInputFormat\uff0c\u5b83\u662fFlinkX\u6240\u6709source\u7b97\u5b50\u7684\u57fa\u7840\uff0c\u5e76\u7ee7\u627f\u81eaFlink API \u63d0\u4f9b\u7684RichInputFormat\u7c7b\u3002\u73b0\u5728\u53ea\u9700\u8981\u5148\u8bb0\u7740\u6211\u4eec\u6784\u9020\u7684InputFormat\u662fJdbcInputFormat\u5b9e\u4f8b\u3002"),(0,a.kt)("h3",{id:"rowconverter"},"RowConverter"),(0,a.kt)("p",null,"RowConverter\u8d1f\u8d23\u5c06JDBC\u8bfb\u53d6\u7684\u6570\u636e\u8f6c\u4e3aFlink API\u4e2d\u7684RowData\u5f62\u5f0f\uff0c\u66f4\u5177\u4f53\u70b9\uff0c",(0,a.kt)("strong",{parentName:"p"},"\u5b83\u5c06JDBC\u5b57\u6bb5\u7c7b\u578b\u6620\u5c04\u4e3aFlink\u4e2d\u7684DataType\u7c7b\u578b"),"\u3002\u4ee5MySQL\u4e3a\u4f8b\u5206\u6790\uff0cTableUtil.createRowType\u65b9\u6cd5\u6e90\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"public static RowType createRowType(List<FieldConf> fields, RawTypeConverter converter) {\n    String[] fieldNames = fields.stream().map(FieldConf::getName).toArray(String[]::new);\n    String[] fieldTypes = fields.stream().map(FieldConf::getType).toArray(String[]::new);\n    TableSchema.Builder builder = TableSchema.builder();\n    for (int i = 0; i < fieldTypes.length; i++) {\n        DataType dataType = converter.apply(fieldTypes[i]);\n        builder.add(TableColumn.physical(fieldNames[i], dataType));\n    }\n\n    return (RowType) builder.build().toRowDataType().getLogicalType();\n}\n")),(0,a.kt)("p",null,"\u8be5\u65b9\u6cd5\u904d\u5386\u5b57\u6bb5\u7c7b\u578b\u5217\u8868\uff0c\u7531RawTypeConverter.apply\u65b9\u6cd5\u8fd4\u56de\u6bcf\u4e2a\u7c7b\u578b\u5e94\u8be5\u5bf9\u5e94\u7684DataType\u7c7b\u578b\u3002\u56e0\u6b64\uff0c\u51fd\u6570\u5f0f\u63a5\u53e3RawTypeConverter\u7684\u5b9e\u73b0\u5c31\u5c24\u4e3a\u91cd\u8981\uff0c\u5e76\u4e14\u6bcf\u79cd\u6570\u636e\u5e93\u7684\u5e94\u8be5\u5404\u4e0d\u76f8\u540c\u3002\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff0cRawTypeConverter\u7531JdbcSourceFactory\u7c7b\u7684\u6210\u5458\u53d8\u91cfjdbcDialect\u7ed9\u51fa\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"@Override\npublic RawTypeConverter getRawTypeConverter() {\n    return jdbcDialect.getRawTypeConverter();\n}\n")),(0,a.kt)("p",null,"\u800cjdbcDialect\u53c8\u662f\u5728JdbcSourceFactory\u552f\u4e00\u7684\u6784\u9020\u51fd\u6570\u4e2d\u88ab\u8bbe\u7f6e\uff0c\u5982\u4e0b\u6240\u793a\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"public JdbcSourceFactory(\n      SyncConf syncConf, StreamExecutionEnvironment env, JdbcDialect jdbcDialect) {\n  // \u53c8\u5206\u4e86\u4e00\u5c42\uff0c\u7236\u7c7b\u8c03\u7528\n  super(syncConf, env);\n  // jdbcDialect\u7531\u6bcf\u4e2a\u5b50\u7c7b\u81ea\u5df1\u5b9e\u73b0\n  this.jdbcDialect = jdbcDialect;\n  ...\n}\n")),(0,a.kt)("p",null,"\u56de\u987e\u4e0a\u4e00\u7bc7\u6587\u7ae0\u7684\u5185\u5bb9\uff0c\u901a\u8fc7\u53cd\u5c04\u6765\u521b\u5efaSourceFactory\u5bf9\u8c61\u7684\u4ee3\u7801\u4e3a",(0,a.kt)("inlineCode",{parentName:"p"},"Constructor<?> constructor =clazz.getConstructor(SyncConf.class, StreamExecutionEnvironment.class)"),"\u3002\u8bf6\uff0c\u600e\u4e48\u5c11\u4e86\u4e00\u4e2aJdbcDialect\u53c2\u6570\uff1f\u6ce8\u610f\u5b9e\u9645\u8c03\u7528\u7684\u662f\u5b50\u7c7bxxxSourceFactory\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u4ee5MysqlSourceFactory\u4e3a\u4f8b\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u662f\u4f20\u5165\u4e86\u81ea\u5df1\u5b9a\u4e49\u7684MysqlDialect\u5bf9\u8c61\uff0c\u800cMysqlDialect\u7684getRawTypeConverter\u8fd4\u56de\u7684\u662fMysqlRawTypeConverter\u7c7b\u7684apply\u65b9\u6cd5\u5f15\u7528\uff0c\u7531\u5b83\u6765\u51b3\u5b9aMySQL\u7684JDBC\u5b57\u6bb5\u7c7b\u578b\u5e94\u8be5\u5bf9\u5e94\u54ea\u4e00\u79cdFlink DataTypes\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"public MysqlSourceFactory(SyncConf syncConf, StreamExecutionEnvironment env) {\n    // JdbcSourceFactory\u5b8c\u6210\u901a\u7528\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u516c\u5171\u529f\u80fd\n    super(syncConf, env, new MysqlDialect());\n    // \u907f\u514dresult.next\u963b\u585e\n    if (jdbcConf.isPolling()\n            && StringUtils.isEmpty(jdbcConf.getStartLocation())\n            && jdbcConf.getFetchSize() == 0) {\n        jdbcConf.setFetchSize(1000);\n    }\n}\n")),(0,a.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\u5c0f\u7ed3")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"\u53ea\u9700\u8981\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684xxxSourceFactory\u3001xxxDialect\u548cxxxRawTypeConverter\u7c7b\u5c31\u53ef\u4ee5\u8f7b\u677e\u5730\u6dfb\u52a0\u4e00\u79cdJDBC\u6570\u636e\u6e90\u7684source\u7b97\u5b50\uff0c\u8fd9\u662f\u7b56\u7565\u6a21\u5f0f+\u6a21\u677f\u6a21\u5f0f\u7684\u597d\u5904\u3002"))),(0,a.kt)("h3",{id:"\u521b\u5efa\u8f93\u51fa\u6d41"},"\u521b\u5efa\u8f93\u51fa\u6d41"),(0,a.kt)("p",null,"JdbcSourceFactory\u901a\u8fc7",(0,a.kt)("inlineCode",{parentName:"p"},"createInput(builder.finish())"),"\u6765\u521b\u5efa\u8f93\u51fa\u6d41\uff0c\u8be5\u65b9\u6cd5\u53c8\u8c03\u7528\u6765\u81ea\u7236\u7c7bSourceFactory\u7684createInput\u65b9\u6cd5\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="com/dtstack/flinkx/source/SourceFactory.java"',title:'"com/dtstack/flinkx/source/SourceFactory.java"'},"protected DataStream<RowData> createInput(InputFormat<RowData, InputSplit> inputFormat) {\n    return createInput(inputFormat, this.getClass().getSimpleName().toLowerCase());\n}\n")),(0,a.kt)("p",null,"SourceFactory\u7c7bcreateInput\u65b9\u6cd5\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff0c\u5728\u68c0\u67e5\u4f20\u5165\u53c2\u6570\u975e\u7a7a\u540e\uff0c\u901a\u8fc7\u4f20\u5165\u7684inputformat\u548cgetTypeInformation()\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u6784\u9020DtInputFormatSourceFunction\uff0c\u81f3\u6b64\u7ec8\u4e8e\u5f97\u5230\u4e86SourceFunction\u65b9\u6cd5\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u4f7f\u7528env.add\u65b9\u6cd5\u5c06\u5176\u6dfb\u52a0\u5230\u6d41\u6267\u884c\u73af\u5883\uff0c\u5e76\u8fd4\u56de\u8f93\u51fa\u6d41\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"protected DataStream<RowData> createInput(\n            InputFormat<RowData, InputSplit> inputFormat, String sourceName) {\n    Preconditions.checkNotNull(sourceName);\n    Preconditions.checkNotNull(inputFormat);\n\n    DtInputFormatSourceFunction<RowData> function =\n            new DtInputFormatSourceFunction<>(inputFormat, getTypeInformation());\n    // \u6dfb\u52a0source\u7b97\u5b50\uff0c\u7b97\u5b50\u540d\u79f0\u662f\u5de5\u5382\u7c7b\u540d\u7684\u5168\u5c0f\u5199\u6a21\u5f0f\uff0c\u5982mysqlsourcefactory\n    return env.addSource(function, sourceName, getTypeInformation());\n}\n")),(0,a.kt)("h2",{id:"dtinputformatsourcefunction"},"DtInputFormatSourceFunction"),(0,a.kt)("p",null,"DtInputFormatSourceFunction\u7ee7\u627f\u81eaFlink DataStream API\u4e2d\u7684InputFormatSourceFunction\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5b83\u4f9d\u8d56\u4e8eInputFormat\u6765\u63d0\u4f9b\u6570\u636e\u3002DtInputFormatSourceFunction\u91cd\u5199\u4e86\u5982\u4e0b\u751f\u547d\u5468\u671f\u65b9\u6cd5\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"// \u51c6\u5907\u8f93\u51fa\u73af\u5883\npublic void open(Configuration parameters);\n\n// \u6267\u884c\u8f93\u51fa\u6570\u636e\u6d41\u7684\u51fd\u6570\u4f53\npublic void run(SourceContext<OUT> ctx) throws Exception;\n\n// \u53d6\u6d88\u6267\u884c\uff0c\u5c31\u662f\u5c06run\u65b9\u6cd5\u7684\u8fd0\u884c\u6807\u5fd7\u503c\u4e3afalse\npublic void cancel();\n\n// \u5173\u95ed\u8f93\u51fa\u6d41\uff0c\u8c03\u7528gracefulClose\u4ee3\u52b3\npublic void public void close() throws Exception;\n")),(0,a.kt)("p",null,"\u5176\u4e2d\uff0c\u6700\u91cd\u8981\u7684run\u65b9\u6cd5\u4ee3\u7801\u5982\u4e0b\u6240\u793a\u3002\u9996\u5148\u8c03\u7528format\u7684openInputFormat\u65b9\u6cd5\u8bbe\u7f6e\u8bbe\u7f6ejobName\u3001jobId\u548c\u4efb\u52a1\u7f16\u53f7\uff0c\u5e76\u4e14\u8fd8\u8bbe\u7f6e\u4e86\u8bfb\u53d6\u7684\u5f00\u59cb\u65f6\u95f4\u3002\u63a5\u7740\u5728while\u5faa\u73af\u4e2d\u4e0d\u65ad\u4ea7\u751f\u4e00\u6761\u8f93\u51fa\u6570\u636e\uff0c\u5173\u952e\u65b9\u6cd5\u5206\u522b\u662fformat.open()\u3001format.nextRecord\uff0c\u63a5\u4e0b\u6765\u5177\u4f53\u5206\u6790\u3002"),(0,a.kt)("details",null,(0,a.kt)("summary",null,"DtInputFormatSourceFunction.run()"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'public void run(SourceContext<OUT> ctx) throws Exception {\n    Exception tryException = null;\n    try {\n\n        Counter completedSplitsCounter =\n                getRuntimeContext().getMetricGroup().counter("numSplitsProcessed");\n        if (isRunning && format instanceof RichInputFormat) {\n            // openInputFormat\u8bbe\u7f6ejobName\u3001jobId\u548c\u4efb\u52a1\u7f16\u53f7\uff0c\u5e76\u4e14\u5f00\u542f\u81ea\u5b9a\u4e49reporter\n            // \u5e76\u4e14\u8bbe\u7f6e\u8bfb\u53d6\u7684\u5f00\u59cb\u65f6\u95f4\n            ((RichInputFormat) format).openInputFormat();\n        }\n\n        OUT nextElement = serializer.createInstance();\n        while (isRunning) {\n            // \u8c03\u7528BaseRichInputFormat.open\u65b9\u6cd5\n            format.open(splitIterator.next());\n\n            // for each element we also check if cancel\n            // was called by checking the isRunning flag\n\n            while (isRunning && !format.reachedEnd()) {\n                synchronized (ctx.getCheckpointLock()) {\n                    nextElement = format.nextRecord(nextElement);\n                    if (nextElement != null) {\n                        ctx.collect(nextElement);\n                    }\n                }\n            }\n            format.close();\n            completedSplitsCounter.inc();\n\n            if (isRunning) {\n                isRunning = splitIterator.hasNext();\n            }\n        }\n    } catch (Exception exception) {\n        tryException = exception;\n        LOG.error("Exception happened, start to close format", exception);\n    } finally {\n        isRunning = false;\n        gracefulClose();\n        if (null != tryException) {\n            throw tryException;\n        }\n    }\n}\n'))),(0,a.kt)("h3",{id:"baserichinputformatopen\u65b9\u6cd5"},"BaseRichInputFormat.open\u65b9\u6cd5"),(0,a.kt)("p",null,"\u8be5\u65b9\u6cd5\u6838\u5fc3\u529f\u80fd\u901a\u8fc7\u8c03\u7528\u62bd\u8c61\u65b9\u6cd5openInternal\u5b9e\u73b0\uff0c\u5373\u7531\u6bcf\u4e2a\u5b50\u7c7b\u6839\u636e\u81ea\u8eab\u60c5\u51b5\u5b9e\u73b0\u3002\u5bf9\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0cJdbcInputFormat\u7c7b\u5728openInternal\u65b9\u6cd5\u4e2d\u5b9e\u73b0\u6253\u5f00\u6570\u636e\u5e93\u8fde\u63a5\u5e76\u67e5\u8be2\u8bb0\u5f55\u7684\u903b\u8f91\uff0c\u5177\u4f53\u7684\u53ef\u4ee5\u5206\u4e3a3\u6b65\uff1a\u83b7\u53d6\u8fde\u63a5\u3001\u6784\u9020\u67e5\u8be2SQL\u3001\u6267\u884cSQL\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7b2c\u4e00\u6b65"),"\uff1a\u83b7\u53d6JDBC\u8fde\u63a5\uff0c\u7531getConnection\u65b9\u6cd5\u5b9e\u73b0\uff0c\u6ce8\u610f\u7d27\u63a5\u7740\u5c06autocommit\u8bbe\u7f6e\u4e3afalse\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7b2c\u4e8c\u6b65"),"\uff1a\u6784\u9020\u67e5\u8be2SQL\uff0cFlinkX\u6839\u636e\u81ea\u8eab\u8bbe\u8ba1\u7684\u4e1a\u52a1\u903b\u8f91",(0,a.kt)("strong",{parentName:"p"},"\u5206\u5c42"),"\u6784\u9020sql\u3002"))}m.isMDXComponent=!0}}]);