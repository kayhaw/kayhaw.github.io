"use strict";(self.webpackChunkkayhaw_github_io=self.webpackChunkkayhaw_github_io||[]).push([[7289],{835:function(n,e,t){t.r(e),t.d(e,{assets:function(){return c},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return p}});var a=t(3117),r=t(102),i=(t(7294),t(3905)),o=["components"],s={layout:"article",title:"Pulsar Functions",slug:"/Mastering-Apache-Pulsar/Chap08",tags:["Apache Pulsar","ReadingNotes"]},l=void 0,u={unversionedId:"Mastering Apache Pulsar/Mastering-Apache-Pulsar-Chap08",id:"Mastering Apache Pulsar/Mastering-Apache-Pulsar-Chap08",title:"Pulsar Functions",description:"Mastering Apache Pulsar \u7b2c8\u7ae0\u8bfb\u4e66\u7b14\u8bb0",source:"@site/docs/Mastering Apache Pulsar/07-Mastering-Apache-Pulsar-Chap08.md",sourceDirName:"Mastering Apache Pulsar",slug:"/Mastering-Apache-Pulsar/Chap08",permalink:"/docs/Mastering-Apache-Pulsar/Chap08",draft:!1,editUrl:"https://github.com/kayhaw/kayhaw.github.io/edit/master/website/docs/Mastering Apache Pulsar/07-Mastering-Apache-Pulsar-Chap08.md",tags:[{label:"Apache Pulsar",permalink:"/docs/tags/apache-pulsar"},{label:"ReadingNotes",permalink:"/docs/tags/reading-notes"}],version:"current",sidebarPosition:7,frontMatter:{layout:"article",title:"Pulsar Functions",slug:"/Mastering-Apache-Pulsar/Chap08",tags:["Apache Pulsar","ReadingNotes"]},sidebar:"tutorialSidebar",previous:{title:"Pulsar IO",permalink:"/docs/Mastering-Apache-Pulsar/Chap07"},next:{title:"\u5206\u5c42\u5b58\u50a8",permalink:"/docs/Mastering-Apache-Pulsar/Chap09"}},c={},p=[{value:"\u6d41\u5904\u7406",id:"\u6d41\u5904\u7406",level:2},{value:"Pulsar Functions\u67b6\u6784",id:"pulsar-functions\u67b6\u6784",level:2},{value:"\u8fd0\u884c\u65f6",id:"\u8fd0\u884c\u65f6",level:3},{value:"\u9694\u79bb\u6027",id:"\u9694\u79bb\u6027",level:3},{value:"K8S\u90e8\u7f72\u7684\u9694\u79bb\u6027",id:"k8s\u90e8\u7f72\u7684\u9694\u79bb\u6027",level:2},{value:"\u4f7f\u7528\u793a\u4f8b",id:"\u4f7f\u7528\u793a\u4f8b",level:2},{value:"\u521b\u5efaPulsar Functions",id:"\u521b\u5efapulsar-functions",level:3},{value:"\u7b80\u5355\u4e8b\u4ef6\u5904\u7406",id:"\u7b80\u5355\u4e8b\u4ef6\u5904\u7406",level:3},{value:"Topic\u6e05\u7406",id:"topic\u6e05\u7406",level:3},{value:"\u8131\u654f",id:"\u8131\u654f",level:4},{value:"\u7ffb\u8bd1",id:"\u7ffb\u8bd1",level:4},{value:"Schema\u6807\u51c6\u5316",id:"schema\u6807\u51c6\u5316",level:4},{value:"Topic\u7edf\u8ba1",id:"topic\u7edf\u8ba1",level:3},{value:"\u7d2f\u52a0\u4e2a\u6570",id:"\u7d2f\u52a0\u4e2a\u6570",level:4},{value:"\u72b6\u6001\u8bbe\u7f6e/\u83b7\u53d6",id:"\u72b6\u6001\u8bbe\u7f6e\u83b7\u53d6",level:4},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}],d={toc:p};function m(n){var e=n.components,t=(0,r.Z)(n,o);return(0,i.kt)("wrapper",(0,a.Z)({},d,t,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},(0,i.kt)("em",{parentName:"p"},"Mastering Apache Pulsar")," \u7b2c8\u7ae0\u8bfb\u4e66\u7b14\u8bb0"))),(0,i.kt)("h2",{id:"\u6d41\u5904\u7406"},"\u6d41\u5904\u7406"),(0,i.kt)("p",null,"\u6d41\u5904\u7406\u7cfb\u7edf\u7c7b\u4f3c\u6d88\u8d39\u8005\uff0c\u4f46\u5bf9\u6d88\u606f\u65f6\u95f4\u654f\u611f\u3002\u73b0\u6709\u7684\u6d41\u5904\u7406\u7cfb\u7edf\u5982Spark\u548cFlink\u901a\u8fc7\u8bbe\u8ba1\u63d0\u4f9b\u5b8c\u5584\u7684\u6d41\u5904\u7406\u529f\u80fd\uff1a\u72b6\u6001\u7ba1\u7406\u3001\u6545\u969c\u6062\u590d\u3001\u68c0\u67e5\u70b9\u548c\u6c34\u5370\u3002Pusar Functions\u53ea\u63d0\u4f9b\u65e5\u5e38\u4f7f\u7528\u7684\u6d41\u5904\u7406\u529f\u80fd"),(0,i.kt)("h2",{id:"pulsar-functions\u67b6\u6784"},"Pulsar Functions\u67b6\u6784"),(0,i.kt)("h3",{id:"\u8fd0\u884c\u65f6"},"\u8fd0\u884c\u65f6"),(0,i.kt)("p",null,"Pulsar Function\u652f\u63013\u79cd\u8fd0\u884c\u65f6\uff1a\u57fa\u4e8e\u7ebf\u7a0b\u7684\u3001\u57fa\u4e8e\u8fdb\u7a0b\u7684\u3001\u57fa\u4e8eK8S\u7684\u3002"),(0,i.kt)("h3",{id:"\u9694\u79bb\u6027"},"\u9694\u79bb\u6027"),(0,i.kt)("p",null,"Pulsar Functions\u9ed8\u8ba4\u4f7f\u7528\u57fa\u4e8e\u7ebf\u7a0b\u7684\u8fd0\u884c\u65f6\uff0c\u7ebf\u7a0b\u6a21\u578b\u5171\u4eab\u5185\u5b58\u4f46\u662f\u9694\u79bb\u6027\u4f4e\uff0c\u5728Go\u548cPython API\u4e2dPulsar Functions\u4f7f\u7528\u57fa\u4e8e\u8fdb\u7a0b\u7684\u8fd0\u884c\u65f6\uff0c\u9694\u79bb\u6027\u9ad8\u4f46\u8d44\u6e90\u5f00\u9500\u4e5f\u66f4\u5927\u3002\u4f7f\u7528K8S\u8fd0\u884c\u65f6\u7684Pulsar Functions\u4e0d\u4ec5\u4eab\u53d7K8S\u63d0\u4f9b\u7684\u9694\u79bb\u6027\uff0c\u5e76\u4e14\u652f\u6301\u9664Java\u3001Go\u548cPython\u5916\u7684\u5176\u4ed6\u8bed\u8a00\u8fd0\u884c\u65f6\u3002"),(0,i.kt)("h2",{id:"k8s\u90e8\u7f72\u7684\u9694\u79bb\u6027"},"K8S\u90e8\u7f72\u7684\u9694\u79bb\u6027"),(0,i.kt)("p",null,"Pulsar Functions\u90e8\u7f72\u5728K8S\u4e0a\u5c06\u8c03\u5ea6\u4ecePulsar\u79fb\u81f3K8S\uff0c\u5e76\u5229\u7528K8S\u63d0\u4f9b\u7684\u8d44\u6e90\u62bd\u8c61\u80fd\u529b\u3002\u5bf9\u4e8e\u7b80\u5355\u4f7f\u7528\u573a\u666f\uff0c\u672a\u6765Pulsar Functions\u5c06\u8fd0\u884c\u5728broker\u4e0a\uff0c\u800cK8S\u90e8\u7f72\u7528\u4e8e\u66f4\u590d\u6742\u7684\u4f7f\u7528\u573a\u666f\u3002"),(0,i.kt)("h2",{id:"\u4f7f\u7528\u793a\u4f8b"},"\u4f7f\u7528\u793a\u4f8b"),(0,i.kt)("h3",{id:"\u521b\u5efapulsar-functions"},"\u521b\u5efaPulsar Functions"),(0,i.kt)("p",null,"\u521b\u5efaPulsar Functions\u6709\u4e24\u79cd\u65b9\u5f0f\uff1aAdmin CLI\u3001Admin REST API(\u63d0\u524d\u662f\u63d0\u4f9b\u5bf9\u5e94\u7684\u7a0b\u5e8f\u6587\u4ef6)\u3002\u5bf9\u4e8eJava API\uff0c\u9700\u8981\u5b9e\u73b0Function\u63a5\u53e3\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'import org.apache.pulsar.functions.api.Context;\nimport org.apache.pulsar.functions.api.Function;\n\npublic class ExclamationFunction implements Function<String, String> {\n  @Override\n  public String process(String input, Context context) {\n    return String.format("%s!", input);\n  }\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin functions create \\\n  --jar target/my-jar-with-dependencies.jar \\\n  --classname org.example.functions.ExclamationFunction \\\n  --tenant public \\\n  --namespace default \\\n  --name word-count \\\n  --inputs persistent://public/default/normal \\\n  --output persistent://public/default/exclaimed\n")),(0,i.kt)("h3",{id:"\u7b80\u5355\u4e8b\u4ef6\u5904\u7406"},"\u7b80\u5355\u4e8b\u4ef6\u5904\u7406"),(0,i.kt)("p",null,"\u4ee5\u4e0b\u7a0b\u5e8f\u5b9a\u4e49\u4e00\u4e2a\u8fc7\u6ee4\u8bbe\u5907\u5269\u4f59\u7535\u91cf\u5927\u4e8e10%\u7684\u7b80\u5355\u4e8b\u4ef6\u5904\u7406\uff0c\u8fd4\u56de\u8bbe\u5907id\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"package org.example.functions;\nimport org.apache.pulsar.functions.api.Context;\nimport org.apache.pulsar.functions.api.Function;\n\npublic class SensorData {\n  private String deviceId;\n  private Long timestamp;\n  private int power;\n\n  public SensorData(String deviceId, Long timestamp, int power) {\n    this.deviceId = deviceId;\n    this.timestamp = timestamp;\n    this.power = power;\n  }\n\n   // Standard setters and getters\n}\n\npublic class DeviceChecker implements Function<SensorData, String> {\n  @Override\n  public String process(SensorData input, Context context) {\n    if(input.power < 10){\n      return input.deviceId;\n      }\n  }\n}\n")),(0,i.kt)("h3",{id:"topic\u6e05\u7406"},"Topic\u6e05\u7406"),(0,i.kt)("p",null,"\u5bf9\u4e8e\u6ce8\u518cschema\u7684topic\uff0c\u90e8\u5206\u6d88\u606f\u53ef\u80fd\u4e0d\u7b26\u5408schema\u5b9a\u4e49\u6216\u8005\u4e0d\u5c5e\u4e8e\u6d88\u8d39\u8005\u8981\u6c42\u7684\u683c\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u7528Pulsar Functions\u6765\u6267\u884c\u5982\u4e0b\u6d88\u606f\u6e05\u7406\u64cd\u4f5c\u3002"),(0,i.kt)("h4",{id:"\u8131\u654f"},"\u8131\u654f"),(0,i.kt)("p",null,"\u5982\u4e0bPulsar Function\u5c06\u5458\u5de5\u793e\u4fdd\u53f7(ssn)\u8131\u654f\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'package org.example.functions;\nimport org.apache.pulsar.functions.api.Context;\nimport org.apache.pulsar.functions.api.Function;\n\npublic class EmployeeRecord {\n  private String name;\n  private String jobTitle;\n  private String ssn;\n\n  public EmployeeRecord(String name, String jobTitle, String ssn) {\n    this.name = name;\n    this.jobTitle = jobTitle;\n    this.ssn = ssn;\n  }\n\n   // Standard setters and getters\n}\n\npublic class EmployeeScrub implements Function<EmployeeRecord, EmployeeRecord> {\n  @Override\n  public EmployeeRecord process(EmployeeRecord input, Context context) {\n    return new EmployeeRecord(input.name, inpt.jobTitle, "xxx-xx-xxxx");\n  }\n}\n')),(0,i.kt)("h4",{id:"\u7ffb\u8bd1"},"\u7ffb\u8bd1"),(0,i.kt)("p",null,"\u5982\u4e0bPulsar Function\u5c06\u82f1\u8bed\u7ffb\u8bd1\u6210\u897f\u73ed\u7259\u8bed"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"package org.example.functions;\nimport org.apache.pulsar.functions.api.Context;\nimport org.apache.pulsar.functions.api.Function;\nimport org.jowanza.languages.spanish.SpanishTranslator;\n\npublic class TranslateToSpanish implements Function<String, String> {\n  @Override\n  public String process(String input, Context context) {\n    return SpanishTranslator.translate(input); // Returns a string\n  }\n}\n")),(0,i.kt)("h4",{id:"schema\u6807\u51c6\u5316"},"Schema\u6807\u51c6\u5316"),(0,i.kt)("p",null,"\u5982\u4e0bPulsar Function\u5c06\u6240\u6709\u4f20\u611f\u5668\u6570\u636e\u7684\u4e8b\u4ef6\u6570\u7ec4\u8f6c\u4e3a\u5355\u4e2a\u503c\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"package org.example.functions;\nimport org.apache.pulsar.functions.api.Context;\nimport org.apache.pulsar.functions.api.Function;\n\npublic class SensorData {\n  private String deviceId;\n  private int[] hours;\n\n  public SensorData(String deviceId, int[] hours) {\n    this.deviceId = deviceId;\n    this.hours = hours;\n  }\n\n  // Standard setters and getters\n}\n\npublic class NormalizedSensorData {\n  private String deviceId;\n  private int recentHour;\n\n  public NormalizedSenorData(String deviceId, int recentHour) {\n    this.deviceId = deviceId;\n    this.recentHour = recentHour;\n  }\n\n  // Standard setters and getters\n}\n\npublic class DataNormalizer implements Function<SensorData,\n  NormalizedSensorData> {\n  @Override\n  public String process(SensorData input, Context context) {\n    return new NormalizedSensorData(input.deviceId, input.hours[0]);\n  }\n}\n")),(0,i.kt)("h3",{id:"topic\u7edf\u8ba1"},"Topic\u7edf\u8ba1"),(0,i.kt)("p",null,"\u6709\u72b6\u6001\u7684Pulsar Function\u53ef\u4ee5\u7edf\u8ba1topic\u7684\u4e2a\u6570\u3001\u5e73\u5747\u503c\u6216\u5176\u4ed6\u6307\u6807\u3002"),(0,i.kt)("h4",{id:"\u7d2f\u52a0\u4e2a\u6570"},"\u7d2f\u52a0\u4e2a\u6570"),(0,i.kt)("p",null,"\u5982\u4e0bPulsar Function\u7edf\u8ba1\u53e5\u5b50\u4e2d\u6bcf\u79cd\u5355\u8bcd\u4e2a\u6570\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'package org.example.functions;\n\nimport org.apache.pulsar.functions.api.Context;\nimport org.apache.pulsar.functions.api.Function;\n\nimport java.util.Arrays;\n\npublic class DoubleWordCountFunction implements Function<String, Void> {\n  @Override\n  public Void process(String input, Context context) throws Exception {\n    Arrays.asList(input.split(" ")).forEach(word -> {\n      String counterKey = word.toLowerCase();\n      context.incrCounter(counterKey, 1);\n    });\n    return null;\n  }\n}\n')),(0,i.kt)("h4",{id:"\u72b6\u6001\u8bbe\u7f6e\u83b7\u53d6"},"\u72b6\u6001\u8bbe\u7f6e/\u83b7\u53d6"),(0,i.kt)("p",null,"\u901a\u8fc7Context\u5bf9\u8c61\u6765\u8bbe\u7f6e/\u83b7\u53d6\u72b6\u6001\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'public class DataSetter implements Function<String, Void> {\n  public void process (String input, Context context) {\n    context.setState("jowanza", "good guy".getBytes());\n    return null;\n  }\n}\n\npublic class DataGetter implements Function<String, Void> {\n  public void process (String input, Context context) {\n    context.getState("jowanza"); // Byte Array of "good guy string"\n    return null;\n  }\n}\n')),(0,i.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Pulsar Functions\u4e09\u79cd\u8fd0\u884c\u65f6\uff1a\u7ebf\u7a0b\u3001\u8fdb\u7a0b\u3001K8S\uff1b"),(0,i.kt)("li",{parentName:"ol"},"\u901a\u8fc7\u5b9e\u73b0Function\u63a5\u53e3\u521b\u5efaPulsar Function\uff0c\u7136\u540e\u901a\u8fc7Admin CLI/API\u4f7f\u7528Function\uff1b"),(0,i.kt)("li",{parentName:"ol"},"Pulsar Functions\u63d0\u4f9b\u72b6\u6001\u7ba1\u7406\uff0c\u901a\u8fc7Context\u5bf9\u8c61\u64cd\u4f5c\u72b6\u6001\u3002")))}m.isMDXComponent=!0},3905:function(n,e,t){t.d(e,{Zo:function(){return c},kt:function(){return m}});var a=t(7294);function r(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function i(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function o(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?i(Object(t),!0).forEach((function(e){r(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function s(n,e){if(null==n)return{};var t,a,r=function(n,e){if(null==n)return{};var t,a,r={},i=Object.keys(n);for(a=0;a<i.length;a++)t=i[a],e.indexOf(t)>=0||(r[t]=n[t]);return r}(n,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(a=0;a<i.length;a++)t=i[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}var l=a.createContext({}),u=function(n){var e=a.useContext(l),t=e;return n&&(t="function"==typeof n?n(e):o(o({},e),n)),t},c=function(n){var e=u(n.components);return a.createElement(l.Provider,{value:e},n.children)},p={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},d=a.forwardRef((function(n,e){var t=n.components,r=n.mdxType,i=n.originalType,l=n.parentName,c=s(n,["components","mdxType","originalType","parentName"]),d=u(t),m=r,g=d["".concat(l,".").concat(m)]||d[m]||p[m]||i;return t?a.createElement(g,o(o({ref:e},c),{},{components:t})):a.createElement(g,o({ref:e},c))}));function m(n,e){var t=arguments,r=e&&e.mdxType;if("string"==typeof n||r){var i=t.length,o=new Array(i);o[0]=d;var s={};for(var l in e)hasOwnProperty.call(e,l)&&(s[l]=e[l]);s.originalType=n,s.mdxType="string"==typeof n?n:r,o[1]=s;for(var u=2;u<i;u++)o[u]=t[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"}}]);