<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kay Haw&#39;s Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kay Haw&#39;s Blog Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">Hadoop 3.xå­¦ä¹ ç¬”è®°(6) | Kay Haw&#x27;s Blog</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://kayhaw.github.io/blog/2022/02/10/Learning-Hadoop3.x-06"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Hadoop 3.xå­¦ä¹ ç¬”è®°(6) | Kay Haw&#x27;s Blog"><meta data-react-helmet="true" name="description" content="Hadoop 3.1.3å­¦ä¹ ç¬”è®°(6)"><meta data-react-helmet="true" property="og:description" content="Hadoop 3.1.3å­¦ä¹ ç¬”è®°(6)"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-02-10T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/kayhaw"><meta data-react-helmet="true" property="article:tag" content="Hadoop,BigData"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://kayhaw.github.io/blog/2022/02/10/Learning-Hadoop3.x-06"><link data-react-helmet="true" rel="alternate" href="https://kayhaw.github.io/blog/2022/02/10/Learning-Hadoop3.x-06" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://kayhaw.github.io/blog/2022/02/10/Learning-Hadoop3.x-06" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.0138175c.css">
<link rel="preload" href="/assets/js/runtime~main.5c7121e2.js" as="script">
<link rel="preload" href="/assets/js/main.eedec005.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Kay Haw&#x27;s Blog</b></a><a class="navbar__item navbar__link" href="/docs/intro">è¯»ä¹¦ç¬”è®°</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2022/02/20/Learning-Hive3.x-02">Hive 3.xå­¦ä¹ ç¬”è®°(2)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2022/02/19/Learning-Hive3.x-01">Hive 3.xå­¦ä¹ ç¬”è®°(1)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2022/02/19/WorkJournal">2022å¹´2æœˆä»½å·¥ä½œæ€»ç»“</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2022/02/15/NetworkingSummary-01">è®¡ç®—æœºç½‘ç»œçŸ¥è¯†æ€»ç»“(1)</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/2022/02/10/Learning-Hadoop3.x-06">Hadoop 3.xå­¦ä¹ ç¬”è®°(6)</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">Hadoop 3.xå­¦ä¹ ç¬”è®°(6)</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2022-02-10T00:00:00.000Z" itemprop="datePublished">February 10, 2022</time> Â· 3 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://avatars.githubusercontent.com/u/16892835?v=4" alt="ä½•è½²"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">ä½•è½²</span></a></div><small class="avatar__subtitle" itemprop="description">Never settle down</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>ğŸ“Hadoop 3.1.3å­¦ä¹ ç¬”è®°ç¬¬6ç¯‡ï¼šæºç åˆ†æã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="namenodeå¯åŠ¨æºç åˆ†æ"></a>NameNodeå¯åŠ¨æºç åˆ†æ<a class="hash-link" href="#namenodeå¯åŠ¨æºç åˆ†æ" title="Direct link to heading">#</a></h2><p>åˆ†æNameNode.java(åœ¨hadoop-hdfs.jaråŒ…ä¸‹)ï¼Œä¸»è¦æœ‰ä»¥ä¸‹æµç¨‹ï¼šå¯åŠ¨WebæœåŠ¡ã€åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ—¥å¿—ã€åˆå§‹åŒ–RPCæœåŠ¡å™¨ã€å¯åŠ¨èµ„æºæ£€æŸ¥ã€å¿ƒè·³æ£€æµ‹å’Œå®‰å…¨æ¨¡å¼ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="å¯åŠ¨webæœåŠ¡"></a>å¯åŠ¨WebæœåŠ¡<a class="hash-link" href="#å¯åŠ¨webæœåŠ¡" title="Direct link to heading">#</a></h3><p>ä»NameNode.javaçš„main() -&gt; createNameNode -&gt; NameNodeæ„é€ æ–¹æ³• -&gt; initialize -&gt; <strong>startHttpServer</strong>æ–¹æ³•å¯åŠ¨NameNodeæœåŠ¡ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">private void startHttpServer(final Configuration conf) throws IOException {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpServer = new NameNodeHttpServer(conf, this, getHttpServerBindAddress(conf));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpServer.start();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpServer.setStartupProgress(startupProgress);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">protected InetSocketAddress getHttpServerBindAddress(Configuration conf) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    InetSocketAddress bindAddress = getHttpServerAddress(conf);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // If DFS_NAMENODE_HTTP_BIND_HOST_KEY exists then it overrides the</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // host name portion of DFS_NAMENODE_HTTP_ADDRESS_KEY.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    final String bindHost = conf.getTrimmed(DFS_NAMENODE_HTTP_BIND_HOST_KEY);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (bindHost != null &amp;&amp; !bindHost.isEmpty()) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      bindAddress = new InetSocketAddress(bindHost, bindAddress.getPort());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return bindAddress;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å…¶ä¸­getHttpServerBindAddressä»confè·å–<code>dfs.namenode.http-address</code>æ¥è®¾ç½®æœåŠ¡çš„åœ°å€å’Œç«¯å£å·ï¼Œè‹¥æ²¡æœ‰è®¾ç½®åˆ™é»˜è®¤ä¸º<code>0.0.0.0:9870</code>ï¼›æ¥ç€åˆ¤æ–­æ˜¯å¦é…ç½®<code>dfs.namenode.http-bind-host</code>ï¼Œè‹¥æœ‰è®¾ç½®åˆ™ç”¨å…¶ä½œä¸ºæœåŠ¡åœ°å€ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶"></a>åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶<a class="hash-link" href="#åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶" title="Direct link to heading">#</a></h3><p>NameNode.javaçš„loadNameSystemæ–¹æ³•ï¼Œåˆè°ƒç”¨FSNamesystem.loadFromDiskæ–¹æ³•ï¼Œæ³¨æ„åŠ è½½ä¼ å…¥é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶ä¸¤ä¸ªåœ°å€ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">static FSNamesystem loadFromDisk(Configuration conf) throws IOException {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    checkConfiguration(conf);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    FSImage fsImage = new FSImage(conf,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        FSNamesystem.getNamespaceDirs(conf),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        FSNamesystem.getNamespaceEditsDirs(conf));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="åˆ›å»ºrpcæœåŠ¡"></a>åˆ›å»ºRPCæœåŠ¡<a class="hash-link" href="#åˆ›å»ºrpcæœåŠ¡" title="Direct link to heading">#</a></h3><p>initializeæ–¹æ³•è°ƒç”¨createRpcServeræ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªNameNodeRpcServerå¯¹è±¡ï¼Œå…¶æ„é€ æ–¹æ³•åŒ…å«å¦‚ä¸‹ä»£ç æ¥åˆ›å»ºRpcæœåŠ¡å™¨ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">lifelineRpcServer = new RPC.Builder(conf)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .setProtocol(HAServiceProtocolPB.class)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .setInstance(haPbService)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .setBindAddress(bindHost)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .setPort(lifelineRpcAddr.getPort())</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .setNumHandlers(lifelineHandlerCount)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .setVerbose(false)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .setSecretManager(namesystem.getDelegationTokenSecretManager())</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="èµ„æºæ£€æµ‹"></a>èµ„æºæ£€æµ‹<a class="hash-link" href="#èµ„æºæ£€æµ‹" title="Direct link to heading">#</a></h3><p>initializeæ–¹æ³•è°ƒç”¨startCommonServicesæ–¹æ³•ï¼Œè°ƒç”¨FSNamesystemçš„startCommonServicesæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åŒ…å«æ“ä½œï¼š</p><ol><li>åˆ›å»ºNameNodeResourceCheckerå¯¹è±¡ï¼Œæ£€æŸ¥å…ƒæ•°æ®å­˜å‚¨ç©ºé—´æ˜¯å¦å‰©ä½™100MBå¯ç”¨</li><li>checkAvailableResources-&gt;hasAvailableDiskSpace-&gt;areResourcesAvailable-&gt;isResourceAvailableï¼Œæ£€æŸ¥èµ„æºæ˜¯å¦å‰©ä½™100MBç©ºé—´</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="å¿ƒè·³æ£€æµ‹"></a>å¿ƒè·³æ£€æµ‹<a class="hash-link" href="#å¿ƒè·³æ£€æµ‹" title="Direct link to heading">#</a></h3><p>startCommonServicesé€šè¿‡blockManager.activate-&gt;datanodeManager.activate(conf)-&gt;heartbeatManager.activate()-&gt;heartbeatThread.start()-&gt;Monitor.run()-&gt;heartbeatCheck()-&gt;isDatanodeDead()ï¼Œåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æŒ‚æ‰çš„å¿ƒè·³æ—¶é•¿<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mo>=</mo><mn>2</mn><mo>âˆ—</mo><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>R</mi><mi>e</mi><mi>c</mi><mi>h</mi><mi>e</mi><mi>c</mi><mi>k</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mo>+</mo><mn>10</mn><mo>âˆ—</mo><mn>1000</mn><mo>âˆ—</mo><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>S</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>n</mi><mi>d</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">heartbeatExpireInterval=2*heartbeatRecheckInterval+10*1000*heartbeatIntervalSeconds</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">s</span></span></span></span></span>ï¼Œå…¶ä¸­<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>R</mi><mi>e</mi><mi>c</mi><mi>h</mi><mi>e</mi><mi>c</mi><mi>k</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">heartbeatRecheckInterval</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span></span></span></span></span>é»˜è®¤ä¸º5åˆ†é’Ÿï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>S</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>n</mi><mi>d</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">heartbeatIntervalSeconds</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">s</span></span></span></span></span>é»˜è®¤ä¸º3ï¼Œå³åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æŒ‚æ‰çš„å¿ƒè·³æ—¶é•¿é»˜è®¤ä¸º10åˆ†é’ŸåŠ 30ç§’ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="å®‰å…¨æ¨¡å¼å¼€å¯"></a>å®‰å…¨æ¨¡å¼å¼€å¯<a class="hash-link" href="#å®‰å…¨æ¨¡å¼å¼€å¯" title="Direct link to heading">#</a></h3><p>FSNamesystemçš„startCommonServicesæ–¹æ³•è°ƒç”¨blockManager.activate-&gt;bmSafeMode.activate(blockTotal)ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œè°ƒç”¨setBlockTotalæ–¹æ³•è®¾ç½®æ‰€æœ‰å—çš„æ€»æ•°å’Œå®‰å…¨é˜ˆå€¼ï¼Œè°ƒç”¨areThresholdsMetåˆ¤æ–­æ˜¯å¦æ»¡è¶³å¯ç”¨é˜ˆå€¼ï¼Œç›¸åº”çš„è®¾ç½®æ˜¯å¦è¿›å…¥å®‰å…¨æ¨¡å¼ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">void activate(long total) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  assert namesystem.hasWriteLock();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  assert status == BMSafeModeStatus.OFF;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  startTime = monotonicNow();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  setBlockTotal(total);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (areThresholdsMet()) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean exitResult = leaveSafeMode(false);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Preconditions.checkState(exitResult, &quot;Failed to leave safe mode.&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  } else {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // enter safe mode</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = BMSafeModeStatus.PENDING_THRESHOLD;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    initializeReplQueuesIfNecessary();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    reportStatus(&quot;STATE* Safe mode ON.&quot;, true);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastStatusReport = monotonicNow();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="datanodeå¯åŠ¨æºç åˆ†æ"></a>DataNodeå¯åŠ¨æºç åˆ†æ<a class="hash-link" href="#datanodeå¯åŠ¨æºç åˆ†æ" title="Direct link to heading">#</a></h2><p>DataNodeå¯åŠ¨åï¼Œé¦–å…ˆå‘NameNodeæ³¨å†Œè‡ªå·±ï¼Œç„¶åå®šæœŸ(6å°æ—¶)å‘NNä¸ŠæŠ¥æ‰€æœ‰å—ä¿¡æ¯ï¼Œæ¯éš”3ç§’å‘NNå‘é€å¿ƒè·³ï¼Œå¦‚æœNNè¶…è¿‡10åˆ†30ç§’æ²¡æœ‰æ”¶åˆ°DataNodeå¿ƒè·³åˆ™è®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸å¯ç”¨ã€‚å¯åŠ¨æµç¨‹å¦‚ä¸‹ï¼š</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="åˆå§‹åŒ–dataxceiverserver"></a>åˆå§‹åŒ–DataXceiverServer<a class="hash-link" href="#åˆå§‹åŒ–dataxceiverserver" title="Direct link to heading">#</a></h3><p>ä»¥DataNode.javaçš„mainæ–¹æ³•ä¸ºå…¥å£ï¼šsecureMain-&gt;createDataNode-&gt;instantiateDataNode-&gt;makeInstance-&gt;new DataNode-&gt;startDataNode-&gt;initDataXceiverï¼Œè°ƒç”¨<code>this.dataXceiverServer = new Daemon(threadGroup, xserver);</code>å¼€å¯æœåŠ¡çº¿ç¨‹ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="åˆå§‹åŒ–httpæœåŠ¡"></a>åˆå§‹åŒ–HTTPæœåŠ¡<a class="hash-link" href="#åˆå§‹åŒ–httpæœåŠ¡" title="Direct link to heading">#</a></h3><p>startDataNodeæ–¹æ³•è°ƒç”¨startInfoServerä¸ºå…¥å£ï¼šnew DatanodeHttpServer-&gt;new HttpServer2ï¼Œç„¶åå¼€å¯httpæœåŠ¡ï¼Œæä¾›è®¿é—®DataNodeä¿¡æ¯çš„endpointã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="åˆå§‹åŒ–rpcæœåŠ¡"></a>åˆå§‹åŒ–RpcæœåŠ¡<a class="hash-link" href="#åˆå§‹åŒ–rpcæœåŠ¡" title="Direct link to heading">#</a></h3><p>startDataNodeæ–¹æ³•è°ƒç”¨initIpcServerä¸ºå…¥å£ï¼Œåˆ›å»ºRPCå¯¹è±¡ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="å‘namenodeæ³¨å†Œ"></a>å‘NameNodeæ³¨å†Œ<a class="hash-link" href="#å‘namenodeæ³¨å†Œ" title="Direct link to heading">#</a></h3><p>startDataNodeæ–¹æ³•è°ƒç”¨BlockPoolManager.refreshNamenodesæ–¹æ³•ä¸ºå…¥å£ï¼šdoRefreshNamenodes-&gt;createBPOS-&gt;new BPOfferService-&gt;new BPServiceActorï¼Œæœ‰å¤šå°‘ä¸ªNameNodeå°±æ·»åŠ å¤šå°‘ä¸ªBPServiceActorï¼Œåœ¨è°ƒç”¨createBPOSåï¼Œè°ƒç”¨startAllæ–¹æ³•è¿›å…¥æ³¨å†Œï¼šbpos.start()-&gt;actor.start()-&gt;BPServiceActor.run()-&gt;connectToNNAndHandshake()-&gt;db.connectToNN()-&gt;new DatanodeProtocolClientSideTranslatorPB()-&gt;createNamenode()-&gt;RPC.getProxy()ï¼Œæœ€ç»ˆå¾—åˆ°ä»£ç†å¯¹è±¡ã€‚ç„¶åå¼€å§‹æ³¨å†ŒDataNodeä¿¡æ¯ï¼šregister()-&gt;bpNamenode.registerDatanode(newBpRegistration)-&gt;rpcProxy.registerDatanode()ï¼Œé€šè¿‡rpcè°ƒç”¨<strong>NameNode</strong>çš„registerDatanodeæ–¹æ³•ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="å‘é€å¿ƒè·³"></a>å‘é€å¿ƒè·³<a class="hash-link" href="#å‘é€å¿ƒè·³" title="Direct link to heading">#</a></h3><p>å›åˆ°BPServiceActor.run()æ–¹æ³•ï¼Œè°ƒç”¨offerServiceä¸ºå…¥å£ï¼šsendHeartBeat-&gt;bpNamenode.sendHeartbeat-&gt;NameNodeRpcServer.sendHeartbeat-&gt;namesystem.handleHeartbeat-&gt;blockManager.getDatanodeManager().handleHeartbeat-&gt;heartbeatManager.updateHeartbeat-&gt;blockManager.updateHeartbeat-&gt;node.updateHeartbeat-&gt;updateHeartbeatStateï¼Œç”±NameNodeè¿”å›ä¸€ä¸ªHeartbeatResponseå¯¹è±¡ä½œä¸ºå¿ƒè·³å“åº”ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">void updateHeartbeatState(StorageReport[] reports, long cacheCapacity,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    long cacheUsed, int xceiverCount, int volFailures,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    VolumeFailureSummary volumeFailureSummary) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  updateStorageStats(reports, cacheCapacity, cacheUsed, xceiverCount,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      volFailures, volumeFailureSummary);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  setLastUpdate(Time.now());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  setLastUpdateMonotonic(Time.monotonicNow());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  rollBlocksScheduled(getLastUpdateMonotonic());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="hdfsæ–‡ä»¶ä¸Šä¼ æºç åˆ†æ"></a>HDFSæ–‡ä»¶ä¸Šä¼ æºç åˆ†æ<a class="hash-link" href="#hdfsæ–‡ä»¶ä¸Šä¼ æºç åˆ†æ" title="Direct link to heading">#</a></h2><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šæ–°å¢æ–‡ä»¶å…ƒä¿¡æ¯ã€‚ä»¥FileSystem.create(Path path, boolean overwrite)æ–¹æ³•ä¸ºå…¥å£ï¼Œè°ƒç”¨æŠ½è±¡æ–¹æ³•create-&gt;DistributedFileSystem.create()-&gt;dfs.create-&gt;DFSOutputStream.newStreamForCreate-&gt;dfsClient.namenode.create(è°ƒç”¨å®¢æˆ·ç«¯çš„Rpcåˆ›å»ºæ–¹æ³•)-&gt;namesystem.startFile()[NameNodeRpcServer.java, Line 791]-&gt;startFileInt(FSNamesystem.java, Line 2375)-&gt;FSDirWriteFileOp.startFile-&gt;FSDirWriteFileOp.addFile-&gt;fsd.addINode(Line 568)ï¼Œæœ€åé€šè¿‡addINodeæ–¹æ³•å°†è·¯å¾„æ·»åŠ åˆ°æ–‡ä»¶ç³»ç»Ÿå…ƒä¿¡æ¯ä¸­ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public void testPut2() throws IOException {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    FSDataOutputStream fos = fs.create(new Path(&quot;/input2&quot;));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    fos.write(&quot;hello world&quot;.getBytes());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å›åˆ°DFSOutputStream.javaçš„276è¡Œï¼Œåœ¨æ·»åŠ å®Œæ–‡ä»¶å…ƒä¿¡æ¯åï¼Œåœ¨313è¡Œåˆ›å»ºæ–‡ä»¶è¾“å‡ºæµDFSOutputStreamå¯¹è±¡outï¼Œè¯¥ç±»çš„æ„é€ æ–¹æ³•è°ƒç”¨äº†å¦‚ä¸‹computePacketChunkSizeæ–¹æ³•æ¥è®¡ç®—PacketåŒ…å«çš„chunkæ•°é‡å’Œpacketçš„å¤§å°ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">protected void computePacketChunkSize(int psize, int csize) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  final int bodySize = psize - PacketHeader.PKT_MAX_HEADER_LEN;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  final int chunkSize = csize + getChecksumSize();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  chunksPerPacket = Math.max(bodySize/chunkSize, 1);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  packetSize = chunkSize*chunksPerPacket;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  DFSClient.LOG.debug(&quot;computePacketChunkSize: src={}, chunkSize={}, &quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          + &quot;chunksPerPacket={}, packetSize={}&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      src, chunkSize, chunksPerPacket, packetSize);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>é»˜è®¤Packetå¤§å°ä¸º64KBï¼Œchunkå¤§å°ä¸º512Byteï¼Œchunksumå¤§å°ä¸º4Byteã€‚åˆ›å»ºå®Œoutå¯¹è±¡åï¼Œæ¥ç€è°ƒç”¨å…¶startæ–¹æ³•ï¼šDataStreamer.start()-&gt;DataStreamer.run()-&gt;dataQueue.wait()ã€‚å…¶ä¸­dataQueueæ˜¯<code>LinkedList&lt;DFSPacket&gt;</code>ç±»å‹å¯¹è±¡ï¼Œè°ƒç”¨waitæ–¹æ³•é˜»å¡é˜Ÿåˆ—ç›´åˆ°æœ‰packetå…¥é˜Ÿã€‚</p><p>ç¬¬äºŒéƒ¨åˆ†ï¼šå†™æ•°æ®ã€‚ç¬¬ä¸€æ­¥æ˜¯å†™packetï¼Œä»¥FSDataOutputStream.writeæ–¹æ³•ä¸ºå…¥å£ï¼šFilterOutputStream.write-&gt;FSOutputSummer.write-&gt;FSOutputSummer.flushBuffer-&gt;FSOutputSummer.writeChecksumChunks-&gt;DFSOutputStream.writeChunk-&gt;DFSOutputStream.enqueueCurrentPacketFull-&gt;DFSOutputStream.enqueueCurrentPacket-&gt;DataStreamer.waitAndQueuePacketï¼Œç¬¬ä¸€æ¬¡å†™æ•°æ®é˜Ÿåˆ—ä¸ºç©ºï¼Œå› æ­¤æ¥ä¸‹æ¥è°ƒç”¨queuePacketæ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹æ‰€æœ‰ï¼Œå®ƒå°†packetæ·»åŠ åœ¨é˜Ÿåˆ—æœ«å°¾ï¼Œç„¶åè°ƒç”¨notifyAllå”¤é†’æ‰€æœ‰é˜»å¡çº¿ç¨‹ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">void queuePacket(DFSPacket packet) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  synchronized (dataQueue) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (packet == null) return;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    packet.addTraceParent(Tracer.getCurrentSpanId());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataQueue.addLast(packet);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastQueuedSeqno = packet.getSeqno();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOG.debug(&quot;Queued {}, {}&quot;, packet, this);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataQueue.notifyAll();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ç¬¬äºŒæ­¥ï¼Œå»ºç«‹æ•°æ®ä¼ è¾“ç®¡ç†pipelineã€‚å›åˆ°DataStreamerçš„runæ–¹æ³•ï¼Œä»¥setPipelineæ–¹æ³•ä¸ºå…¥å£ï¼šDataStreamer.nextBlockOutputStream-&gt;DataStreamer.locateFollowingBlock-&gt;DFSOutputStream.addBlock-&gt;dfsClient.namenode.addBlock(NameNodeRpcServer.addBlock)-&gt;FSNamesystem.getAdditionalBlock-&gt;FSDirWriteFileOp.chooseTargetForNewBlock-&gt;BlockManager.chooseTarget4NewBlock-&gt;BlockPlacementPolicyDefault.chooseTarget-&gt;BlockPlacementPolicyDefault.chooseTargetInOrder-&gt;</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">protected Node chooseTargetInOrder(int numOfReplicas, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 Node writer,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 final Set&lt;Node&gt; excludedNodes,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 final long blocksize,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 final int maxNodesPerRack,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 final List&lt;DatanodeStorageInfo&gt; results,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 final boolean avoidStaleNodes,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 final boolean newBlock,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 EnumMap&lt;StorageType, Integer&gt; storageTypes)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 throws NotEnoughReplicasException {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  final int numOfResults = results.size();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (numOfResults == 0) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    DatanodeStorageInfo storageInfo = chooseLocalStorage(writer,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        excludedNodes, blocksize, maxNodesPerRack, results, avoidStaleNodes,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        storageTypes, true);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    writer = (storageInfo != null) ? storageInfo.getDatanodeDescriptor()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    : null;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (--numOfReplicas == 0) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      return writer;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  final DatanodeDescriptor dn0 = results.get(0).getDatanodeDescriptor();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (numOfResults &lt;= 1) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    chooseRemoteRack(1, dn0, excludedNodes, blocksize, maxNodesPerRack,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        results, avoidStaleNodes, storageTypes);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (--numOfReplicas == 0) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      return writer;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (numOfResults &lt;= 2) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    final DatanodeDescriptor dn1 = results.get(1).getDatanodeDescriptor();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (clusterMap.isOnSameRack(dn0, dn1)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      chooseRemoteRack(1, dn0, excludedNodes, blocksize, maxNodesPerRack,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          results, avoidStaleNodes, storageTypes);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else if (newBlock){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      chooseLocalRack(dn1, excludedNodes, blocksize, maxNodesPerRack,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          results, avoidStaleNodes, storageTypes);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      chooseLocalRack(writer, excludedNodes, blocksize, maxNodesPerRack,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          results, avoidStaleNodes, storageTypes);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (--numOfReplicas == 0) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      return writer;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  chooseRandom(numOfReplicas, NodeBase.ROOT, excludedNodes, blocksize,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      maxNodesPerRack, results, avoidStaleNodes, storageTypes);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  return writer;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å›åˆ°DataStreamer.nextBlockOutputStreamæ–¹æ³•ï¼Œåœ¨è°ƒç”¨locateFollowingBlockåå¾—åˆ°ä¸Šä¼ èŠ‚ç‚¹çš„ä½ç½®ä¿¡æ¯åï¼Œæ¥ç€ä»¥createBlockOutputStreamæ–¹æ³•ä¸ºå…¥å£ï¼šnew Sender(out).writeBlock-&gt;Sender.send(out, Op.WRITE_BLOCK, proto.build()å‘é€æ•°æ®ã€‚å¯¹åº”åœ°ï¼ŒDataXceiverServerçš„runæ–¹æ³•æ‰§è¡ŒDataXceiverçš„runæ–¹æ³•ï¼Œæ ¹æ®å‘é€ç«¯çš„opç±»å‹è°ƒç”¨processOpè¿›è¡Œå¤„ç†ã€‚ç”±äºå‘é€ç«¯opç±»å‹ä¸ºWRITE_BLOCKï¼Œè°ƒç”¨Receiver.opWriteBlock(DataInputStream in)æ–¹æ³•ï¼Œç»§è€Œè°ƒç”¨DataXceiver.writeBlockæ–¹æ³•ï¼šé¦–å…ˆé€šè¿‡setCurrentBlockReceiverå†™å—æ–‡ä»¶ï¼Œç„¶ååˆ¤æ–­ç›®æ ‡èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¦å¤§äº0ï¼Œæ˜¯çš„è¯åˆç”¨new Sender(mirrorOut).writeBlockå†™æ•°æ®ï¼ˆè§¦å‘å†™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„é“¾å¼è°ƒç”¨ï¼‰ã€‚</p><p>å›åˆ°DataStreamerçš„runæ–¹æ³•ï¼Œåœ¨717è¡Œè°ƒç”¨setPipelineåï¼Œæ¥ç€è°ƒç”¨initDataStreamingæ–¹æ³•ï¼Œé€šè¿‡ResponseProcessorçº¿ç¨‹å¯¹è±¡å¤„ç†å†™æˆåŠŸå“åº”ã€‚</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">ResponseProcessor.run(), Line 1179-1183</div><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">lastAckedSeqno = seqno;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pipelineRecoveryCount = 0;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ackQueue.removeFirst();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">packetSendTime.remove(seqno);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">dataQueue.notifyAll();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>åœ¨å‘é€packetåï¼Œä¸ä¼šå°†è¯¥packetåˆ é™¤è€Œæ˜¯æ·»åŠ åˆ°ackQueueä¸­ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">DataStreamer.run(), Line 753-767</div><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">synchronized (dataQueue) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  // move packet from dataQueue to ackQueue</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!one.isHeartbeatPacket()) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (scope != null) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      spanId = scope.getSpanId();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      scope.detach();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      one.setTraceScope(scope);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    scope = null;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataQueue.removeFirst();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ackQueue.addLast(one);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    packetSendTime.put(one.getSeqno(), Time.monotonicNow());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataQueue.notifyAll();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="yarnå·¥ä½œæœºåˆ¶"></a>Yarnå·¥ä½œæœºåˆ¶<a class="hash-link" href="#yarnå·¥ä½œæœºåˆ¶" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ä»»åŠ¡æäº¤"></a>ä»»åŠ¡æäº¤<a class="hash-link" href="#ä»»åŠ¡æäº¤" title="Direct link to heading">#</a></h3><p>Job.waitForCompletionä¸ºå…¥å£ï¼šJob.submit-&gt;submitter.submitJobInternal-&gt;submitClient.submitJob-&gt;YARNRunner.submitJobï¼Œè¯¥æ–¹æ³•æœ‰2ä¸ªä¸»è¦æ–¹æ³•è°ƒç”¨ï¼šcreateApplicationSubmissionContextå’ŒsubmitApplicationã€‚å…ˆçœ‹åˆ›å»ºåº”ç”¨æ‰§è¡Œç¯å¢ƒæ–¹æ³•ï¼šå®ƒä¼šè°ƒç”¨setupAMCommandæ–¹æ³•æ„å»ºApp masterçš„å¯åŠ¨å‘½ä»¤ï¼Œè¯¥æ–¹æ³•è®¾ç½®ä¸€å †javaå¯åŠ¨å‚æ•°åï¼Œè®¾ç½®å¯åŠ¨ç±»ä¸º<code>org.apache.hadoop.mapreduce.v2.app.MRAppMaster</code>ï¼Œå¹¶å°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°å¯¹åº”æ–‡ä»¶å¤¹ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">YARNRunner.java, Line 498-502</div><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">vargs.add(MRJobConfig.APPLICATION_MASTER_CLASS);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">vargs.add(&quot;1&gt;&quot; + ApplicationConstants.LOG_DIR_EXPANSION_VAR +</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Path.SEPARATOR + ApplicationConstants.STDOUT);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">vargs.add(&quot;2&gt;&quot; + ApplicationConstants.LOG_DIR_EXPANSION_VAR +</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Path.SEPARATOR + ApplicationConstants.STDERR);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>åœ¨åˆ›å»ºå¥½åº”ç”¨æäº¤ä¸Šä¸‹æ–‡ç¯å¢ƒå¯¹è±¡appContextåï¼Œæ¥ç€è°ƒç”¨submitApplicationæäº¤ï¼Œè¯¥æ–¹æ³•è¿›è€Œè°ƒç”¨YarnClinetImpl.submitApplicationæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆè°ƒç”¨ClientRMService.submitApplicationæ–¹æ³•(åˆ°äº†ResourceManageræœåŠ¡)ï¼Œå°†æäº¤ä¸Šä¸‹æ–‡ä¿¡æ¯æ’å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="mrappmasterå¯åŠ¨"></a>MRAppMasterå¯åŠ¨<a class="hash-link" href="#mrappmasterå¯åŠ¨" title="Direct link to heading">#</a></h3><p>å°†ä»»åŠ¡ä¿¡æ¯æ’å…¥åˆ°é˜Ÿåˆ—åï¼Œç”±MRAppMasteræ¥è·å–é˜Ÿåˆ—ä»»åŠ¡å¹¶å®‰æ’æ‰§è¡Œã€‚ä»¥MRAppMaster.mainæ–¹æ³•ä¸ºå…¥å£ï¼šinitAndStartAppMaster-&gt;init-&gt;serviceInit-&gt;createDispatcheråˆ›å»ºè°ƒåº¦å™¨ã€‚åœ¨initæ–¹æ³•åè°ƒç”¨startæ–¹æ³•å¯åŠ¨æœåŠ¡ï¼šserviceStart-&gt;startJobs-&gt;dispatcher.getEventHandler().handle(startJobEvent)-&gt;GenericEventHandler.eventQueue.put(event)ï¼Œå°†ä»»åŠ¡æäº¤åˆ°è¿è¡Œé˜Ÿåˆ—ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="yarnchildæ‰§è¡Œä»»åŠ¡"></a>YarnChildæ‰§è¡Œä»»åŠ¡<a class="hash-link" href="#yarnchildæ‰§è¡Œä»»åŠ¡" title="Direct link to heading">#</a></h3><p>YarnChildæ˜¯MRAppMasterä¸­æ‰§è¡Œä»»åŠ¡çš„å°è£…ï¼Œä»¥å…¶mainæ–¹æ³•ä¸ºå…¥å£ï¼šTask.run-&gt;MapTask.run/ReduceTask.runã€‚ä»¥MapTaskRunä¸ºä¾‹ï¼Œè°ƒç”¨runNewMapper-&gt;mapper.run-&gt;è‡ªå®šä¹‰Mapper.runã€‚</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/hadoop">Hadoop</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/big-data">BigData</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/kayhaw/kayhaw.github.io/edit/master/website/blog/blog/2022-02-10-Learning-Hadoop3.x-06.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2022/02/15/NetworkingSummary-01"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« è®¡ç®—æœºç½‘ç»œçŸ¥è¯†æ€»ç»“(1)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2022/02/07/Learning-Hadoop3.x-04"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Hadoop 3.xå­¦ä¹ ç¬”è®°(4) Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#namenodeå¯åŠ¨æºç åˆ†æ" class="table-of-contents__link">NameNodeå¯åŠ¨æºç åˆ†æ</a><ul><li><a href="#å¯åŠ¨webæœåŠ¡" class="table-of-contents__link">å¯åŠ¨WebæœåŠ¡</a></li><li><a href="#åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶" class="table-of-contents__link">åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶</a></li><li><a href="#åˆ›å»ºrpcæœåŠ¡" class="table-of-contents__link">åˆ›å»ºRPCæœåŠ¡</a></li><li><a href="#èµ„æºæ£€æµ‹" class="table-of-contents__link">èµ„æºæ£€æµ‹</a></li><li><a href="#å¿ƒè·³æ£€æµ‹" class="table-of-contents__link">å¿ƒè·³æ£€æµ‹</a></li><li><a href="#å®‰å…¨æ¨¡å¼å¼€å¯" class="table-of-contents__link">å®‰å…¨æ¨¡å¼å¼€å¯</a></li></ul></li><li><a href="#datanodeå¯åŠ¨æºç åˆ†æ" class="table-of-contents__link">DataNodeå¯åŠ¨æºç åˆ†æ</a><ul><li><a href="#åˆå§‹åŒ–dataxceiverserver" class="table-of-contents__link">åˆå§‹åŒ–DataXceiverServer</a></li><li><a href="#åˆå§‹åŒ–httpæœåŠ¡" class="table-of-contents__link">åˆå§‹åŒ–HTTPæœåŠ¡</a></li><li><a href="#åˆå§‹åŒ–rpcæœåŠ¡" class="table-of-contents__link">åˆå§‹åŒ–RpcæœåŠ¡</a></li><li><a href="#å‘namenodeæ³¨å†Œ" class="table-of-contents__link">å‘NameNodeæ³¨å†Œ</a></li><li><a href="#å‘é€å¿ƒè·³" class="table-of-contents__link">å‘é€å¿ƒè·³</a></li></ul></li><li><a href="#hdfsæ–‡ä»¶ä¸Šä¼ æºç åˆ†æ" class="table-of-contents__link">HDFSæ–‡ä»¶ä¸Šä¼ æºç åˆ†æ</a></li><li><a href="#yarnå·¥ä½œæœºåˆ¶" class="table-of-contents__link">Yarnå·¥ä½œæœºåˆ¶</a><ul><li><a href="#ä»»åŠ¡æäº¤" class="table-of-contents__link">ä»»åŠ¡æäº¤</a></li><li><a href="#mrappmasterå¯åŠ¨" class="table-of-contents__link">MRAppMasterå¯åŠ¨</a></li><li><a href="#yarnchildæ‰§è¡Œä»»åŠ¡" class="table-of-contents__link">YarnChildæ‰§è¡Œä»»åŠ¡</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">è¯»ä¹¦ç¬”è®°</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.zhihu.com/people/xiao-ke-dou-7" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>çŸ¥ä¹<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitee.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 ä½•è½²(Kay Haw). Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.5c7121e2.js"></script>
<script src="/assets/js/main.eedec005.js"></script>
</body>
</html>