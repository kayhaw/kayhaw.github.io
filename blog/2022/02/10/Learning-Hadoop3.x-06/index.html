<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.16">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kay Haw&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kay Haw&#39;s Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-rh="true">Hadoop 3.xå­¦ä¹ ç¬”è®°(6) | Kay Haw&#x27;s Blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kayhaw.github.io/blog/2022/02/10/Learning-Hadoop3.x-06"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Hadoop 3.xå­¦ä¹ ç¬”è®°(6) | Kay Haw&#x27;s Blog"><meta data-rh="true" name="description" content="Hadoop 3.1.3å­¦ä¹ ç¬”è®°(6)"><meta data-rh="true" property="og:description" content="Hadoop 3.1.3å­¦ä¹ ç¬”è®°(6)"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-02-10T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/kayhaw"><meta data-rh="true" property="article:tag" content="Hadoop,BigData"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kayhaw.github.io/blog/2022/02/10/Learning-Hadoop3.x-06"><link data-rh="true" rel="alternate" href="https://kayhaw.github.io/blog/2022/02/10/Learning-Hadoop3.x-06" hreflang="en"><link data-rh="true" rel="alternate" href="https://kayhaw.github.io/blog/2022/02/10/Learning-Hadoop3.x-06" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4bafb564.css">
<link rel="preload" href="/assets/js/runtime~main.b8f66f99.js" as="script">
<link rel="preload" href="/assets/js/main.a8d1eeac.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="Kay Haw&#x27;s Blog" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Kay Haw&#x27;s Blog</b></a><a class="navbar__item navbar__link" href="/docs/intro">è¯»ä¹¦ç¬”è®°</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ğŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ğŸŒ</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/02/MySQLSummary">MySQLçŸ¥è¯†ç‚¹æ€»ç»“</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/01/RedisSummary">RedisçŸ¥è¯†ç‚¹æ€»ç»“</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/27/Learning-Hive3.x-06">Hive 3.xå­¦ä¹ ç¬”è®°(6)</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/25/Learning-Hive3.x-05">Hive 3.xå­¦ä¹ ç¬”è®°(5)</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/22/Learning-Hive3.x-04">Hive 3.xå­¦ä¹ ç¬”è®°(4)</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">Hadoop 3.xå­¦ä¹ ç¬”è®°(6)</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-02-10T00:00:00.000Z" itemprop="datePublished">February 10, 2022</time> Â· <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/16892835?v=4" alt="ä½•è½²"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">ä½•è½²</span></a></div><small class="avatar__subtitle" itemprop="description">Never settle down</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>ğŸ“Hadoop 3.1.3å­¦ä¹ ç¬”è®°ç¬¬6ç¯‡ï¼šæºç åˆ†æã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="namenodeå¯åŠ¨æºç åˆ†æ">NameNodeå¯åŠ¨æºç åˆ†æ<a class="hash-link" href="#namenodeå¯åŠ¨æºç åˆ†æ" title="Direct link to heading">â€‹</a></h2><p>åˆ†æNameNode.java(åœ¨hadoop-hdfs.jaråŒ…ä¸‹)ï¼Œä¸»è¦æœ‰ä»¥ä¸‹æµç¨‹ï¼šå¯åŠ¨WebæœåŠ¡ã€åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ—¥å¿—ã€åˆå§‹åŒ–RPCæœåŠ¡å™¨ã€å¯åŠ¨èµ„æºæ£€æŸ¥ã€å¿ƒè·³æ£€æµ‹å’Œå®‰å…¨æ¨¡å¼ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¯åŠ¨webæœåŠ¡">å¯åŠ¨WebæœåŠ¡<a class="hash-link" href="#å¯åŠ¨webæœåŠ¡" title="Direct link to heading">â€‹</a></h3><p>ä»NameNode.javaçš„main() -&gt; createNameNode -&gt; NameNodeæ„é€ æ–¹æ³• -&gt; initialize -&gt; <strong>startHttpServer</strong>æ–¹æ³•å¯åŠ¨NameNodeæœåŠ¡ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">startHttpServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Configuration</span><span class="token plain"> conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpServer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">NameNodeHttpServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getHttpServerBindAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpServer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpServer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setStartupProgress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">startupProgress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token class-name">InetSocketAddress</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getHttpServerBindAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Configuration</span><span class="token plain"> conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">InetSocketAddress</span><span class="token plain"> bindAddress </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getHttpServerAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// If DFS_NAMENODE_HTTP_BIND_HOST_KEY exists then it overrides the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// host name portion of DFS_NAMENODE_HTTP_ADDRESS_KEY.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> bindHost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getTrimmed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DFS_NAMENODE_HTTP_BIND_HOST_KEY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bindHost </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">bindHost</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      bindAddress </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">InetSocketAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bindHost</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bindAddress</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> bindAddress</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>å…¶ä¸­getHttpServerBindAddressä»confè·å–<code>dfs.namenode.http-address</code>æ¥è®¾ç½®æœåŠ¡çš„åœ°å€å’Œç«¯å£å·ï¼Œè‹¥æ²¡æœ‰è®¾ç½®åˆ™é»˜è®¤ä¸º<code>0.0.0.0:9870</code>ï¼›æ¥ç€åˆ¤æ–­æ˜¯å¦é…ç½®<code>dfs.namenode.http-bind-host</code>ï¼Œè‹¥æœ‰è®¾ç½®åˆ™ç”¨å…¶ä½œä¸ºæœåŠ¡åœ°å€ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶">åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶<a class="hash-link" href="#åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶" title="Direct link to heading">â€‹</a></h3><p>NameNode.javaçš„loadNameSystemæ–¹æ³•ï¼Œåˆè°ƒç”¨FSNamesystem.loadFromDiskæ–¹æ³•ï¼Œæ³¨æ„åŠ è½½ä¼ å…¥é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶ä¸¤ä¸ªåœ°å€ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">FSNamesystem</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loadFromDisk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Configuration</span><span class="token plain"> conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">checkConfiguration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">FSImage</span><span class="token plain"> fsImage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FSImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">FSNamesystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getNamespaceDirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">FSNamesystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getNamespaceEditsDirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="åˆ›å»ºrpcæœåŠ¡">åˆ›å»ºRPCæœåŠ¡<a class="hash-link" href="#åˆ›å»ºrpcæœåŠ¡" title="Direct link to heading">â€‹</a></h3><p>initializeæ–¹æ³•è°ƒç”¨createRpcServeræ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªNameNodeRpcServerå¯¹è±¡ï¼Œå…¶æ„é€ æ–¹æ³•åŒ…å«å¦‚ä¸‹ä»£ç æ¥åˆ›å»ºRpcæœåŠ¡å™¨ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lifelineRpcServer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">RPC</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Builder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setProtocol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HAServiceProtocolPB</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">haPbService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setBindAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bindHost</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lifelineRpcAddr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setNumHandlers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lifelineHandlerCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setVerbose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setSecretManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">namesystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDelegationTokenSecretManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="èµ„æºæ£€æµ‹">èµ„æºæ£€æµ‹<a class="hash-link" href="#èµ„æºæ£€æµ‹" title="Direct link to heading">â€‹</a></h3><p>initializeæ–¹æ³•è°ƒç”¨startCommonServicesæ–¹æ³•ï¼Œè°ƒç”¨FSNamesystemçš„startCommonServicesæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åŒ…å«æ“ä½œï¼š</p><ol><li>åˆ›å»ºNameNodeResourceCheckerå¯¹è±¡ï¼Œæ£€æŸ¥å…ƒæ•°æ®å­˜å‚¨ç©ºé—´æ˜¯å¦å‰©ä½™100MBå¯ç”¨</li><li>checkAvailableResources-&gt;hasAvailableDiskSpace-&gt;areResourcesAvailable-&gt;isResourceAvailableï¼Œæ£€æŸ¥èµ„æºæ˜¯å¦å‰©ä½™100MBç©ºé—´</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¿ƒè·³æ£€æµ‹">å¿ƒè·³æ£€æµ‹<a class="hash-link" href="#å¿ƒè·³æ£€æµ‹" title="Direct link to heading">â€‹</a></h3><p>startCommonServicesé€šè¿‡blockManager.activate-&gt;datanodeManager.activate(conf)-&gt;heartbeatManager.activate()-&gt;heartbeatThread.start()-&gt;Monitor.run()-&gt;heartbeatCheck()-&gt;isDatanodeDead()ï¼Œåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æŒ‚æ‰çš„å¿ƒè·³æ—¶é•¿<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mo>=</mo><mn>2</mn><mo>âˆ—</mo><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>R</mi><mi>e</mi><mi>c</mi><mi>h</mi><mi>e</mi><mi>c</mi><mi>k</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mo>+</mo><mn>10</mn><mo>âˆ—</mo><mn>1000</mn><mo>âˆ—</mo><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>S</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>n</mi><mi>d</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">heartbeatExpireInterval=2*heartbeatRecheckInterval+10*1000*heartbeatIntervalSeconds</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">s</span></span></span></span></span>ï¼Œå…¶ä¸­<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>R</mi><mi>e</mi><mi>c</mi><mi>h</mi><mi>e</mi><mi>c</mi><mi>k</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">heartbeatRecheckInterval</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span></span></span></span></span>é»˜è®¤ä¸º5åˆ†é’Ÿï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>S</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>n</mi><mi>d</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">heartbeatIntervalSeconds</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">s</span></span></span></span></span>é»˜è®¤ä¸º3ï¼Œå³åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æŒ‚æ‰çš„å¿ƒè·³æ—¶é•¿é»˜è®¤ä¸º10åˆ†é’ŸåŠ 30ç§’ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å®‰å…¨æ¨¡å¼å¼€å¯">å®‰å…¨æ¨¡å¼å¼€å¯<a class="hash-link" href="#å®‰å…¨æ¨¡å¼å¼€å¯" title="Direct link to heading">â€‹</a></h3><p>FSNamesystemçš„startCommonServicesæ–¹æ³•è°ƒç”¨blockManager.activate-&gt;bmSafeMode.activate(blockTotal)ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œè°ƒç”¨setBlockTotalæ–¹æ³•è®¾ç½®æ‰€æœ‰å—çš„æ€»æ•°å’Œå®‰å…¨é˜ˆå€¼ï¼Œè°ƒç”¨areThresholdsMetåˆ¤æ–­æ˜¯å¦æ»¡è¶³å¯ç”¨é˜ˆå€¼ï¼Œç›¸åº”çš„è®¾ç½®æ˜¯å¦è¿›å…¥å®‰å…¨æ¨¡å¼ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">activate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> total</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> namesystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasWriteLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token class-name">BMSafeModeStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OFF</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  startTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">monotonicNow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setBlockTotal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">total</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">areThresholdsMet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> exitResult </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">leaveSafeMode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Preconditions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">checkState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">exitResult</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Failed to leave safe mode.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// enter safe mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">BMSafeModeStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PENDING_THRESHOLD</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">initializeReplQueuesIfNecessary</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">reportStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;STATE* Safe mode ON.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastStatusReport </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">monotonicNow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="datanodeå¯åŠ¨æºç åˆ†æ">DataNodeå¯åŠ¨æºç åˆ†æ<a class="hash-link" href="#datanodeå¯åŠ¨æºç åˆ†æ" title="Direct link to heading">â€‹</a></h2><p>DataNodeå¯åŠ¨åï¼Œé¦–å…ˆå‘NameNodeæ³¨å†Œè‡ªå·±ï¼Œç„¶åå®šæœŸ(6å°æ—¶)å‘NNä¸ŠæŠ¥æ‰€æœ‰å—ä¿¡æ¯ï¼Œæ¯éš”3ç§’å‘NNå‘é€å¿ƒè·³ï¼Œå¦‚æœNNè¶…è¿‡10åˆ†30ç§’æ²¡æœ‰æ”¶åˆ°DataNodeå¿ƒè·³åˆ™è®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸å¯ç”¨ã€‚å¯åŠ¨æµç¨‹å¦‚ä¸‹ï¼š</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="åˆå§‹åŒ–dataxceiverserver">åˆå§‹åŒ–DataXceiverServer<a class="hash-link" href="#åˆå§‹åŒ–dataxceiverserver" title="Direct link to heading">â€‹</a></h3><p>ä»¥DataNode.javaçš„mainæ–¹æ³•ä¸ºå…¥å£ï¼šsecureMain-&gt;createDataNode-&gt;instantiateDataNode-&gt;makeInstance-&gt;new DataNode-&gt;startDataNode-&gt;initDataXceiverï¼Œè°ƒç”¨<code>this.dataXceiverServer = new Daemon(threadGroup, xserver);</code>å¼€å¯æœåŠ¡çº¿ç¨‹ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="åˆå§‹åŒ–httpæœåŠ¡">åˆå§‹åŒ–HTTPæœåŠ¡<a class="hash-link" href="#åˆå§‹åŒ–httpæœåŠ¡" title="Direct link to heading">â€‹</a></h3><p>startDataNodeæ–¹æ³•è°ƒç”¨startInfoServerä¸ºå…¥å£ï¼šnew DatanodeHttpServer-&gt;new HttpServer2ï¼Œç„¶åå¼€å¯httpæœåŠ¡ï¼Œæä¾›è®¿é—®DataNodeä¿¡æ¯çš„endpointã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="åˆå§‹åŒ–rpcæœåŠ¡">åˆå§‹åŒ–RpcæœåŠ¡<a class="hash-link" href="#åˆå§‹åŒ–rpcæœåŠ¡" title="Direct link to heading">â€‹</a></h3><p>startDataNodeæ–¹æ³•è°ƒç”¨initIpcServerä¸ºå…¥å£ï¼Œåˆ›å»ºRPCå¯¹è±¡ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å‘namenodeæ³¨å†Œ">å‘NameNodeæ³¨å†Œ<a class="hash-link" href="#å‘namenodeæ³¨å†Œ" title="Direct link to heading">â€‹</a></h3><p>startDataNodeæ–¹æ³•è°ƒç”¨BlockPoolManager.refreshNamenodesæ–¹æ³•ä¸ºå…¥å£ï¼šdoRefreshNamenodes-&gt;createBPOS-&gt;new BPOfferService-&gt;new BPServiceActorï¼Œæœ‰å¤šå°‘ä¸ªNameNodeå°±æ·»åŠ å¤šå°‘ä¸ªBPServiceActorï¼Œåœ¨è°ƒç”¨createBPOSåï¼Œè°ƒç”¨startAllæ–¹æ³•è¿›å…¥æ³¨å†Œï¼šbpos.start()-&gt;actor.start()-&gt;BPServiceActor.run()-&gt;connectToNNAndHandshake()-&gt;db.connectToNN()-&gt;new DatanodeProtocolClientSideTranslatorPB()-&gt;createNamenode()-&gt;RPC.getProxy()ï¼Œæœ€ç»ˆå¾—åˆ°ä»£ç†å¯¹è±¡ã€‚ç„¶åå¼€å§‹æ³¨å†ŒDataNodeä¿¡æ¯ï¼šregister()-&gt;bpNamenode.registerDatanode(newBpRegistration)-&gt;rpcProxy.registerDatanode()ï¼Œé€šè¿‡rpcè°ƒç”¨<strong>NameNode</strong>çš„registerDatanodeæ–¹æ³•ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å‘é€å¿ƒè·³">å‘é€å¿ƒè·³<a class="hash-link" href="#å‘é€å¿ƒè·³" title="Direct link to heading">â€‹</a></h3><p>å›åˆ°BPServiceActor.run()æ–¹æ³•ï¼Œè°ƒç”¨offerServiceä¸ºå…¥å£ï¼šsendHeartBeat-&gt;bpNamenode.sendHeartbeat-&gt;NameNodeRpcServer.sendHeartbeat-&gt;namesystem.handleHeartbeat-&gt;blockManager.getDatanodeManager().handleHeartbeat-&gt;heartbeatManager.updateHeartbeat-&gt;blockManager.updateHeartbeat-&gt;node.updateHeartbeat-&gt;updateHeartbeatStateï¼Œç”±NameNodeè¿”å›ä¸€ä¸ªHeartbeatResponseå¯¹è±¡ä½œä¸ºå¿ƒè·³å“åº”ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">updateHeartbeatState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StorageReport</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> reports</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> cacheCapacity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> cacheUsed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> xceiverCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> volFailures</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">VolumeFailureSummary</span><span class="token plain"> volumeFailureSummary</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">updateStorageStats</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reports</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cacheCapacity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cacheUsed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> xceiverCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volFailures</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> volumeFailureSummary</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setLastUpdate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setLastUpdateMonotonic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">monotonicNow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">rollBlocksScheduled</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getLastUpdateMonotonic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="hdfsæ–‡ä»¶ä¸Šä¼ æºç åˆ†æ">HDFSæ–‡ä»¶ä¸Šä¼ æºç åˆ†æ<a class="hash-link" href="#hdfsæ–‡ä»¶ä¸Šä¼ æºç åˆ†æ" title="Direct link to heading">â€‹</a></h2><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šæ–°å¢æ–‡ä»¶å…ƒä¿¡æ¯ã€‚ä»¥FileSystem.create(Path path, boolean overwrite)æ–¹æ³•ä¸ºå…¥å£ï¼Œè°ƒç”¨æŠ½è±¡æ–¹æ³•create-&gt;DistributedFileSystem.create()-&gt;dfs.create-&gt;DFSOutputStream.newStreamForCreate-&gt;dfsClient.namenode.create(è°ƒç”¨å®¢æˆ·ç«¯çš„Rpcåˆ›å»ºæ–¹æ³•)-&gt;namesystem.startFile()<!-- -->[NameNodeRpcServer.java, Line 791]<!-- -->-&gt;startFileInt(FSNamesystem.java, Line 2375)-&gt;FSDirWriteFileOp.startFile-&gt;FSDirWriteFileOp.addFile-&gt;fsd.addINode(Line 568)ï¼Œæœ€åé€šè¿‡addINodeæ–¹æ³•å°†è·¯å¾„æ·»åŠ åˆ°æ–‡ä»¶ç³»ç»Ÿå…ƒä¿¡æ¯ä¸­ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">testPut2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">FSDataOutputStream</span><span class="token plain"> fos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/input2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hello world&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>å›åˆ°DFSOutputStream.javaçš„276è¡Œï¼Œåœ¨æ·»åŠ å®Œæ–‡ä»¶å…ƒä¿¡æ¯åï¼Œåœ¨313è¡Œåˆ›å»ºæ–‡ä»¶è¾“å‡ºæµDFSOutputStreamå¯¹è±¡outï¼Œè¯¥ç±»çš„æ„é€ æ–¹æ³•è°ƒç”¨äº†å¦‚ä¸‹computePacketChunkSizeæ–¹æ³•æ¥è®¡ç®—PacketåŒ…å«çš„chunkæ•°é‡å’Œpacketçš„å¤§å°ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">computePacketChunkSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> psize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> csize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> bodySize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> psize </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token class-name">PacketHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PKT_MAX_HEADER_LEN</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> chunkSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> csize </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getChecksumSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  chunksPerPacket </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bodySize</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">chunkSize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  packetSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> chunkSize</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">chunksPerPacket</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">DFSClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LOG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;computePacketChunkSize: src={}, chunkSize={}, &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;chunksPerPacket={}, packetSize={}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      src</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chunkSize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chunksPerPacket</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> packetSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>é»˜è®¤Packetå¤§å°ä¸º64KBï¼Œchunkå¤§å°ä¸º512Byteï¼Œchunksumå¤§å°ä¸º4Byteã€‚åˆ›å»ºå®Œoutå¯¹è±¡åï¼Œæ¥ç€è°ƒç”¨å…¶startæ–¹æ³•ï¼šDataStreamer.start()-&gt;DataStreamer.run()-&gt;dataQueue.wait()ã€‚å…¶ä¸­dataQueueæ˜¯<code>LinkedList&lt;DFSPacket&gt;</code>ç±»å‹å¯¹è±¡ï¼Œè°ƒç”¨waitæ–¹æ³•é˜»å¡é˜Ÿåˆ—ç›´åˆ°æœ‰packetå…¥é˜Ÿã€‚</p><p>ç¬¬äºŒéƒ¨åˆ†ï¼šå†™æ•°æ®ã€‚ç¬¬ä¸€æ­¥æ˜¯å†™packetï¼Œä»¥FSDataOutputStream.writeæ–¹æ³•ä¸ºå…¥å£ï¼šFilterOutputStream.write-&gt;FSOutputSummer.write-&gt;FSOutputSummer.flushBuffer-&gt;FSOutputSummer.writeChecksumChunks-&gt;DFSOutputStream.writeChunk-&gt;DFSOutputStream.enqueueCurrentPacketFull-&gt;DFSOutputStream.enqueueCurrentPacket-&gt;DataStreamer.waitAndQueuePacketï¼Œç¬¬ä¸€æ¬¡å†™æ•°æ®é˜Ÿåˆ—ä¸ºç©ºï¼Œå› æ­¤æ¥ä¸‹æ¥è°ƒç”¨queuePacketæ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹æ‰€æœ‰ï¼Œå®ƒå°†packetæ·»åŠ åœ¨é˜Ÿåˆ—æœ«å°¾ï¼Œç„¶åè°ƒç”¨notifyAllå”¤é†’æ‰€æœ‰é˜»å¡çº¿ç¨‹ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">queuePacket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DFSPacket</span><span class="token plain"> packet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataQueue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">packet </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addTraceParent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Tracer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCurrentSpanId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">packet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastQueuedSeqno </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> packet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getSeqno</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Queued {}, {}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> packet</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">notifyAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ç¬¬äºŒæ­¥ï¼Œå»ºç«‹æ•°æ®ä¼ è¾“ç®¡ç†pipelineã€‚å›åˆ°DataStreamerçš„runæ–¹æ³•ï¼Œä»¥setPipelineæ–¹æ³•ä¸ºå…¥å£ï¼šDataStreamer.nextBlockOutputStream-&gt;DataStreamer.locateFollowingBlock-&gt;DFSOutputStream.addBlock-&gt;dfsClient.namenode.addBlock(NameNodeRpcServer.addBlock)-&gt;FSNamesystem.getAdditionalBlock-&gt;FSDirWriteFileOp.chooseTargetForNewBlock-&gt;BlockManager.chooseTarget4NewBlock-&gt;BlockPlacementPolicyDefault.chooseTarget-&gt;BlockPlacementPolicyDefault.chooseTargetInOrder-&gt;</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chooseTargetInOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> numOfReplicas</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token class-name">Node</span><span class="token plain"> writer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">DatanodeStorageInfo</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> newBlock</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token class-name">EnumMap</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">StorageType</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> storageTypes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">NotEnoughReplicasException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> numOfResults </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">numOfResults </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">DatanodeStorageInfo</span><span class="token plain"> storageInfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chooseLocalStorage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">writer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        storageTypes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    writer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">storageInfo </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> storageInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDatanodeDescriptor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">numOfReplicas </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> writer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">DatanodeDescriptor</span><span class="token plain"> dn0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDatanodeDescriptor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">numOfResults </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">chooseRemoteRack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dn0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> storageTypes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">numOfReplicas </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> writer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">numOfResults </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">DatanodeDescriptor</span><span class="token plain"> dn1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDatanodeDescriptor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clusterMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isOnSameRack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dn0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dn1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">chooseRemoteRack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dn0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> storageTypes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newBlock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">chooseLocalRack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dn1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> storageTypes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">chooseLocalRack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">writer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> storageTypes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">numOfReplicas </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> writer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">chooseRandom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">numOfReplicas</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">NodeBase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ROOT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> storageTypes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> writer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>å›åˆ°DataStreamer.nextBlockOutputStreamæ–¹æ³•ï¼Œåœ¨è°ƒç”¨locateFollowingBlockåå¾—åˆ°ä¸Šä¼ èŠ‚ç‚¹çš„ä½ç½®ä¿¡æ¯åï¼Œæ¥ç€ä»¥createBlockOutputStreamæ–¹æ³•ä¸ºå…¥å£ï¼šnew Sender(out).writeBlock-&gt;Sender.send(out, Op.WRITE_BLOCK, proto.build()å‘é€æ•°æ®ã€‚å¯¹åº”åœ°ï¼ŒDataXceiverServerçš„runæ–¹æ³•æ‰§è¡ŒDataXceiverçš„runæ–¹æ³•ï¼Œæ ¹æ®å‘é€ç«¯çš„opç±»å‹è°ƒç”¨processOpè¿›è¡Œå¤„ç†ã€‚ç”±äºå‘é€ç«¯opç±»å‹ä¸ºWRITE_BLOCKï¼Œè°ƒç”¨Receiver.opWriteBlock(DataInputStream in)æ–¹æ³•ï¼Œç»§è€Œè°ƒç”¨DataXceiver.writeBlockæ–¹æ³•ï¼šé¦–å…ˆé€šè¿‡setCurrentBlockReceiverå†™å—æ–‡ä»¶ï¼Œç„¶ååˆ¤æ–­ç›®æ ‡èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¦å¤§äº0ï¼Œæ˜¯çš„è¯åˆç”¨new Sender(mirrorOut).writeBlockå†™æ•°æ®ï¼ˆè§¦å‘å†™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„é“¾å¼è°ƒç”¨ï¼‰ã€‚</p><p>å›åˆ°DataStreamerçš„runæ–¹æ³•ï¼Œåœ¨717è¡Œè°ƒç”¨setPipelineåï¼Œæ¥ç€è°ƒç”¨initDataStreamingæ–¹æ³•ï¼Œé€šè¿‡ResponseProcessorçº¿ç¨‹å¯¹è±¡å¤„ç†å†™æˆåŠŸå“åº”ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">ResponseProcessor.run(), Line 1179-1183</div><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lastAckedSeqno </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> seqno</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipelineRecoveryCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ackQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">removeFirst</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">packetSendTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">seqno</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dataQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">notifyAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>åœ¨å‘é€packetåï¼Œä¸ä¼šå°†è¯¥packetåˆ é™¤è€Œæ˜¯æ·»åŠ åˆ°ackQueueä¸­ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">DataStreamer.run(), Line 753-767</div><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataQueue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// move packet from dataQueue to ackQueue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">one</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isHeartbeatPacket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scope </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      spanId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> scope</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getSpanId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      scope</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">detach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      one</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setTraceScope</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scope </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">removeFirst</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ackQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">one</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packetSendTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">one</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getSeqno</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">monotonicNow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">notifyAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="yarnå·¥ä½œæœºåˆ¶">Yarnå·¥ä½œæœºåˆ¶<a class="hash-link" href="#yarnå·¥ä½œæœºåˆ¶" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä»»åŠ¡æäº¤">ä»»åŠ¡æäº¤<a class="hash-link" href="#ä»»åŠ¡æäº¤" title="Direct link to heading">â€‹</a></h3><p>Job.waitForCompletionä¸ºå…¥å£ï¼šJob.submit-&gt;submitter.submitJobInternal-&gt;submitClient.submitJob-&gt;YARNRunner.submitJobï¼Œè¯¥æ–¹æ³•æœ‰2ä¸ªä¸»è¦æ–¹æ³•è°ƒç”¨ï¼šcreateApplicationSubmissionContextå’ŒsubmitApplicationã€‚å…ˆçœ‹åˆ›å»ºåº”ç”¨æ‰§è¡Œç¯å¢ƒæ–¹æ³•ï¼šå®ƒä¼šè°ƒç”¨setupAMCommandæ–¹æ³•æ„å»ºApp masterçš„å¯åŠ¨å‘½ä»¤ï¼Œè¯¥æ–¹æ³•è®¾ç½®ä¸€å †javaå¯åŠ¨å‚æ•°åï¼Œè®¾ç½®å¯åŠ¨ç±»ä¸º<code>org.apache.hadoop.mapreduce.v2.app.MRAppMaster</code>ï¼Œå¹¶å°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°å¯¹åº”æ–‡ä»¶å¤¹ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">YARNRunner.java, Line 498-502</div><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">vargs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">MRJobConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">APPLICATION_MASTER_CLASS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vargs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;1&gt;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token class-name">ApplicationConstants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LOG_DIR_EXPANSION_VAR </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SEPARATOR </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token class-name">ApplicationConstants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">STDOUT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vargs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;2&gt;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token class-name">ApplicationConstants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LOG_DIR_EXPANSION_VAR </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SEPARATOR </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token class-name">ApplicationConstants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">STDERR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>åœ¨åˆ›å»ºå¥½åº”ç”¨æäº¤ä¸Šä¸‹æ–‡ç¯å¢ƒå¯¹è±¡appContextåï¼Œæ¥ç€è°ƒç”¨submitApplicationæäº¤ï¼Œè¯¥æ–¹æ³•è¿›è€Œè°ƒç”¨YarnClinetImpl.submitApplicationæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆè°ƒç”¨ClientRMService.submitApplicationæ–¹æ³•(åˆ°äº†ResourceManageræœåŠ¡)ï¼Œå°†æäº¤ä¸Šä¸‹æ–‡ä¿¡æ¯æ’å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="mrappmasterå¯åŠ¨">MRAppMasterå¯åŠ¨<a class="hash-link" href="#mrappmasterå¯åŠ¨" title="Direct link to heading">â€‹</a></h3><p>å°†ä»»åŠ¡ä¿¡æ¯æ’å…¥åˆ°é˜Ÿåˆ—åï¼Œç”±MRAppMasteræ¥è·å–é˜Ÿåˆ—ä»»åŠ¡å¹¶å®‰æ’æ‰§è¡Œã€‚ä»¥MRAppMaster.mainæ–¹æ³•ä¸ºå…¥å£ï¼šinitAndStartAppMaster-&gt;init-&gt;serviceInit-&gt;createDispatcheråˆ›å»ºè°ƒåº¦å™¨ã€‚åœ¨initæ–¹æ³•åè°ƒç”¨startæ–¹æ³•å¯åŠ¨æœåŠ¡ï¼šserviceStart-&gt;startJobs-&gt;dispatcher.getEventHandler().handle(startJobEvent)-&gt;GenericEventHandler.eventQueue.put(event)ï¼Œå°†ä»»åŠ¡æäº¤åˆ°è¿è¡Œé˜Ÿåˆ—ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="yarnchildæ‰§è¡Œä»»åŠ¡">YarnChildæ‰§è¡Œä»»åŠ¡<a class="hash-link" href="#yarnchildæ‰§è¡Œä»»åŠ¡" title="Direct link to heading">â€‹</a></h3><p>YarnChildæ˜¯MRAppMasterä¸­æ‰§è¡Œä»»åŠ¡çš„å°è£…ï¼Œä»¥å…¶mainæ–¹æ³•ä¸ºå…¥å£ï¼šTask.run-&gt;MapTask.run/ReduceTask.runã€‚ä»¥MapTaskRunä¸ºä¾‹ï¼Œè°ƒç”¨runNewMapper-&gt;mapper.run-&gt;è‡ªå®šä¹‰Mapper.runã€‚</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/hadoop">Hadoop</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/big-data">BigData</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/kayhaw/kayhaw.github.io/edit/master/website/blog/blog/2022-02-10-Learning-Hadoop3.x-06.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2022/02/15/NetworkingSummary-01"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">è®¡ç®—æœºç½‘ç»œçŸ¥è¯†æ€»ç»“(1)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2022/02/07/Learning-Hadoop3.x-04"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Hadoop 3.xå­¦ä¹ ç¬”è®°(4)</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#namenodeå¯åŠ¨æºç åˆ†æ" class="table-of-contents__link toc-highlight">NameNodeå¯åŠ¨æºç åˆ†æ</a><ul><li><a href="#å¯åŠ¨webæœåŠ¡" class="table-of-contents__link toc-highlight">å¯åŠ¨WebæœåŠ¡</a></li><li><a href="#åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶" class="table-of-contents__link toc-highlight">åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶</a></li><li><a href="#åˆ›å»ºrpcæœåŠ¡" class="table-of-contents__link toc-highlight">åˆ›å»ºRPCæœåŠ¡</a></li><li><a href="#èµ„æºæ£€æµ‹" class="table-of-contents__link toc-highlight">èµ„æºæ£€æµ‹</a></li><li><a href="#å¿ƒè·³æ£€æµ‹" class="table-of-contents__link toc-highlight">å¿ƒè·³æ£€æµ‹</a></li><li><a href="#å®‰å…¨æ¨¡å¼å¼€å¯" class="table-of-contents__link toc-highlight">å®‰å…¨æ¨¡å¼å¼€å¯</a></li></ul></li><li><a href="#datanodeå¯åŠ¨æºç åˆ†æ" class="table-of-contents__link toc-highlight">DataNodeå¯åŠ¨æºç åˆ†æ</a><ul><li><a href="#åˆå§‹åŒ–dataxceiverserver" class="table-of-contents__link toc-highlight">åˆå§‹åŒ–DataXceiverServer</a></li><li><a href="#åˆå§‹åŒ–httpæœåŠ¡" class="table-of-contents__link toc-highlight">åˆå§‹åŒ–HTTPæœåŠ¡</a></li><li><a href="#åˆå§‹åŒ–rpcæœåŠ¡" class="table-of-contents__link toc-highlight">åˆå§‹åŒ–RpcæœåŠ¡</a></li><li><a href="#å‘namenodeæ³¨å†Œ" class="table-of-contents__link toc-highlight">å‘NameNodeæ³¨å†Œ</a></li><li><a href="#å‘é€å¿ƒè·³" class="table-of-contents__link toc-highlight">å‘é€å¿ƒè·³</a></li></ul></li><li><a href="#hdfsæ–‡ä»¶ä¸Šä¼ æºç åˆ†æ" class="table-of-contents__link toc-highlight">HDFSæ–‡ä»¶ä¸Šä¼ æºç åˆ†æ</a></li><li><a href="#yarnå·¥ä½œæœºåˆ¶" class="table-of-contents__link toc-highlight">Yarnå·¥ä½œæœºåˆ¶</a><ul><li><a href="#ä»»åŠ¡æäº¤" class="table-of-contents__link toc-highlight">ä»»åŠ¡æäº¤</a></li><li><a href="#mrappmasterå¯åŠ¨" class="table-of-contents__link toc-highlight">MRAppMasterå¯åŠ¨</a></li><li><a href="#yarnchildæ‰§è¡Œä»»åŠ¡" class="table-of-contents__link toc-highlight">YarnChildæ‰§è¡Œä»»åŠ¡</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">è¯»ä¹¦ç¬”è®°</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.zhihu.com/people/xiao-ke-dou-7" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>çŸ¥ä¹<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitee.com/kayhaw" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 ä½•è½²(Kay Haw). Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b8f66f99.js"></script>
<script src="/assets/js/main.a8d1eeac.js"></script>
</body>
</html>