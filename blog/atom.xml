<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://kayhaw.github.io/blog</id>
    <title>Kay Haw's Blog Blog</title>
    <updated>2022-04-06T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://kayhaw.github.io/blog"/>
    <subtitle>Kay Haw's Blog Blog</subtitle>
    <icon>https://kayhaw.github.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Javaå®ç°LRUå’ŒLFU]]></title>
        <id>/2022/04/06/Java_Implement_of_LRU&amp;LFU</id>
        <link href="https://kayhaw.github.io/blog/2022/04/06/Java_Implement_of_LRU&amp;LFU"/>
        <updated>2022-04-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Javaå®ç°LRUå’ŒLFU]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“å¦‚ä½•ç”¨Javaæ¥å®ç°LRUå’ŒLFUä¸¤ç§ç®—æ³•</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="lru">LRU<a class="hash-link" href="#lru" title="Direct link to heading">â€‹</a></h2><p>æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•(Least Recently Used, LRU)æ˜¯æœ€å¸¸ç”¨çš„ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼šå½“ç¼“å­˜ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œå°†ä¸Šä¸€æ¬¡è®¿é—®æ—¶é—´æœ€æ—©çš„è®°å½•æ·˜æ±°ååŠ å…¥æ–°è®°å½•ã€‚<a href="https://leetcode-cn.com/problems/lru-cache/" target="_blank" rel="noopener noreferrer">Leetcode 146. LRU ç¼“å­˜</a>è¦æ±‚å®ç°åŒ…å«å¦‚ä¸‹æ–¹æ³•çš„LRUCacheç±»æ¥æ¨¡æ‹ŸLRUç¼“å­˜ï¼š</p><ol><li><code>LRUCache(int capacity)</code>ï¼šä»¥æ­£æ•´æ•°capacityä½œä¸ºå®¹é‡åˆå§‹åŒ–LRUç¼“å­˜ï¼›</li><li><code>int get(int key)</code>ï¼šå¦‚æœå…³é”®å­—keyå­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å¯¹åº”å€¼ï¼Œå¦åˆ™è¿”å›-1ï¼›</li><li><code>void put(int key, int value)</code>ï¼šå¦‚æœå…³é”®å­—keyå·²ç»å­˜åœ¨ï¼Œåˆ™æ›´æ–°å¯¹åº”å€¼ä¸ºvalueï¼›å¦‚æœkeyä¸å­˜åœ¨åˆ™å‘ç¼“å­˜ä¸­æ’å…¥key-valueï¼Œå¦‚æœæ’å…¥åé”®å€¼å¯¹ä¸ªæ•°è¶…è¿‡capacityï¼Œåˆ™æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„é”®å€¼å¯¹ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="å“ˆå¸Œè¡¨åŠ åŒå‘é“¾è¡¨">å“ˆå¸Œè¡¨åŠ åŒå‘é“¾è¡¨<a class="hash-link" href="#å“ˆå¸Œè¡¨åŠ åŒå‘é“¾è¡¨" title="Direct link to heading">â€‹</a></h3><p>å¯ä»¥é€šè¿‡å“ˆå¸Œè¡¨æ¥ç»´æŠ¤é”®å€¼å¯¹çš„å”¯ä¸€æ€§ã€åŒå‘é“¾è¡¨æ¥ç»´æŠ¤å…ƒç´ è®¿é—®é¡ºåºä»è€Œå®ç°LRUç¼“å­˜ã€‚è®¾è®¡åŒå‘é“¾è¡¨çš„é¦–èŠ‚ç‚¹æ˜¯æœ€æ–°åˆšè¢«è®¿é—®çš„èŠ‚ç‚¹ï¼Œå°¾èŠ‚ç‚¹æ˜¯æœ€ä¹…æœªè¢«è®¿é—®çš„èŠ‚ç‚¹ï¼Œæ³¨æ„â€œ<strong>è®¿é—®</strong>â€åŒ…å«æŸ¥è¯¢ã€æ›´æ–°ã€æ–°å¢3ç§æ“ä½œï¼Œå› æ­¤æ¯æ¬¡è¿›è¡Œå¦‚ä¸Šæ“ä½œæ—¶éƒ½éœ€è¦å°†å¯¹åº”èŠ‚ç‚¹ä»åŒå‘é“¾è¡¨ä¸­åˆ é™¤å¹¶æŒªåŠ¨ä¸ºå¤´èŠ‚ç‚¹ã€‚å…·ä½“åœ°ï¼Œå¯¹äºgetã€putæ–¹æ³•ï¼Œè®¾è®¡é€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>getæ–¹æ³•å…ˆåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ï¼›<ol><li>keyä¸å­˜åœ¨ï¼Œè¿”å›-1ï¼›</li><li>keyå­˜åœ¨ï¼Œè¿”å›valueã€‚<strong>æ­¤æ—¶keyæ˜¯æœ€è¿‘è¢«ä½¿ç”¨çš„èŠ‚ç‚¹ï¼Œå°†å…¶æŒªåˆ°åŒå‘é“¾è¡¨çš„å¤´éƒ¨</strong>ã€‚</li></ol></li><li>putæ–¹æ³•å…ˆåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ï¼š<ol><li>keyä¸å­˜åœ¨ï¼Œç›´æ¥æ’å…¥åˆ°å“ˆå¸Œè¡¨ï¼Œ<strong>æ¥ç€åˆ¤æ–­æ˜¯å¦è¶…è¿‡ç¼“å­˜å¤§å°ï¼Œæ˜¯çš„è¯å°±æ·˜æ±°é“¾è¡¨å°¾éƒ¨çš„é”®å€¼å¯¹</strong>ï¼›</li><li>keyå­˜åœ¨ï¼Œåˆ™æ›´æ–°å“ˆå¸Œè¡¨ä¸­å¯¹åº”valueï¼Œå¹¶å°†å…¶æŒªåˆ°é“¾è¡¨å¤´éƒ¨ï¼›</li><li>å°†æ–°å¢keyå¯¹åº”èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨ã€‚</li></ol></li></ol><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>æ€»ç»“</h5></div><div class="admonition-content"><p>é™¤äº†getæ–¹æ³•keyä¸å­˜åœ¨å¤–ï¼Œå…¶ä»–æƒ…å†µéƒ½éœ€è¦æ›´æ–°keyä¸ºåŒå‘ä¿©è¡¨çš„å¤´èŠ‚ç‚¹(åˆ«å¿˜äº†è¿™ä¸ªé€»è¾‘)ã€‚å½“æ’å…¥keyå­˜åœ¨æ—¶è¿˜éœ€è¦åˆ¤æ–­æ˜¯å¦éœ€è¦æ·˜æ±°keyã€‚</p></div></div><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">LRUCache</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">LRUCache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">map </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">queue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">capacity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">containsKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">removeToFirst</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">containsKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">removeToFirst</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addFirst</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> last </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">removeLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">last</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">removeToFirst</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addFirst</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç»§æ‰¿linkedhashmap">ç»§æ‰¿LinkedHashMap<a class="hash-link" href="#ç»§æ‰¿linkedhashmap" title="Direct link to heading">â€‹</a></h3><p>å®é™…ä¸Šï¼ŒJavaå†…ç½®çš„LinkedHashMapç±»å·²ç»å°†å…¶æ‰€æœ‰é”®å€¼å¯¹ç»´æŠ¤æˆåŒå‘é“¾è¡¨ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç»§æ‰¿LinkedHashMapæ¥å¿«é€Ÿåœ°å®ç°LRUCacheç±»ã€‚LinkedHashMapé€šè¿‡å¦‚ä¸‹3ä¸ªå›è°ƒå‡½æ•°ç»´æŠ¤åŒå‘é“¾è¡¨çš„é¡ºåºï¼š</p><ol><li><code>void afterNodeAccess(Node&lt;K,V&gt; e)</code>ï¼šè®¿é—®èŠ‚ç‚¹eåï¼Œå°†èŠ‚ç‚¹eæŒªè‡³åŒå‘é“¾è¡¨å°¾éƒ¨ï¼›</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">afterNodeAccess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// move node to last</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">LinkedHashMap</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Entry</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> last</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">accessOrder </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">last </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tail</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">LinkedHashMap</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Entry</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> p </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">LinkedHashMap</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Entry</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">before</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">after</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">after </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            head </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">after </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">before </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            last </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">last </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            head </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">before </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> last</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            last</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">after </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tail </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">modCount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="2"><li><code>void afterNodeRemoval(Node&lt;K,V&gt; e)</code>ï¼šåˆ é™¤èŠ‚ç‚¹eåï¼Œå°†èŠ‚ç‚¹eä»åŒå‘é“¾è¡¨ä¸­åˆ é™¤ï¼›</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">afterNodeRemoval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// unlink</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">LinkedHashMap</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Entry</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> p </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">LinkedHashMap</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Entry</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">before</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">after</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">before </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">after </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        head </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">after </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tail </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">before </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="3"><li><code>void afterNodeInsertion(boolean evict)</code>ï¼šæ’å…¥èŠ‚ç‚¹eåï¼Œåˆ¤æ–­æ˜¯å¦å°†å¤´èŠ‚ç‚¹ä»åŒå‘é“¾è¡¨ä¸­åˆ é™¤ã€‚</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">afterNodeInsertion</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> evict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// possibly remove eldest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">LinkedHashMap</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Entry</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> first</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">evict </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">first </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> head</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">removeEldestEntry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">first</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">K</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> first</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">removeNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">hash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">removeEldestEntry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Map</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Entry</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> eldest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆå‘˜å˜é‡accessOrderå’Œæ–¹æ³•removeEldestEntryå½±å“ç€è®¿é—®å’Œæ’å…¥èŠ‚ç‚¹åçš„å›è°ƒå‡½æ•°è¡Œä¸ºã€‚å…¶ä¸­accessOrderé»˜è®¤ä¸ºfalseï¼Œè¡¨ç¤ºå…ƒç´ è®¿é—®ä¸å½±å“å®ƒåœ¨åŒå‘é“¾è¡¨ä¸­çš„ä½ç½®(æŒ‰ç…§æ’å…¥é¡ºåºæ’åºè€Œä¸æ˜¯è®¿é—®é¡ºåº)ï¼Œè€ŒLRUç®—æ³•è¦æ±‚æŒ‰ç…§è®¿é—®é¡ºåºç»´æŠ¤åŒå‘é“¾è¡¨ï¼Œ<strong>å› æ­¤éœ€è¦å°†å…¶è®¾ç½®ä¸ºtrue</strong>ï¼Œæ­¤æ—¶åªèƒ½é€šè¿‡<code>public LinkedHashMap(int initialCapacity,float loadFactor,boolean accessOrder)</code>æ„é€ å‡½æ•°æ¥è®¾ç½®ã€‚</p><p>å¦å¤–ï¼ŒremoveEldestEntryæ–¹æ³•é»˜è®¤è¿”å›falseï¼Œè¡¨ç¤ºå…ƒç´ æ’å…¥åä¸æ·˜æ±°æœ€è€çš„èŠ‚ç‚¹ï¼Œè€ŒLRUç®—æ³•è¦æ±‚ç¼“å­˜å®¹é‡æ»¡æ—¶åˆ é™¤æœ€è€èŠ‚ç‚¹ï¼Œå› æ­¤éœ€è¦é‡å†™è¯¥æ–¹æ³•ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œå®ç°ç»§æ‰¿è‡ªLinkedHashMapçš„LRUCacheç±»ä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">LRUCache</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">LinkedHashMap</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">LRUCache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">capacity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.75F</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">capacity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getOrDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™ä¸ªå¯ä¸å†™</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">removeEldestEntry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Map</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Entry</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> eldest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>æ³¨æ„</h5></div><div class="admonition-content"><p>åœ¨LinkHashMapä¸­ï¼ŒåŒå‘é“¾è¡¨çš„å¤´èŠ‚ç‚¹è¡¨ç¤ºæœ€è€çš„èŠ‚ç‚¹ï¼Œè€Œå°¾èŠ‚ç‚¹æ‰è¡¨ç¤ºæœ€æ–°çš„èŠ‚ç‚¹ã€‚</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="lfu">LFU<a class="hash-link" href="#lfu" title="Direct link to heading">â€‹</a></h2><p>æœ€ä¸ç»å¸¸ä½¿ç”¨(Least Recently Used, LRU)ç®—æ³•ï¼šå½“ç¼“å­˜ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œå°†è®¿é—®é¢‘ç‡æœ€ä½çš„è®°å½•æ·˜æ±°ååŠ å…¥æ–°è®°å½•ã€‚<a href="https://leetcode-cn.com/problems/lfu-cache/" target="_blank" rel="noopener noreferrer">Leetcode 460. LFUç¼“å­˜</a>è¦æ±‚å®ç°åŒ…å«å¦‚ä¸‹æ–¹æ³•çš„LFUCacheç±»æ¥æ¨¡æ‹ŸLFUç¼“å­˜ï¼š</p><ol><li><code>LFUCache(int capacity)</code>ï¼šä»¥æ­£æ•´æ•°capacityä½œä¸ºå®¹é‡åˆå§‹åŒ–LFUç¼“å­˜ï¼›</li><li><code>int get(int key)</code>ï¼šå¦‚æœå…³é”®å­—keyå­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å¯¹åº”å€¼ï¼Œå¦åˆ™è¿”å›-1ï¼›</li><li><code>void put(int key, int value)</code>ï¼šå¦‚æœå…³é”®å­—keyå·²ç»å­˜åœ¨ï¼Œåˆ™æ›´æ–°å¯¹åº”å€¼ä¸ºvalueï¼›å¦‚æœkeyä¸å­˜åœ¨åˆ™å‘ç¼“å­˜ä¸­æ’å…¥key-valueï¼Œå¦‚æœæ’å…¥åé”®å€¼å¯¹ä¸ªæ•°è¶…è¿‡capacityï¼Œåˆ™æ·˜æ±°æœ€ä¸ç»å¸¸ä½¿ç”¨çš„é”®å€¼å¯¹ï¼Œ<strong>å¦‚æœä½¿ç”¨é¢‘ç‡ç›¸åŒï¼Œåˆ™æ·˜æ±°æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„é”®å€¼å¯¹</strong>ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="å“ˆå¸Œè¡¨åŠ å¹³è¡¡äºŒå‰æ ‘">å“ˆå¸Œè¡¨åŠ å¹³è¡¡äºŒå‰æ ‘<a class="hash-link" href="#å“ˆå¸Œè¡¨åŠ å¹³è¡¡äºŒå‰æ ‘" title="Direct link to heading">â€‹</a></h3><p>ä¸å®ç°LRUç®—æ³•ä»…é åŒå‘é“¾è¡¨å°±å¯ä»¥å®ç°æŒ‰ç…§è®¿é—®æ—¶é—´å…ˆåæ’åºåŒæ­¥ï¼ŒLFUç®—æ³•éœ€è¦å…ˆæ¯”é¢‘ç‡å†æ¯”è®¿é—®æ—¶é—´ï¼Œè¿™é‡Œé€‰æ‹©å¹³è¡¡äºŒå‰æ ‘æŒ‰ç…§è¯¥æ¯”è¾ƒé€»è¾‘æ¥ç»´æŠ¤é”®å€¼å¯¹çš„é¡ºåºã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæ·»åŠ å±æ€§freqå’Œtimeåˆ†åˆ«è¡¨ç¤ºå¯¹åº”keyçš„è®¿é—®æ¬¡æ•°å’Œè®¿é—®æ—¶é—´ï¼šfreqè¶Šå¤§è¡¨ç¤ºè®¿é—®é¢‘ç‡è¶Šé«˜ï¼Œtimeè¶Šå¤§è¡¨ç¤ºè®¿é—®æ—¶é—´æœ€æ–°ã€‚å…·ä½“åœ°ï¼Œå¯¹äºgetã€putæ–¹æ³•ï¼Œè®¾è®¡é€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>getæ–¹æ³•å…ˆåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ï¼›<ol><li>keyä¸å­˜åœ¨ï¼Œè¿”å›-1ï¼›</li><li>keyå­˜åœ¨ï¼Œè¿”å›valueã€‚<strong>æ­¤æ—¶keyè®¿é—®æ¬¡æ•°åŠ 1ï¼Œè®¿é—®æ—¶é—´åŠ 1</strong>ï¼Œå¹¶ä¸”ç”±äºè¿™ä¸¤ä¸ªå±æ€§å€¼æ”¹å˜ï¼Œéœ€è¦é‡æ–°å°†å…¶ä»å¹³è¡¡äºŒå‰æ ‘ä¸­åˆ é™¤å†æ’å…¥ï¼Œä»¥ç»´æŒäºŒå‰æ ‘çš„æœ‰åºæ€§ã€‚</li></ol></li><li>putæ–¹æ³•å…ˆåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ï¼š<ol><li>keyä¸å­˜åœ¨ï¼Œ<strong>å…ˆåˆ¤æ–­æ˜¯å¦ç¼“å­˜æ˜¯å¦å·²æ»¡ï¼Œæ˜¯çš„è¯å°±æ·˜æ±°äºŒå‰æ ‘ä¸­æœ€å°çš„èŠ‚ç‚¹</strong>ï¼Œæ¥ç€è®¾ç½®æ–°èŠ‚ç‚¹freq=1ï¼Œtime=1åæ’å…¥åˆ°å¹³è¡¡äºŒå‰æ ‘ä¸­ï¼›</li><li>keyå­˜åœ¨ï¼Œåˆ™æ›´æ–°å“ˆå¸Œè¡¨ä¸­å¯¹åº”valueï¼ŒåŒæ—¶è®¿é—®æ¬¡æ•°åŠ 1ï¼Œè®¿é—®æ—¶é—´åŠ 1ï¼Œæ›´æ–°äºŒå‰æ ‘(å…ˆåˆ é™¤å†æ’å…¥)ï¼›</li></ol></li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">LFUCache</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">SortedSet</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> avl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// åªæœ‰æ–°å¢è®°å½•æ—¶timeæ‰ä¼šåŠ 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">LFUCache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">map </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">avl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">TreeSet</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">capacity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">capacity </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">containsKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// é€šè¿‡å“ˆå¸Œè¡¨æ‰¾åˆ°Nodeï¼Œæ›´æ–°å…¶é¢‘ç‡å’Œè®¿é—®æ—¶é—´ï¼Œè°ƒæ•´èŠ‚ç‚¹åœ¨TreeSetä¸­ä½ç½®(å…ˆåˆ é™¤ååŠ å…¥)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Node</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        avl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        avl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">capacity </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 1. å·²ç»å­˜åœ¨åˆ™æ›´æ–°é¢‘ç‡å’Œè®¿é—®æ—¶é—´ï¼Œé€»è¾‘åŒgetå‘½ä¸­</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">containsKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Node</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            avl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            avl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// putå’Œreturnåˆ«æ¼äº†ï¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 2. å¦‚æœç¼“å­˜å·²æ»¡ï¼Œå…ˆä»ä»å“ˆå¸Œè¡¨å’Œå¹³è¡¡äºŒå‰æ ‘ä¸­åˆ é™¤æœ€ä¸å¸¸è®¿é—®èŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Node</span><span class="token plain"> exile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> avl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">first</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">exile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            avl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">exile</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 3. æ„é€ æ–°èŠ‚ç‚¹åŠ å…¥åˆ°å“ˆå¸Œè¡¨å’Œå¹³è¡¡äºŒå‰æ ‘ä¸­</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Node</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        avl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">Comparable</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> freq</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> freq</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> freq</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ç”±äºNodeä½œä¸ºTreeSetçš„å…ƒç´ ï¼Œå¿…é¡»é‡å†™equalså’Œhashcodeæ–¹æ³•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">equals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Object</span><span class="token plain"> object</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> object</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">object </span><span class="token keyword" style="color:#00009f">instanceof</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">Node</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> object</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">hashCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> freq </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000000007</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">compareTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Node</span><span class="token plain"> another</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> another</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> another</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> another</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>åœ¨ç¼–ç¨‹æ—¶è¦æ³¨æ„å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ol><li>Nodeå¿…é¡»é‡å†™equalså’ŒhashCodeæ–¹æ³•ï¼Œå®ç°comparableæ¥å£ï¼›</li><li>èŠ‚ç‚¹è®¿é—®æ—¶é—´åº”è¯¥ä½¿ç”¨LFUCacheç»Ÿä¸€ç»´æŠ¤çš„æ—¶é’Ÿï¼Œå°¤å…¶æ³¨æ„æ›´æ–°èŠ‚ç‚¹çš„timeä¸èƒ½ç®€å•å†™æˆ<code>node.time += 1</code>ï¼›</li><li>åˆ é™¤ã€æ›´æ–°äºŒå‰æ ‘èŠ‚ç‚¹æ—¶ä¸è¦å¿˜è®°å¯¹å“ˆå¸Œè¡¨è¿›è¡Œç›¸åŒæ“ä½œï¼›</li><li>è¯¥ä»£ç å®ç°çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(logN)ï¼Œæ²¡èƒ½è¾¾åˆ°åŸé¢˜è¦æ±‚çš„O(1)ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="åŒå“ˆå¸Œè¡¨">åŒå“ˆå¸Œè¡¨<a class="hash-link" href="#åŒå“ˆå¸Œè¡¨" title="Direct link to heading">â€‹</a></h3><p>å¯¹äºLRUå’ŒLFUç®—æ³•ä¸éš¾å‘ç°ï¼š<strong>å½“ä½¿ç”¨é¢‘ç‡ç›¸åŒæ—¶ï¼ŒLFUå°±é€€åŒ–æˆäº†LRUï¼›å½“ä½¿ç”¨é¢‘ç‡ä¸åŒæ—¶ï¼Œåªå…³å¿ƒä½¿ç”¨é¢‘ç‡æœ€ä½çš„</strong>ã€‚å€Ÿé‰´LRUçš„æ€è·¯ï¼Œè®¾è®¡ä¸¤ä¸ªå“ˆå¸Œè¡¨freqMapå’ŒkeyMapï¼Œå‰è€…keyä¸ºä½¿ç”¨é¢‘ç‡è€Œvalueä¸ºåŒå‘é“¾è¡¨èŠ‚ç‚¹ï¼Œåè€…ç”¨äºå­˜å‚¨ç¼“å­˜ï¼Œå¹¶ä¸”ä½¿ç”¨minFreqä¿å­˜å½“å‰æœ€ä½çš„ä½¿ç”¨é¢‘ç‡ã€‚å…·ä½“åœ°ï¼Œå¯¹äºgetã€putæ–¹æ³•ï¼Œè®¾è®¡é€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>getæ–¹æ³•å…ˆåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨äºkeyMapä¸­ï¼›<ol><li>keyä¸å­˜åœ¨ï¼Œè¿”å›-1ï¼›</li><li>keyå­˜åœ¨ï¼Œè¿”å›valueã€‚<strong>æ­¤æ—¶keyè®¿é—®æ¬¡æ•°åŠ 1</strong>ï¼Œå¹¶ä¸”éœ€è¦å°†å…¶æŒªåŠ¨åˆ°å¯¹åº”freqçš„åŒå‘é“¾è¡¨çš„å¤´éƒ¨ï¼›</li><li>æ›´æ–°minFreqã€‚</li></ol></li><li>putæ–¹æ³•å…ˆåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ï¼š<ol><li>keyä¸å­˜åœ¨ï¼Œ<strong>å…ˆåˆ¤æ–­æ˜¯å¦ç¼“å­˜æ˜¯å¦å·²æ»¡ï¼Œæ˜¯çš„è¯å°±æ·˜æ±°freqMapä¸­freqå¯¹åº”é“¾è¡¨çš„å°¾èŠ‚ç‚¹</strong>ï¼Œæ¥ç€è®¾ç½®æ–°èŠ‚ç‚¹freq=1ï¼Œæ’å…¥åˆ°freqMapå’ŒkeyMapï¼›</li><li>keyå­˜åœ¨ï¼Œåˆ™æ›´æ–°keyMapä¸­å¯¹åº”valueï¼Œå‰©ä½™æ“ä½œåŒgetæ–¹æ³•å‘½ä¸­ï¼›</li><li>æ›´æ–°minFreqã€‚</li></ol></li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">LFUCache</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> freqMap</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> keyMap</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> minFreq</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">LFUCache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        freqMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keyMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        minFreq </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">capacity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">capacity </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">keyMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">containsKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         * ç¼“å­˜å‘½ä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         * 1. ä»keyMapå’ŒfreqMapä¸­åˆ é™¤å¯¹åº”node</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         * 2. å¦‚æœfreqMapåˆ é™¤nodeåçš„é˜Ÿåˆ—ä¸ºç©ºè¡¨ç¤ºå·²ç»æ²¡æœ‰è¯¥é¢‘ç‡çš„ç¼“å­˜ï¼Œæ­¤æ—¶è¿›ä¸€æ­¥åˆ¤æ–­æ›´æ–°minFreq</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         * 3. æ›´æ–°freqMapï¼Œå°†nodeé¢‘ç‡åŠ 1ï¼Œæ’å…¥åˆ°å¯¹åº”é˜Ÿåˆ—ä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Node</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> keyMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> freq </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> originQueue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> freqMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">freq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        originQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">originQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            freqMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">freq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">minFreq </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> freq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                minFreq </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> currentQueue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> freqMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getOrDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">freq</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Node</span><span class="token plain"> newNode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> freq</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        currentQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offerFirst</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newNode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keyMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newNode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        freqMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">freq</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> currentQueue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">capacity </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å‘½ä¸­ç¼“å­˜åˆ™æ›´æ–°valueå€¼ï¼Œå…¶ä»–é€»è¾‘åŒgetå‘½ä¸­ï¼Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">keyMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">containsKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Node</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> keyMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> originQueue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> freqMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            originQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">originQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                freqMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">minFreq </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    minFreq </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> newQueue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> freqMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getOrDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            newQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offerFirst</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            freqMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newQueue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">             * å¢åŠ ç¼“å­˜ä¹‹å‰å…ˆåˆ¤æ–­æ˜¯å¦å·²æ»¡ï¼Œæ·˜æ±°é€»è¾‘</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">             * 1. æ‰¾åˆ°minFreqå¯¹åº”çš„queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">             * 2. queueåˆ é™¤å…¶å°¾èŠ‚ç‚¹</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">             * 3. keyMapåˆ é™¤èŠ‚ç‚¹</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">             * 4. å¦‚æœqueueåˆ é™¤åä¸ºç©ºéœ€è¦ç§»é™¤æ•´ä¸ªé˜Ÿåˆ—</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">             * 5. é‡æ–°è®¾ç½®minFreqä¸º1</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">             */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">keyMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> minQueue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> freqMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">minFreq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">Node</span><span class="token plain"> exile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> minQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                keyMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">exile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                minQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">removeLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸éœ€è¦ç§»é™¤ï¼Œå¤ç”¨é˜Ÿåˆ—</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// if(minQueue.isEmpty()) {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">//    freqMap.remove(minFreq);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">             * æ–°å¢èŠ‚ç‚¹é€»è¾‘</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">             * 1. åˆå§‹freqä¸º1</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">             * 2. keyMapå’Œqueueæ·»åŠ èŠ‚ç‚¹</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">             * 3. è®¾ç½®minFreqä¸º1</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">             */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Node</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> minQueue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> freqMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getOrDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            minQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addFirst</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            keyMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            freqMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> minQueue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            minFreq </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> freq</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> freq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freq </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> freq</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>åœ¨ç¼–ç¨‹æ—¶è¦æ³¨æ„å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ol><li>Mapæ¥å£çš„getOrDefaultæ–¹æ³•ä¸ä¼šå°†é»˜è®¤è¿”å›å€¼åŠ å…¥åˆ°å“ˆå¸Œè¡¨ï¼Œä¸€å¼€å§‹è‡ªè®¤ä¸ºä¼šè‡ªåŠ¨åŠ å…¥å¯¼è‡´ä»£ç æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ğŸ¤¡ï¼›</li><li>freqMapçš„keyä¸ºé¢‘ç‡å¤§å°è€Œä¸æ˜¯ç¼“å­˜keyï¼Œæ‰‹å¿«å†™æˆfreqMap.put(key, queue)ï¼Œæ­£ç¡®åº”ä¸ºfreqMap.put(freq, queue)ï¼›</li><li>putæ–¹æ³•æ²¡æœ‰è€ƒè™‘capacity=0æƒ…å†µï¼Œå¯¼è‡´ä¸€ä¸Šæ¥å°±æ˜¯putæ“ä½œæ—¶å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><ol><li>LinkHashMapåœ¨å…ƒç´ è®¿é—®ã€åˆ é™¤ã€æ’å…¥åˆ†åˆ«å¯¹åº”3ä¸ªå›è°ƒå‡½æ•°ï¼Œé€šè¿‡ä¿®æ”¹å½±å“è¿™3ä¸ªå›è°ƒå‡½æ•°çš„å˜é‡å’Œæ–¹æ³•æ¥å®ç°è‡ªå®šä¹‰LRUç±»ï¼›</li><li>LinkHashMapçš„åŒå‘é“¾è¡¨å¤´èŠ‚ç‚¹æ˜¯æœ€è€çš„èŠ‚ç‚¹ï¼Œè€Œå°¾èŠ‚ç‚¹æ‰æ˜¯æœ€æ–°çš„èŠ‚ç‚¹ï¼Œæˆ–è€…ç›¸åï¼Œä½†æ€»ä¹‹ä¸€å®šè¦åˆ é™¤æœ€æ—§èŠ‚ç‚¹ï¼›</li><li><strong>æœªæ¥å¼€å‘sourcesflowæ—¶ï¼Œå„ç§è¯»å†™æ’ä»¶åŠ è½½åçš„ç»´æŠ¤ä¹Ÿéœ€è¦ç”¨åˆ°LRUç®—æ³•</strong>ï¼›</li><li>ä½¿ç”¨å“ˆå¸Œè¡¨åŠ FIFOé˜Ÿåˆ—å®ç°LRUï¼Œä½¿ç”¨å“ˆå¸Œè¡¨åŠ AVLæˆ–è€…åŒå“ˆå¸Œè¡¨(åˆ«å¿˜äº†minFreq)å®ç°LFUã€‚å®ç°ç®—æ³•éƒ½æ˜¯ç±»ä¼¼çš„ï¼šç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ç»´æŠ¤ç¼“å­˜æ›´æ–°ï¼Œç”¨å¦ä¸€ç§æ•°æ®ç»“æ„ç»´æŠ¤ç¼“å­˜æ’åºï¼›</li><li><strong>æ— è®ºæ˜¯getè¿˜æ˜¯putæ–¹æ³•ï¼Œéƒ½è¦è§†ä¸ºâ€œè®¿é—®â€æ¬¡æ•°åŠ 1</strong>ã€‚</li></ol>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="LRU" term="LRU"/>
        <category label="LFU" term="LFU"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[HashMapçŸ¥è¯†ç‚¹æ€»ç»“]]></title>
        <id>/2022/03/12/HashMapSummary</id>
        <link href="https://kayhaw.github.io/blog/2022/03/12/HashMapSummary"/>
        <updated>2022-03-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[HashMapçŸ¥è¯†ç‚¹æ€»ç»“]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“HashMapçŸ¥è¯†ç‚¹æ€»ç»“ï¼šåŒ…å«HashTableã€HashMapã€ConcurrentHashMap</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="hashtable">HashTable<a class="hash-link" href="#hashtable" title="Direct link to heading">â€‹</a></h2><h2 class="anchor anchorWithStickyNavbar_mojV" id="hashmap">HashMap<a class="hash-link" href="#hashmap" title="Direct link to heading">â€‹</a></h2><p>HashMapç»§æ‰¿è‡ªAbstractMapç±»å¹¶å®ç°Mapæ¥å£ï¼Œæ˜¯ä»¥K-Vå¯¹è¿›è¡Œå­˜å‚¨çš„æ•°æ®ç»“æ„ã€‚åœ¨JDK 1.7ä¸­åº•å±‚æ•°æ®ç»“æ„ä¸ºæ•°ç»„åŠ é“¾è¡¨ã€‚ä½¿ç”¨Entryç±»å­˜å‚¨Keyå’ŒValueï¼Œè€Œåœ¨JDK 1.8ä¸­æ˜¯æ•°ç»„åŠ é“¾è¡¨/çº¢é»‘æ ‘ï¼Œä½¿ç”¨Nodeç±»å­˜å‚¨Keyå’ŒValueã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å…ƒç´ æ’å…¥">å…ƒç´ æ’å…¥<a class="hash-link" href="#å…ƒç´ æ’å…¥" title="Direct link to heading">â€‹</a></h3><p>åœ¨æ’å…¥å…ƒç´ å‡ºç°Hashå†²çªæ—¶ï¼ŒHashMapä½¿ç”¨æ‹‰é“¾æ³•å°†å†²çªçš„é”®å€¼å¯¹æ’åˆ—æˆé“¾è¡¨ã€‚åœ¨JDK 1.7ä¸­ä½¿ç”¨å¤´æ’æ³•ï¼Œè€Œåœ¨JDK 1.8ä¸­ä½¿ç”¨å°¾æ’æ³•(ç®€è®°ä¸ƒä¸Šå…«ä¸‹)ï¼Œè¿™æ˜¯å› ä¸ºå¤´æ’æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå‡ºç°å¾ªç¯é“¾è¡¨é—®é¢˜ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="é“¾è¡¨è½¬çº¢é»‘æ ‘">é“¾è¡¨è½¬çº¢é»‘æ ‘<a class="hash-link" href="#é“¾è¡¨è½¬çº¢é»‘æ ‘" title="Direct link to heading">â€‹</a></h3><p>åœ¨JDK 1.7ä¸­ä½¿ç”¨æ‹‰é“¾æ³•è§£å†³Hashå†²çªï¼Œä½†å½“Hashå†²çªä¸¥é‡æ—¶é“¾è¡¨ä¼šè¶Šæ¥è¶Šé•¿ï¼ŒæŸ¥è¯¢æ—¶éœ€è¦éå†é“¾è¡¨é™ä½æ•ˆç‡ã€‚å› æ­¤ï¼Œåœ¨JDK 1.8ä¸­ï¼Œ<strong>å½“é“¾è¡¨é•¿åº¦å¤§äº8æ—¶</strong>è°ƒç”¨treeifyBinæ–¹æ³•å°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ã€‚ä½†treeifyBinæ–¹æ³•å¹¶ä¸æ˜¯æ— è„‘è½¬åŒ–ï¼Œå®ƒå…ˆåˆ¤æ–­å½“å‰æ•°ç»„é•¿åº¦æ˜¯å¦å°äº<code>MIN_TREEIFY_CAPACITY</code>(å›ºå®šå€¼64)ï¼Œå¦‚æœæ˜¯çš„è¯å†è°ƒç”¨resizeæ–¹æ³•è¿›è¡Œæ‰©å®¹æ“ä½œã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">treeifyBin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> tab</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> hash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tab </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tab</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> MIN_TREEIFY_CAPACITY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">resize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tab</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> hash</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> hd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> p </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">replacementTreeNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tl </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                hd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prev </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                tl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tab</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">treeify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tab</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="çº¢é»‘æ ‘è½¬é“¾è¡¨">çº¢é»‘æ ‘è½¬é“¾è¡¨<a class="hash-link" href="#çº¢é»‘æ ‘è½¬é“¾è¡¨" title="Direct link to heading">â€‹</a></h3><h3 class="anchor anchorWithStickyNavbar_mojV" id="resizeæ–¹æ³•">resizeæ–¹æ³•<a class="hash-link" href="#resizeæ–¹æ³•" title="Direct link to heading">â€‹</a></h3><p>resizeæ–¹æ³•è°ƒç”¨çš„æ—¶æœºä¸ä¸¤ä¸ªå‚æ•°æœ‰å…³ï¼šcapacity(HashMapå½“å‰æœ€å¤§å®¹é‡)ï¼ŒloadFactor(è´Ÿè½½å› å­ï¼Œé»˜è®¤0.75)ã€‚å¦‚æœè¾“å…¥æ•°æ®é‡å¤§äºcapacity * loadFactoræ—¶ï¼Œåˆ™è°ƒç”¨resizeæ–¹æ³•ï¼ŒåŒ…å«å¦‚ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol><li>æ‰©å®¹ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Entry/Nodeæ•°ç»„ï¼Œå¤§å°ä¸ºåŸæ•°ç»„2å€ï¼›</li><li>Rehashï¼šéå†Entry/Nodeï¼Œå°†æ‰€æœ‰Entry/Nodeé‡æ–°hashåˆ°æ–°æ•°ç»„ã€‚</li></ol><p>é€šè¿‡å…¬å¼<code>hashcode(key) &amp; (length-1)</code>å¾—åˆ°ï¼Œè¿™é‡Œåˆ©ç”¨å¯¹2çš„æ•´æ•°å¹‚lengthå–æ¨¡ç»“æœç­‰äºä¸length-1æŒ‰ä½ä¸è¿è¡Œçš„ç»“æœï¼Œå› æ­¤æ¯æ¬¡æ‰©å®¹æ—¶æ•°ç»„å¤§å°å¢ä¸º2å€ï¼Œå¹¶ä¸”æœ€å¼€å§‹é»˜è®¤å¤§å°ä¹Ÿæ˜¯2çš„4æ¬¡æ–¹16ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å…¶ä»–é—®é¢˜">å…¶ä»–é—®é¢˜<a class="hash-link" href="#å…¶ä»–é—®é¢˜" title="Direct link to heading">â€‹</a></h3><ol><li>ä¸ºä»€ä¹ˆé‡å†™equalsæ–¹æ³•æ—¶è¿˜éœ€è¦é‡å†™hashCodeæ–¹æ³•ï¼Ÿ</li></ol><p>HashMapå…ˆæ ¹æ®keyçš„hashCodeå€¼æ‰¾åˆ°åœ¨åº•å±‚æ•°ç»„ä¸­çš„ä½ç½®indexï¼Œå½“indexç›¸åŒæ—¶å¤šä¸ªå…ƒç´ å½¢æˆé“¾è¡¨/çº¢é»‘æ ‘ï¼Œæ­¤æ—¶é€šè¿‡equalsæ–¹æ³•æ¯”è¾ƒå¯¹è±¡æ˜¯å¦ç›¸åŒã€‚å¦‚æœåªé‡å†™equalsæ–¹æ³•ï¼Œç”±äºä»»æ„2ä¸ªå¯¹è±¡çš„hashCode()è¿”å›å€¼ä¸åŒï¼Œå³2ä¸ªç›¸åŒå¯¹è±¡hashCodeå€¼ä¸åŒï¼Œæ­¤æ—¶åœ¨ç¬¬ä¸€æ­¥åˆ¤æ–­æ—¶HashMapè®¤ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ï¼Œæ˜¾ç„¶è¿èƒŒä½¿ç”¨Hashè¡¨çš„è§„åˆ™ã€‚</p><ol start="2"><li>HashMapçº¿ç¨‹å®‰å…¨å—ï¼Ÿå¦‚ä½•åšåˆ°çº¿ç¨‹å®‰å…¨çš„HashMapï¼Ÿ</li></ol><p>ä¸å®‰å…¨ï¼ŒJDK 1.7çš„HashMapä½¿ç”¨å¤´æ’æ³•ä¼šå¯¼è‡´å¾ªç¯é“¾è¡¨é—®é¢˜ï¼ŒJDK 1.8çš„HashMapæ²¡æœ‰å¯¹putæ“ä½œä¸Šé”å¯¼è‡´æ’å…¥æ•°æ®è¢«è¦†ç›–çš„é—®é¢˜ã€‚è§£å†³æ–¹æ³•ï¼š1. ä½¿ç”¨Collections.synchronizedMap()åŒ…è£…HashMapï¼›2. ä½¿ç”¨HashTableï¼›3. ä½¿ç”¨ConcurrentHashMapã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="concurrenthashmap">ConcurrentHashMap<a class="hash-link" href="#concurrenthashmap" title="Direct link to heading">â€‹</a></h2>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="HashMap" term="HashMap"/>
        <category label="Summary" term="Summary"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[MySQLçŸ¥è¯†ç‚¹æ€»ç»“]]></title>
        <id>/2022/03/02/MySQLSummary</id>
        <link href="https://kayhaw.github.io/blog/2022/03/02/MySQLSummary"/>
        <updated>2022-03-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[MySQLçŸ¥è¯†ç‚¹æ€»ç»“]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“MySQLçŸ¥è¯†ç‚¹æ€»ç»“ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="å­˜å‚¨å¼•æ“">å­˜å‚¨å¼•æ“<a class="hash-link" href="#å­˜å‚¨å¼•æ“" title="Direct link to heading">â€‹</a></h2><p>MySQLå¯ä½¿ç”¨çš„å­˜å‚¨å¼•æ“ç”±InnoDBå’ŒMyISAMï¼Œä¸¤è€…çš„æ¯”å¯¹å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>MyISAM</th><th>InnoDB</th></tr></thead><tbody><tr><td>å­˜å‚¨ç»“æ„</td><td>è¡¨ä¿¡æ¯åˆ†ä¸º3ä¸ªæ–‡ä»¶ï¼šfrmè¡¨å®šä¹‰ä¿¡æ¯ã€MYDè¡¨æ•°æ®ä¿¡æ¯å’ŒMYIç´¢å¼•ä¿¡æ¯</td><td>è¡¨ä¿¡æ¯ä¸º1ä¸ªæ–‡ä»¶</td></tr><tr><td>æ–‡ä»¶æ ¼å¼</td><td>æ•°æ®æ–‡ä»¶(.MYD)å’Œç´¢å¼•æ–‡ä»¶(.MYI)åˆ†å¼€</td><td>æ•°æ®å’Œç´¢å¼•é›†ä¸­å­˜å‚¨(.ibd)</td></tr><tr><td>è®°å½•å­˜å‚¨é¡ºåº</td><td>æŒ‰è®°å½•æ’å…¥é¡ºåºä¿å­˜</td><td>æŒ‰ä¸»é”®å¤§å°æœ‰åºæ’å…¥</td></tr><tr><td>å¤–é”®</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>äº‹åŠ¡</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>æ”¯æŒé”çº§åˆ«</td><td>è¡¨é”</td><td>è¡Œé”ã€è¡¨é”</td></tr><tr><td>ç´¢å¼•å®ç°</td><td>B+æ ‘ç´¢å¼•</td><td>B+æ•°ç´¢å¼•</td></tr><tr><td>å“ˆå¸Œç´¢å¼•</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table><p>å…¶ä»–åŒºåˆ«æœ‰ï¼š</p><ol><li>InnoDBä½¿ç”¨èšç°‡ç´¢å¼•ï¼ŒMyISAMä½¿ç”¨éèšç°‡ç´¢å¼•ï¼›</li><li>InnoDBä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨è¡Œæ•°æ®ï¼Œè€ŒMyISAMå¶å­èŠ‚ç‚¹å­˜å‚¨è¡Œæ•°æ®åœ°å€ï¼Œéœ€è¦å†å¯»å€ä¸€æ¬¡æ‰èƒ½å¾—åˆ°æ•°æ®ï¼›</li><li>InnDBéä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ä¸»é”®å’Œå…¶ä»–ç´¢å¼•åˆ—çš„æ•°æ®æŸ¥è¯¢æ—¶åšåˆ°ç´¢å¼•è¦†ç›–ååˆ†é«˜æ•ˆã€‚</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="ç´¢å¼•">ç´¢å¼•<a class="hash-link" href="#ç´¢å¼•" title="Direct link to heading">â€‹</a></h2><p>ç´¢å¼•æ—¶æ–¹ä¾¿å¿«é€Ÿå®šä½æ•°æ®çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œåœ¨å®ç°ä¸Šä¸ºä¸€ä¸ªæ–‡ä»¶ã€‚ç´¢å¼•ä¼˜ç‚¹æ˜¯å¯ä»¥åŠ å¿«æ•°æ®æ£€ç´¢é€Ÿåº¦ï¼Œç¼ºç‚¹æ˜¯åœ¨å¢åˆ æ”¹æ•°æ®æ—¶éœ€è¦ç»´æŠ¤ä»¥åŠå ç”¨ç‰©ç†ç©ºé—´ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç´¢å¼•ç±»å‹">ç´¢å¼•ç±»å‹<a class="hash-link" href="#ç´¢å¼•ç±»å‹" title="Direct link to heading">â€‹</a></h3><ol><li>ä»æ•°æ®ç»“æ„è§’åº¦ï¼šB+æ ‘ç´¢å¼•ã€hashç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ï¼›</li><li>ä»ç‰©ç†å­˜å‚¨è§’åº¦ï¼šèšç°‡ç´¢å¼•ã€éèšç°‡ç´¢å¼•(äºŒçº§ç´¢å¼•ã€è¾…åŠ©ç´¢å¼•)ï¼›</li><li>ä»å­—æ®µç‰¹æ€§è§’åº¦ï¼šä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç¼©å½±ã€å‰ç¼€ç´¢å¼•ï¼›</li><li>ä»å­—æ®µä¸ªæ•°è§’åº¦ï¼šå•åˆ—ç´¢å¼•ã€è”åˆç´¢å¼•ã€‚</li></ol><p>å…¶ä¸­
5. ä¸»é”®ç´¢å¼•ï¼šæ•°æ®åˆ—ä¸èƒ½é‡å¤ï¼Œä¸èƒ½ä¸ºnullï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼›
6. å”¯ä¸€ç´¢å¼•ï¼šæ•°æ®åˆ—ä¸èƒ½é‡å¤ï¼Œå¯ä»¥ä¸ºnullï¼Œä¸€ä¸ªè¡¨å…è®¸åˆ›å»ºå¤šä¸ªå”¯ä¸€ç´¢å¼•ï¼›
7. æ™®é€šç´¢å¼•ï¼šæ•°æ®åˆ—å¯ä»¥é‡å¤ï¼Œå¯ä»¥ä¸ºnullï¼Œæ²¡æœ‰é™åˆ¶ã€‚</p><p>å…¶ä»–çš„ç±»å‹è¿˜åŒ…æ‹¬å‰ç¼€ç´¢å¼•ï¼šå½“ç´¢å¼•å­—æ®µä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œä¸ºäº†å‡å°‘ç´¢å¼•å¤§å°ï¼Œä½¿ç”¨å…¶å‰nä½ä¸ºä½œä¸ºç´¢å¼•ï¼›å…¨æ–‡ç´¢å¼•ï¼šç”¨äºæ–‡æœ¬æœç´¢ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç´¢å¼•æ•°æ®ç»“æ„">ç´¢å¼•æ•°æ®ç»“æ„<a class="hash-link" href="#ç´¢å¼•æ•°æ®ç»“æ„" title="Direct link to heading">â€‹</a></h3><p>ä¸€èˆ¬ç´¢å¼•çš„æ•°æ®ç»“æ„æœ‰B+æ ‘å’Œhashè¡¨ä¸¤ç§ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="bæ ‘å’Œbæ ‘åŒºåˆ«">Bæ ‘å’ŒB+æ ‘åŒºåˆ«<a class="hash-link" href="#bæ ‘å’Œbæ ‘åŒºåˆ«" title="Direct link to heading">â€‹</a></h4><ol><li>Bæ ‘æ‰€æœ‰èŠ‚ç‚¹éƒ½å­˜æ”¾é”®å€¼å¯¹ï¼Œè€ŒB+æ ‘éå¶å­èŠ‚ç‚¹åªå­˜æ”¾é”®æ²¡æœ‰å€¼ï¼Œåªæœ‰å¶å­èŠ‚ç‚¹æ‰åŒæ—¶å­˜æ”¾é”®å’Œå€¼ï¼›</li><li>B+æ ‘å¶å­èŠ‚ç‚¹ä¹‹é—´ç›¸è¿å½¢æˆé“¾è¡¨ï¼Œè€ŒBæ ‘å¶å­èŠ‚ç‚¹æ²¡æœ‰ã€‚</li></ol><p>ç”±äºä¸Šè¿°ä¸¤è€…ç»“æ„çš„ä¸åŒï¼ŒæŠŠé¢‘ç¹è®¿é—®æ•°æ®æ”¾åœ¨é è¿‘Bæ ‘æ ¹èŠ‚ç‚¹æ—¶å¯ä»¥åŠ å¿«çƒ­ç‚¹æ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ï¼Œè€ŒB+æ•°éå¶å­èŠ‚ç‚¹åªå­˜æ”¾é”®ï¼Œç›¸åŒæ¡ä»¶ä¸‹ä¸€æ¬¡è¯»å–å¯ä»¥è·å–æ›´å¤šé”®ï¼Œå¯ä»¥æ›´å¿«åœ°ç¼©å°æŸ¥è¯¢èŒƒå›´ã€‚ç”±äºå¶å­èŠ‚ç‚¹å½¢æˆé“¾è¡¨ï¼Œåœ¨å…¨å±€è®¿é—®æ—¶å¯ä»¥å…ˆç”¨O(logN)æ—¶é—´æ‰¾åˆ°æœ€å°èŠ‚ç‚¹ï¼Œç„¶åç”¨O(N)æ—¶é—´é¡ºåºéå†å³å¯ï¼›ä½†Bæ•°éœ€è¦éå†æ¯ä¸€å±‚ï¼Œéœ€è¦æ›´å¤šçš„å†…å­˜ç½®æ¢æ¬¡æ•°ã€‚æ€»åœ°æ¥è¯´ï¼š</p><ol><li>Bæ ‘åªé€‚åˆéšæœºæ£€ç´¢ï¼ŒB+æ ‘åŒæ—¶æ”¯æŒéšæœºæ£€ç´¢å’Œé¡ºåºæ£€ç´¢ï¼›</li><li>B+æ ‘ç©ºé—´åˆ©ç”¨ç‡æ›´é«˜ï¼Œå‡å°‘IOæ¬¡æ•°ï¼›</li><li>B+æ ‘éšæœºæŸ¥è¯¢æ•ˆç‡æ›´ç¨³å®šï¼ŒBæ ‘æ£€ç´¢å¯èƒ½åœ¨éå¶å­èŠ‚ç‚¹ç»“æŸï¼ŒB+æ ‘éšæœºæ£€ç´¢æ—¶éƒ½éœ€è¦ä»æ ¹èŠ‚ç‚¹èµ°åˆ°å¶å­èŠ‚ç‚¹ï¼Œè·¯å¾„é•¿åº¦ç›¸åŒï¼Œå› æ­¤æŸ¥è¯¢æ•ˆç‡ç›¸å½“ï¼›</li><li>B+æ ‘é¡ºåºæŸ¥è¯¢æ•ˆç‡é«˜ï¼Œé€‚åˆèŒƒå›´æŸ¥è¯¢ï¼›</li><li>å¢åˆ èŠ‚ç‚¹æ—¶B+æ ‘æ•ˆç‡æ›´é«˜</li><li>B+æ ‘åœ¨æ»¡è¶³èšç°‡ç´¢å¼•å’Œç´¢å¼•è¦†ç›–æ˜¯ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®</li></ol><p>å¯¹äºå…·æœ‰Nä¸ªèŠ‚ç‚¹çš„B+æ ‘ï¼Œå…¶æœç´¢å¤æ‚åº¦ä¸º<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mi>d</mi></msub><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(log_dN)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mclose">)</span></span></span></span></span>ï¼Œå…¶ä¸­dä¸ºB+æ ‘çš„åº¦ï¼Œå®é™…ä¸­då€¼å¤§äº100ï¼Œå³ä½¿æ•°æ®è¾¾åˆ°åƒä¸‡çº§åˆ«B+æ ‘çš„é«˜åº¦ä¾ç„¶ç»´æŒåœ¨3-4å±‚å·¦å³ï¼Œä¿è¯3-4æ¬¡çš„ç£ç›˜IOå°±å¯ä»¥æŸ¥åˆ°æ•°æ®ã€‚è€Œçº¢é»‘æ ‘æ˜¯äºŒå‰æ ‘ï¼Œå…¶æœç´¢å¤æ‚åº¦ä¸º<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>O</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(OlogN)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mclose">)</span></span></span></span></span>ï¼Œæ ‘å±‚æ•°å¤šå¯¼è‡´ç£ç›˜IOä¹Ÿå¤šï¼Œä¸¥é‡å½±å“æŸ¥è¯¢æ€§èƒ½ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="èšç°‡ç´¢å¼•ä¸å›è¡¨">èšç°‡ç´¢å¼•ä¸å›è¡¨<a class="hash-link" href="#èšç°‡ç´¢å¼•ä¸å›è¡¨" title="Direct link to heading">â€‹</a></h3><p>èšç°‡ç´¢å¼•ï¼šæŒ‰ç…§æ¯å¼ è¡¨çš„ä¸»é”®æ„å»ºä¸€ä¸ªB+æ ‘ï¼Œè¯¥æ ‘çš„å¶å­èŠ‚ç‚¹å­˜æ”¾è¡Œæ•°æ®ã€‚InnoDBé€šè¿‡ä¸»é”®å»ºç«‹èšç°‡ç´¢å¼•ï¼Œå¦‚æœè¡¨æ²¡æœ‰ä¸»é”®ï¼Œåˆ™ä½¿ç”¨éç©ºçš„å”¯ä¸€ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„ç´¢å¼•ï¼Œåˆ™éšå¼åœ°ç”Ÿæˆä¸€ä¸ªä¸»é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•ã€‚èšç°‡ç´¢å¼•çš„ä¼˜ç‚¹æ˜¯æ•°æ®è®¿é—®å¿«ï¼Œå¯¹ä¸»é”®çš„æ’åºæŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œç¼ºç‚¹æ˜¯æ’å…¥é€Ÿåº¦ä¾èµ–äºæ’å…¥é¡ºåºï¼Œæ›´æ–°ä¸»é”®å¼€é”€å¤§ã€‚</p><p>éèšç°‡ç´¢å¼•ï¼šåˆç§°è¾…åŠ©ç´¢å¼•ã€äºŒçº§ç´¢å¼•ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªB+æ ‘ï¼Œä½†å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œå› æ­¤é€šè¿‡éèšç°‡ç´¢å¼•æ‰¾åˆ°ä¸»é”®åï¼Œå†é€šè¿‡èšç°‡ç´¢å¼•è·å–è¡Œæ•°æ®ï¼Œè¯¥è¿‡ç¨‹ç§°ä¹‹ä¸ºå›è¡¨ã€‚å›è¡¨åŒ…å«2æ¬¡B+æ ‘çš„éå†ï¼Œå› æ­¤æ•ˆç‡æ›´ä½ã€‚<strong>æ³¨æ„éèšç°‡ç´¢å¼•ä¸ä¸€å®šå‘ç”Ÿå›è¡¨</strong>ï¼Œå¦‚æœæŸ¥è¯¢å­—æ®µå°±æ˜¯ç´¢å¼•å­—æ®µï¼Œæ­¤æ—¶ä¸éœ€è¦å›è¡¨ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç´¢å¼•è¦†ç›–">ç´¢å¼•è¦†ç›–<a class="hash-link" href="#ç´¢å¼•è¦†ç›–" title="Direct link to heading">â€‹</a></h3><p>å½“æŸ¥è¯¢å­—æ®µéƒ½å»ºç«‹ç´¢å¼•ï¼Œå¼•æ“ç›´æ¥è¿”å›ç´¢å¼•è¡¨ä¸­æŸ¥è¯¢ç»“æœè€Œä¸ä¼šäºŒæ¬¡è®¿é—®ï¼Œè¯¥è¡Œä¸ºç§°ä¹‹ä¸ºç´¢å¼•è¦†ç›–ã€‚ç´¢å¼•è¦†ç›–åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œå› æ­¤å°½å¯èƒ½åœ¨selectå­—æ®µåˆ—è¡¨ä¸­ç»™å‡ºå¿…è¦çš„å­—æ®µã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="äº‹åŠ¡">äº‹åŠ¡<a class="hash-link" href="#äº‹åŠ¡" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="äº‹åŠ¡ç‰¹æ€§acid">äº‹åŠ¡ç‰¹æ€§ï¼šACID<a class="hash-link" href="#äº‹åŠ¡ç‰¹æ€§acid" title="Direct link to heading">â€‹</a></h3><ul><li>åŸå­æ€§(<strong>A</strong>tomicity)ï¼šäº‹åŠ¡ä¸­çš„æ“ä½œä¸å¯åˆ†å‰²ï¼Œè¦ä¹ˆå…¨éƒ½å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ½å–æ¶ˆï¼›</li><li>ä¸€è‡´æ€§(<strong>C</strong>onsistency)ï¼šäº‹åŠ¡å‰åçš„æ•°æ®ä¿æŒä¸€è‡´ï¼›</li><li>éš”ç¦»æ€§(<strong>I</strong>solation)ï¼šå¤šä¸ªäº‹åŠ¡äº’ä¸å¹²æ‰°ï¼›</li><li>æŒä¹…æ€§(<strong>D</strong>urability)ï¼šäº‹åŠ¡æäº¤åäº§ç”Ÿçš„å½±å“æ˜¯æ°¸ä¹…çš„ã€‚</li></ul><p>é€šè¿‡<code>start</code>æˆ–<code>begin</code>å‘½ä»¤å¼€å¯äº‹åŠ¡ï¼Œ<code>commit</code>å‘½ä»¤æäº¤äº‹åŠ¡ï¼Œ<code>rollback</code>å‘½ä»¤å›æ»šäº‹åŠ¡ã€‚MySQLé»˜è®¤è‡ªåŠ¨å¼€å¯äº‹åŠ¡æäº¤ï¼Œå³æ¯æ‰§è¡Œä¸€æ¡è¯­å¥éƒ½ä¼šæäº¤äº‹åŠ¡ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¹¶å‘é—®é¢˜ä¸éš”ç¦»çº§åˆ«">å¹¶å‘é—®é¢˜ä¸éš”ç¦»çº§åˆ«<a class="hash-link" href="#å¹¶å‘é—®é¢˜ä¸éš”ç¦»çº§åˆ«" title="Direct link to heading">â€‹</a></h3><p>InnoDBæ”¯æŒäº‹åŠ¡ï¼Œä½†æ˜¯å¹¶å‘äº‹åŠ¡ä¼šå¯¼è‡´å¦‚ä¸‹é—®é¢˜ï¼š</p><ul><li>è„è¯»ï¼šäº‹åŠ¡Bè¯»å–äº‹åŠ¡Aæœªæäº¤çš„æ•°æ®ï¼›</li><li>ä¸å¯é‡å¤è¯»ï¼šäº‹åŠ¡Bè¯»å–äº‹åŠ¡Aå·²æäº¤çš„<strong>ä¿®æ”¹</strong>æ•°æ®ï¼›</li><li>å¹»è¯»ï¼šäº‹åŠ¡Bè¯»å–äº‹åŠ¡Aå·²æäº¤çš„<strong>æ–°å¢</strong>æ•°æ®ã€‚</li></ul><p>ä¸ºäº†è§£å†³å¦‚ä¸Šå¹¶å‘é—®é¢˜ï¼Œæ•°æ®åº“æä¾›å¦‚ä¸‹4ç§éš”ç¦»çº§åˆ«ï¼š</p><ul><li>è¯»æœªæäº¤ï¼šä»€ä¹ˆé—®é¢˜ä¹Ÿä¸èƒ½è§£å†³ï¼Œç›¸å½“äºä»€ä¹ˆéƒ½ä¸åšï¼›</li><li>è¯»å·²æäº¤ï¼šäº‹åŠ¡Aæäº¤åäº‹åŠ¡Bæ‰èƒ½çœ‹åˆ°å…¶ä¿®æ”¹çš„æ•°æ®ï¼Œè§£å†³è„è¯»é—®é¢˜(Oracleé»˜è®¤éš”ç¦»çº§åˆ«)ï¼›</li><li>å¯é‡å¤è¯»ï¼šäº‹åŠ¡Aæ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®å’Œè¯¥äº‹åŠ¡å¯åŠ¨æ—¶çœ‹åˆ°çš„ä¿æŒä¸€è‡´ï¼Œè§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»é—®é¢˜(MySQLé»˜è®¤éš”ç¦»çº§åˆ«)ï¼›</li><li>ä¸²è¡ŒåŒ–ï¼šåŒä¸€è¡Œè®°å½•è¯»åŠ è¯»é”ã€å†™åŠ å†™é”ï¼Œè¯»å†™é”å†²çªæ—¶å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æäº¤æ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œè§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜ã€‚</li></ul><p>äº‹åŠ¡éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œè§£å†³çš„å¹¶å‘é—®é¢˜ä¹Ÿè¶Šå¤šï¼Œä½†æ˜¯å¹¶å‘æ€§èƒ½ä¹Ÿè¶Šä½ã€‚å®é™…åº”ç”¨ä¸­å¾ˆå°‘ç”¨åˆ°ä¸²è¡ŒåŒ–ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="lbccå’Œmvcc">LBCCå’ŒMVCC<a class="hash-link" href="#lbccå’Œmvcc" title="Direct link to heading">â€‹</a></h2><p>MySQLé»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»ï¼Œä¸ºäº†è§£å†³è¯¥çº§åˆ«ä¸‹å‡ºç°çš„å¹»è¯»é—®é¢˜ï¼Œä½¿ç”¨LBCCå’ŒMVCCä¸¤ç§æ–¹æ³•ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="lbcc">LBCC<a class="hash-link" href="#lbcc" title="Direct link to heading">â€‹</a></h3><p>LBCCæ˜¯åŸºäºé”çš„å¹¶å‘æ§åˆ¶(Lock-Based Concurrent Control)ç¼©å†™ã€‚InnoDBä¸­çš„é”æŒ‰æ¨¡å¼åˆ†ä¸ºå†™é”ã€è¯»é”å’Œæ„å‘é”ï¼ŒæŒ‰ç…§é”ç²’åº¦åˆ†ä¸ºè®°å½•é”(Record Lock)ã€é—´éš™é”(Gap Lock)å’Œä¸´é”®é”(Next-Key Lock)ï¼Œå…¶ä¸­ä¸´é”®é”å¯ä»¥è§£å†³å¯é‡å¤è¯»ä¸‹çš„å¹»è¯»é—®é¢˜ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="è®°å½•é”">è®°å½•é”<a class="hash-link" href="#è®°å½•é”" title="Direct link to heading">â€‹</a></h4><p>è®°å½•é”å¯¹è¡¨ä¸­çš„ä¸€è¡Œè®°å½•åŠ é”ï¼Œä¹Ÿç§°è¡Œé”ã€‚ä½¿ç”¨<code>select .... for update</code>å¼€å¯ï¼Œå¹¶ä¸”å¯¹selectè¯­å¥æœ‰å¦‚ä¸‹è¦æ±‚ï¼š</p><ol><li>å¿…é¡»ä½¿ç”¨ç²¾å‡†åŒ¹é…(å¦‚<code>=</code>æˆ–è€…<code>IN</code>)ï¼Œè€Œä¸èƒ½æ˜¯èŒƒå›´åŒ¹é…ï¼›</li><li>whereè¿‡æ»¤çš„åˆ—å¿…é¡»æœ‰å”¯ä¸€ç´¢å¼•æˆ–è€…ä¸»é”®ç´¢å¼•ã€‚</li></ol><p>ä¹Ÿå¯ä»¥ä½¿ç”¨updateæ“ä½œå¼€å¯ï¼Œ<strong>è®°å½•é”å­˜åœ¨äºåŒ…æ‹¬ä¸»é”®ç´¢å¼•åœ¨å†…çš„å”¯ä¸€ç´¢å¼•ä¸­ï¼Œé”å®šå•æ¡ç´¢å¼•è®°å½•ã€‚</strong></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="é—´éš™é”">é—´éš™é”<a class="hash-link" href="#é—´éš™é”" title="Direct link to heading">â€‹</a></h4><p>é—´éš™é”å¯¹èŒƒå›´åŠ é”ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä½¿ç”¨<code>select * for update</code>å¼€å¯é—´éš™é”ï¼Œæœ‰å¦‚ä¸‹è¦æ±‚ï¼š</p><ol><li>è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼ŒåŒ¹é…å­—æ®µæœ‰ç´¢å¼•ï¼Œå¹¶ä¸”æ²¡æœ‰æ•°æ®è¿”å›ï¼›</li><li>æˆ–è€…ç­‰å€¼æŸ¥è¯¢ï¼ŒåŒ¹é…å­—æ®µæœ‰å”¯ä¸€ç´¢å¼•ï¼Œæ²¡æœ‰æ•°æ®è¿”å›ã€‚</li></ol><p>é—´éš™é”çš„ç¼ºç‚¹åœ¨äºé”å®šèŒƒå›´åï¼Œå³ä½¿ä¸å­˜åœ¨çš„é”®ä¹Ÿä¼šè¢«é”å®šï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">update</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//æ’å…¥å¤±è´¥ï¼Œå› ä¸ºid20å¤§äº15ï¼Œä¸éš¾ç†è§£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'20'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//æ’å…¥å¤±è´¥ï¼ŒåŸå› æ˜¯é—´éš™é”é”çš„æ˜¯è®°å½•é—´éš™ï¼Œè€Œä¸æ˜¯sqlï¼Œä¹Ÿå°±æ˜¯è¯´`select`è¯­å¥çš„é”èŒƒå›´æ˜¯ï¼ˆ11ï¼Œ+âˆï¼‰ï¼Œè€Œ13åœ¨è¿™ä¸ªåŒºé—´ä¸­ï¼Œæ‰€ä»¥ä¹Ÿå¤±è´¥ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">13</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'13'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>é—´éš™é”é”å®šçš„æ˜¯è®°å½•ä¸­é—´çš„ç©ºéš™ï¼Œè€Œä¸æ˜¯sqlè¯­å¥ä¸­ç»™å‡ºçš„ç©ºéš™ï¼Œé—´éš™å’Œé”ä¸å­˜åœ¨å†²çªå…³ç³»ã€‚é€šè¿‡å°†<code>innodb_locks_unsafe_for_binlog</code>è®¾ç½®ä¸ºOFFæ¥å¼€å¯é—´éš™é”ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="ä¸´é”®é”">ä¸´é”®é”<a class="hash-link" href="#ä¸´é”®é”" title="Direct link to heading">â€‹</a></h4><p>ä¸´é”®é”åŒæ—¶å¯¹å‘½ä¸­è®°å½•å’Œé—´éš™åŠ é”ï¼Œç›¸å½“äºè®°å½•é”å’Œé—´éš™é”çš„ç»„åˆ(å·¦å¼€å³é—­åŠ é”)ï¼Œä¸´é”®é”é˜»æ­¢è¯¥èŒƒå›´å†…æ–°çºªå½•æ’å…¥ï¼Œå³é˜²æ­¢å¹»è¯»ã€‚ä½¿ç”¨<code>select ... for update</code>ä¸‹ä»¥ä¸‹æƒ…å†µå¼€å¯é”ï¼š</p><ol><li>ä½¿ç”¨èŒƒå›´æŸ¥è¯¢æœ‰è¿”å›å€¼ï¼ŒåŒ¹é…åˆ—æœ‰ç´¢å¼•ï¼›</li><li>ä½¿ç”¨ç­‰å€¼æŸ¥è¯¢ä¸ç®¡æœ‰æ— è¿”å›å€¼ï¼ŒåŒ¹é…åˆ—æœ‰ç´¢å¼•ã€‚</li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="åŠ é”æ€»ç»“">åŠ é”æ€»ç»“<a class="hash-link" href="#åŠ é”æ€»ç»“" title="Direct link to heading">â€‹</a></h4><ol><li>å¦‚æœæ²¡æœ‰æŸ¥è¯¢æ²¡æœ‰å‘½ä¸­ç´¢å¼•ï¼Œåˆ™é€€åŒ–ä¸ºè¡¨é”ï¼›</li><li>å¦‚æœç­‰å€¼æŸ¥è¯¢å”¯ä¸€ç´¢å¼•ä¸”å‘½ä¸­ï¼Œåˆ™é€€åŒ–ä¸ºè¡Œé”ï¼›</li><li>å¦‚æœç­‰å€¼æŸ¥è¯¢å”¯ä¸€ç´¢å¼•ä½†æ²¡å‘½ä¸­ï¼Œåˆ™é€€åŒ–ä¸ºé—´éš™é”ï¼›</li><li>å¦‚æœç­‰å€¼æŸ¥è¯¢éå”¯ä¸€ç´¢å¼•ä½†æ²¡å‘½ä¸­ï¼Œé€€åŒ–ä¸ºé—´éš™é”ï¼Œå¦‚æœå‘½ä¸­ï¼Œåˆ™é”å®šæ‰€æœ‰å‘½ä¸­è¡Œçš„ä¸´é”®é”ï¼ŒåŒæ—¶é”å®šæœ€å¤§è®°å½•è¡Œä¸‹ä¸€ä¸ªåŒºé—´çš„é—´éš™é”ï¼›</li><li>å¦‚æœèŒƒå›´æŸ¥è¯¢å‘½ä¸­ç´¢å¼•ï¼Œåˆ™é”å®šæ‰€æœ‰å‘½ä¸­è¡Œçš„ä¸´é”®é”ï¼ŒåŒæ—¶é”å®šæœ€å¤§è®°å½•è¡Œä¸‹ä¸€ä¸ªåŒºé—´çš„é—´éš™é”ï¼›</li><li>å¦‚æœèŒƒå›´æŸ¥è¯¢æ²¡æœ‰å‘½ä¸­çºªå¾‹ï¼Œé€€åŒ–ä¸ºä¸´è¿‘ç»“æœçš„é—´éš™é”ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="mvcc">MVCC<a class="hash-link" href="#mvcc" title="Direct link to heading">â€‹</a></h3><p>LBCCç”±äºé”çš„ç²’åº¦è¿‡å¤§ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼ŒInnoDBä½¿ç”¨MVCCæ¥è§£å†³å¹»è¯»é—®é¢˜ã€‚MVCCå®ç°ä¾èµ–äºï¼š3ä¸ªéšè—å­—æ®µã€undo logå’Œread viewï¼Œ<strong>å…¶æ ¸å¿ƒæ€æƒ³æ˜¯åªèƒ½æŸ¥æ‰¾äº‹åŠ¡idå°äºç­‰äºå½“å‰äº‹åŠ¡idçš„è¡Œï¼Œåªèƒ½æŸ¥æ‰¾åˆ é™¤æ—¶é—´å¤§äºç­‰äºå½“å‰äº‹åŠ¡idçš„è¡Œæˆ–è€…æœªåˆ é™¤çš„è¡Œ</strong>ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="éšè—å­—æ®µ">éšè—å­—æ®µ<a class="hash-link" href="#éšè—å­—æ®µ" title="Direct link to heading">â€‹</a></h4><p>MySQLä¸ºæ¯ä¸€è¡Œè®°å½•ç”Ÿæˆå¦‚ä¸‹4ä¸ªéšè—å­—æ®µï¼š</p><ol><li>DB_TRX_IDï¼šäº‹åŠ¡idï¼Œæ ¹æ®äº‹åŠ¡äº§ç”Ÿæ—¶é—´è‡ªåŠ¨é€’å¢ï¼›</li><li>DB_ROLL_PTRï¼šå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è®°å½•å¯¹åº”undo logä½ç½®ï¼Œå¤§å°7å­—èŠ‚ï¼›</li><li>DB_ROW_IDï¼šè¡Œæ ‡è¯†(å•è°ƒè‡ªå¢id)ï¼Œå¦‚æœè¡¨æ²¡æœ‰ä¸»é”®ï¼Œè‡ªåŠ¨ç”Ÿæˆå¹¶ä»¥å…¶äº§ç”Ÿèšç°‡ç´¢å¼•ï¼Œå¤§å°6å­—èŠ‚ï¼›</li><li>flagï¼šæ ‡è¯†è®°å½•æ˜¯å¦åˆ é™¤ã€‚</li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="undo-log">undo log<a class="hash-link" href="#undo-log" title="Direct link to heading">â€‹</a></h4><p>å½“å¯¹è®°å½•è¿›è¡Œå¢åˆ æ”¹æ“ä½œæ—¶ï¼Œç”Ÿæˆå¦‚ä¸‹ç±»å‹çš„undo logï¼š</p><ul><li>insert undo logï¼šæ’å…¥ä¸€æ¡è®°å½•æ—¶ï¼Œè®°ä¸‹è¯¥è®°å½•ä¸»é”®ï¼Œå›æ»šæ—¶åˆ é™¤è¯¥ä¸»é”®å¯¹åº”çš„è®°å½•ï¼›</li><li>delete undo logï¼šåˆ é™¤ä¸€æ¡è®°å½•æ—¶ï¼Œè®°ä¸‹è¯¥è®°å½•çš„æ‰€æœ‰å­—æ®µå€¼ï¼Œå›æ»šæ—¶é‡æ–°æ’å…¥è¿™äº›å­—æ®µå€¼ï¼›</li><li>update undo logï¼šä¿®æ”¹ä¸€æ¡è®°å½•æ—¶ï¼Œè®°ä¸‹ä¿®æ”¹å‰çš„æ—§å€¼ï¼Œå›æ»šæ—¶é‡æ–°æ›´æ–°ä¸ºæ—§å€¼ã€‚</li></ul><p>æ¯æ¬¡å¯¹è®°å½•è¿›è¡Œå¢åˆ æ”¹å°±ä¼šå½¢æˆä¸€æ¡undoæ—¥å¿—ï¼Œæ¯æ¡undo logä¹Ÿæœ‰ä¸€ä¸ªDB_ROLL_PTRï¼ŒæŒ‡å‘ä¸Šä¸€æ¡æ—¥å¿—å½¢æˆç‰ˆæœ¬é“¾ï¼Œè¯¥é“¾çš„å¤´ç»“ç‚¹å³è®°å½•çš„æœ€æ–°å€¼ã€‚undo logå¹¶ä¸æ˜¯ä»ç‰©ç†ç£ç›˜ä¸Šå°†æ•°æ®æ¢å¤åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒåªæ˜¯å°†æ•°æ®åº“é€»è¾‘æ¢å¤åˆ°ä¸Šä¸€ç‰ˆæœ¬(é€»è¾‘æ—¥å¿—)ï¼Œå› ä¸ºå¹¶å‘æƒ…å†µä¸‹æ¢å¤ç‰©ç†é¡µä¼šå½±å“å…¶ä»–äº‹åŠ¡ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="read-view">read view<a class="hash-link" href="#read-view" title="Direct link to heading">â€‹</a></h4><p>read viewæ˜¯ä½¿ç”¨æ™®é€šselectæŸ¥è¯¢æ—¶äº§ç”Ÿçš„ä¸€è‡´æ€§è¯»è§†å›¾ï¼Œä¹Ÿç§°å¿«ç…§è¯»ï¼Œå®ƒç”±æ‰§è¡ŒæŸ¥è¯¢æ—¶<strong>æ‰€æœ‰æœªæäº¤äº‹åŠ¡idæ•°ç»„(è®°æœ€å°idä¸ºmin_id)å’Œå·²ç»æäº¤äº‹åŠ¡çš„æœ€å¤§id(è®°ä¸ºmax_id)ç»„æˆ</strong>ã€‚æ‰§è¡ŒæŸ¥è¯¢æ—¶æ ¹æ®è®°å½•çš„äº‹åŠ¡idä¸min_idã€max_idçš„å¤§å°å…³ç³»è¿”å›ç»“æœï¼š</p><ol><li>å¦‚æœDB_TRX_ID &lt; min_idï¼Œè¡¨ç¤ºè¯¥ç‰ˆæœ¬æ˜¯å·²æäº¤äº‹åŠ¡ç”Ÿæˆçš„ï¼Œè®°å½•å¯ä»¥è¿”å›ï¼›</li><li>å¦‚æœDB_TRX_ID &gt; max_idï¼Œè¡¨ç¤ºè¯¥ç‰ˆæœ¬è¿˜æœªæäº¤ï¼Œè®°å½•ä¸å¯è§ï¼›</li><li>å¦‚æœmin_id &lt; DB_TRX_ID &lt; max_idï¼š<ol><li>DB_TRX_IDåœ¨idæ•°ç»„ä¸­ï¼Œè¡¨ç¤ºè¯¥ç‰ˆæœ¬æ˜¯è¿˜æœªæäº¤äº‹åŠ¡ç”Ÿæˆï¼Œä¸å¯è§ï¼Œå¦‚æœæ˜¯è‡ªå·±çš„äº‹åŠ¡åˆ™å¯è§ï¼›</li><li>DB_TRX_IDä¸åœ¨idæ•°ç»„ä¸­ï¼Œè¡¨ç¤ºè¯¥ç‰ˆæœ¬æ˜¯å·²æäº¤äº‹åŠ¡ç”Ÿæˆï¼Œå¯è§ã€‚</li></ol></li></ol><p>å¿«ç…§è¯»ä¸ä¼šçœ‹åˆ°å…¶ä»–äº‹åŠ¡æ’å…¥çš„æ•°æ®ï¼Œå› æ­¤å¹»è¯»åªä¼šåœ¨å½“å‰è¯»ä¸‹å‡ºç°ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="mysqlæ—¥å¿—">MySQLæ—¥å¿—<a class="hash-link" href="#mysqlæ—¥å¿—" title="Direct link to heading">â€‹</a></h2><p>MySQLæ—¥å¿—åŒ…æ‹¬é”™è¯¯æ—¥å¿—ã€æŸ¥è¯¢æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ã€äº‹åŠ¡æ—¥å¿—å’ŒäºŒè¿›åˆ¶æ—¥å¿—ã€‚é‡ç‚¹ä»‹ç»äºŒè¿›åˆ¶æ—¥å¿—binlogå’Œäº‹åŠ¡æ—¥å¿—redo logå’Œundo logã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="binlog">binlog<a class="hash-link" href="#binlog" title="Direct link to heading">â€‹</a></h3><p>binlogä»¥äºŒè¿›åˆ¶å½¢å¼è®°å½•æ•°æ®åº“æ‰§è¡Œçš„å†™å…¥æ“ä½œï¼Œå®ƒæ˜¯é€»è¾‘æ—¥å¿—ï¼Œ<strong>ä½¿ç”¨ä»»ä½•å­˜å‚¨å¼•æ“çš„MySQLéƒ½ä¼šè®°å½•binlogæ—¥å¿—</strong>ã€‚Bin logä¸»è¦ä½¿ç”¨åœºæ™¯æœ‰ï¼š</p><ol><li>ä¸»ä»å¤åˆ¶ï¼šåœ¨MasterèŠ‚ç‚¹å¼€å¯bin logï¼Œç„¶åå°†å…¶å‘é€åˆ°Slaveç«¯ï¼ŒSlaveç«¯é‡æ”¾bin logå®ç°ä¸»ä»ä¸€è‡´ï¼›</li><li>æ•°æ®æ¢å¤ï¼šé€šè¿‡mysqlbinlogå·¥å…·æ¥æ¢å¤æ•°æ®ã€‚</li></ol><p>binlogé€šè¿‡è¿½åŠ æ–¹å¼å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œå‚æ•°<code>max_binlog_size</code>æ§åˆ¶binlogæ–‡ä»¶å¤§å°ï¼Œè¾¾åˆ°è¯¥å€¼åç”Ÿæˆæ–°æ—¥å¿—æ–‡ä»¶ï¼Œé€šè¿‡<code>sync_binlog</code>å‚æ•°æ§åˆ¶å†™å…¥æ—¶æœºï¼š</p><ol><li>0ï¼šç”±ç³»ç»Ÿè‡ªè¡Œåˆ¤æ–­ä½•æ—¶å†™å…¥ç£ç›˜ï¼›</li><li>1ï¼šæ¯æ¬¡commintæäº¤éƒ½å°†binlogå†™å…¥ç£ç›˜ï¼›</li><li>Nï¼šæ¯Nä¸ªäº‹åŠ¡å°†binlogå†™å…¥ç£ç›˜ã€‚</li></ol><p>MySQL 5.7.7èµ·é»˜è®¤å€¼ä¸º1ï¼Œè°ƒå¤§è¯¥å€¼å¯ä»¥æå‡æ€§èƒ½ä½†ä¼šç‰ºç‰²æ•°æ®ä¸€è‡´æ€§ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="æ—¥å¿—æ ¼å¼">æ—¥å¿—æ ¼å¼<a class="hash-link" href="#æ—¥å¿—æ ¼å¼" title="Direct link to heading">â€‹</a></h4><p>binlogæ—¥å¿—æ ¼å¼åˆ†ä¸ºå¦‚ä¸‹3ç§ï¼Œé€šè¿‡å‚æ•°<code>binlog-format</code>æŒ‡å®šï¼š</p><ol><li>statementï¼šåŸºäºSQLè¯­å¥çš„å¤åˆ¶(statement-based replication, SBR)ï¼Œå°†ä¿®æ”¹æ•°æ®çš„sqlè®°å½•åˆ°binlogï¼›<ol><li>ä¼˜ç‚¹ï¼šä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œå˜åŒ–ï¼Œå‡å°‘æ—¥å¿—é‡ï¼›</li><li>ç¼ºç‚¹ï¼šæŸäº›sqlè¯­å¥ä¼šå¯¼è‡´ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Œå¦‚sysdate()ã€sleep()ç­‰ã€‚</li></ol></li><li>rowï¼šåŸºäºè¡Œçš„å¤åˆ¶(row-based replication, RBR)ï¼Œä¸è®°å½•sqlè¯­å¥ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»…è®°å½•å“ªæ¡æ•°æ®è¢«ä¿®æ”¹<ol><li>ä¼˜ç‚¹ï¼šä¸ä¼šå‡ºç°å­˜å‚¨è¿‡ç¨‹æŒ‡å®šå¯¼è‡´æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ï¼›</li><li>ç¼ºç‚¹ï¼šä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—ï¼Œå°¤å…¶alter tableæ—¶ã€‚</li></ol></li><li>mixedï¼šä»¥ä¸Šä¸¤è€…çš„èåˆï¼Œä¸€èˆ¬å¤åˆ¶ä½¿ç”¨statementï¼Œå¤„ç†ä¸äº†çš„ä½¿ç”¨rowæ¨¡å¼ã€‚</li></ol><p>MySQL 5.7.7å‰é»˜è®¤ä¸ºstatementï¼Œä¹‹åé»˜è®¤ä¸ºrowã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="redo-log">redo log<a class="hash-link" href="#redo-log" title="Direct link to heading">â€‹</a></h3><p>ä¸ºäº†å®ç°äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯åœ¨æ¯æ¬¡äº‹åŠ¡æäº¤åå°†ä¿®æ”¹æ•°æ®å…¨éƒ¨åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œä½†è¿™ä¹ˆåšä¼šå¯¼è‡´ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>InnoDBä»¥é¡µä¸ºå•ä½åˆ·æ–°ç£ç›˜ï¼Œä¸€ä¸ªäº‹åŠ¡å¯èƒ½åªä¿®æ”¹äº†æ•°æ®é¡µä¸­çš„å‡ ä¸ªå­—èŠ‚ï¼Œæ­¤æ—¶å°†å®Œæ•´é¡µå†™å›ç£ç›˜æµªè´¹èµ„æºï¼›</li><li>ä¸€ä¸ªäº‹åŠ¡å¯èƒ½ä¿®æ”¹å¤šä¸ªæ•°æ®é¡µï¼Œè€Œè¿™äº›æ•°æ®é¡µåœ¨ç‰©ç†ä¸Šå¹¶ä¸è¿ç»­ï¼Œä½¿ç”¨éšæœºIOå†™å›æ€§èƒ½å¤ªå·®ã€‚</li></ol><p>å› æ­¤MySQLå®ç°redo logæ¥è®°å½•äº‹åŠ¡å¯¹æ•°æ®é¡µè¿›è¡Œäº†å“ªäº›ä¿®æ”¹ï¼Œè§£å†³ä¿®æ”¹å†™å›çš„æ€§èƒ½é—®é¢˜ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="å†™å…¥æœºåˆ¶">å†™å…¥æœºåˆ¶<a class="hash-link" href="#å†™å…¥æœºåˆ¶" title="Direct link to heading">â€‹</a></h4><p>redo logåŒ…æ‹¬å†…å­˜ä¸­çš„æ—¥å¿—ç¼“å†²redo log bufferå’Œç£ç›˜ä¸­çš„æ—¥å¿—æ–‡ä»¶redo log fileã€‚æ¯æ¬¡æ‰§è¡ŒDMLè¯­å¥ï¼Œå…ˆå°†è®°å½•å†™å…¥redo log bufferï¼Œç„¶ååœ¨æŸä¸ªæ—¶åˆ»ä¸€æ¬¡æ€§å°†å¤šæ¡è®°å½•å†™å…¥åˆ°redo log fileï¼Œè¿™ç§å…ˆå†™å†…å­˜å†å†™ç£ç›˜çš„æ–¹å¼ç§°ä¸ºå†™å‰æ—¥å¿—(Write Ahead Logginï¼ŒWAL)ã€‚æ“ä½œç³»ç»Ÿä¸­ç”¨æˆ·ç©ºé—´çš„ç¼“å†²åŒºæ•°æ®æ˜¯æ— æ³•ç›´æ¥å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œä¸­é—´å¿…é¡»ç»è¿‡æ“ä½œç³»ç»Ÿç¼“å­˜åŒºos bufferï¼Œå› æ­¤redo bufferå†™å…¥redo lof fileæ˜¯å…ˆå†™å…¥åˆ°os bufferå†é€šè¿‡fsyncç³»ç»Ÿè°ƒç”¨å†™åˆ°redo log fileã€‚redo logå†™å…¥ç­–ç•¥ç”±å‚æ•°<code>innodb_flush_log_at_trx_commit</code>æ§åˆ¶ï¼Œå¯é€‰å€¼åŠå«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>0(å»¶è¿Ÿå†™)ï¼šäº‹åŠ¡æäº¤ä¸ä¼šå°†redo log bufferå†™å…¥åˆ°os bufferï¼Œè€Œæ˜¯æ¯ç§’å†™å…¥os bufferç„¶åå†é€šè¿‡fsyncå†™å…¥åˆ°redo log fileï¼Œå³æ¯éš”1ç§’å†™å›ç£ç›˜ï¼Œå› æ­¤æ•…éšœæ—¶ä¼šä¸¢å¤±1ç§’å†…çš„æ•°æ®ï¼›</li><li>1(å®æ—¶å†™ï¼Œå®æ—¶åˆ·)ï¼šæ¯æ¬¡äº‹åŠ¡æäº¤å³å†™å…¥os bufferå¹¶è°ƒç”¨fsyncåˆ·åˆ°redo log fileï¼Œæ•…éšœæ—¶ä¸ä¼šä¸¢å¤±æ•°æ®ä½†IOæ€§èƒ½å·®ï¼›</li><li>2(å®æ—¶å†™ï¼Œå»¶è¿Ÿåˆ·)ï¼šæ¯æ¬¡äº‹åŠ¡æäº¤å†™å…¥åˆ°os bufferï¼Œç„¶åæ¯éš”1ç§’è°ƒç”¨fsyncåˆ·åˆ°redo log fileã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ—¥å¿—å¯¹æ¯”">æ—¥å¿—å¯¹æ¯”<a class="hash-link" href="#æ—¥å¿—å¯¹æ¯”" title="Direct link to heading">â€‹</a></h3><table><thead><tr><th>æ¯”è¾ƒé¡¹</th><th>redo log</th><th>bin log</th></tr></thead><tbody><tr><td>æ–‡ä»¶å¤§å°</td><td>å¤§å°å›ºå®š</td><td>å¤§å°é€šè¿‡å‚æ•°è®¾ç½®</td></tr><tr><td>å®ç°å±‚çº§</td><td>InnDBå¼•æ“å®ç°</td><td>Serverå±‚å®ç°ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨</td></tr><tr><td>è®°å½•æ–¹å¼</td><td>å¾ªç¯å†™</td><td>è¿½åŠ å†™ï¼Œæ–‡ä»¶å¤§å°è¶…è¿‡è®¾å®šå€¼æ—¶è®°å½•åˆ°æ–°æ–‡ä»¶ä¸Š</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>å´©æºƒæ¢å¤</td><td>ä¸»ä»å¤åˆ¶å’Œæ•°æ®æ¢å¤</td></tr></tbody></table><p>Redo logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•æ•°æ®é¡µçš„å˜åŒ–ï¼Œè€Œbin logå’Œundo logæ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•æ‰§è¡Œè¯­å¥ã€‚Redo logå®ç°äº‹åŠ¡æŒä¹…æ€§ï¼Œundo logå®ç°æ—¥å¿—åŸå­æ€§ã€‚åœ¨æ¢å¤æ•°æ®çš„æ•ˆç‡ä¸Šï¼Œredo logä¼˜äºbin logã€‚</p>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="MySQL" term="MySQL"/>
        <category label="Summary" term="Summary"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[RedisçŸ¥è¯†ç‚¹æ€»ç»“]]></title>
        <id>/2022/03/01/RedisSummary</id>
        <link href="https://kayhaw.github.io/blog/2022/03/01/RedisSummary"/>
        <updated>2022-03-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[RedisçŸ¥è¯†ç‚¹æ€»ç»“]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“RedisçŸ¥è¯†ç‚¹æ€»ç»“ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ•°æ®ç»“æ„">æ•°æ®ç»“æ„<a class="hash-link" href="#æ•°æ®ç»“æ„" title="Direct link to heading">â€‹</a></h2><p>Rediså¸¸ç”¨æ•°æ®ç»“æ„5ç§ï¼šStringã€Listã€Setã€ZSetå’ŒHashï¼Œè¿™äº›æ•°æ®ç»“æ„åˆç”±å¦‚ä¸‹åº•å±‚æ•°æ®ç»“æ„æ”¯æ’‘ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="sds">SDS<a class="hash-link" href="#sds" title="Direct link to heading">â€‹</a></h3><p>Redisçš„å­—ç¬¦ä¸²ç±»å‹åŸºäºSDS(Simple Dynamic String)ï¼Œç›¸æ¯”äºCè¯­è¨€çš„å­—ç¬¦ä¸²ï¼Œå®ƒå…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p><ol><li>å­—æ®µlenè®°å½•å­—ç¬¦ä¸²é•¿åº¦ï¼Œä¸éœ€è¦ä½¿ç”¨<code>strlen</code>æ–¹æ³•éå†å­—ç¬¦ä¸²è®¡ç®—ï¼›</li><li>ç©ºé—´é¢„åˆ†é…ï¼šä¸ºå­—ç¬¦ä¸²åˆ†é…ç©ºé—´æ—¶ä¼šç”³è¯·é¢å¤–çš„ç©ºé—´ï¼›</li><li>æƒ°æ€§ç©ºé—´é‡Šæ”¾ï¼šSDSç¼©çŸ­æ—¶ä¸ä¼šå›æ”¶å¤šä½™ç©ºé—´ï¼Œè€Œæ˜¯ä½¿ç”¨freeå­—æ®µè®°å½•å¤šä½™ç©ºé—´ï¼Œåç»­appendæ“ä½œç›´æ¥ä½¿ç”¨å‡å°‘å†…å­˜ç”³è¯·æ¬¡æ•°ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="ziplist">zipList<a class="hash-link" href="#ziplist" title="Direct link to heading">â€‹</a></h3><p>å‹ç¼©åˆ—è¡¨æ˜¯listã€hashå’Œsorted setåº•å±‚å®ç°ï¼Œå‹ç¼©åˆ—è¡¨å¹¶ä¸æ˜¯æŒ‡ä½¿ç”¨æŸç§å‹ç¼©ç®—æ³•æ¥èŠ‚çœç©ºé—´ï¼Œè€Œæ˜¯ä½¿ç”¨è¿ç»­å†…å­˜ç©ºé—´æ¥èŠ‚çœï¼Œzipliståˆåˆ†ä¸ºå¦‚ä¸‹éƒ¨åˆ†ï¼š</p><ul><li>zlbytesï¼š4bytesï¼Œä¿å­˜ziplistå ç”¨çš„å†…å­˜å­—èŠ‚æ•°ï¼›</li><li>zltailï¼š4bytesï¼Œä¿å­˜å°¾èŠ‚ç‚¹åˆ°èµ·å§‹åœ°å€çš„åç§»é‡ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åˆ°å°¾èŠ‚ç‚¹ï¼›</li><li>zllenï¼š2bytesï¼Œä¿å­˜å‹ç¼©åˆ—è¡¨ä¸­çš„èŠ‚ç‚¹ä¸ªæ•°ï¼›</li><li>entryï¼šåˆ—è¡¨èŠ‚ç‚¹<ul><li>previous_entry_lengthï¼šå‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ï¼›</li><li>encodingï¼šcontentçš„å†…å®¹ç±»å‹å’Œé•¿åº¦ï¼›</li><li>contentï¼šèŠ‚ç‚¹å†…å®¹ã€‚</li></ul></li><li>zlendï¼šè¡¨ç¤ºå‹ç¼©åˆ—è¡¨ç»“æŸçš„ç‰¹æ®Šç¬¦å·<code>0xFF</code>ã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="skiplist">skipList<a class="hash-link" href="#skiplist" title="Direct link to heading">â€‹</a></h3><p>è·³è¡¨skipListæ˜¯ä¸€ç§æœ‰åºçš„æ•°æ®ç»“æ„ï¼ŒRedisçš„sorted set(zset)åŸºäºå®ƒå®ç°ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="redisä¸ºä»€ä¹ˆå¿«">Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ<a class="hash-link" href="#redisä¸ºä»€ä¹ˆå¿«" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="å•çº¿ç¨‹æ¨¡å‹">å•çº¿ç¨‹æ¨¡å‹<a class="hash-link" href="#å•çº¿ç¨‹æ¨¡å‹" title="Direct link to heading">â€‹</a></h3><p>Redisçš„å•çº¿ç¨‹æ¨¡å¼æ˜¯æŒ‡Redisç½‘ç»œIO(Redis 5.xä¹‹åä¸ºå¤šçº¿ç¨‹)ä»¥åŠK-Vè¯»å†™ç”±ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œï¼Œè€ŒRedisæŒä¹…åŒ–ã€é›†ç¾¤åŒæ­¥å’Œå¼‚æ­¥åˆ é™¤æ˜¯ç”±å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œå¹¶ä¸æ˜¯è¯´Redisç¨‹åºå°±ä¸€ä¸ªçº¿ç¨‹å·¥ä½œã€‚Redisé”®å€¼å¯¹çš„è¯»å†™æ˜¯å•çº¿ç¨‹çš„ï¼Œå…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p><ol><li>é¿å…å¤šçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶çš„å¼€é”€ï¼›</li><li>é¿å…çº¿ç¨‹åˆ›å»ºå¼€é”€ï¼›</li><li>é¿å…å¤šçº¿ç¨‹ç«äº‰é—®é¢˜ï¼›</li><li>ä»£ç æ¸…æ™°ï¼Œé€»è¾‘ç®€å•ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="ioå¤šè·¯å¤ç”¨">I/Oå¤šè·¯å¤ç”¨<a class="hash-link" href="#ioå¤šè·¯å¤ç”¨" title="Direct link to heading">â€‹</a></h3><p>Redisä½¿ç”¨epollåŠ è‡ªè¡Œå®ç°çš„äº‹ä»¶æ¡†æ¶æ¥å¤„ç†è¿æ¥è¯·æ±‚ï¼Œä¸ä¼šé˜»å¡åœ¨æŸä¸ªç‰¹å®šçš„å®¢æˆ·ç«¯è¯·æ±‚å¤„ç†ä¸Šï¼Œå› æ­¤å¯ä»¥åŒæ—¶å’Œå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥å¤„ç†è¯·æ±‚ï¼Œæå‡å¹¶å‘æ€§ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å…¨å±€hashè¡¨">å…¨å±€Hashè¡¨<a class="hash-link" href="#å…¨å±€hashè¡¨" title="Direct link to heading">â€‹</a></h3><p>Redisä½¿ç”¨ä¸€ä¸ªå…¨å±€Hashè¡¨æ¥ä¿å­˜æ‰€æœ‰é”®å€¼å¯¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚keyç±»å‹ä¸ºStringï¼Œvalueç±»å‹ä¸ºredisObjectã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¦‚ä½•å¤„ç†hashå†²çª">å¦‚ä½•å¤„ç†Hashå†²çª<a class="hash-link" href="#å¦‚ä½•å¤„ç†hashå†²çª" title="Direct link to heading">â€‹</a></h3><p>Redisä½¿ç”¨é“¾è¡¨æ–¹è§£å†³hashå†²çªï¼Œä½†æ˜¯å½“é“¾è¡¨é•¿åº¦è¿‡é•¿æ—¶å°±ä¼šå¯¼è‡´æŸ¥è¯¢æ€§èƒ½ä¸‹é™ï¼Œæ­¤æ—¶éœ€è¦å¢åŠ åº•å±‚hashæ•°ç»„çš„é•¿åº¦å¹¶rehashæ¥è¿›è¡Œæ‰©å®¹ã€‚å’ŒJava HashMapåœ¨hashæ•°ç»„è´Ÿè½½è¾¾åˆ°0.75ä¸åŒï¼ŒRedis hashè¡¨åœ¨è´Ÿè½½ä¸º1æ—¶è¿›è¡Œæ‰©å®¹rehashï¼Œå¹¶ä¸”é‡‡ç”¨<strong>æ¸è¿›å¼rehash</strong>ã€‚hashè¡¨æœ‰2ä¸ªåº•å±‚æ•°ç»„ä»¥åŠrehashidxæ ‡è¯†ï¼Œåˆå§‹hashè¡¨é•¿åº¦ä¸º4ï¼Œrehashidxä¸º-1ï¼Œå½“å…ƒç´ ä¸ªæ•°è¾¾åˆ°4æ—¶æ‰©å®¹ä¸ºåŸæ¥2å€ã€‚</p><ol><li>ä¸ºht<!-- -->[1]<!-- -->åˆ†é…ç©ºé—´ï¼Œè®©å…¨å±€hashè¡¨åŒæ—¶æŒ‡å‘ht<!-- -->[0]<!-- -->å’Œht<!-- -->[1]<!-- -->ï¼›</li><li>è®¾ç½®rehashxidä¸º0ï¼Œæ ‡è¯†rehashå¼€å§‹ï¼›</li><li>æ¯æ¬¡å¢åˆ æ”¹æŸ¥æ—¶ï¼Œå°†ht<!-- -->[0]<!-- -->çš„å…ƒç´ rehashåˆ°ht<!-- -->[1]<!-- -->ï¼ŒrehashidxåŠ 1ï¼›</li><li>éšç€æ“ä½œæ‰§è¡Œï¼Œæœ€ç»ˆht<!-- -->[0]<!-- -->çš„å…ƒç´ éƒ½ä¼šè¢«rehashåˆ°ht<!-- -->[1]<!-- -->ä¸Šï¼Œæ­¤æ—¶å°†rehashidxç½®ä¸º-1ï¼Œæ ‡è¯†rehashç»“æŸã€‚</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="æŒä¹…åŒ–">æŒä¹…åŒ–<a class="hash-link" href="#æŒä¹…åŒ–" title="Direct link to heading">â€‹</a></h2><p>ä¸ºäº†é¿å…æ”¾åœ¨å†…å­˜ä¸­çš„ç¼“å­˜æ•°æ®å› ä¸ºæ•…éšœè€Œä¸¢å¤±ï¼ŒRedisæä¾›RDBå’ŒAOFä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="rdb">RDB<a class="hash-link" href="#rdb" title="Direct link to heading">â€‹</a></h3><p>RDB(Redis Database)æ˜¯ä¸€ç§å¿«ç…§æŒä¹…åŒ–æ–¹å¼ï¼Œå®ƒå°†RedisæŸä¸€æ—¶åˆ»çš„å†…å­˜æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜æ–‡ä»¶ä¸­ï¼Œé»˜è®¤æ–‡ä»¶åä¸ºdump.rdbï¼Œåœ¨RedisæœåŠ¡å¯åŠ¨æ—¶ä¼šé‡æ–°åŠ è½½è¯¥æ–‡ä»¶åˆ°å†…å­˜ä¸­ä»¥æ¢å¤æ•°æ®ã€‚RDBé€šè¿‡å¦‚ä¸‹æ–¹å¼å¼€å¯ï¼š</p><ol><li>saveå‘½ä»¤ï¼šåŒæ­¥æ“ä½œï¼ŒRedisæœåŠ¡ä¼šé˜»å¡saveå‘½ä»¤ä¹‹åçš„æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå½“å¿«ç…§æ•°æ®é‡è¿‡å¤§æ—¶saveæ“ä½œæ‰§è¡Œæ—¶é—´è¾ƒé•¿ï¼Œå› æ­¤é¿å…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼›</li><li>bgsaveå‘½ä»¤ï¼šå¼‚æ­¥æ“ä½œï¼ŒRedisæœåŠ¡ä¸»è¿›ç¨‹forksä¸€ä¸ªå­è¿›ç¨‹å°†æ•°æ®ä¿å­˜åˆ°dump.rdbæ–‡ä»¶ï¼Œä¸»è¿›ç¨‹ä»å¯ä»¥æ¥æ”¶å…¶ä»–è¯·æ±‚ä½†å­è¿›ç¨‹æ˜¯åŒæ­¥çš„ï¼›</li><li>é…ç½®æ–‡ä»¶ï¼šåœ¨redis.confé…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼Œæ ¼å¼ä¸º<code>save N M</code>ï¼Œè¡¨ç¤ºåœ¨Nç§’å†…è¾¾åˆ°Mæ¡å†™å‘½ä»¤åˆ™è¿›è¡Œä¸€æ¬¡æ•°æ®ä¿å­˜(ä¸bgsaveç±»ä¼¼)ã€‚</li></ol><p>æ— è®ºæ˜¯ç”±ä¸»è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹ï¼Œç”Ÿæˆdump.rdbæ–‡ä»¶æ­¥éª¤ä¸ºï¼šç”Ÿæˆä¸´æ—¶rdbæ–‡ä»¶å¹¶å†™å…¥æ•°æ®ï¼Œå®Œæˆæ•°æ®å†™å…¥ç”¨ä¸´æ—¶æ–‡ä»¶ä»£æ›¿åŸrdbæ–‡ä»¶ï¼Œåˆ é™¤åŸrdbæ–‡ä»¶ã€‚ä¸rdbç›¸å…³çš„é…ç½®æœ‰ï¼š</p><ol><li>æ˜¯å¦å¼€å¯å‹ç¼©ï¼š<code>rdbcompression yes[no]</code>;</li><li>æ–‡ä»¶åç§°ï¼š<code>dbfilename &lt;filename&gt;</code>;</li><li>å­˜å‚¨è·¯å¾„ï¼š<code>dir &lt;path&gt;</code>ã€‚</li></ol><p>ğŸ˜„ä¼˜ç‚¹ï¼š</p><ul><li>ä¸aofç›¸æ¯”æ¢å¤æ•°æ®é€Ÿåº¦æ›´å¿«ï¼›</li><li>æ–‡ä»¶æ ¼å¼ç´§å‡‘ï¼Œé€‚åˆæ•°æ®å¤‡ä»½ï¼›</li><li>ä½¿ç”¨å­è¿›ç¨‹å¤‡ä»½æ•°æ®ï¼Œæœ‰Redisä¸»è¿›ç¨‹æœåŠ¡å½±å“å°</li></ul><p>ğŸ˜ ç¼ºç‚¹ï¼š</p><ul><li>æœåŠ¡å™¨æ•…éšœä¼šä¸¢å¤±ä¸Šä¸€æ¬¡æˆåŠŸå¤‡ä»½ä»¥æ¥çš„æ•°æ®ï¼›</li><li>ä½¿ç”¨saveå‘½ä»¤ä¼šé˜»å¡ä¸»è¿›ç¨‹ï¼Œç›´åˆ°ä¿å­˜å®Œæˆï¼›</li><li>ä½¿ç”¨bgsaveå‘½ä»¤åœ¨æ•°æ®é‡å¤ªå¤§æ—¶ä¹Ÿä¼šå‘ç”Ÿé˜»å¡ã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="aof">AOF<a class="hash-link" href="#aof" title="Direct link to heading">â€‹</a></h3><p>AOF(Append-only File)è®°å½•å®¢æˆ·ç«¯æ¯æ¬¡çš„å†™æ“ä½œå‘½ä»¤åˆ°ç¼“å†²åŒºï¼Œç„¶åå°†ç¼“å†²åŒºæ•°æ®ä»¥Redisåè®®<strong>è¿½åŠ </strong>ä¿å­˜åˆ°appendonly.aofæ–‡ä»¶å°¾éƒ¨ï¼Œåœ¨RedisæœåŠ¡å¯åŠ¨æ—¶ä¼šåŠ è½½å¹¶æ‰§è¡Œaofæ–‡ä»¶ä¸­çš„å‘½ä»¤ï¼Œä»è€Œæ¢å¤æ•°æ®ã€‚ä¸aofç›¸å…³çš„é…ç½®æœ‰ï¼š</p><ol><li>æ˜¯å¦å¼€å¯aofï¼š<code>appendonly yes[no]</code>ï¼›</li><li>æ–‡ä»¶åç§°ï¼š<code>appendfilename &lt;filename&gt;</code>ï¼›</li><li>å†™å…¥ç­–ç•¥ï¼š<code>appendfsync always[everysec][no]</code>ï¼›</li><li>æ˜¯å¦é‡å†™aofæ–‡ä»¶ï¼Œé»˜è®¤å¦ï¼š<code>no-appendfsync-on-rewrite no</code>ï¼›</li><li>å­˜å‚¨è·¯å¾„ï¼š<code>dir &lt;path&gt;</code>ã€‚</li></ol><p>å…¶ä¸­ï¼Œå†™å…¥ç­–ç•¥å¯é€‰å€¼åŠå…¶å«ä¹‰å¦‚ä¸‹ï¼š</p><ol><li>alwaysï¼šæ¯ä¸ªå†™æ“ä½œéƒ½ä¿å­˜åˆ°aofæ–‡ä»¶ä¸­ï¼Œé€Ÿåº¦æ…¢ï¼›</li><li>everysecï¼šæ¯ç§’å†™å…¥ä¸€æ¬¡aofæ–‡ä»¶ï¼Œæœ€å¤šä¼šä¸¢å¤±1sçš„æ•°æ®ï¼›</li><li>noï¼šç”±æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™å†™å…¥aofæ–‡ä»¶ï¼Œä¸æ¨èã€‚</li></ol><p>aofé‡å†™å€¼å°†å¤šä¸ªå†™æ“ä½œåˆå¹¶ç”Ÿæˆä¸ºç­‰ä»·çš„æœ€å°å‘½ä»¤é›†ï¼Œæ¯”å¦‚<code>incr num 1</code>...<code>incr num 10000</code>å¯ä»¥é‡å†™ä¸º<code>set num 10000</code>(aofæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸æ˜¯ç›´æ¥å­˜å‚¨å‘½ä»¤ï¼Œä»…æ˜¯ç¤ºä¾‹è¯´æ˜)ã€‚ç”±äºé‡å†™åœ¨æ¯æ¬¡fsyncæ“ä½œæ—¶è¿›è¡Œï¼Œä¼šå½±å“æœåŠ¡æ€§èƒ½ï¼Œå› æ­¤é»˜è®¤å…³é—­ã€‚å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡<code>bgrewriteaof</code>å‘½ä»¤è®©æœåŠ¡ç«¯è¿›è¡Œaofé‡å†™ã€‚é‡å†™aofå¯ä»¥å‹ç¼©aofæ–‡ä»¶å¤§å°ï¼Œå¹¶ä¸”åŠ å¿«æ•°æ®æ¢å¤é€Ÿåº¦ã€‚</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>AOFæ–‡ä»¶æŸåæ€ä¹ˆåŠï¼Ÿ</h5></div><div class="admonition-content"><p>åœ¨å†™å…¥aofæ–‡ä»¶æ—¶RedisæœåŠ¡å‘ç”Ÿæ•…éšœï¼Œæ­¤æ—¶aofæ–‡ä»¶ä¼šå‡ºç°æ ¼å¼é”™è¯¯ï¼Œå¯ä»¥å…ˆå¤åˆ¶aofæ–‡ä»¶ï¼Œç„¶åé€šè¿‡<code>redis-check-aof -fix &lt;appendonly.aof&gt;</code>ä¿®å¤ã€‚</p></div></div><p>ğŸ˜„ä¼˜ç‚¹ï¼šAOFåªæ˜¯è¿½åŠ æ–‡ä»¶ï¼Œå¯¹æœåŠ¡å™¨æ€§èƒ½å°ï¼Œä¿å­˜æ•°æ®æ—¶æ¯”RDBå¿«ä¸”æ¶ˆè€—å†…å­˜å°‘;</p><p>ğŸ˜ ç¼ºç‚¹ï¼šç”Ÿæˆæ—¥å¿—æ–‡ä»¶å¤ªå¤§(å³ä½¿ç»è¿‡é‡å†™)ï¼Œæ¢å¤é€Ÿåº¦æ¯”RDBæ…¢ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="rdb-vs-aof">RDB vs AOF<a class="hash-link" href="#rdb-vs-aof" title="Direct link to heading">â€‹</a></h3><table><thead><tr><th>å¯¹æ¯”é¡¹\æ–¹æ¡ˆ</th><th>RDB</th><th>AOF</th></tr></thead><tbody><tr><td>å·¥ä½œè´Ÿè·</td><td>é‡</td><td>è½»</td></tr><tr><td>æ¢å¤é€Ÿåº¦</td><td>å¿«</td><td>æ…¢</td></tr><tr><td>æ–‡ä»¶ä½“ç§¯</td><td>å°</td><td>å¤§</td></tr><tr><td>æ•°æ®å®‰å…¨</td><td>ä¼šä¸¢æ•°æ®</td><td>ç”±ç­–ç•¥å†³å®š</td></tr></tbody></table><p><strong>å½“åŒæ—¶å¼€å¯AOFå’ŒRDBæ—¶ï¼ŒRedisä¼˜å…ˆä½¿ç”¨AOFæ¥æ¢å¤æ•°æ®ï¼Œå› ä¸ºAOFä¿å­˜è®°å½•æ¯”RDBæ›´åŠ å®Œæ•´</strong>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ•°æ®æ·˜æ±°ç­–ç•¥">æ•°æ®æ·˜æ±°ç­–ç•¥<a class="hash-link" href="#æ•°æ®æ·˜æ±°ç­–ç•¥" title="Direct link to heading">â€‹</a></h2><p>è¿™é‡Œå°†Redisçš„æ•°æ®æ·˜æ±°ç­–ç•¥åˆ†ä¸º2ç±»ï¼šé’ˆå¯¹è¿‡æœŸé”®å€¼å¯¹çš„åˆ é™¤ç­–ç•¥å’Œé’ˆå¯¹æ‰€æœ‰é”®å€¼å¯¹çš„å†…å­˜æ·˜æ±°ç­–ç•¥ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="è¿‡æœŸé”®åˆ é™¤ç­–ç•¥">è¿‡æœŸé”®åˆ é™¤ç­–ç•¥<a class="hash-link" href="#è¿‡æœŸé”®åˆ é™¤ç­–ç•¥" title="Direct link to heading">â€‹</a></h3><p>é€šè¿‡EXPIREå’ŒPERSISTå‘½ä»¤åˆ†åˆ«è®¾ç½®é”®è¿‡æœŸæ—¶é—´æˆ–è€…æ°¸ä¹…æœ‰æ•ˆï¼ŒRedisé€šè¿‡å¦‚ä¸‹3ç§ç­–ç•¥åˆ é™¤è¿‡æœŸé”®å€¼å¯¹ï¼š</p><table><thead><tr><th>åˆ é™¤ç­–ç•¥</th><th>å·¥ä½œæœºåˆ¶</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>å®šæ—¶åˆ é™¤</td><td>æ¯ä¸ªæœ‰è¿‡æœŸæ—¶é—´çš„keyåˆ›å»ºå¯¹åº”çš„å®šæ—¶å™¨ï¼Œåˆ°ç‚¹ç«‹å³åˆ é™¤</td><td>å‡å°‘å†…å­˜å ç”¨</td><td>å ç”¨å¤§é‡CPUèµ„æºï¼Œå½±å“ç¼“å­˜å“åº”æ—¶é—´å’Œååé‡</td></tr><tr><td>æƒ°æ€§åˆ é™¤</td><td>å½“è®¿é—®keyæ—¶åˆ¤æ–­å…¶æ˜¯å¦è¿‡æœŸå†åˆ é™¤</td><td>æœ€å¤§åŒ–åœ°èŠ‚çœCPUèµ„æº</td><td>å¤§é‡è¿‡æœŸkeyæ²¡è¢«è®¿é—®ä¼šå ç”¨å¤§é‡å†…å­˜</td></tr><tr><td>å®šæœŸåˆ é™¤</td><td>æ¯éš”ä¸€æ®µæ—¶é—´æ‰«æè¿‡æœŸkeyå¹¶æ¸…é™¤</td><td>å®šæ—¶ã€æƒ°æ€§åˆ é™¤çš„æŠ˜ä¸­æ–¹æ¡ˆ</td><td>éš¾ä»¥ç¡®å®šé—´éš”æ—¶é•¿</td></tr></tbody></table><p>Rediså®é™…ä½¿ç”¨æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤çš„ç»„åˆåœ¨CPUèµ„æºå’Œå†…å­˜èµ„æºä¹‹é—´å¹³è¡¡ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å†…å­˜æ·˜æ±°ç­–ç•¥">å†…å­˜æ·˜æ±°ç­–ç•¥<a class="hash-link" href="#å†…å­˜æ·˜æ±°ç­–ç•¥" title="Direct link to heading">â€‹</a></h3><p>å½“Redisç”¨äºç¼“å­˜çš„å†…å­˜ä¸è¶³æ—¶ï¼Œé€šè¿‡å¦‚ä¸‹æ·˜æ±°ç­–ç•¥å¤„ç†æ•°æ®ï¼š</p><table><thead><tr><th>æ·˜æ±°ç­–ç•¥</th><th>ä½œç”¨èŒƒå›´</th><th>å·¥ä½œæœºåˆ¶</th></tr></thead><tbody><tr><td>noeviction(é»˜è®¤)</td><td>æ‰€æœ‰key</td><td>å†…å­˜ä¸è¶³æ—¶ä¸æ·˜æ±°æ•°æ®ï¼ŒæŠ›å‡ºOOMå¼‚å¸¸</td></tr><tr><td>allkeys-lru</td><td>æ‰€æœ‰key</td><td>ç§»é™¤æœ€è¿‘æœ€å°‘è¢«ä½¿ç”¨key</td></tr><tr><td>allkeys-random</td><td>æ‰€æœ‰key</td><td>éšæœºåˆ é™¤key</td></tr><tr><td>volatile-lru</td><td>è¿‡æœŸkey</td><td>ç§»é™¤æœ€è¿‘æœ€å°‘è¢«ä½¿ç”¨key</td></tr><tr><td>volatile-random</td><td>è¿‡æœŸkey</td><td>éšæœºåˆ é™¤key</td></tr><tr><td>volatile-ttl</td><td>è¿‡æœŸkey</td><td>åˆ é™¤è¿‡æœŸæ—¶é—´æ›´æ—©key</td></tr></tbody></table><p>Rediså†…å­˜æ·˜æ±°ç­–ç•¥ä¸ä¼šå½±å“è¿‡æœŸkeyåˆ é™¤çš„å¤„ç†ï¼Œå‰è€…ç”¨äºå†…å­˜ä¸è¶³æ—¶ï¼Œåè€…ç”¨äºå¤„ç†è¿‡æœŸçš„ç¼“å­˜æ•°æ®ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ç¼“å­˜å¤±æ•ˆæƒ…å†µ">ç¼“å­˜å¤±æ•ˆæƒ…å†µ<a class="hash-link" href="#ç¼“å­˜å¤±æ•ˆæƒ…å†µ" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç¼“å­˜é›ªå´©">ç¼“å­˜é›ªå´©<a class="hash-link" href="#ç¼“å­˜é›ªå´©" title="Direct link to heading">â€‹</a></h3><p>å‡ºç°åŸå› ï¼šæçŸ­æ—¶é—´å†…ï¼ŒæŸ¥è¯¢å¤§é‡keyé›†ä¸­å¤±æ•ˆæˆ–è€…ç¼“å­˜æœåŠ¡å¤±æ•ˆï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚è½¬åˆ°æ•°æ®åº“ï¼Œå¯¹æ•°æ®åº“é€ æˆå‹åŠ›ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>åŠ é”æ’é˜Ÿï¼Œæ§åˆ¶è¯·æ±‚ï¼›</li><li>è®¾ç½®è¿‡æœŸæ ‡è®°æ›´æ–°ç¼“å­˜ï¼›</li><li>æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„ï¼›</li><li>ä¸åŒkeyè¿‡æœŸæ—¶é—´åˆ†æ•£å¼€ï¼Œé¿å…é›†ä¸­å¤±æ•ˆã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç¼“å­˜ç©¿é€">ç¼“å­˜ç©¿é€<a class="hash-link" href="#ç¼“å­˜ç©¿é€" title="Direct link to heading">â€‹</a></h3><p>å‡ºç°åŸå› ï¼šredisæŸ¥ä¸åˆ°æ•°æ®ï¼Œå†æ·±ä¸€ç‚¹çš„å°±æ˜¯è¿™ä¸ªkeyæ²¡æœ‰å€¼ï¼Œæˆ–è€…æ¶æ„è¯·æ±‚ä¸å­˜åœ¨çš„keyï¼Œredisæ²¡æœ‰å¹¶ä¸”æ•°æ®åº“ä¹Ÿæ²¡æœ‰ï¼Œè¿›è¡Œäº†2æ¬¡æ— ç”¨çš„æŸ¥è¯¢ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>è®¾ç½®nullç¼“å­˜ï¼Œè®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´</li><li>è®¾ç½®ç™½åå•ï¼Œæ’é™¤æ¶æ„è¯·æ±‚ip</li><li>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç¼“å­˜å‡»ç©¿">ç¼“å­˜å‡»ç©¿<a class="hash-link" href="#ç¼“å­˜å‡»ç©¿" title="Direct link to heading">â€‹</a></h3><p>å‡ºç°åŸå› ï¼š<strong>æŸä¸ª</strong>keyè¿‡æœŸï¼Œå¤§é‡è®¿é—®è¯·æ±‚è¯¥keyï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›å¢å¤§ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>é¢„å…ˆè®¾ç½®çƒ­é—¨æ•°æ®ï¼›</li><li>å®æ—¶è°ƒæ•´è¿‡æœŸæ—¶é—´ï¼›</li><li>ä½¿ç”¨é”ã€‚</li></ol><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>æ€»ç»“</h5></div><div class="admonition-content"><p>ç¼“å­˜é›ªå´©æ˜¯å¤§é‡è®°å½•è¿‡æœŸå¤±æ•ˆå¯¼è‡´å¤§é‡è¯·æ±‚æŸ¥è¯¢ä¸åˆ°ï¼Œç¼“å­˜å‡»ç©¿æ˜¯æŸæ¡è®°å½•å¤±æ•ˆåˆæœ‰å¤§é‡è¯·æ±‚æŸ¥è¯¢å®ƒå¯¼è‡´æŸ¥è¯¢ä¸åˆ°ï¼Œç»“æœéƒ½æ˜¯è¯·æ±‚å‹åŠ›è½¬åˆ°äº†æ•°æ®åº“ã€‚è€Œç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢æ ¹æœ¬ä¸å­˜åœ¨çš„ç¼“å­˜å¯¼è‡´è¯·æ±‚éƒ½è½¬åˆ°æ•°æ®åº“ã€‚</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç¼“å­˜é¢„çƒ­">ç¼“å­˜é¢„çƒ­<a class="hash-link" href="#ç¼“å­˜é¢„çƒ­" title="Direct link to heading">â€‹</a></h3><p>ç³»ç»Ÿä¸Šçº¿åå…ˆç›´æ¥æŠŠç¼“å­˜æ•°æ®åŠ è½½åˆ°redisï¼Œä¸æ˜¯ç­‰åˆ°ç¬¬ä¸€æ¬¡ç”¨æˆ·è¯·æ±‚æ—¶å…ˆæŸ¥è¯¢æ•°æ®åº“å†åŠ è½½åˆ°redisã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ç¼“å­˜ä¸€è‡´æ€§">ç¼“å­˜ä¸€è‡´æ€§<a class="hash-link" href="#ç¼“å­˜ä¸€è‡´æ€§" title="Direct link to heading">â€‹</a></h2><p>æ›´æ–°ç¼“å­˜çš„ç­–ç•¥æœ‰å¦‚ä¸‹4ç§æ–¹æ¡ˆï¼š</p><ol><li>å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼›</li><li>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ï¼›</li><li>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼›</li><li>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼›</li></ol><p>åˆ¶å®šæ­£ç¡®çš„ç¼“å­˜æ›´æ–°ç­–ç•¥ç¬¬ä¸€ç‚¹éœ€è¦è€ƒè™‘æ›´æ–°æ“ä½œå¤±è´¥çš„æƒ…å†µï¼šå¯¹äºæ–¹æ¡ˆ1ï¼Œå¦‚æœç¼“å­˜æ›´æ–°æˆåŠŸä½†æ•°æ®åº“æ›´æ–°å¤±è´¥ï¼Œå‡ºç°ç¼“å­˜ä¸ä¸€è‡´ã€‚è¯»æ“ä½œå…ˆæ‹¿åˆ°ç¼“å­˜çš„æœ€æ–°å€¼ï¼Œä½†ç¼“å­˜å¤±æ•ˆåå°±ä¼šä»æ•°æ®åº“å–åˆ°â€œæ—§å€¼â€ï¼Œå› æ­¤æ’é™¤è¿™ç§æ–¹æ¡ˆã€‚å¯¹äºæ–¹æ¡ˆ2ï¼Œå¦‚æœæ•°æ®åº“æ›´æ–°æˆåŠŸä½†æ˜¯ç¼“å­˜æ›´æ–°å¤±è´¥ï¼Œæ­¤åè¯»ç¼“å­˜æ˜¯â€œæ—§å€¼â€ï¼Œå½“ç¼“å­˜å¤±æ•ˆååˆå¾—åˆ°æ­£ç¡®å€¼ã€‚</p><p>ç¬¬äºŒéœ€è¦è€ƒè™‘çš„æ˜¯æ“ä½œå¹¶å‘æ€§ï¼šå¯¹äºæ–¹æ¡ˆ3ï¼Œå¦‚æœæ›´æ–°æ•°æ®åº“ä¹‹å‰æœ‰æŸ¥è¯¢è¯·æ±‚ï¼Œåˆ™å°†ä¼šè„æ•°æ®åˆ·æ–°åˆ°ç¼“å­˜ã€‚å¯¹äºæ–¹æ¡ˆ4ï¼Œå¦‚æœæ›´æ–°æ•°æ®åº“ä¹‹å‰æœ‰æŸ¥è¯¢è¯·æ±‚ï¼Œå¹¶ä¸”ç¼“å­˜å¤±æ•ˆï¼Œåˆ™ä¼šæŸ¥è¯¢æ•°æ®åº“â€œæ—§å€¼â€å¹¶æ›´æ–°ç¼“å­˜ã€‚</p><p>é‚£åˆ°åº•æ˜¯é€‰æ‹©åˆ é™¤ç¼“å­˜è¿˜æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿä¸€èˆ¬é€‰æ‹©åˆ é™¤ç¼“å­˜ï¼Œç†ç”±å¦‚ä¸‹ï¼š</p><ol><li>æ›´æ–°ç¼“å­˜æœ‰ç»´æŠ¤æˆæœ¬ï¼Œå­˜åœ¨å¹¶å‘æ›´æ–°é—®é¢˜ï¼›</li><li>å†™å¤šè¯»å°‘åœºæ™¯ä¸‹ï¼Œè¯»è¯·æ±‚è¿˜æ²¡æ¥ï¼Œç¼“å­˜å°±è¢«é¢‘ç¹æ›´æ–°ï¼Œæ²¡æœ‰èµ·åˆ°ç¼“å­˜ä½œç”¨ï¼›</li><li>æ›´æ–°ç¼“å­˜å€¼å¯èƒ½ç»è¿‡å¤æ‚è®¡ç®—ï¼Œæ¯æ¬¡æ›´æ–°ç¼“å­˜å€¼æµªè´¹æ€§èƒ½ï¼›</li><li>åˆ é™¤ç¼“å­˜æ“ä½œç®€å•ï¼Œç¼ºç‚¹ä»…æ˜¯é€ æˆä¸€æ¬¡cache missã€‚</li></ol><p>å¦‚æœæ›´æ–°ç¼“å­˜å¼€é”€å°å¹¶ä¸”è¯»å¤šå†™å°‘ï¼ŒåŸºæœ¬æ²¡æœ‰å¹¶å‘å†™æ—¶æ‰æ›´æ–°ç¼“å­˜ï¼Œå¦åˆ™ä¸€èˆ¬ä½¿ç”¨åˆ é™¤ç¼“å­˜ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å»¶è¿ŸåŒåˆ ">å»¶è¿ŸåŒåˆ <a class="hash-link" href="#å»¶è¿ŸåŒåˆ " title="Direct link to heading">â€‹</a></h3><p>å½“é€‰æ‹©å…ˆåˆ é™¤ç¼“å­˜å†æ›´æ–°æ•°æ®åº“æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹å¹¶å‘æ“ä½œï¼š</p><ol><li>çº¿ç¨‹Aæ›´æ–°Xä¸º2ï¼Œæ—§å€¼ä¸º1ï¼›</li><li>çº¿ç¨‹Aå…ˆåˆ é™¤ç¼“å­˜ï¼›</li><li>çº¿ç¨‹Bè¯»ç¼“å­˜æœªå‘½ä¸­ï¼Œäºæ˜¯ä»æ•°æ®åº“è¯»åˆ°æ—§å€¼1å¹¶è®¾ç½®ç¼“å­˜ï¼›</li><li>çº¿ç¨‹Aå°†æ–°å€¼2å†™å…¥æ•°æ®åº“ï¼›</li><li>çº¿ç¨‹Bå°†æ—§å€¼1å†™å…¥ç¼“å­˜ã€‚</li></ol><p>å¦‚æ­¤å½¢æˆäº†ç¼“å­˜ä¸ºæ—§å€¼ï¼Œæ•°æ®åº“ä¸ºæ–°å€¼çš„ä¸ä¸€è‡´æƒ…å†µï¼Œä¸ºæ­¤å»¶è¿ŸåŒåˆ è¢«æå‡ºä»¥è§£å†³è¯¥é—®é¢˜ï¼Œå…¶æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>çº¿ç¨‹Aæ›´æ–°Xä¸º2ï¼Œæ—§å€¼ä¸º1ï¼›</li><li>çº¿ç¨‹Aåˆ é™¤ç¼“å­˜ï¼›</li><li>çº¿ç¨‹Bè¯»ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“è¯»åˆ°æ—§å€¼1å¹¶è®¾ç½®ç¼“å­˜ï¼›</li><li>çº¿ç¨‹Aæ ¹æ®ä¼°ç®—ä¼‘çœ ä¸€æ®µæ—¶é—´ï¼Œè¯¥æ—¶é—´å¤§äºçº¿ç¨‹Bè¯»æ•°æ®åŠ è®¾ç½®ç¼“å­˜çš„è€—æ—¶ï¼Œç»“æŸåå†æ¬¡åˆ é™¤ç¼“å­˜ï¼›</li><li>å…¶ä»–çº¿ç¨‹è¯»ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“è·å–æœ€æ–°å€¼å¹¶è®¾ç½®ç¼“å­˜ã€‚</li></ol><p>å»¶è¿ŸåŒåˆ è§£å†³äº†å¹¶å‘è¯»å†™ç¼“å­˜å¯¼è‡´çš„æ—§å€¼å›å†™é—®é¢˜ï¼Œé€šè¿‡ç¬¬2æ¬¡çš„å»¶è¿Ÿåˆ é™¤ç¡®ä¿å…¶ä»–çº¿ç¨‹å†™çš„æ—§å€¼è¢«åˆ æ‰ï¼Œå…¶ç¼ºç‚¹æ˜¯ä¼‘çœ æ—¶é—´éš¾ä»¥è¯„ä¼°ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ¶ˆæ¯é˜Ÿåˆ—">æ¶ˆæ¯é˜Ÿåˆ—<a class="hash-link" href="#æ¶ˆæ¯é˜Ÿåˆ—" title="Direct link to heading">â€‹</a></h3><p>æ— è®ºæ˜¯å…ˆæ“ä½œç¼“å­˜è¿˜æ˜¯å…ˆæ“ä½œæ•°æ®åº“ï¼Œéƒ½æœ‰å¯èƒ½æ‰§è¡Œå¤±è´¥ï¼Œæ­¤æ—¶éœ€è¦é€šè¿‡é‡è¯•æ¥ç¡®ä¿æ“ä½œæˆåŠŸã€‚ä½†æ˜¯åœ¨æœ¬åœ°çš„ç«‹å³é‡è¯•å¤§æ¦‚ç‡è¿˜æ˜¯å¤±è´¥ï¼Œå¹¶ä¸”å ç”¨çº¿ç¨‹èµ„æºï¼Œå¹¶ä¸”ç¨‹åºé‡å¯ä¼šä¸¢å¤±è¯¥é‡è¯•è¯·æ±‚ã€‚ä¸ºæ­¤ï¼Œæå‡ºå¼‚æ­¥é‡è¯•ï¼šå°†é‡è¯•è¯·æ±‚å†™å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”±ä¸“é—¨çš„æ¶ˆè´¹è€…æ¥é‡è¯•ç›´åˆ°æˆåŠŸï¼Œå®ƒåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯å¯é æ€§å’Œæ¶ˆæ¯æˆåŠŸæŠ•é€’çš„ç‰¹æ€§ã€‚</p><p>æ›´è¿›ä¸€æ­¥åœ°ï¼Œä¸ºäº†å…å»åº”ç”¨ç¨‹åºä¸æ¶ˆæ¯ä¸­é—´ä»¶äº¤äº’ï¼Œå¯ä»¥é€šè¿‡ç›‘å¬æ•°æ®åº“bin logæ—¥å¿—çš„ä¸­é—´ä»¶(å¦‚Canal)æ¥æŠ•é€’åˆ é™¤è¯·æ±‚ã€‚è¿™æ ·åº”ç”¨ç¨‹åºåªéœ€è¦å’ŒMySQLäº¤äº’ï¼Œæ— éœ€è€ƒè™‘å†™æ¶ˆæ¯é˜Ÿåˆ—å¤±è´¥è¯·æ±‚ï¼Œåªè¦MySQLæ›´æ–°è®°å½•æˆåŠŸï¼Œbin logè‚¯å®šäº§ç”Ÿç›¸åº”æ—¥å¿—ï¼Œå¹¶ç”±Canalè‡ªåŠ¨æŠ•é€’åˆ é™¤è¯·æ±‚åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>å°ç»“</h5></div><div class="admonition-content"><p>å»¶è¿ŸåŒåˆ è§£å†³çš„æ˜¯å¹¶å‘åœºæ™¯ä¸‹ç¼“å­˜å†™å›æ—§å€¼é—®é¢˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—è§£å†³çš„æ˜¯åˆ é™¤æ“ä½œå¤±è´¥é—®é¢˜ï¼Œæœ¬è´¨æ˜¯å¼‚æ­¥é‡è¯•ã€‚</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="é«˜å¯ç”¨">é«˜å¯ç”¨<a class="hash-link" href="#é«˜å¯ç”¨" title="Direct link to heading">â€‹</a></h2><p>Rediså®ç°é«˜å¯ç”¨æœ‰2ç§æ–¹æ¡ˆï¼šä¸»ä»å¤åˆ¶ã€å“¨å…µæ¨¡å¼ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä¸»ä»å¤åˆ¶">ä¸»ä»å¤åˆ¶<a class="hash-link" href="#ä¸»ä»å¤åˆ¶" title="Direct link to heading">â€‹</a></h3><p>ä¸»ä»å¤åˆ¶æŒ‡å°†Redisä¸»èŠ‚ç‚¹æ•°æ®å¤åˆ¶åˆ°ä»èŠ‚ç‚¹ï¼Œåˆåˆ†ä¸ºå…¨é‡å¤åˆ¶å’Œéƒ¨åˆ†å¤åˆ¶2ç§ã€‚Redisçš„å…¨é‡å¤åˆ¶åˆåˆ†æ–°æ—§ç‰ˆæœ¬ï¼Œåœ¨æ—§ç‰ˆæœ¬ä¸­å…¨é‡å¤åˆ¶é€šè¿‡syncå‘½ä»¤å®ç°ï¼Œå…¶æµç¨‹ä¸ºï¼š</p><ol><li>ä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€syncå‘½ä»¤(ä»èŠ‚ç‚¹æ‹‰)ï¼›</li><li>ä¸»æœåŠ¡å™¨æ”¶åˆ°syncå‘½ä»¤åï¼Œè°ƒç”¨bgsaveå‘½ä»¤ç”Ÿæˆrdbæ–‡ä»¶ï¼Œå°†å…¶å‘é€ç»™ä»æœåŠ¡å™¨ï¼›</li><li>ä¸»æœåŠ¡å™¨å°†å‘½ä»¤ç¼“å†²åŒºä¸­çš„å†™æ“ä½œå‘é€åˆ°ä»æœåŠ¡å™¨ï¼Œåè€…æ‰§è¡Œè¿™äº›å‘½ä»¤åï¼ŒçŠ¶æ€å’Œä¸»æœåŠ¡å™¨å½“å‰çŠ¶æ€ä¿æŒä¸€è‡´ã€‚</li></ol><p>æ–°ç‰ˆæœ¬ä¸­Redisä½¿ç”¨psyncä»£æ›¿syncï¼Œè¯¥å‘½ä»¤æ—¢å¯ä»¥å®ç°å…¨é‡å¤åˆ¶ä¹Ÿå¯å®ç°éƒ¨åˆ†å¤åˆ¶ã€‚ç›¸å…³æ¦‚å¿µï¼š</p><ul><li><strong>å¤åˆ¶åç§»é‡</strong>ï¼šä¸»ã€ä»æœåŠ¡å™¨éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªå¤åˆ¶åç§»é‡ï¼Œå½“å…¶åŒæ­¥äº†Nå­—èŠ‚æ•°æ®åä¾¿å°†å¤åˆ¶åç§»é‡åŠ Nï¼›</li><li><strong>å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</strong>ï¼šä¸»æœåŠ¡å™¨ç»´æŠ¤çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œé»˜è®¤å¤§å°1MBï¼Œä¸»æœåŠ¡å™¨å‘é€å†™å‘½ä»¤ç»™ä»æœåŠ¡å™¨æ—¶ï¼Œä¹Ÿå°†å‘½ä»¤å†™å…¥åˆ°è¯¥ç¼“å†²åŒºï¼›</li><li><strong>æœåŠ¡å™¨è¿è¡Œid</strong>ï¼šæ¯ä¸ªRedisæœåŠ¡å™¨å¯åŠ¨æ—¶ç”Ÿæˆçš„idï¼Œä¸»æœåŠ¡å™¨å°†å…¶è¿è¡Œidå‘é€ç»™ä»æœåŠ¡å™¨ã€‚</li></ul><p>åŸºäºå¦‚ä¸Šæ¦‚å¿µï¼Œpsyncå‘½ä»¤æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img loading="lazy" alt="JMM.svg" src="/assets/images/psync-bfae7abec25e95ed35bdb7a48b750b0f.svg" width="421" height="291" class="img_E7b_"></p><p>ä»æœåŠ¡å™¨å‘é€psyncå‘½ä»¤åï¼Œä¸»æœåŠ¡å“åº”æœ‰å¦‚ä¸‹3ç§æƒ…å†µï¼š</p><ol><li>è¿”å›<code>+fullresync &lt;runid&gt; &lt;offset&gt;</code>ï¼Œè¡¨ç¤ºå…¨é‡å¤åˆ¶ï¼›</li><li>è¿”å›<code>+continue</code>ï¼Œè¡¨ç¤ºéƒ¨åˆ†å¤åˆ¶ï¼›</li><li>è¿”å›<code>-err</code>ï¼Œè¡¨ç¤ºä¸»æœåŠ¡å™¨Redisç‰ˆæœ¬ä½äº2.8ï¼Œæ— æ³•è¯†åˆ«psyncå‘½ä»¤ï¼Œæ­¤æ—¶ä»æœåŠ¡å™¨å‘é€syncå‘½ä»¤æ‰§è¡Œå…¨é‡å¤åˆ¶ã€‚</li></ol><p>ğŸ˜ ä¸»ä»å¤åˆ¶çš„ç¼ºç‚¹ï¼š</p><ol><li>ä¸»èŠ‚ç‚¹å®•æœºåï¼Œä»èŠ‚ç‚¹çœå‡çº§ä¸ºä¸»èŠ‚ç‚¹ï¼Œæ­¤æ—¶éœ€è¦<strong>æ‰‹åŠ¨</strong>ä¿®æ”¹å®¢æˆ·ç«¯åº”ç”¨çš„ä¸»èŠ‚ç‚¹åœ°å€ä»¥åŠæ‰§è¡Œå‘½ä»¤è®©æ‰€æœ‰ä»èŠ‚ç‚¹å¤åˆ¶æ•°æ®ï¼›</li><li>ä¸»èŠ‚ç‚¹å­˜å‚¨ã€å†™æ€§èƒ½å—å•æœºé™åˆ¶ï¼Œæ²¡æœ‰ç”¨åˆ°å¤šæœºæ‰©å±•æ€§èƒ½ï¼›</li><li>å…¨é‡åŒæ­¥ä¼šé€ æˆæ¯«ç§’çº§å¡é¡¿ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="å“¨å…µæ¨¡å¼">å“¨å…µæ¨¡å¼<a class="hash-link" href="#å“¨å…µæ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p>å“¨å…µæ˜¯RedisæœåŠ¡çš„ä¸€ç§è¿è¡Œæ¨¡å¼ï¼ŒRediså“¨å…µèŠ‚ç‚¹çš„åŠŸèƒ½æœ‰ï¼š</p><ol><li>ç›‘æ§ï¼šæŒç»­ç›‘æ§masterã€slaveèŠ‚ç‚¹æ˜¯å¦å¤„äºé¢„æœŸå·¥ä½œçŠ¶æ€ï¼›</li><li>åˆ‡æ¢ä¸»èŠ‚ç‚¹ï¼šå½“masterè¿è¡Œæ•…éšœï¼Œå“¨å…µæ¨¡å¼è‡ªåŠ¨ä»slaveä¸­é€‰æ‹©ä¸€å°ä½œä¸ºæ–°masterï¼›</li><li>é€šçŸ¥ï¼šè®©slaveæ‰§è¡Œreplicaofå‘½ä»¤ä¸æ–°masteråŒæ­¥ï¼Œé€šçŸ¥å®¢æˆ·ç«¯ä¸æ–°masterè¿æ¥ã€‚</li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="ä¸»è§‚ä¸‹çº¿ä¸å®¢è§‚ä¸‹çº¿">ä¸»è§‚ä¸‹çº¿ä¸å®¢è§‚ä¸‹çº¿<a class="hash-link" href="#ä¸»è§‚ä¸‹çº¿ä¸å®¢è§‚ä¸‹çº¿" title="Direct link to heading">â€‹</a></h4><p>å“¨å…µèŠ‚ç‚¹å‘å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹å‘é€PINGå‘½ä»¤ï¼Œå¦‚æœslaveèŠ‚ç‚¹æ²¡æœ‰è¿”å›æœ‰æ•ˆå›å¤åˆ™ä»»åŠ¡æ ‡è®°è¯¥èŠ‚ç‚¹ä¸º<strong>ä¸»è§‚ä¸‹çº¿</strong>(å“¨å…µè‡ªå·±è®¤ä¸ºè¯¥èŠ‚ç‚¹å¼‚å¸¸)ã€‚PINGå‘½ä»¤å›å¤æœ‰ä¸¤ç§æƒ…å†µï¼š</p><ol><li>æœ‰æ•ˆå›å¤ï¼š+PONGã€-LOADINGæˆ–-MASTERDOWNä»»æ„ä¸€ç§ï¼›</li><li>æ— æ•ˆå›å¤ï¼šæœ‰æ•ˆå›å¤å¤–çš„å›å¤ï¼Œæˆ–è€…æœªåœ¨æŒ‡å®šæ—¶é—´å†…è¿”å›ä»»åŠ¡å›å¤ã€‚</li></ol><p>å¯¹äºmasterèŠ‚ç‚¹ï¼Œä¸èƒ½ä»…é ä¸€ä¸ªå“¨å…µå°±åˆ¤æ–­å…¶æ˜¯å¦æ•…éšœï¼Œåªæœ‰å½“è¶…è¿‡åŠæ•°çš„å“¨å…µåˆ¤æ–­masterä¸»è§‚ä¸‹çº¿æ—¶ï¼Œæ‰æ ‡è®°å…¶ä¸º<strong>å®¢è§‚ä¸‹çº¿</strong>(å®¢è§‚äº‹å®ï¼ŒçœŸçš„ä¸è¡Œäº†)ï¼Œæ­¤åè§¦å‘ä¸»ä»åˆ‡æ¢æµç¨‹ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="æ–°masteré€‰ä¸¾">æ–°masteré€‰ä¸¾<a class="hash-link" href="#æ–°masteré€‰ä¸¾" title="Direct link to heading">â€‹</a></h4><p>å½“masterè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿åï¼Œéœ€è¦ä»slaveä¸­é€‰ä¸¾å‡ºæ–°masterï¼Œè¯¥æµç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼šå…ˆè¿‡æ»¤å†è¯„æ¯”ã€‚</p><ol><li>è¿‡æ»¤ï¼šç­›é€‰æ‰ä¸‹çº¿çš„slaveèŠ‚ç‚¹ï¼Œæˆ–è€…æ ¹æ®slaveèŠ‚ç‚¹å’ŒmasterèŠ‚ç‚¹æ–­å¼€æ¬¡æ•°æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼›</li><li>è¯„æ¯”ï¼šæŒ‰ç…§å¦‚ä¸‹ä¼˜å…ˆé¡ºåºä¾æ¬¡æ¯”è¾ƒé€‰æ‹©ä¼˜å…ˆslave<ol><li>slaveä¼˜å…ˆçº§ï¼Œé€šè¿‡<code>slave-priority</code>å‚æ•°é…ç½®ï¼Œä¼˜å…ˆçº§é«˜é€‰ä¸ºæ–°masterï¼›</li><li>å¤åˆ¶è¿›åº¦ï¼Œé€šè¿‡æ¯”è¾ƒ<code>slave_repl_offset</code>å’Œ<code>master_repl_offset</code>çš„å·®è·é€‰æ‹©æ–°masterï¼›</li><li>slave runIDï¼Œidæœ€å°çš„é€‰ä¸ºæ–°master</li></ol></li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="é€šçŸ¥">é€šçŸ¥<a class="hash-link" href="#é€šçŸ¥" title="Direct link to heading">â€‹</a></h4><p>å“¨å…µå°†æ–°masterè¿æ¥ä¿¡æ¯å‘é€ç»™å…¶ä»–slaveèŠ‚ç‚¹ï¼Œè®©å…¶æ‰§è¡Œ<code>replaceof</code>å‘½ä»¤å’Œæ–°masterå»ºç«‹è¿æ¥å¹¶å¼€å§‹å¤åˆ¶æ•°æ®ï¼ŒåŒæ—¶è¦å°†æ–°masterè¿æ¥ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="å“¨å…µé›†ç¾¤">å“¨å…µé›†ç¾¤<a class="hash-link" href="#å“¨å…µé›†ç¾¤" title="Direct link to heading">â€‹</a></h4><p>åœ¨äº†è§£å®Œä¸»ä»åˆ‡æ¢çš„æµç¨‹åï¼Œæ¥æ¥ä¸‹éœ€è¦è§£ç­”çš„é—®é¢˜æœ‰ï¼š</p><ul><li>å“¨å…µå¦‚ä½•å‘ç°å½¼æ­¤ï¼Ÿ
å“¨å…µä¸masterå»ºç«‹è¿æ¥åé€šè¿‡masterçš„å‘å¸ƒ/è®¢é˜…æœºåˆ¶å‘å¸ƒè‡ªå·±ä¿¡æ¯ï¼Œå½¼æ­¤ä¹‹é—´äº’ç›¸å‘ç°å»ºç«‹è¿æ¥ã€‚</li><li>å“¨å…µå¦‚ä½•å‘ç°å¹¶ç›‘æ§slaveï¼Ÿ
å“¨å…µå‘masterå‘é€<code>INFO</code>å‘½ä»¤ï¼Œç”±masterè¿”å›æ‰€æœ‰slaveèŠ‚ç‚¹ä¿¡æ¯ã€‚</li><li>å“ªä¸ªå“¨å…µæ¥æ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Ÿ
ä»»ä½•ä¸€ä¸ªå“¨å…µåˆ¤æ–­masterä¸»è§‚ä¸‹çº¿åï¼Œå‘å…¶ä»–å“¨å…µå‘é€<code>is-master-down-by-addr</code>å‘½ä»¤ï¼Œå…¶ä»–å“¨å…µå“åº”æŠ•ç¥¨ï¼Œå¦‚æœè¶…è¿‡ä¸€åŠå“¨å…µè¿”å›Yï¼Œåˆ™å¯ä»¥æ ‡è®°masterå®¢è§‚ä¸‹çº¿ã€‚æˆ–è€…å¤šæ•°èµæˆç¥¨çš„å“¨å…µå¯ä»¥å‘å…¶ä»–å“¨å…µå£°æ˜æƒ³æ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Œå¹¶è®©å…¶ä»–å“¨å…µæŠ•ç¥¨ï¼Œè¯¥è¿‡ç¨‹ç§°ä¸ºLeaderé€‰ä¸¾ã€‚æˆä¸ºleaderçš„æ¡ä»¶æ˜¯ï¼šæˆ–è€…è¿‡åŠèµæˆç¥¨å¹¶ä¸”èµæˆç¥¨æ•°å¿…é¡»å¤§äºç­‰äºå“¨å…µé…ç½®ä¸­quorumå€¼ã€‚</li></ul><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>å“¨å…µé…ç½®</h5></div><div class="admonition-content"><p>é€šè¿‡<code>sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</code>é…ç½®è¯¥å“¨å…µèŠ‚ç‚¹è¿æ¥çš„masterèŠ‚ç‚¹ä¿¡æ¯å’Œquorumå€¼ã€‚</p></div></div><ul><li>å¦‚ä½•é€šçŸ¥å®¢æˆ·ç«¯ï¼Ÿ
è¿˜æ˜¯é€šè¿‡è®¢é˜…å‘å¸ƒæœºåˆ¶ã€‚</li></ul>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Redis" term="Redis"/>
        <category label="Summary" term="Summary"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hive 3.xå­¦ä¹ ç¬”è®°(6)]]></title>
        <id>/2022/02/27/Learning-Hive3.x-06</id>
        <link href="https://kayhaw.github.io/blog/2022/02/27/Learning-Hive3.x-06"/>
        <updated>2022-02-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Hive 3.1.2å­¦ä¹ ç¬”è®°(6)ï¼šHiveè°ƒä¼˜]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“Hive 3.1.2å­¦ä¹ ç¬”è®°ç¬¬6ç¯‡ï¼šHiveè°ƒä¼˜ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="explainå‘½ä»¤">EXPLAINå‘½ä»¤<a class="hash-link" href="#explainå‘½ä»¤" title="Direct link to heading">â€‹</a></h2><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Explain" target="_blank" rel="noopener noreferrer"><code>EXPALIN</code></a>ç”¨äºå±•ç¤ºæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œä½¿ç”¨è¯­æ³•å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">EXTENDED</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">CBO</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">AST</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">DEPENDENCY</span><span class="token operator" style="color:#393A34">|</span><span class="token keyword" style="color:#00009f">AUTHORIZATION</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">LOCKS</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">VECTORIZATION</span><span class="token operator" style="color:#393A34">|</span><span class="token keyword" style="color:#00009f">ANALYZE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> query</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="è¾“å‡ºç»“æ„">è¾“å‡ºç»“æ„<a class="hash-link" href="#è¾“å‡ºç»“æ„" title="Direct link to heading">â€‹</a></h3><p>EXPLAINçš„è¾“å‡ºåŒ…å«å¦‚ä¸‹2ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>ä¾èµ–å›¾æè¿°ã€‚å¦‚ä¸‹æ‰€ç¤ºStage-1æ˜¯æ ¹æ­¥éª¤ï¼ŒStage-2åœ¨Stage-1ä¹‹åæ‰§è¡Œï¼Œè€ŒStage-0åˆåœ¨Stage-2ä¹‹åæ‰§è¡Œï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">STAGE DEPENDENCIES:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Stage-1 is a root stage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Stage-2 depends on stages: Stage-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Stage-0 depends on stages: Stage-2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="2"><li>æ¯ä¸ªé˜¶æ®µè®¡åˆ’ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">STAGE PLANS:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Stage: Stage-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Map Reduce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Alias -&gt; Map Operator Tree:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Reduce Output Operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              key expressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    expr: key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    type: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sort order: +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Map-reduce partition columns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    expr: rand()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    type: double</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              tag: -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              value expressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    expr: substr(value, 4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    type: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Reduce Operator Tree:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Group By Operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          aggregations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                expr: sum(UDFToDouble(VALUE.0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          keys:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                expr: KEY.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                type: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          mode: partial1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          File Output Operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            compressed: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            table:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                input format: org.apache.hadoop.mapred.SequenceFileInputFormat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                output format: org.apache.hadoop.mapred.SequenceFileOutputFormat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: binary_table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Stage: Stage-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Map Reduce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Alias -&gt; Map Operator Tree:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /tmp/hive-zshao/67494501/106593589.10001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Reduce Output Operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            key expressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  expr: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  type: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sort order: +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map-reduce partition columns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  expr: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  type: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tag: -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            value expressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  expr: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  type: double</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Reduce Operator Tree:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Group By Operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          aggregations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                expr: sum(VALUE.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          keys:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                expr: KEY.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                type: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          mode: final</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Select Operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            expressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  expr: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  type: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  expr: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  type: double</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Select Operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              expressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    expr: UDFToInteger(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    type: int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    expr: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    type: double</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              File Output Operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                compressed: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                table:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    input format: org.apache.hadoop.mapred.TextInputFormat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    name: dest_g1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Stage: Stage-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Move Operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tables:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            replace: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            table:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                input format: org.apache.hadoop.mapred.TextInputFormat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: dest_g1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä¸Šè¿°ä¾‹å­ä¸­åŒ…å«2ä¸ªmap/reduceé˜¶æ®µ(Stage-1å’ŒStage-2)ï¼Œä»¥åŠä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿç›¸å…³é˜¶æ®µ(Stage-0)ã€‚Stage-0æœ¬è´¨ä¸Šå°±æ˜¯æŠŠä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸­çš„ç»“æœç§»åŠ¨åˆ°è¡¨dest_g1å¯¹åº”çš„ç›®å½•ã€‚sort orderé¡¹è¡¨ç¤ºç”¨äºæ’åºçš„åˆ—ï¼Œ<code>+</code>è¡¨ç¤ºå‡åºè€Œ<code>-</code>è¡¨ç¤ºé™åºã€‚</p><p>æ¯ä¸ªmap/reduceé˜¶æ®µåˆåŒ…å«2éƒ¨åˆ†ï¼š</p><ol><li>ä»è¡¨åˆ«ååˆ°Map Operator Treeçš„æ˜ å°„ï¼šå‘Šè¯‰mapperç”¨äºå¤„ç†ç‰¹å®šè¡¨è¡Œè®°å½•(æˆ–å‰ä¸€ä¸ªstageè¾“å‡º)çš„operator treeã€‚</li><li>Reduce Operator Treeï¼šå¤„ç†map/reduceä½œä¸šçš„operator treeã€‚ä¾‹å­ä¸­Stage-1çš„Reducer Operator Treeæ‰§è¡Œéƒ¨åˆ†èšåˆï¼Œè€ŒStage-2çš„Reducer Operatoræ ¹æ®Stage-1ç»“æœè®¡ç®—æœ€ç»ˆèšåˆç»“æœã€‚</li></ol><p>æ³¨æ„å½“HiveæŸ¥è¯¢æ²¡æœ‰æ‰§è¡ŒMRç¨‹åºæ—¶ï¼Œä½¿ç”¨<a href="#Fetch">Fetch Operator</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cboä»å¥">CBOä»å¥<a class="hash-link" href="#cboä»å¥" title="Direct link to heading">â€‹</a></h3><p>CBOä»å¥è¾“å‡ºCalciteä¼˜åŒ–å™¨äº§ç”Ÿçš„æ‰§è¡Œè®¡åˆ’ï¼Œä½¿ç”¨è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">FORMATTED</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> CBO </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">COST</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">JOINCOST</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ul><li>COSTé€‰é¡¹(é»˜è®¤)è¡¨ç¤ºè¾“å‡ºä½¿ç”¨Calciteé»˜è®¤æ¶ˆè€—æ¨¡å‹çš„ç»“æœï¼›</li><li>JOINCOSTé€‰é¡¹è¡¨ç¤ºè¾“å‡ºä½¿ç”¨join reorderingæ¶ˆè€—æ¨¡å‹çš„ç»“æœã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="astä»å¥">ASTä»å¥<a class="hash-link" href="#astä»å¥" title="Direct link to heading">â€‹</a></h3><p>è¾“å‡ºæŸ¥è¯¢SQLçš„æŠ½è±¡è¯­æ³•æ ‘(Abstract Syntax Tree)ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="dependencyä»å¥">DEPENDENCYä»å¥<a class="hash-link" href="#dependencyä»å¥" title="Direct link to heading">â€‹</a></h3><p>è¾“å‡ºæ‰§è¡Œè®¡åˆ’è¾“å…¥éƒ¨åˆ†çš„é¢å¤–ä¿¡æ¯ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="authorizationä»å¥">AUTHORIZATIONä»å¥<a class="hash-link" href="#authorizationä»å¥" title="Direct link to heading">â€‹</a></h3><p>è¾“å‡ºæ‰§è¡ŒæŸ¥è¯¢è¯­å¥éœ€è¦æˆæƒçš„æ¡ç›®ä»¥åŠå¤±è´¥çš„æˆæƒï¼ŒåŠ ä¸ŠFORMATTEDåˆ™è¿”å›JSONæ ¼å¼çš„è¾“å‡ºã€‚</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># æ‰§è¡Œè¯­å¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTHORIZATION</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> src </span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> srcpart</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># è¾“å‡ºç»“æœ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INPUTS:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">default</span><span class="token variable" style="color:#36acaa">@srcpart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">default</span><span class="token variable" style="color:#36acaa">@src</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">default</span><span class="token variable" style="color:#36acaa">@srcpart</span><span class="token variable" style="color:#36acaa">@ds</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2008</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">04</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">08</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">hr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">default</span><span class="token variable" style="color:#36acaa">@srcpart</span><span class="token variable" style="color:#36acaa">@ds</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2008</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">04</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">08</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">hr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">default</span><span class="token variable" style="color:#36acaa">@srcpart</span><span class="token variable" style="color:#36acaa">@ds</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2008</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">04</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">09</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">hr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">default</span><span class="token variable" style="color:#36acaa">@srcpart</span><span class="token variable" style="color:#36acaa">@ds</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2008</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">04</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">09</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">hr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OUTPUTS:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hdfs:</span><span class="token comment" style="color:#999988;font-style:italic">//localhost:9000/tmp/.../-mr-10000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CURRENT_USER</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  navis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OPERATION:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  QUERY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AUTHORIZATION_FAILURES:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Permission denied: Principal </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">navis</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">USER</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> does </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> have </span><span class="token keyword" style="color:#00009f">following</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">privileges</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> operation QUERY </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> Object </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">TABLE_OR_VIEW</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">src</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> Object </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">TABLE_OR_VIEW</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">srcpart</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="locksä»å¥">LOCKSä»å¥<a class="hash-link" href="#locksä»å¥" title="Direct link to heading">â€‹</a></h3><p>è¾“å‡ºæ‰§è¡ŒæŸ¥è¯¢è¯­å¥éœ€è¦è·å–çš„é”ä¿¡æ¯ï¼ŒåŠ ä¸ŠFORMATTEDåˆ™ä»¥JSONæ ¼å¼è¾“å‡ºã€‚</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># æ‰§è¡Œè¯­å¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> LOCKS </span><span class="token keyword" style="color:#00009f">UPDATE</span><span class="token plain"> target </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> p </span><span class="token operator" style="color:#393A34">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">q1 </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> source t </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">a1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># è¾“å‡ºç»“æœ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">LOCK</span><span class="token plain"> INFORMATION:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">source </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> SHARED_READ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">p</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">q</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> SHARED_READ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">p</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">q</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> SHARED_READ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">p</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">q</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> SHARED_READ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">p</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">q</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> SHARED_WRITE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">p</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">q</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> SHARED_WRITE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">p</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">q</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> SHARED_WRITE</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="vectorizationä»å¥">VECTORIZATIONä»å¥<a class="hash-link" href="#vectorizationä»å¥" title="Direct link to heading">â€‹</a></h3><p>è¾“å‡ºMapå’ŒReduceä½œä¸šæ²¡æœ‰å‘é‡åŒ–çš„åŸå› ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="analyzeä»å¥">ANALYZEä»å¥<a class="hash-link" href="#analyzeä»å¥" title="Direct link to heading">â€‹</a></h3><p>è¾“å‡ºè®¡åˆ’çœŸæ­£æ‰§è¡Œçš„è¡Œæ•°ï¼Œæ ¼å¼ä¸º<code>(é¢„è®¡è¡Œæ•°)/(å®é™…è¡Œæ•°)</code>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="fetch">Fetch<a class="hash-link" href="#fetch" title="Direct link to heading">â€‹</a></h2><p>å¯¹äºæŸäº›ç‰¹å®šæŸ¥è¯¢ï¼ŒHiveå¯ä»¥ä¸ä½¿ç”¨map/reduceä»»åŠ¡è®¡ç®—è€Œæ˜¯ä½¿ç”¨fetchä»»åŠ¡ã€‚æ¯”å¦‚<code>select * from employees</code>ï¼ŒHiveå¯ä»¥è¯»å–employeeså¯¹åº”å­˜å‚¨ç›®å½•ä¸‹æ–‡ä»¶ï¼Œè§£æå¹¶è¾“å‡ºè®°å½•ã€‚è¯¥è¡Œä¸ºé€šè¿‡hive-default.xmlä¸­çš„é…ç½®é¡¹<code>hive.fetch.task.conversion</code>è®¾ç½®ï¼ŒHiveæä¾›3ä¸ªè®¾ç½®å€¼ï¼š</p><ul><li>noneï¼šç¦ç”¨fetchï¼Œå³æ‰€æœ‰æŸ¥è¯¢éƒ½èµ°MRä»»åŠ¡ï¼›</li><li>minimalï¼šåªæœ‰select *ï¼Œåœ¨åˆ†åŒºå­—æ®µä¸Šè¿‡æ»¤ï¼Œlimité™åˆ¶æ‰ä½¿ç”¨fetchï¼›</li><li>moreï¼šselectï¼Œè¿‡æ»¤ï¼Œlimitæ—¶ä½¿ç”¨fetchä»»åŠ¡ï¼ŒåŒ…å«tablesampleå’Œè™šæ‹Ÿå­—æ®µï¼Œ<strong>é»˜è®¤</strong>ã€‚</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="æœ¬åœ°æ¨¡å¼">æœ¬åœ°æ¨¡å¼<a class="hash-link" href="#æœ¬åœ°æ¨¡å¼" title="Direct link to heading">â€‹</a></h2><p>å½“å¤„ç†æ•°æ®é‡è¾ƒå°æ—¶ï¼Œæ²¡æœ‰å¿…è¦ä½¿ç”¨åˆ†å¸ƒå¼MRä»»åŠ¡è®¡ç®—ï¼ŒHiveæä¾›æœ¬åœ°æ¨¡å¼åœ¨å•å°æœºå™¨ä¸Šå¤„ç†ä»»åŠ¡ï¼Œç¼©çŸ­æ‰§è¡Œæ—¶é—´ï¼Œè®¾ç½®å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 1. å¼€å¯æœ¬åœ°æ¨¡å¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> hive.exec.mode.local.auto</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. è®¾ç½®æœ¬åœ°æ¨¡å¼æœ€å¤§è¾“å…¥æ•°æ®é‡ï¼Œè¶…è¿‡åˆ™ä½¿ç”¨åˆ†å¸ƒå¼MRä»»åŠ¡ï¼Œé»˜è®¤128MB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> hive.exec.mode.local.auto.inputbytes.max</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">50000000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. è®¾ç½®æœ¬åœ°æ¨¡å¼æœ€å¤šè¾“å…¥æ–‡ä»¶æ•°ï¼Œè¶…è¿‡åˆ™ä½¿ç”¨åˆ†å¸ƒå¼MRä»»åŠ¡ï¼Œæ¨¡å¼4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> hive.exec.mode.local.auto.input.files.max</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="è¡¨ä¼˜åŒ–">è¡¨ä¼˜åŒ–<a class="hash-link" href="#è¡¨ä¼˜åŒ–" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="map-join">Map Join<a class="hash-link" href="#map-join" title="Direct link to heading">â€‹</a></h3><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+JoinOptimization" target="_blank" rel="noopener noreferrer">Map Join</a>æŒ‡å½“å…³è”æŸ¥è¯¢çš„ä¸¤ä¸ªè¡¨å¤§å°ç›¸å·®è¿‡å¤§æ—¶ï¼Œå¯ä»¥å°†å°è¡¨è½¬ä¸ºHashMapæ”¾åœ¨å†…å­˜ï¼Œåœ¨mapperå®Œæˆjoinã€‚ç›¸å…³è®¾ç½®å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># è®¾ç½®å¼€å¯map joinï¼Œé»˜è®¤ä¸ºtrue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> hive.auto.convert.join </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># è®¾ç½®åŒºåˆ†å¤§å°è¡¨çš„é˜ˆå€¼ï¼Œé»˜è®¤25MB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> hive.mapjoin.smalltable.filesize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">25000000</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol><li>æœ¬åœ°ä»»åŠ¡ï¼š<ol><li>åœ¨æœ¬åœ°ä¸Šæ‰§è¡Œæ ‡å‡†çš„è¡¨æ‰«æè·å–å°è¡¨æ•°æ®ï¼›</li><li>åœ¨å†…å­˜ä¸­æ„å»ºHashTableï¼›</li><li>å°†HashTableå†™åˆ°æœ¬åœ°ç£ç›˜ï¼›</li><li>å°†HashTableä¸Šä¼ åˆ°HDFSï¼›</li><li>å°†HashTableæ·»åŠ åˆ°åˆ†å¸ƒå¼ç¼“å­˜ï¼›</li></ol></li><li>Mapä»»åŠ¡ï¼š<ol><li>ä»æœ¬åœ°(åˆ†å¸ƒå¼ç¼“å­˜)è¯»å–HashTableåŠ è½½åˆ°å†…å­˜ï¼›</li><li>æ ¹æ®HashTableåŒ¹é…è®°å½•ï¼›</li><li>åˆå¹¶åŒ¹é…è®°å½•å¹¶è¾“å‡ºï¼›</li></ol></li><li><strong>æ²¡æœ‰Reduceä»»åŠ¡</strong>ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="joinä¼˜åŒ–">Joinä¼˜åŒ–<a class="hash-link" href="#joinä¼˜åŒ–" title="Direct link to heading">â€‹</a></h3><ol><li>ç©ºkeyè¿‡æ»¤</li><li>ç©ºkeyè½¬æ¢</li><li>SMB(Sort Merge Bucket)ï¼šä¸¤ä¸ªå¤§çš„åˆ†æ¡¶è¡¨å…³è”æŸ¥è¯¢ï¼Œéœ€è¦è®¾ç½®å¦‚ä¸‹å‚æ•°</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">set</span><span class="token plain"> hive.optimize.bucketmapjoin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> hive.optimize.bucketmapjoin.sortedmerge </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> hive.input.format</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">org.apache.hadoop.hive.ql.io.BucketizedHiveInputFormat</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="group-byä¼˜åŒ–">Group Byä¼˜åŒ–<a class="hash-link" href="#group-byä¼˜åŒ–" title="Direct link to heading">â€‹</a></h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMapé˜¶æ®µç›¸åŒkeyçš„æ•°æ®å‘é€ç»™åŒä¸€ä¸ªreducerå¤„ç†ï¼Œå½“æŸä¸ªkeyçš„æ•°æ®è¿œè¶…è¿‡å…¶ä»–keyçš„å°±ä¼šå‘ç”Ÿæ•°æ®å€¾æ–œï¼Œæ­¤æ—¶å¯ä»¥å¼€å¯mapç«¯è¿›è¡Œéƒ¨åˆ†èšåˆã€‚</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 1. æ˜¯å¦åœ¨mapperè¿›è¡Œèšåˆï¼Œé»˜è®¤true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> hive.map.aggr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. åœ¨mapperè¿›è¡Œèšåˆçš„æ¡æ•°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> hive.groupby.mapaggr.checkinterval </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. æœ‰æ•°æ®å€¾æ–œæ—¶è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œé»˜è®¤false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> hive.groupby.skewindata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è®¾ç½®skewindataä¸ºtrueåï¼Œç”Ÿæˆçš„æŸ¥è¯¢è®¡åˆ’ä¼šæœ‰ä¸¤ä¸ªMRä»»åŠ¡ï¼šç¬¬ä¸€ä¸ªMRä»»åŠ¡çš„mapperéšæœºè¾“å‡ºåˆ°reducerï¼Œæ¯ä¸ªreduceråšéƒ¨åˆ†èšåˆæ“ä½œï¼Œä½¿å¾—ç›¸åŒkeyåˆ†å¸ƒåˆ°ä¸åˆ°reducerä¸­ï¼›ç¬¬äºŒä¸ªMRä»»åŠ¡å†æŠŠé¢„å¤„ç†ç»“æœæŒ‰ç…§keyåˆ†å‘åˆ°reducerä¸­ï¼Œå®Œæˆæœ€ç»ˆçš„èšåˆæ“ä½œã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å…¶ä»–">å…¶ä»–<a class="hash-link" href="#å…¶ä»–" title="Direct link to heading">â€‹</a></h3><ul><li>COUNT(DISTINCT)ä¼˜åŒ–ï¼šå½“ä½¿ç”¨count distinctæ—¶å¯èƒ½å‡ºç°æŸä¸ªreduceræ•°æ®é‡è¿‡å¤§æƒ…å†µï¼Œæ­¤æ—¶ä½¿ç”¨å…ˆGROUP BYå†COUNTçš„æ–¹å¼ä¼˜åŒ–ï¼›</li><li>ç¬›å¡å°”ç§¯ï¼šå°½é‡é¿å…ï¼ŒJOINæ—¶æ·»åŠ æœ‰æ•ˆçš„ONæ¡ä»¶</li><li>è¡Œåˆ—è¿‡æ»¤ï¼šå°½é‡ä½¿ç”¨åˆ†åŒºå­—æ®µè¿‡æ»¤ï¼Œå…³è”æŸ¥è¯¢æ—¶å‰¯è¡¨çš„è¿‡æ»¤æå‰</li></ul><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> bigtable b </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> bigtable o </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> bigtable b </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> id </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> bigtable </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> o </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="ä¸¥æ ¼æ¨¡å¼">ä¸¥æ ¼æ¨¡å¼<a class="hash-link" href="#ä¸¥æ ¼æ¨¡å¼" title="Direct link to heading">â€‹</a></h2><p>é€šè¿‡è®¾ç½®å¦‚ä¸‹ä¸¥æ ¼æ¨¡å¼å‚æ•°ï¼Œé˜²æ­¢ç”¨æˆ·è¿›è¡Œå±é™©æ“ä½œï¼š</p><ol><li><code>hive.strict.checks.no.partition.filter</code>ï¼šè®¾ç½®ä¸ºtrueè¦æ±‚æŸ¥è¯¢åˆ†åŒºè¡¨æ—¶éœ€è¦å¸¦ä¸Šåˆ†åŒºè¿‡æ»¤ï¼›</li><li><code>hive.strict.checks.orderby.no.limit</code>ï¼šè®¾ç½®ä¸ºtrueè¦æ±‚ä½¿ç”¨order byçš„æŸ¥è¯¢è¯­å¥å¿…é¡»ä½¿ç”¨limité™åˆ¶æ•°æ®é‡ï¼›</li><li><code>hive.strict.checks.cartesian.product</code>ï¼šè®¾ç½®ä¸ºtrueè¦æ±‚æŸ¥è¯¢ä¸ä¼šäº§ç”Ÿç¬›å¡å°”ç§¯ã€‚</li></ol>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Hive" term="Hive"/>
        <category label="BigData" term="BigData"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hive 3.xå­¦ä¹ ç¬”è®°(5)]]></title>
        <id>/2022/02/25/Learning-Hive3.x-05</id>
        <link href="https://kayhaw.github.io/blog/2022/02/25/Learning-Hive3.x-05"/>
        <updated>2022-02-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Hive 3.1.2å­¦ä¹ ç¬”è®°(5)ï¼šæ–‡ä»¶å‹ç¼©å’Œå­˜å‚¨]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“Hive 3.1.2å­¦ä¹ ç¬”è®°ç¬¬5ç¯‡ï¼šæ–‡ä»¶å‹ç¼©å’Œå­˜å‚¨ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ–‡ä»¶å‹ç¼©">æ–‡ä»¶å‹ç¼©<a class="hash-link" href="#æ–‡ä»¶å‹ç¼©" title="Direct link to heading">â€‹</a></h2><p>Hadoopæ”¯æŒçš„å‹ç¼©ç®—æ³•å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th>å‹ç¼©æ ¼å¼</th><th>ç®—æ³•</th><th>æ‰©å±•å</th><th>æ˜¯å¦å¯åˆ‡åˆ†</th><th>è§£/ç¼–ç å™¨</th><th>Hadoopæ˜¯å¦è‡ªå¸¦</th></tr></thead><tbody><tr><td>deflate</td><td>DEFLATE</td><td>.deflate</td><td>å¦</td><td>org.apache.hadoop.io.compress.DefaultCodec</td><td>æ˜¯</td></tr><tr><td>Gzip</td><td>DEFLATE</td><td>.gz</td><td>å¦</td><td>org.apache.hadoop.io.compress.GzipCodec</td><td>æ˜¯</td></tr><tr><td>bzip2</td><td>bzip2</td><td>.bz2</td><td>æ˜¯</td><td>org.apache.hadoop.io.compress.BZip2Codec</td><td>æ˜¯</td></tr><tr><td>LZO</td><td>LZO</td><td>.lzo</td><td>æ˜¯(éœ€è¦å»ºç´¢å¼•)</td><td>com.hadoop.compression.lzo.LzopCodec</td><td>å¦</td></tr><tr><td>Snappy</td><td>Snappy</td><td>.snappy</td><td>å¦</td><td>org.apache.hadoop.io.compress.SnappyCodec</td><td>å¦</td></tr></tbody></table><p>å„å‹ç¼©ç®—æ³•æ€§èƒ½æ¯”è¾ƒï¼š</p><ul><li>å‹ç¼©æ¯”ï¼šbzip2(gzip) &gt; lzo(snappy)</li><li>å‹ç¼©ã€è§£å‹é€Ÿç‡ï¼šsnappy(lzo) &gt; gzip &gt; bzip</li></ul><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>ä¸ºä»€ä¹ˆHadoopæ²¡æœ‰è‡ªå¸¦LZOå’ŒSnappyï¼Ÿ</h5></div><div class="admonition-content"><p>LZOå’ŒSnappyé‡‡ç”¨GPLåè®®ï¼Œè€ŒHadoopæ˜¯Apacheåè®®ã€‚</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="å‹ç¼©é…ç½®">å‹ç¼©é…ç½®<a class="hash-link" href="#å‹ç¼©é…ç½®" title="Direct link to heading">â€‹</a></h3><p>ä¿®æ”¹mapred-site.xmlæ–‡ä»¶æˆ–è€…é€šè¿‡hive setå‘½ä»¤ï¼Œç›¸å…³å‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><table><thead><tr><th>å‚æ•°å</th><th>é»˜è®¤å€¼</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>io.compression.codecs</td><td>org.apache.hadoop.io<br>.compress.DefaultCodec</td><td>Hadoopæ ¹æ®æ–‡ä»¶æ‰©å±•ååˆ¤æ–­æ˜¯å¦æ”¯æŒæŸç§è§£ç å™¨ï¼Œåœ¨core-site.xmlä¸­é…ç½®</td></tr><tr><td>mapreduce.map<br>.output.compress</td><td>false</td><td>è®¾ç½®ä¸ºtrueå¼€å¯å‹ç¼©</td></tr><tr><td>mapreduce.map<br>.output.compress.codec</td><td>org.apache.hadoop.io<br>.compress.DefaultCodec</td><td>Mapperå‹ç¼©æ ¼å¼</td></tr><tr><td>mapreduce.output<br>.fileoutputformat.compress</td><td>false</td><td>è®¾ç½®ä¸ºtrueå¼€å¯å‹ç¼©</td></tr><tr><td>mapreduce.output<br>.fileoutputformat.compress.codec</td><td>org.apache.hadoop.io<br>.compress.DefaultCodec</td><td>ä½¿ç”¨gzipæˆ–è€…bzip2</td></tr><tr><td>mapreduce.output<br>.fileoutputformat.compress.type</td><td>RECORD</td><td><strong>SequenceFile</strong>è¾“å‡ºä½¿ç”¨çš„å‹ç¼©ç±»å‹ï¼Œå¦å¯é€‰NONEå’ŒBLOCK</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¼€å¯mapperå‹ç¼©">å¼€å¯Mapperå‹ç¼©<a class="hash-link" href="#å¼€å¯mapperå‹ç¼©" title="Direct link to heading">â€‹</a></h3><ol><li>å¼€å¯Hiveä¸­é—´ä¼ è¾“æ•°æ®å‹ç¼©ï¼š<code>set hive.exec.compress.intermediate=true;</code>ï¼›</li><li>å¼€å¯Hadoopä¸­Mapperè¾“å‡ºå‹ç¼©ï¼š<code>set mapreduce.map.output.compress=true;</code>ï¼›</li><li>è®¾ç½®Hadoopä¸­Mapperå‹ç¼©æ ¼å¼ï¼š<code>set mapreduce.map.output.compress.codec=org.apache.hadoop.io.compress.SnappyCodec;</code>ï¼›</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¼€å¯reducerå‹ç¼©">å¼€å¯Reducerå‹ç¼©<a class="hash-link" href="#å¼€å¯reducerå‹ç¼©" title="Direct link to heading">â€‹</a></h3><ol><li>å¼€å¯Hiveæœ€ç»ˆè¾“å‡ºæ•°æ®å‹ç¼©åŠŸèƒ½ï¼š<code>set hive.exec.compress.output=true;</code>ï¼›</li><li>å¼€å¯Hadoopä¸­Reducerè¾“å‡ºå‹ç¼©ï¼š<code>set mapreduce.output.fileoutputformat.compress=true;</code>ï¼›</li><li>è®¾ç½®Hadoopä¸­Reducerå‹ç¼©æ ¼å¼ï¼š<code>set mapreduce.output.fileoutputformat.compress.codec=org.apache.hadoop.io.compress.SnappyCodec;</code>ï¼›</li><li>è®¾ç½®Hadoopä¸­Reducerå‹ç¼©å•ä½ï¼š<code>set mapreduce.output.fileoutputformat.compress.type=BLOCK;</code>ï¼›</li></ol><p>å…¶ä¸­mapreduce.output.fileoutputformat.compress.typeå‚æ•°ä»…ç”¨äºç¼–ç æ–¹å¼è®¾ç½®ä¸ºSequenceFileæ—¶ï¼Œé»˜è®¤ä¸ºRECORDï¼Œä½†å»ºè®®ä½¿ç”¨BLOCKã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ–‡ä»¶å­˜å‚¨">æ–‡ä»¶å­˜å‚¨<a class="hash-link" href="#æ–‡ä»¶å­˜å‚¨" title="Direct link to heading">â€‹</a></h2><p>Hiveæ”¯æŒçš„æ–‡ä»¶å­˜å‚¨æ ¼å¼æœ‰TEXTFILEã€SEQUENCEFILEã€ORCå’ŒPARQUETã€‚å…¶ä¸­TEXTFILEå’ŒSEQUENCEFILEåŸºäºè¡Œå­˜å‚¨ï¼Œè€ŒORCå’ŒPARQUETåŸºäºåˆ—å­˜å‚¨ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="è¡Œåˆ—å¼å­˜å‚¨">è¡Œ/åˆ—å¼å­˜å‚¨<a class="hash-link" href="#è¡Œåˆ—å¼å­˜å‚¨" title="Direct link to heading">â€‹</a></h3><p>è¡Œå¼å­˜å‚¨å’Œåˆ—å¼å­˜å‚¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‰è€…ä»¥ä¸€è¡Œæ•°æ®ä¸ºå•ä½ä¾æ¬¡å­˜å‚¨ï¼Œåè€…ä»¥ä¸€åˆ—æ•°æ®ä¸ºå•ä½ä¾æ¬¡å­˜å‚¨ã€‚</p><p>æŸ¥è¯¢æ»¡è¶³æ¡ä»¶çš„ä¸€è¡Œæ•°æ®æ—¶ï¼Œåˆ—å¼å­˜å‚¨éœ€è¦å–æ¯ä¸ªèšé›†çš„å­—æ®µæ‰¾åˆ°å¯¹åº”åˆ—å€¼ï¼Œè€Œè¡Œå­˜å‚¨åªéœ€è¦æ‰¾åˆ°å…¶ä¸­ä¸€ä¸ªå€¼ï¼Œå…¶ä½™å€¼éƒ½åœ¨ç›¸é‚»åœ°æ–¹ï¼Œæ­¤æ—¶è¡Œå¼å­˜å‚¨æŸ¥è¯¢é€Ÿåº¦ä¼˜äºåˆ—å¼å­˜å‚¨ã€‚</p><p>ç”±äºæ¯ä¸ªå­—æ®µçš„æ•°æ®èšé›†å­˜å‚¨ï¼Œå½“åªéœ€è¦æŸ¥è¯¢å°‘æ•°å‡ ä¸ªå­—æ®µæ—¶å¤§å¤§å‡å°‘è¯»å–æ•°æ®é‡ã€‚ç”±äºæ¯ä¸ªå­—æ®µç±»å‹ç›¸åŒï¼Œåˆ—å¼å­˜å‚¨å¯ä»¥è®¾è®¡æ›´å¥½çš„å‹ç¼©ç®—æ³•ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="textfileæ ¼å¼">TEXTFILEæ ¼å¼<a class="hash-link" href="#textfileæ ¼å¼" title="Direct link to heading">â€‹</a></h3><p>Hiveä½¿ç”¨çš„é»˜è®¤æ ¼å¼ï¼Œä¸è¦å‹ç¼©æ•°æ®ï¼Œæ•°æ®å­˜å‚¨ã€è§£æå¼€é”€å¤§ã€‚å¯ç»“åˆGzipã€Bzip2ä½¿ç”¨ï¼Œä½†ä½¿ç”¨Gzipæ—¶Hiveä¸å¯¹åˆ‡åˆ†æ•°æ®ï¼Œå› æ­¤æ— æ³•å¹¶è¡Œæ“ä½œã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="orcæ ¼å¼">ORCæ ¼å¼<a class="hash-link" href="#orcæ ¼å¼" title="Direct link to heading">â€‹</a></h3><p>ORC(Optimized Row Columnar)æ˜¯ä¸€ç§äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”±1è‡³å¤šä¸ªstripeã€file footerå’Œpostscriptç»„æˆï¼Œæ¯ä¸ªstripeåŒ…å«3éƒ¨åˆ†ï¼šindex dataã€row dataã€stripe footerï¼Œå¦‚ä¸‹æ‰€ç¤ºä¸ºorcæ–‡ä»¶ç»“æ„å›¾ï¼š</p><img loading="lazy" style="width:80%;height:80%" src="/img/blog/HiveNotes/OrcFileLayout.png" title="Orc File Layout" class="img_E7b_"><ul><li>stripe<ul><li>index dataï¼šè½»é‡çº§indexï¼Œé»˜è®¤æ¯éš”1wè¡Œåšä¸€ä¸ªç´¢å¼•ï¼Œè¡¨ç¤ºå­—æ®µæ•°æ®åœ¨row dataä¸­çš„offsetï¼›</li><li>row dataï¼šå…·ä½“æ•°æ®ï¼Œåˆ†æˆå¤šä¸ªstreamï¼›</li><li>stripe footerï¼šå­˜æ”¾streamç±»å‹ã€é•¿åº¦ç­‰ä¿¡æ¯ï¼›</li></ul></li><li>file footerï¼šå­˜æ”¾stripeã€columnæ•°æ®ç±»å‹ç­‰ï¼›</li><li>postscriptï¼šå­˜æ”¾æ–‡ä»¶å‹ç¼©ç±»å‹å’Œfile footeré•¿åº¦ç­‰ã€‚</li></ul><p>è¯»å–ORCæ–‡ä»¶æ—¶ï¼Œå…ˆseekåˆ°æ–‡ä»¶å°¾éƒ¨è¯»å–postscriptï¼Œå¾—åˆ°file footeré•¿åº¦ï¼Œå†è¯»filefooterï¼Œå¾—åˆ°stripeä¿¡æ¯ï¼Œæœ€åè¯»å†™stripeå¾—åˆ°åˆ—æ•°æ®ï¼Œå³ä»åå¾€å‰è¯»å–è§£æã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="parquetæ ¼å¼">PARQUETæ ¼å¼<a class="hash-link" href="#parquetæ ¼å¼" title="Direct link to heading">â€‹</a></h3><p>å’ŒORCæ–‡ä»¶ä¸€æ ·ï¼ŒPARQUETæ–‡ä»¶ä¹Ÿæ˜¯ä¸€ç§äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒåŒ…å«æ•°æ®å’Œå…ƒæ•°æ®ï¼Œå› æ­¤PARQUETæ˜¯è‡ªè§£æçš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºä¸ºparquetç»“æ„å›¾ï¼š</p><img loading="lazy" style="width:80%;height:80%" src="/img/blog/HiveNotes/ParquetFileLayout.gif" title="Parquet File Layout" class="img_E7b_"><ul><li>Magic Numberï¼š4å­—èŠ‚å†…å®¹<code>PAR1</code>ï¼Œæ ‡è¯†å…¶ä¸ºPARQUETæ–‡ä»¶</li><li>è¡Œç»„(Row Group)ï¼šæ¯ä¸ªè¡Œç»„åŒ…å«ä¸€å®šè¡Œæ•°ï¼Œä¸€ä¸ªPARQUETæ–‡ä»¶è‡³å°‘å­˜å‚¨ä¸€ä¸ªè¡Œç»„ï¼Œç±»ä¼¼stripeï¼›<ul><li>åˆ—å—(Column Chunk)ï¼šè¡Œç»„ä¸­çš„æ¯ä¸€åˆ—å­˜åœ¨ä¸€ä¸ªåˆ—å—ä¸­ï¼Œæ‰€æœ‰åˆ—è¿ç»­å­˜å‚¨åœ¨è¡Œç»„æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªåˆ—å—ä¸­æ•°æ®ç±»å‹ç›¸åŒï¼Œä½†å¯ä»¥ä½¿ç”¨ä¸åŒå‹ç¼©ç®—æ³•ï¼›<ul><li>é¡µ(Page)ï¼šæ¯ä¸€ä¸ªåˆ—å—åˆ’åˆ†ä¸ºå¤šä¸ªé¡µï¼Œé¡µæ˜¯æœ€å°çš„ç¼–ç å•ä½ï¼ŒåŒä¸€ä¸ªåˆ—å—çš„ä¸åŒé¡µå¯ä»¥ä½¿ç”¨ä¸åŒç¼–ç æ–¹å¼ã€‚</li></ul></li></ul></li><li>Footer<ul><li>Column meta data</li></ul></li><li>Footer Lengthï¼š4å­—èŠ‚å­˜å‚¨æ–‡ä»¶å…ƒæ•°æ®é•¿åº¦</li><li>Magic Numberï¼š4å­—èŠ‚å†…å®¹<code>PAR1</code>ï¼Œæ ‡è¯†å…¶ä¸ºPARQUETæ–‡ä»¶</li></ul><p>parquetæ–‡ä»¶é¦–å°¾æ˜¯å›ºå®šçš„4å­—èŠ‚å†…å®¹'PAR1'ï¼Œä»åº•å¾€ä¸Šèµ°æ˜¯footer lengthè¡¨ç¤ºå…ƒæ•°æ®é•¿åº¦ï¼Œé€šè¿‡footer lengthå’Œæ–‡ä»¶é•¿åº¦å¯ä»¥è®¡ç®—å‡ºå…ƒæ•°æ®åç§»é‡ä»è€Œè¯»å–ã€‚å…ƒæ•°æ®åŒ…å«è¡Œç»„å…ƒæ•°æ®ä¿¡æ¯ã€è¯¥æ–‡ä»¶å­˜å‚¨æ•°æ®çš„schemaä¿¡æ¯ä»¥åŠé¡µå…ƒæ•°æ®ã€‚</p>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Hive" term="Hive"/>
        <category label="BigData" term="BigData"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hive 3.xå­¦ä¹ ç¬”è®°(4)]]></title>
        <id>/2022/02/22/Learning-Hive3.x-04</id>
        <link href="https://kayhaw.github.io/blog/2022/02/22/Learning-Hive3.x-04"/>
        <updated>2022-02-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Hive 3.1.2å­¦ä¹ ç¬”è®°(4)ï¼šåˆ†åŒºè¡¨å’Œåˆ†æ¡¶è¡¨]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“Hive 3.1.2å­¦ä¹ ç¬”è®°ç¬¬4ç¯‡ï¼šåˆ†åŒºè¡¨å’Œåˆ†æ¡¶è¡¨ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="åˆ†åŒºè¡¨">åˆ†åŒºè¡¨<a class="hash-link" href="#åˆ†åŒºè¡¨" title="Direct link to heading">â€‹</a></h2><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-PartitionedTables" target="_blank" rel="noopener noreferrer">Hiveåˆ†åŒºè¡¨</a>å¯¹åº”HDFSä¸Šè¡¨æ•°æ®ç›®å½•ä¸‹çš„å­ç›®å½•ï¼Œè¯¥å­ç›®å½•ä¸‹åŒ…å«åˆ†åŒºçš„æ‰€æœ‰æ•°æ®æ–‡ä»¶ã€‚Hiveåˆ†åŒºå°±æ˜¯æŠŠå¤§æ•°æ®é›†æŒ‰ç…§ä¸šåŠ¡éœ€è¦åˆ†å‰²ä¸ºå°æ•°æ®é›†æ”¾åœ¨ä¸åŒç›®å½•ä¸‹ï¼Œæ¯”å¦‚æŒ‰å¤©åˆ›å»ºåˆ†åŒºç›®å½•æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™æ ·åœ¨whereå­å¥ä¸­æŒ‡å®šåˆ†åŒºå¯ä»¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ<a class="hash-link" href="#åŸºæœ¬æ“ä½œ" title="Direct link to heading">â€‹</a></h3><ol><li>åˆ›å»ºåˆ†åŒºè¡¨çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼Œæ³¨æ„partitionåŠ edã€‚åˆ†åŒºå­—æ®µæ˜¯è¡¨çš„ä¼ªåˆ—ï¼Œå› æ­¤ä¸èƒ½å’Œè¡¨å­—æ®µé‡åï¼Œå¦åˆ™æŠ¥é”™"FAILED: Error in semantic analysis: Column repeated in partitioning columns"ã€‚</li></ol><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">TEMPORARY</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EXTERNAL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">table_name    </span><span class="token comment" style="color:#999988;font-style:italic">-- (Note: TEMPORARY available in Hive 0.14.0 and later)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col_name data_type </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">column_constraint_specification</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> col_comment</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">constraint_specification</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> table_comment</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">PARTITIONED </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col_name data_type </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> col_comment</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="2"><li>åŠ è½½æ–‡ä»¶åˆ°åˆ†åŒºè¡¨å¿…é¡»æŒ‡å®šåˆ†åŒºå­—æ®µï¼Œæ³¨æ„partitionæ²¡æœ‰åŠ edã€‚</li></ol><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">LOAD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATA</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">LOCAL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> INPATH </span><span class="token string" style="color:#e3116c">'filepath'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">OVERWRITE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename </span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol1</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> partcol2</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val2 </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="3"><li><p>æŸ¥è¯¢åˆ†åŒºæ•°æ®ï¼Œåªéœ€è¦æŠŠåˆ†åŒºå­—æ®µå½“æˆæ™®é€šå­—æ®µæ”¾åœ¨whereå­å¥ä¸­è¿‡æ»¤å³å¯ã€‚</p></li><li><p>å¢åŠ /åˆ é™¤åˆ†åŒºï¼Œç›¸å½“äºæ–°å»º/åˆ é™¤æ–‡ä»¶å¤¹ï¼Œ<strong>æ³¨æ„æ·»åŠ å¤šä¸ªåˆ†åŒºæ²¡æœ‰é€—å·ï¼Œä½†åˆ é™¤å¤šä¸ªåˆ†åŒºæœ‰é€—å·</strong>ã€‚</p></li></ol><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename </span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol1</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol2</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename </span><span class="token keyword" style="color:#00009f">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol1</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol2</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="5"><li>æŸ¥çœ‹åˆ†åŒºè¡¨åˆ†åŒºä¿¡æ¯:</li></ol><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SHOW</span><span class="token plain"> PARTITIONS tablename</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DESC</span><span class="token plain"> FORMATTED tablename</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¤šçº§åˆ†åŒº">å¤šçº§åˆ†åŒº<a class="hash-link" href="#å¤šçº§åˆ†åŒº" title="Direct link to heading">â€‹</a></h3><p>å½“æ¯å¤©çš„æ•°æ®é‡ä¹Ÿå¾ˆå¤§æ—¶ï¼Œå¯ä»¥æŒ‰ç…§å°æ—¶ç»§ç»­åˆ†åŒº(å³åœ¨æŒ‰å¤©ä¸ºç›®å½•ä¸‹åˆ›å»ºæŒ‰å°æ—¶çš„ç›®å½•)ï¼Œå³åˆ›å»ºå¤šçº§åˆ†åŒº(æŒ‡å®šå¤šä¸ªåˆ†åŒºå­—æ®µ)ã€‚åŒæ ·åœ°ï¼Œå¯¹äºå¤šçº§åˆ†åŒºè¡¨çš„æ•°æ®åŠ è½½ï¼Œä½¿ç”¨LOAD DATAæ—¶è¦æŒ‡å®šæ‰€æœ‰åˆ†åŒºå­—æ®µçš„å€¼ï¼Œä¸ç„¶Hiveä¸çŸ¥é“è¯¥æ”¾å“ªä¸ªå­æ–‡ä»¶å¤¹ä¸‹(åŠ¨æ€åˆ†åŒºå¯ä»¥)ã€‚</p><p>ç°åœ¨é€šè¿‡<code>dfs -mkdir</code>è‡ªè¡Œåˆ›å»ºæ–‡ä»¶å¤¹å’Œ<code>dfs -put</code>ä¸Šä¼ æ•°æ®æ–‡ä»¶ï¼Œæ­¤æ—¶æ‰§è¡ŒSELECTè¯­å¥æŸ¥è¯¢ä¸åˆ°ç»“æœã€‚è¦è®©åˆ†åŒºè¡¨å’Œæ•°æ®å…³è”ï¼Œæœ‰å¦‚ä¸‹3ç§æ–¹å¼ï¼š</p><ol><li>æ‰§è¡Œä¿®å¤å‘½ä»¤<code>MSCK REPAIR TABLE tablename</code>ï¼›</li><li>æ·»åŠ åˆ†åŒº<code>ALTER TABLE tablename PARTITION(partcol1=val1) [ PARTITION(partcol2=val2)]</code>ï¼›</li><li>ä½¿ç”¨<code>LOAD DATA</code>ä¸Šä¼ æ•°æ®æ–‡ä»¶ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="åŠ¨æ€åˆ†åŒº">åŠ¨æ€åˆ†åŒº<a class="hash-link" href="#åŠ¨æ€åˆ†åŒº" title="Direct link to heading">â€‹</a></h3><p>é™æ€åˆ†åŒºæŒ‡æ’å…¥æ•°æ®æ—¶æ˜¾å¼æŒ‡å®šåˆ†åŒºå­—æ®µåå’Œåˆ†åŒºå­—æ®µå€¼ï¼Œè€ŒåŠ¨æ€åˆ†åŒºæŒ‡Hiveæ ¹æ®è¡¨å­—æ®µå€¼è‡ªåŠ¨åœ°åˆ›å»ºå¯¹åº”åˆ†åŒºå¹¶å°†æ•°æ®æ’å…¥åˆ†åŒºï¼Œå¼€å¯åŠ¨æ€åˆ†åŒºéœ€è¦è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><ol><li>é…ç½®<code>hive.exec.dynamic.partition</code>ï¼Œé»˜è®¤ä¸ºtrueè¡¨ç¤ºå¼€å¯åŠ¨æ€åˆ†åŒºï¼›</li><li>é…ç½®<code>hive.exec.dynamic.partition.mode</code>ï¼Œé»˜è®¤ä¸º<code>strict</code>è¡¨ç¤ºè‡³å°‘æŒ‡å®šä¸€ä¸ªåˆ†åŒºä¸ºé™æ€åˆ†åŒºï¼Œ<code>nostrict</code>æ¨¡å¼è¡¨ç¤ºå…è®¸æ‰€æœ‰åˆ†åŒºå­—æ®µéƒ½å¯ä»¥ä½¿ç”¨åŠ¨æ€åˆ†åŒºï¼›</li><li>é…ç½®<code>hive.exec.max.dynamic.partitions</code>ï¼Œè¡¨ç¤ºæ‰€æœ‰æŒ‡å®šMRèŠ‚ç‚¹ä¸Šæœ€å¤šå¯ä»¥åˆ›å»ºåŠ¨æ€åˆ†åŒºçš„æ•°é‡ï¼Œé»˜è®¤1000ï¼›</li><li>é…ç½®<code>hive.exec.max.dynamic.partitions.pernode</code>ï¼Œè¡¨ç¤ºæ¯ä¸ªMRèŠ‚ç‚¹ä¸Šæœ€å¤šå¯ä»¥åˆ›å»ºåŠ¨æ€åˆ†åŒºçš„æ•°é‡ï¼Œé»˜è®¤100ï¼›</li><li>é…ç½®<code>hive.exec.max.created.files</code>ï¼Œè¡¨ç¤ºæ•´ä¸ªMRç¨‹åºä¸­å†œæœ€å¤§å¯ä»¥åˆ›å»ºHDFSæ–‡ä»¶æ•°é‡ï¼Œé»˜è®¤100000ï¼›</li><li>å¯é€‰é…ç½®<code>hive.error.on.empty.partition</code>ï¼Œè¡¨ç¤ºæœ‰ç©ºåˆ†åŒºç”Ÿæˆæ—¶æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼Œé»˜è®¤falseï¼Œä¸éœ€è¦è®¾ç½®ã€‚</li></ol><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML#LanguageManualDML-DynamicPartitionInserts" target="_blank" rel="noopener noreferrer">Hive 3.xæ–°å¢ç‰¹æ€§</a>ï¼šåŠ¨æ€åˆ†åŒºINSERT-SELECTæ’å…¥å¯ä»¥ä¸ç”¨æŒ‡å®šåˆ†åŒºå­—æ®µï¼Œç”šè‡³ä¸¥æ ¼æ¨¡å¼éƒ½ä¸éœ€è¦å…³é—­ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="åˆ†æ¡¶è¡¨">åˆ†æ¡¶è¡¨<a class="hash-link" href="#åˆ†æ¡¶è¡¨" title="Direct link to heading">â€‹</a></h2><p>åˆ†æ¡¶è¡¨å°†è¡¨æ•°æ®æ–‡ä»¶æ‹†åˆ†ä¸ºå¤šä¸ªå°æ–‡ä»¶æ¥æ›´ç»†ç²’åº¦çš„ç®¡ç†æ•°æ®ï¼Œå³åˆ†åŒºé’ˆå¯¹çš„æ˜¯æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œè€Œåˆ†æ¡¶é’ˆå¯¹çš„æ˜¯æ•°æ®æ–‡ä»¶ã€‚åˆ›å»ºåˆ†æ¡¶è¡¨çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">TEMPORARY</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EXTERNAL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">table_name    </span><span class="token comment" style="color:#999988;font-style:italic">-- (Note: TEMPORARY available in Hive 0.14.0 and later)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col_name data_type </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">column_constraint_specification</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> col_comment</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">constraint_specification</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">CLUSTERED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">SORTED </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col_name </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">ASC</span><span class="token operator" style="color:#393A34">|</span><span class="token keyword" style="color:#00009f">DESC</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> num_buckets BUCKETS</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><strong>å’Œåˆ†åŒºè¡¨è¦æ±‚åˆ†åŒºå­—æ®µå¿…é¡»ä¸èƒ½å’Œè¡¨å­—æ®µé‡åç›¸åï¼Œåˆ†æ¡¶è¡¨è¦æ±‚åˆ†æ¡¶å­—æ®µä¸€å®šæ˜¯è¡¨å­—æ®µå</strong>ã€‚å’ŒPARTITIONED BYä¸€æ ·æ³¨æ„CLUSTERED BYåŠ äº†edã€‚åˆ†æ¡¶ç®—æ³•æ˜¯è®¡ç®—åˆ†æ¡¶å­—æ®µçš„å“ˆå¸Œå€¼ï¼Œç„¶åå¯¹æ¡¶ä¸ªæ•°å–æ¨¡å†³å®šè®°å½•æ”¾åœ¨å“ªä¸ªæ¡¶ä¸­ã€‚æ“ä½œåˆ†æ¡¶è¡¨æ—¶éœ€è¦æ³¨æ„ï¼š</p><ol><li>è®¾ç½®reduceä¸ªæ•°ä¸º-1æˆ–è€…å¤§äºæ¡¶æ•°ï¼Œè®©Jobè‡ªè¡Œå†³å®šç”¨å¤šå°‘ä¸ªreduceï¼›</li><li>ä»HDFSä¸ŠLOADæ•°æ®åˆ°åˆ†æ¡¶è¡¨ï¼Œé˜²æ­¢æœ¬åœ°æ–‡ä»¶æ‰¾ä¸åˆ°ï¼›</li><li>ä¸è¦ä½¿ç”¨æœ¬åœ°æ¨¡å¼ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="æŠ½æ ·æŸ¥è¯¢">æŠ½æ ·æŸ¥è¯¢<a class="hash-link" href="#æŠ½æ ·æŸ¥è¯¢" title="Direct link to heading">â€‹</a></h3><p>Hiveæä¾›<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Sampling" target="_blank" rel="noopener noreferrer">TABLESAMPLEä»å¥</a>ç”¨äºæŸ¥è¯¢æŠ½æ ·æ•°æ®è€Œä¸æ˜¯æ•´ä¸ªè¡¨æ•°æ®ï¼Œåˆ†ä¸ºåˆ†æ¡¶è¡¨æŠ½æ ·å’Œå—æŠ½æ ·ä¸¤ç§ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># åˆ†æ¡¶è¡¨æŠ½æ ·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">selectstatement </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> fromstatement TABLESAMPLE </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BUCKET x </span><span class="token keyword" style="color:#00009f">OUT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">OF</span><span class="token plain"> y </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> colname</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ•°æ®å—æŠ½æ ·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">selectstatement </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> fromstatement TABLESAMPLE </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token keyword" style="color:#00009f">PERCENT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ByteLengthLiteral</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å¯¹äºåˆ†æ¡¶è¡¨æŠ½æ ·ï¼Œæ•°æ®æ ¹æ®æŠ½æ ·åˆ—colnameéšæœºåœ°åˆ†æˆyä»½ï¼Œç¼–å·ä»1åˆ°yï¼Œç„¶åè¿”å›ç¼–å·ä¸ºxçš„æ•°æ®ï¼Œå»ºè®®yæ˜¯è¡¨æ¡¶æ•°çš„å› å­æˆ–å€æ•°ã€‚colnameéåˆ†åŒºå­—æ®µï¼Œå¯ä»¥è®¾ç½®ä¸º<code>rand()</code>è¡¨ç¤ºå¯¹æ•´è¡Œæ•°æ®æŠ½æ ·ã€‚å¯¹äºæ™®é€šè¡¨ä½¿ç”¨TABLESAMPLEä»å¥ä¼šæ‰«ææ•´ä¸ªè¡¨æ•°æ®ï¼Œå¯¼è‡´æ•ˆç‡ä½ï¼Œå› æ­¤å¾€å¾€å°†å…¶è¿ç”¨åˆ°åˆ†æ¡¶è¡¨ä¸Šï¼Œå¹¶ä¸”æŠ½æ ·åˆ—colnameå’Œåˆ†æ¡¶å­—æ®µç›¸åŒã€‚ä¾‹å¦‚åˆ†æ¡¶è¡¨æ¡¶æ•°ä¸º32ï¼Œå¯¹äº<code>TABLESAMPLE(BUCKET 3 OUT OF 16 ON id)</code>ï¼Œå®ƒä¼šé€‰æ‹©ç¬¬3ä¸ªå’Œç¬¬19ä¸ªæ¡¶æ•°æ®åˆæˆ32/16=2ä¸ªæ¡¶è¿”å›ï¼Œè€Œå¯¹äº<code>TABLESAMPLE(BUCKET 3 OUT OF 64 ON id)</code>ï¼Œå®ƒä¼šé€‰æ‹©ç¬¬3ä¸ªæ¡¶çš„1/2æ•°æ®è¿”å›ã€‚<strong>æ³¨æ„xå¿…é¡»å°äºç­‰äºyï¼Œå¦åˆ™æŠ¥é”™</strong>ã€‚</p><p>å¯¹äºæ•°æ®å—æŠ½æ ·ï¼Œå®ƒæŠ½å–è‡³å°‘n%æ•°æ®(æ³¨æ„å¹¶ä¸ä¸€å®šæ˜¯è¡Œæ•°)ä½œä¸ºè¾“å…¥ï¼Œä»…æ”¯æŒ<code>CombineHiveInputFormat</code>ï¼ŒæŸäº›å‹ç¼©æ ¼å¼ä¸æ”¯æŒã€‚å¦‚æœæŠ½æ ·å¤±è´¥åˆ™æ‰«ææ•´ä¸ªè¡¨/åˆ†åŒºã€‚<strong>æ•°æ®å—æŠ½æ ·è¾“å…¥åœ¨HDFSå—çº§åˆ«</strong>ï¼Œæ¯”å¦‚n%æ•°æ®å¤§å°ä¸º100MBè€Œå—å¤§å°ä¸º128MBï¼Œæ­¤æ—¶è¾“å…¥128MBã€‚ä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šæŠ½å–å¤§å°ï¼Œä¾‹å¦‚<code>SELECT * FROM source TABLESAMPLE(100M)</code>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><ol><li>åˆ†åŒºå°±æ˜¯åˆ†ç›®å½•ï¼Œå¤šä¸ªåˆ†åŒºå­—æ®µå¯¹åº”å¤šå±‚å­ç›®å½•ï¼›</li><li>åœ¨Hive3.xä¹‹å‰ï¼ŒåŠ¨æ€åˆ†åŒºéœ€è¦å…³é—­ä¸¥æ ¼æ¨¡å¼ï¼›</li><li>åˆ†æ¡¶è¡¨é‡‡æ ·å°†æ•°æ®åˆ†ä¸ºyä»½å–ç¬¬xä»½(ä»1å¼€å§‹è®¡æ•°)ï¼Œæ•°æ®å—é‡‡æ ·åŸºäºå—ï¼Œå¯¹æ•°æ®æ ¼å¼æœ‰è¦æ±‚ã€‚</li></ol>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Hive" term="Hive"/>
        <category label="BigData" term="BigData"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hive 3.xå­¦ä¹ ç¬”è®°(3)]]></title>
        <id>/2022/02/21/Learning-Hive3.x-03</id>
        <link href="https://kayhaw.github.io/blog/2022/02/21/Learning-Hive3.x-03"/>
        <updated>2022-02-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Hive 3.1.2å­¦ä¹ ç¬”è®°(3)ï¼šHive SQL]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“Hive 3.1.2å­¦ä¹ ç¬”è®°ç¬¬3ç¯‡ï¼šHive SQLã€‚</p><p>Hive SQL(HQL)åˆ†ä¸ºDDL(æ•°æ®å®šä¹‰è¯­è¨€ï¼ŒData Definition Language)ã€æ•°æ®æŸ¥è¯¢å’ŒDML(æ•°æ®æ“æ§è¯­è¨€ï¼ŒData Manipulation Language)ï¼Œæ›´å¤šå†…å®¹è¯¦è§<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual" target="_blank" rel="noopener noreferrer">Hive SQL Language Manual</a>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ddl">DDL<a class="hash-link" href="#ddl" title="Direct link to heading">â€‹</a></h2><ul><li>åˆ›å»ºæ•°æ®åº“ï¼š</li></ul><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> database_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> database_comment</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">LOCATION hdfs_path</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"> DBPROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">property_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">property_value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ul><li><p>æ˜¾ç¤ºæ•°æ®åº“ä¿¡æ¯(åŠ extendedæ˜¾ç¤ºè¯¦æƒ…)ï¼š<code>desc database [extended] &lt;dbname&gt;</code>ï¼›</p></li><li><p><strong>åˆ›å»ºè¡¨</strong>ï¼š</p></li></ul><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">TEMPORARY</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EXTERNAL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">table_name    </span><span class="token comment" style="color:#999988;font-style:italic">-- (Note: TEMPORARY available in Hive 0.14.0 and later)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col_name data_type </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">column_constraint_specification</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> col_comment</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">constraint_specification</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> table_comment</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">PARTITIONED </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col_name data_type </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> col_comment</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">CLUSTERED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">SORTED </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col_name </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">ASC</span><span class="token operator" style="color:#393A34">|</span><span class="token keyword" style="color:#00009f">DESC</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> num_buckets BUCKETS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">SKEWED </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">-- (Note: Available in Hive 0.10.0 and later)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col_value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col_value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col_value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col_value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">STORED </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> DIRECTORIES</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">ROW</span><span class="token plain"> FORMAT row_format</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">STORED </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> file_format</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> STORED </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'storage.handler.class.name'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"> SERDEPROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">-- (Note: Available in Hive 0.6.0 and later)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">LOCATION hdfs_path</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TBLPROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">property_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">property_value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">-- (Note: Available in Hive 0.6.0 and later)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> select_statement</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">-- (Note: Available in Hive 0.5.0 and later; not supported for external tables)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">TEMPORARY</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EXTERNAL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">table_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">LIKE</span><span class="token plain"> existing_table_or_view_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">LOCATION hdfs_path</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¤–éƒ¨è¡¨å’Œç®¡ç†è¡¨">å¤–éƒ¨è¡¨å’Œç®¡ç†è¡¨<a class="hash-link" href="#å¤–éƒ¨è¡¨å’Œç®¡ç†è¡¨" title="Direct link to heading">â€‹</a></h3><p>Hiveé»˜è®¤åˆ›å»ºçš„è¡¨éƒ½æ˜¯ç®¡ç†è¡¨(Managed Tableï¼Œä¹Ÿç§°å†…éƒ¨è¡¨)ï¼Œé»˜è®¤å°†è¡¨æ•°æ®æ”¾åœ¨<code>hive.metastore.warehouse.dir</code>é…ç½®é¡¹æŒ‡å®šçš„ç›®å½•ä¸‹ã€‚<strong>å½“åˆ é™¤ç®¡ç†è¡¨æ—¶ï¼ŒHiveä¼šåˆ é™¤è¡¨æ•°æ®è€Œåˆ é™¤å¤–éƒ¨è¡¨æ—¶ä¸ä¼šåˆ é™¤è¡¨æ•°æ®ï¼Œä»…ä»…åˆ é™¤è¡¨å…ƒä¿¡æ¯</strong>ã€‚</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>è¯¥ä½¿ç”¨å“ªç§è¡¨ï¼Ÿ</h5></div><div class="admonition-content"><p>åŸå§‹æ•°æ®å…ˆä¿å­˜åˆ°å¤–éƒ¨è¡¨ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šç»Ÿè®¡åˆ†æäº§ç”Ÿçš„ç»“æœä¿å­˜åˆ°å†…éƒ¨è¡¨</p></div></div><p>é€šè¿‡<code>ALTER TABLE &lt;tablename&gt; SET TBLPROPERTIES('EXTERNAL'='TRUE');</code>æˆ–è€…<code>ALTER TABLE &lt;tablename&gt; SET TBLPROPERTIES('EXTERNAL'='FALSE');</code>æ¥è½¬æ¢ç®¡ç†è¡¨å’Œå†…éƒ¨è¡¨ï¼Œ<strong>æ³¨æ„ï¼š('EXTERNAL'='TRUE')å’Œ('EXTERNAL'='FALSE')ä¸ºå›ºå®šå†™æ³•ï¼ŒåŒºåˆ†å¤§å°å†™</strong>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="dml">DML<a class="hash-link" href="#dml" title="Direct link to heading">â€‹</a></h2><p>æ ¹æ®<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML" target="_blank" rel="noopener noreferrer">Hive DML Wiki</a>åˆ†ä¸ºï¼šæ•°æ®å¯¼å…¥ã€æ•°æ®å¯¼å‡ºã€æ•°æ®æ¸…é™¤ã€æ•°æ®æ›´æ–°å’Œæ•°æ®åˆå¹¶5ä¸ªéƒ¨åˆ†ï¼Œå…¶ä¸­æ•°æ®DELETEæ¸…é™¤ã€æ•°æ®æ›´æ–°UPDATEå’Œæ•°æ®åˆå¹¶MERGEä»…é€‚ç”¨äºäº‹åŠ¡è¡¨ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ•°æ®å¯¼å…¥">æ•°æ®å¯¼å…¥<a class="hash-link" href="#æ•°æ®å¯¼å…¥" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="æ–‡ä»¶å¯¼å…¥">æ–‡ä»¶å¯¼å…¥<a class="hash-link" href="#æ–‡ä»¶å¯¼å…¥" title="Direct link to heading">â€‹</a></h4><p>é€šè¿‡æ–‡ä»¶å¯¼å…¥æ•°æ®åˆ°è¡¨ï¼Œè¯­æ³•å¦‚ä¸‹ã€‚åŠ LOCALè¡¨ç¤ºä»æœ¬åœ°æ–‡ä»¶å¯¼å…¥(<strong>æ‹·è´åˆ°HDFSï¼ŒåŸæ–‡ä»¶è¿˜åœ¨</strong>)ï¼Œå¦åˆ™ä»HDFSä¸­å¯¼å…¥(<strong>ç§»åŠ¨åˆ°è¡¨æ•°æ®ç›®å½•ï¼ŒåŸæ–‡ä»¶â€œåˆ é™¤â€</strong>)ã€‚</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">LOAD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATA</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">LOCAL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> INPATH </span><span class="token string" style="color:#e3116c">'filepath'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">OVERWRITE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol1</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> partcol2</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val2 </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">LOAD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATA</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">LOCAL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> INPATH </span><span class="token string" style="color:#e3116c">'filepath'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">OVERWRITE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol1</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> partcol2</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val2 </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">INPUTFORMAT </span><span class="token string" style="color:#e3116c">'inputformat'</span><span class="token plain"> SERDE </span><span class="token string" style="color:#e3116c">'serde'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3.0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">or</span><span class="token plain"> later</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="ç®€å•æ’å…¥">ç®€å•æ’å…¥<a class="hash-link" href="#ç®€å•æ’å…¥" title="Direct link to heading">â€‹</a></h4><p>ç®€å•æ’å…¥æ•°æ®åˆ°è¡¨ï¼Œè¯­æ³•å¦‚ä¸‹ã€‚<code>INTO</code>è¿½åŠ å†™æ•°æ®ï¼Œ<code>OVERWRITE</code>è¦†ç›–å†™æ•°æ®ã€‚</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">OVERWRITE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> partcol2</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> values_row </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> values_row </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å…¶ä¸­values_row := ( value [, value ...] )ï¼Œè€Œvalueè¦ä¹ˆæ˜¯nullæˆ–è€…ä»»ä½•æœ‰æ•ˆçš„SQLå­—é¢é‡</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="æŸ¥è¯¢sqlæ’å…¥">æŸ¥è¯¢SQLæ’å…¥<a class="hash-link" href="#æŸ¥è¯¢sqlæ’å…¥" title="Direct link to heading">â€‹</a></h4><p>å°†SQLæŸ¥è¯¢ç»“æœæ’å…¥åˆ°è¡¨ï¼Œè¯­æ³•å¦‚ä¸‹ã€‚<strong>æ³¨æ„åªæœ‰<code>INSERT OVERWRITE</code>æ—¶æ‰èƒ½æ­é…<code>IF NOT EXISTS</code>ï¼Œè¡¨ç¤ºæ’å…¥æ—¶åˆ›å»ºä¸å­˜åœ¨çš„åˆ†åŒºï¼›å½“è¡¨å±æ€§<code>auto.purge</code>ä¸ºtrueå¹¶ä¸”ä¸ºç®¡ç†è¡¨æ—¶ï¼Œè¦†ç›–å†™ä¼šå°†æ—§æ•°æ®ç›´æ¥åˆ é™¤è€Œä¸æ˜¯ç§»åˆ°Trash</strong>ã€‚æ ‡å‡†æ’å…¥å’ŒåŠ¨æ€åˆ†åŒºæ’å…¥çš„åŒºåˆ«åœ¨äºåˆ†åŒºå­—æ®µä¸è¦æ±‚æä¾›å€¼ã€‚</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 1. æ ‡å‡†è¯­æ³•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> OVERWRITE </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol1</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> partcol2</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val2 </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> select_statement1 </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> from_statement</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol1</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> partcol2</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val2 </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> select_statement1 </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> from_statement</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. å¤šæ¡æ’å…¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> from_statement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> OVERWRITE </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol1</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> partcol2</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val2 </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> select_statement1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> OVERWRITE </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename2 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> select_statement2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename2 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> select_statement2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> from_statement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol1</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> partcol2</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val2 </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> select_statement1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename2 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> select_statement2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> OVERWRITE </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename2 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> select_statement2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. åŠ¨æ€åˆ†åŒºæ’å…¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> OVERWRITE </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename </span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> partcol2</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> select_statement </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> from_statement</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename </span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partcol1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> partcol2</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">val2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> select_statement </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> from_statement</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="å…¶ä»–æ–¹å¼">å…¶ä»–æ–¹å¼<a class="hash-link" href="#å…¶ä»–æ–¹å¼" title="Direct link to heading">â€‹</a></h4><ol><li>æ ¹æ®æŸ¥è¯¢SQLç»“æœåˆ›å»ºè¡¨å¹¶æ’å…¥æ•°æ®ï¼Œç”¨äºç”Ÿæˆä¸­é—´è¡¨ï¼Œè¯­æ³•ä¸º<code>CREATE TABLE IF NOT EXISTS tablename AS select_statement FROM from_statement</code>ï¼›</li><li>æŒ‡å®šåŠ è½½æ•°æ®è·¯å¾„åˆ›å»ºè¡¨ï¼›</li><li>ä½¿ç”¨<code>IMPORT</code>å°†æ•°æ®å¯¼å…¥åˆ°è¡¨ï¼Œåªèƒ½ä½¿ç”¨<code>EXPORT</code>è¾“å‡ºçš„å†…å®¹å¯¼å…¥ï¼</li></ol><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>LOADã€INSERTå’ŒIMPORTå¯¼å…¥æ•°æ®çš„åŒºåˆ«</h5></div><div class="admonition-content"><ul><li>LOADä»…ä»…æ˜¯æ·»åŠ ã€ç§»åŠ¨HDFSæ–‡ä»¶ï¼Œä¸åˆ›å»ºè¡¨å’Œåˆ†åŒº</li><li>INSERTéœ€è¦æ‰§è¡ŒMRç¨‹åºï¼Œåœ¨å‘åˆ†æ¡¶è¡¨æ’å…¥æ•°æ®æ—¶å¿…é¡»ä½¿ç”¨ï¼Œä¸åˆ›å»ºè¡¨ä½†ä¼šåˆ›å»ºåˆ†åŒº</li><li>IMPORTåªèƒ½å¯¼å…¥EXPORTè¾“å‡ºçš„å†…å®¹ï¼Œè‡ªåŠ¨åˆ›å»ºè¡¨/åˆ†åŒºã€‚å¦‚æœè¡¨å­˜åœ¨ï¼Œéåˆ†åŒºè¡¨è¦æ±‚ä¸ºç©ºï¼Œåˆ†åŒºè¡¨è¦æ±‚æ’å…¥åˆ†åŒºä¸å­˜åœ¨ã€‚</li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ•°æ®å¯¼å‡º">æ•°æ®å¯¼å‡º<a class="hash-link" href="#æ•°æ®å¯¼å‡º" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="insertå¯¼å‡º">INSERTå¯¼å‡º<a class="hash-link" href="#insertå¯¼å‡º" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 1. æ ‡å‡†è¯­æ³•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> OVERWRITE </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">LOCAL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DIRECTORY directory1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">ROW</span><span class="token plain"> FORMAT row_format</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">STORED </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> file_format</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Note: Only available </span><span class="token keyword" style="color:#00009f">starting</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> Hive </span><span class="token number" style="color:#36acaa">0.11</span><span class="token number" style="color:#36acaa">.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. å¤šæ¡æ’å…¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> from_statement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> OVERWRITE </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">LOCAL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DIRECTORY directory1 select_statement1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> OVERWRITE </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">LOCAL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DIRECTORY directory2 select_statement2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">row_format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  : DELIMITED </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">FIELDS</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TERMINATED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">ESCAPED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">COLLECTION ITEMS </span><span class="token keyword" style="color:#00009f">TERMINATED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAP </span><span class="token keyword" style="color:#00009f">KEYS</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TERMINATED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">LINES</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TERMINATED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> DEFINED </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Note: Only available </span><span class="token keyword" style="color:#00009f">starting</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> Hive </span><span class="token number" style="color:#36acaa">0.13</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="hadoopå‘½ä»¤å¯¼å‡º">Hadoopå‘½ä»¤å¯¼å‡º<a class="hash-link" href="#hadoopå‘½ä»¤å¯¼å‡º" title="Direct link to heading">â€‹</a></h4><p>ä½¿ç”¨<code>hadoop fs -get</code>å‘½ä»¤ä¸‹è½½è¡¨æ•°æ®æ–‡ä»¶åˆ°æœ¬åœ°ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="hive-shellå‘½ä»¤å¯¼å‡º">Hive Shellå‘½ä»¤å¯¼å‡º<a class="hash-link" href="#hive-shellå‘½ä»¤å¯¼å‡º" title="Direct link to heading">â€‹</a></h4><p>ä½¿ç”¨æ ¼å¼ï¼š<code>hive -e[-f] æ‰§è¡Œsqlæˆ–è€…è„šæœ¬å &gt; è¾“å‡ºæ–‡ä»¶</code>ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="export">EXPORT<a class="hash-link" href="#export" title="Direct link to heading">â€‹</a></h4><p><code>EXPORT</code>å‘½ä»¤ç”¨äºå°†è¡¨æ•°æ®<strong>è¿åŒå…ƒæ•°æ®</strong>ä¸€å—å¯¼å‡ºåˆ°ç‰¹å®šè¾“å‡ºä½ç½®ï¼Œå’Œ<code>IMPORT</code>æ­é…ä½¿ç”¨åœ¨ä¸¤ä¸ªHadoopé›†ç¾¤ä¹‹é—´è¿ç§»Hiveè¡¨(å…ƒæ•°æ®åº“å¯ä»¥ä¸åŒ)ã€‚</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">EXPORT </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tablename </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">part_column</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"value"</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'export_target_path'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FOR</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">replication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'eventid'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ•°æ®æ¸…é™¤">æ•°æ®æ¸…é™¤<a class="hash-link" href="#æ•°æ®æ¸…é™¤" title="Direct link to heading">â€‹</a></h3><ol><li>ä½¿ç”¨<code>DELETE</code>åˆ é™¤è¡¨æ•°æ®ï¼š<code>DELETE FROM tablename [WHERE expression]</code>ï¼›</li><li>ä½¿ç”¨<code>TRUNCATE</code>åˆ é™¤è¡¨æˆ–åˆ†åŒºæ•°æ®ï¼Œ<strong>åªé€‚ç”¨äºç®¡ç†è¡¨</strong>ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</li></ol><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ä»Hive 4.0å¼€å§‹TABLEå…³é”®å­—å¯çœç•¥ï¼Œä¸æŒ‡å®šåˆ†åŒºåˆ™åˆ é™¤æ‰€æœ‰åˆ†åŒº</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">TRUNCATE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> table_name </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> partition_spec</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">partition_spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  : </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partition_column </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> partition_col_value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> partition_column </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> partition_col_value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>DELETEã€TRUNCATEå’ŒDROPçš„åŒºåˆ«</h5></div><div class="admonition-content"><ol><li>ç±»å‹ï¼šDELETEå±äºDMLï¼Œè€ŒTRUNCATEå’ŒDROPå±äºDDLï¼›</li><li>æ˜¯å¦ä¿ç•™å…ƒæ•°æ®ï¼šDELETEå’ŒTRUNCATEä»…åˆ é™¤è¡¨æ•°æ®ï¼Œè¡¨ç»“æ„ä¾ç„¶å­˜åœ¨ï¼Œä½†DROPåˆ é™¤è¡¨æ•°æ®åŒæ—¶åˆ é™¤è¡¨ç»“æ„ï¼›</li><li>å¯¹ç›®æ ‡è¡¨è¦æ±‚ï¼šDELETEä»…ç”¨äºäº‹åŠ¡è¡¨ï¼ŒTRUNCATEä»…ç”¨äºç®¡ç†è¡¨ã€‚</li></ol></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><ol><li>LOCALåŠ è½½æ•°æ®å¤åˆ¶æ–‡ä»¶ï¼Œä¸åŠ LOCALåˆ™ç§»åŠ¨æ–‡ä»¶ï¼›</li><li>æ’å…¥æ•°æ®LOADã€INSERTå’ŒIMPORTçš„åŒºåˆ«ï¼›</li><li>æ¸…é™¤æ•°æ®DELETEã€TRUNCATEå’ŒDROPçš„åŒºåˆ«ï¼›</li><li>DELETEã€UPDATEå’ŒMERGEä»…é€‚ç”¨äºäº‹åŠ¡è¡¨ã€‚</li></ol>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Hive" term="Hive"/>
        <category label="BigData" term="BigData"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hive 3.xå­¦ä¹ ç¬”è®°(2)]]></title>
        <id>/2022/02/20/Learning-Hive3.x-02</id>
        <link href="https://kayhaw.github.io/blog/2022/02/20/Learning-Hive3.x-02"/>
        <updated>2022-02-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Hive 3.1.2å­¦ä¹ ç¬”è®°(2)ï¼šhiveå‘½ä»¤ä½¿ç”¨å’ŒHiveæ•°æ®ç±»å‹]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“Hive 3.1.2å­¦ä¹ ç¬”è®°ç¬¬2ç¯‡ï¼šhiveå‘½ä»¤ä½¿ç”¨å’ŒHiveæ•°æ®ç±»å‹ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="hiveå‘½ä»¤ä½¿ç”¨">hiveå‘½ä»¤ä½¿ç”¨<a class="hash-link" href="#hiveå‘½ä»¤ä½¿ç”¨" title="Direct link to heading">â€‹</a></h2><p>åœ¨${HIVE_HOME}/binä¸‹æä¾›äº†hiveè„šæœ¬å‘½ä»¤ï¼Œé€šè¿‡æ‰§è¡Œ<code>hive -help</code>å‘½ä»¤å¾—åˆ°å¦‚ä¸‹å¯é€‰å‚æ•°ï¼š</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">kayhaw@hadoop102 bin</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ hive -help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">which: no hbase </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/opt/module/jdk1.8.0_212/bin:/opt/module/hadoop-3.1.3/bin:/opt/module/hadoop-3.1.3/sbin:/opt/module/apache-hive-3.1.2/bin:/home/kayhaw/.local/bin:/home/kayhaw/bin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hive Session ID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 61f38c61-9723-42c3-97c0-5ca19b080c46</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">usage: hive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -d,--define </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">          Variable substitution to apply to Hive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  commands. e.g. -d </span><span class="token assign-left variable" style="color:#36acaa">A</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">B or --define </span><span class="token assign-left variable" style="color:#36acaa">A</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --database </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">databasename</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">     Specify the database to use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -e </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">quoted-query-string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">         SQL from </span><span class="token builtin class-name">command</span><span class="token plain"> line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -f </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">filename</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">                    SQL from files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -H,--help                        Print </span><span class="token builtin class-name">help</span><span class="token plain"> information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --hiveconf </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">property</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   Use value </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> given property</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --hivevar </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">         Variable substitution to apply to Hive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  commands. e.g. --hivevar </span><span class="token assign-left variable" style="color:#36acaa">A</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">filename</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">                    Initialization SQL </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -S,--silent                      Silent mode </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> interactive shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -v,--verbose                     Verbose mode </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">echo executed SQL to the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  console</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ul><li><code>-e</code>å’Œ<code>-f</code>å‚æ•°åˆ†åˆ«ç”¨äºå‘½ä»¤è¡Œè¾“å…¥å’ŒæŒ‡å®šæ–‡ä»¶æ¥æ‰§è¡ŒHQLï¼›</li><li><strong><code>--hiveconf</code>åœ¨å¯åŠ¨hiveå‘½ä»¤æ—¶æŒ‡å®šHiveç¯å¢ƒå˜é‡</strong>ï¼Œä»…åœ¨æœ¬æ¬¡ä¼šè¯ç”Ÿæ•ˆï¼›</li><li>è¾“å…¥<code>quit;</code>æˆ–<code>exit;</code>é€€å‡ºï¼›</li><li><strong>è¾“å…¥<code>dfs</code>å‘½ä»¤æ“ä½œHDFSæ–‡ä»¶ç³»ç»Ÿ</strong>ï¼›</li><li>è¾“å…¥<code>set</code>æŸ¥çœ‹æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼Œè¾“å…¥<code>set &lt;å‚æ•°å&gt;=&lt;å‚æ•°å€¼&gt;</code>ä¿®æ”¹Hiveå‚æ•°å€¼ï¼Œä»…åœ¨è¾“å…¥ä¹‹åæœ¬æ¬¡ä¼šè¯ç”Ÿæ•ˆï¼›</li><li>æ‰€æœ‰æ‰§è¡Œå‘½ä»¤è®°å½•åœ¨<code>${HOME}/.hivehistory</code>æ–‡ä»¶ä¸­ã€‚</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="å…¶ä»–é…ç½®">å…¶ä»–é…ç½®<a class="hash-link" href="#å…¶ä»–é…ç½®" title="Direct link to heading">â€‹</a></h2><ol><li>ä¿®æ”¹Hiveæ—¥å¿—å­˜æ”¾ä½ç½®ï¼šåœ¨<code>${HIVE_HOME}/conf/hive-log4j2.properties.template</code>æ–‡ä»¶ä¸­é»˜è®¤æ—¥å¿—ä½ç½®ä¸º<code>/tmp/kayhaw/hive.log</code>ï¼Œå°†æ”¹æ–‡ä»¶æ‹·è´ä¸º<code>hive-log4j2.properties</code>å¹¶ä¿®æ”¹<code>property.hive.log.dir</code>å‚æ•°å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><div class="codeBlockContainer_I0IT language-properties theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-properties codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># property.hive.log.dir = ${sys:java.io.tmpdir}/${sys:user.name}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">property.hive.log.dir = ${env:HIVE_HOME}/logs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>LOG4J2é…ç½®æ–‡ä»¶ä½¿ç”¨ç¯å¢ƒå˜é‡</h5></div><div class="admonition-content"><p>ä¸€å¼€å§‹æ”¹ä¸º<code>${HIVE_HOME}/logs</code>å‘ç°ä¸ç”Ÿæ•ˆï¼Œå› ä¸ºè¿™æ˜¯propertiesæ–‡ä»¶è€Œä¸æ˜¯shellè„šæœ¬ï¼ŒæŸ¥çœ‹<a href="https://logging.apache.org/log4j/2.x/manual/lookups.html#EnvironmentLookup" target="_blank" rel="noopener noreferrer">Environment Lookup</a>å¯çŸ¥ä½¿ç”¨<code>env:</code>å‰ç¼€è®©LOG4J2æ¥æŸ¥æ‰¾ç¯å¢ƒå˜é‡ã€‚</p></div></div><ol start="2"><li>è®¾ç½®æ‰“å°åº“åå’Œåˆ—åï¼šåœ¨<code>hive-site.xml</code>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</li></ol><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- æ‰“å°åˆ—å --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hive.cli.print.header</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- æ‰“å°åº“å --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hive.cli.print.current.db</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><strong>é…ç½®åŠ è½½é¡ºåºï¼šhive-default.xml-&gt;hive-site.xml-&gt;hiveå‘½ä»¤å¯åŠ¨<code>--hiveconf</code>-&gt;hiveå‘½ä»¤ä¸­<code>set</code>ï¼Œåè€…è¦†ç›–å‰è€…åŒåé…ç½®å‚æ•°ã€‚åä¸¤æ­¥çš„è®¾ç½®ä»…é™äºæœ¬æ¬¡ä¼šè¯ï¼ŒæŸäº›ç³»ç»Ÿå‚æ•°(å¦‚log4j2ç›¸å…³)éœ€è¦é€šè¿‡å‰ä¸¤æ­¥è®¾ç½®ï¼Œå› æ­¤å®ƒä»¬åœ¨ä¼šè¯å»ºç«‹ä¹‹å‰å°±ä¼šè¯»å–é…ç½®ã€‚</strong></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹<a class="hash-link" href="#æ•°æ®ç±»å‹" title="Direct link to heading">â€‹</a></h2><p>è¯¦è§å®˜ç½‘ä¿¡æ¯<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Types" target="_blank" rel="noopener noreferrer">Data Types</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="åŸºæœ¬ç±»å‹">åŸºæœ¬ç±»å‹<a class="hash-link" href="#åŸºæœ¬ç±»å‹" title="Direct link to heading">â€‹</a></h3><table><thead><tr><th>åˆ†ç±»</th><th>åç§°</th><th>é•¿åº¦(å­—èŠ‚)/èŒƒå›´</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>æ•´æ•°</td><td>TINYINT</td><td>1</td><td>æœ‰ç¬¦å·</td></tr><tr><td></td><td>SMALLINT</td><td>2</td><td>æœ‰ç¬¦å·</td></tr><tr><td></td><td>INT <!-- -->[INTEGER]</td><td>4</td><td>æœ‰ç¬¦å·</td></tr><tr><td></td><td>BIGINT</td><td>8</td><td>æœ‰ç¬¦å·</td></tr><tr><td>æµ®ç‚¹æ•°</td><td>FLOAT</td><td>4</td><td>å•ç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td></td><td>DOUBLE <!-- -->[DOUBLE PERCISION]</td><td>8</td><td>åŒç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td></td><td>DECIMAL <!-- -->[NUMERIC]</td><td></td><td>NUMRICè‡ª3.0.0å¼•å…¥</td></tr><tr><td>å­—ç¬¦ä¸²</td><td>STRING</td><td></td><td></td></tr><tr><td></td><td>CHAR</td><td></td><td>since 0.13.0</td></tr><tr><td></td><td>VARCHAR</td><td></td><td>since 0.12.0</td></tr><tr><td>æ—¶é—´æ—¥æœŸ</td><td>TIMESTAMP</td><td></td><td>since 0.8.0</td></tr><tr><td></td><td>DATE</td><td></td><td>since 0.12.0</td></tr><tr><td></td><td>INTERVAL</td><td></td><td>since 1.2.0</td></tr><tr><td>å…¶ä»–</td><td>BOOLEAN</td><td></td><td></td></tr><tr><td></td><td>BINARY</td><td></td><td>since 0.8.0</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¤åˆç±»å‹">å¤åˆç±»å‹<a class="hash-link" href="#å¤åˆç±»å‹" title="Direct link to heading">â€‹</a></h3><p>Hiveæä¾›çš„å¤åˆç±»å‹åŒ…å«æ•°ç»„ã€mapã€structå’Œunionå››ç§ï¼Œå®ƒä»¬ä¹‹é—´å¯ä»¥äº’ç›¸åµŒå¥—å£°æ˜ã€‚</p><table><thead><tr><th>ç±»å‹</th><th>æè¿°</th><th>å£°æ˜è¯­æ³•</th></tr></thead><tbody><tr><td>array</td><td>é€šè¿‡<code>åˆ—å[ä¸‹æ ‡]</code>è·å–å€¼</td><td>ARRAY&lt;data_type&gt;</td></tr><tr><td>map</td><td>é€šè¿‡<code>åˆ—å[key]</code>è·å–å€¼</td><td>MAP&lt;primitive_type, data_type&gt;</td></tr><tr><td>struct</td><td>é€šè¿‡<code>åˆ—å.key</code>è·å–å€¼</td><td>STRUCT&lt;col_name : data_type <!-- -->[COMMENT col_comment]<!-- -->, ...&gt;</td></tr><tr><td>union</td><td>â“</td><td>UNIONTYPE&lt;data_type, data_type, ...&gt;</td></tr></tbody></table><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">å¤åˆç±»å‹ä½¿ç”¨ç¤ºä¾‹</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  friends array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  children map</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  address struct</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">street:string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> city:string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">row</span><span class="token plain"> format delimited </span><span class="token keyword" style="color:#00009f">fields</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">terminated</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">','</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šå­—æ®µåˆ†éš”ç¬¦</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collection items </span><span class="token keyword" style="color:#00009f">terminated</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'_'</span><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šmapã€structå’Œarrayçš„å…ƒç´ åˆ†éš”ç¬¦</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">map </span><span class="token keyword" style="color:#00009f">keys</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">terminated</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">':'</span><span class="token plain">                      </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šmapä¸­keyå’Œvalueçš„åˆ†éš”ç¬¦</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">lines</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">terminated</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'\n'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                       </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šè¡Œåˆ†éš”ç¬¦</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>é»˜è®¤åˆ†éš”ç¬¦</h5></div><div class="admonition-content"><p>Hiveé»˜è®¤è¡Œåˆ†éš”ç¬¦ä¸º<code>'\n'</code>ï¼Œé»˜è®¤å­—æ®µåˆ†éš”ç¬¦ä¸º<code>'\001'</code>(æ˜¾ç¤ºä¸º<code>^A</code>)ï¼Œé»˜è®¤å…ƒç´ åˆ†éš”ç¬¦ä¸º<code>'\002'</code>(æ˜¾ç¤ºä¸º<code>^B</code>)ï¼Œé»˜è®¤kvåˆ†éš”ç¬¦ä¸º<code>'\003'</code>(æ˜¾ç¤ºä¸º<code>^C</code>)ã€‚</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="ç±»å‹è½¬æ¢">ç±»å‹è½¬æ¢<a class="hash-link" href="#ç±»å‹è½¬æ¢" title="Direct link to heading">â€‹</a></h2><p>Hiveçš„ç±»å‹è½¬æ¢åˆ†ä¸ºéšå¼è½¬æ¢å’Œæ˜¾å¼è½¬æ¢ï¼Œå…¶ä¸­éšå¼è½¬æ¢ç”±Hiveè‡ªåŠ¨å®Œæˆï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p><ol><li>æ‰€æœ‰æ•´æ•°ç±»å‹å¯ä»¥éšå¼è½¬ä¸ºèŒƒå›´æ›´å¤§çš„ç±»å‹ï¼›</li><li>æ‰€æœ‰æ•´æ•°ç±»å‹ã€FLOAT å’Œ<strong>STRING</strong>ç±»å‹éƒ½å¯ä»¥éšå¼åœ°è½¬æ¢æˆDOUBLE;</li><li>TINYINTã€SMALLINTå’ŒINTå¯ä»¥è½¬æ¢ä¸ºFLOATï¼›</li><li>BOOLEAN ç±»å‹ä¸å¯ä»¥è½¬æ¢ä¸ºä»»ä½•å…¶å®ƒçš„ç±»å‹ã€‚</li></ol><p>æ˜¾å¼ç±»å‹è½¬æ¢é€šè¿‡<code>CAST</code>å®ç°ï¼Œå¦‚<code>CAST('1' AS INT)</code>æŠŠå­—ç¬¦ä¸²"1"è½¬ä¸ºæ•´æ•°1ï¼Œ<strong>å¦‚æœè½¬æ¢å¤±è´¥åˆ™è¿”å›NULL</strong>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><ol><li>Hiveé…ç½®çš„ä¼˜å…ˆçº§å’ŒåŠ è½½é¡ºåºï¼›</li><li>è®¾ç½®Hiveæ—¥å¿—è·¯å¾„ã€å‘½ä»¤è¡Œæ˜¾ç¤ºåº“åå’Œåˆ—åçš„æ–¹æ³•ï¼›</li><li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Types#LanguageManualTypes-UnionTypesunionUnionTypes" target="_blank" rel="noopener noreferrer">Hiveè¿˜æœªå®Œå…¨æ”¯æŒUNIONTYPE</a>ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</li></ol>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Hive" term="Hive"/>
        <category label="BigData" term="BigData"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hive 3.xå­¦ä¹ ç¬”è®°(1)]]></title>
        <id>/2022/02/19/Learning-Hive3.x-01</id>
        <link href="https://kayhaw.github.io/blog/2022/02/19/Learning-Hive3.x-01"/>
        <updated>2022-02-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Hive 3.1.2å­¦ä¹ ç¬”è®°(1)ï¼šHiveç®€ä»‹ä¸å®‰è£…]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“Hive 3.1.2å­¦ä¹ ç¬”è®°ç¬¬1ç¯‡ï¼šHiveç®€ä»‹ä¸å®‰è£…ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="hiveç®€ä»‹">Hiveç®€ä»‹<a class="hash-link" href="#hiveç®€ä»‹" title="Direct link to heading">â€‹</a></h2><p>Hiveæ˜¯åŸºäºHadoopçš„<strong>æ•°æ®ä»“åº“å·¥å…·(éä¼ ç»Ÿæ„ä¹‰ä¸Šæ•°æ®åº“)</strong>ï¼Œç”±Facebookå¼€æºç”¨äºè§£å†³æµ·é‡ç»“æ„åŒ–æ—¥å¿—ï¼ŒHiveå°†ç»“æ„åŒ–æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºä¸€å¼ è¡¨ï¼Œå¹¶æä¾›ç±»SQL(HQL)æŸ¥è¯¢åŠŸèƒ½ï¼Œå…¶æœ¬è´¨æ˜¯å°†HQLç¿»è¯‘ä¸ºMapReduceç¨‹åºã€‚</p><p>ğŸ˜„ä¼˜ç‚¹ï¼š</p><ol><li>HQLç±»ä¼¼SQLï¼Œä½¿ç”¨èµ·æ¥å®¹æ˜“ä¸Šæ‰‹ï¼›</li><li>é¿å…å†™MRç¨‹åºï¼Œé™ä½å­¦ä¹ æˆæœ¬ï¼›</li><li>æ‰§è¡Œå»¶è¿Ÿé«˜ï¼Œå› æ­¤é€‚ç”¨äºå¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜ä¸”æ•°æ®é‡å¤§çš„åœºæ™¯ï¼›</li><li>æ”¯æŒè‡ªå®šä¹‰å‡½æ•°ã€‚</li></ol><p>ğŸ˜ ç¼ºç‚¹ï¼š</p><ol><li>HQLæ— æ³•è¡¨è¾¾è¿­ä»£å¼ç®—æ³•ï¼Œå—é™äºMapReduceæµç¨‹ï¼›</li><li>æ‰§è¡Œæ•ˆç‡ä½ï¼Œç”ŸæˆMapReduceä½œä¸šä¸å¤Ÿæ™ºèƒ½åŒ–ï¼›</li><li>è°ƒä¼˜å›°éš¾ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="hiveæ¶æ„">Hiveæ¶æ„<a class="hash-link" href="#hiveæ¶æ„" title="Direct link to heading">â€‹</a></h3><p>ä¸Metastoreäº¤äº’è·å–æ•°æ®æ–‡ä»¶åœ¨HDFSä¸Šçš„ä½ç½®ï¼Œç¼–å†™çš„HQLä¾æ¬¡ç»è¿‡è§£æå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨å’Œæ‰§è¡Œå™¨ç¿»è¯‘ä¸ºMapReduceç¨‹åºæ‰§è¡Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><ul><li><strong>è§£æå™¨</strong>ï¼šå°†HQLè½¬ä¸ºä¸ºæŠ½è±¡è¯­æ³•æ ‘ASTï¼Œå¹¶è¿›è¡Œè¯­æ³•åˆ†æï¼›</li><li><strong>ç¼–è¯‘å™¨</strong>ï¼šç”±ASTç”Ÿæˆé€»è¾‘æ‰§è¡Œè®¡åˆ’ï¼›</li><li><strong>ä¼˜åŒ–å™¨</strong>ï¼šä¼˜åŒ–é€»è¾‘æ‰§è¡Œè®¡åˆ’ï¼›</li><li><strong>æ‰§è¡Œå™¨</strong>ï¼šå°†é€»è¾‘æ‰§è¡Œè®¡åˆ’è½¬ä¸ºå¯ä»¥è¿è¡Œçš„ç‰©ç†è®¡åˆ’(MapReduce/Sparkç¨‹åº)ã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="hiveç‰¹æ€§">Hiveç‰¹æ€§<a class="hash-link" href="#hiveç‰¹æ€§" title="Direct link to heading">â€‹</a></h3><ol><li><strong>æ•°æ®æ›´æ–°</strong>ï¼šHiveä¸ºæ•°æ®ä»“åº“è€Œè®¾è®¡ï¼Œé€‚ç”¨è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œå› æ­¤Hive<strong>ä¸å»ºè®®</strong>æ”¹å†™æ•°æ®ï¼Œè€Œä¼ ç»Ÿæ•°æ®åº“ç»å¸¸ä¿®æ”¹ï¼›</li><li><strong>æ‰§è¡Œå»¶è¿Ÿ</strong>ï¼šHiveæŸ¥è¯¢æ•°æ®æ—¶æ²¡æœ‰ç´¢å¼•éœ€è¦æ‰«ææ•´ä¸ªè¡¨ï¼Œå¹¶ä¸”MapReduceæ¡†æ¶ä¹Ÿæœ‰è¾ƒé«˜å»¶è¿Ÿï¼›ä½†åœ¨å¤§è§„æ¨¡æ•°æ®ä¸‹æ‰èƒ½ä½“ç°Hiveä¼˜åŠ¿ï¼›</li><li><strong>æ•°æ®è§„æ¨¡</strong>ï¼šHiveåŸºäºHadoopé›†ç¾¤å¯ä»¥å¤„ç†å¤§è§„æ¨¡æ•°æ®</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="hiveå®‰è£…">Hiveå®‰è£…<a class="hash-link" href="#hiveå®‰è£…" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="å®‰è£…åŒ…">å®‰è£…åŒ…<a class="hash-link" href="#å®‰è£…åŒ…" title="Direct link to heading">â€‹</a></h3><ol><li><a href="http://archive.apache.org/dist/hive/hive-3.1.2/apache-hive-3.1.2-bin.tar.gz" target="_blank" rel="noopener noreferrer">apache-hive-3.1.2-bin.tar.gz</a></li><li><a href="https://downloads.mysql.com/archives/community/" target="_blank" rel="noopener noreferrer">mysql-5.7.28-1.el7.x86_64.rpm-bundle.tar</a></li></ol><img loading="lazy" style="width:80%;height:80%" src="/img/blog/HiveNotes/mysql-5.7.28-bundle.png" title="mysql-5.7.28-1.el7.x86_64.rpm-bundle.tar" class="img_E7b_"><ol start="3"><li><a href="https://downloads.mysql.com/archives/c-j/" target="_blank" rel="noopener noreferrer">mysql-connector-java-5.1.37.tar.gz</a></li></ol><img loading="lazy" style="width:80%;height:80%" src="/img/blog/HiveNotes/mysql-connector-java-5.1.37.png" title="mysql-connector-java-5.1.37" class="img_E7b_"><h3 class="anchor anchorWithStickyNavbar_mojV" id="å®‰è£…æ­¥éª¤">å®‰è£…æ­¥éª¤<a class="hash-link" href="#å®‰è£…æ­¥éª¤" title="Direct link to heading">â€‹</a></h3><ol><li>å°†apache-hive-3.1.2-bin.tar.gzè§£å‹åˆ°/opt/moduleç›®å½•ä¸‹ï¼Œå¹¶é‡å‘½åä¸ºapache-hive-3.1.2ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> -zxvf /opt/software/apache-hive-3.1.2-bin.tar.gz -C /opt/module/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> /opt/module/apache-hive-3.1.2-bin/ /opt/module/apache-hive-3.1.2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="2"><li>æ·»åŠ å¦‚ä¸‹ç¯å¢ƒå˜é‡å¹¶ä½¿ä¹‹ç”Ÿæ•ˆ(<strong><code>source /etc/profile.d/my_env.sh</code></strong>)ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">/etc/profile.d/my_env.sh</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># HIVE_HOME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">HIVE_HOME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/opt/module/apache-hive-3.1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$HIVE_HOME</span><span class="token plain">/bin</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="3"><li>è§£å†³æ—¥å¿—jaråŒ…å†²çªï¼Œå°†å…¶é‡å‘½åä½¿ä¹‹æ— æ³•åŠ è½½ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$HIVE_HOME</span><span class="token plain">/lib/log4j-slf4j-impl-2.10.0.jar </span><span class="token variable" style="color:#36acaa">$HIVE_HOME</span><span class="token plain">/lib/log4j-slf4j-impl-2.10.0.bak</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="åˆè¯•hive">åˆè¯•Hive<a class="hash-link" href="#åˆè¯•hive" title="Direct link to heading">â€‹</a></h3><ol><li><strong>åˆå§‹åŒ–å…ƒæ•°æ®åº“</strong>ï¼š<code>schematool -dbType derby -initSchema</code>ï¼›</li><li>å¯åŠ¨hiveï¼Œç›´æ¥è¾“å…¥<code>hive</code>å³å¯ï¼Œäº¤äº’ç•Œé¢ç±»ä¼¼MySQLå®¢æˆ·ç«¯å¯ä»¥æ‰§è¡ŒHQLï¼›</li><li>æ–°å»ºsshä¼šè¯ä¹Ÿæ‰§è¡Œ<code>hive</code>å‘½ä»¤ï¼Œå‘ç°å¦‚ä¸‹æŠ¥é”™ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Caused by: ERROR XSDB6: Another instance of Derby may have already booted </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">the database /opt/module/hive/metastore_db.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> at </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.apache.derby.iapi.error.StandardException.newException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Unknown </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> at </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.apache.derby.iapi.error.StandardException.newException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Unknown Source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> at </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.apache.derby.impl.store.raw.data.BaseDataFileFactory.privGetJBMSLockO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nDB</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Unknown Source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> at </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.apache.derby.impl.store.raw.data.BaseDataFileFactory.run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Unknown </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ç”±äºHiveé»˜è®¤ä½¿ç”¨derbyä½œä¸ºå…ƒæ•°æ®åº“ï¼Œä½†æ­¤æ—¶ä¸æ”¯æŒå…¶ä»–ä¼šè¯çš„å…±äº«ï¼Œå› æ­¤æ¥ä¸‹æ¥å°†å…ƒæ•°æ®åº“ç”±derbyæ”¹ä¸ºMySQLã€‚</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>åˆæ¬¡å¯åŠ¨æŠ¥é”™</h5></div><div class="admonition-content"><p>åˆæ¬¡å¯åŠ¨æ—¶æŠ¥å¦‚ä¸‹é”™è¯¯ï¼ŒåŸå› æ˜¯Hadoopå’ŒHiveä¸­guavaç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œå°†<code>${HADOOP_HOME}/share/hadoop/common/lib/</code>ä¸‹çš„é«˜ç‰ˆæœ¬jarå¤åˆ¶åˆ°<code>${HIVE_HOME}/lib/</code>ä¸‹å¹¶å°†ä½ç‰ˆæœ¬jaråŒ…åˆ é™¤ã€‚</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Exception </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> thread </span><span class="token string" style="color:#e3116c">"main"</span><span class="token plain"> java.lang.NoSuchMethodError: com.google.common.base.Preconditions.checkArgument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ZLjava/lang/String</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">Ljava/lang/Object</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">V</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.hadoop.conf.Configuration.set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Configuration.java:1357</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.hadoop.conf.Configuration.set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Configuration.java:1338</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.hadoop.mapred.JobConf.setJar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">JobConf.java:518</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.hadoop.mapred.JobConf.setJarByClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">JobConf.java:536</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.hadoop.mapred.JobConf.</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">init</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">JobConf.java:430</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.hadoop.hive.conf.HiveConf.initialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HiveConf.java:5141</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.hadoop.hive.conf.HiveConf.</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">init</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HiveConf.java:5104</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.hive.beeline.HiveSchemaTool.</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">init</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HiveSchemaTool.java:96</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.hive.beeline.HiveSchemaTool.main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HiveSchemaTool.java:1473</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at sun.reflect.NativeMethodAccessorImpl.invoke0</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Native Method</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at sun.reflect.NativeMethodAccessorImpl.invoke</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NativeMethodAccessorImpl.java:62</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at sun.reflect.DelegatingMethodAccessorImpl.invoke</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DelegatingMethodAccessorImpl.java:43</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.lang.reflect.Method.invoke</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Method.java:498</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.hadoop.util.RunJar.run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">RunJar.java:318</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.hadoop.util.RunJar.main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">RunJar.java:232</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ›´æ¢å…ƒæ•°æ®åº“">æ›´æ¢å…ƒæ•°æ®åº“<a class="hash-link" href="#æ›´æ¢å…ƒæ•°æ®åº“" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤å®‰è£…MySQLï¼š</p><ol><li>æ£€æŸ¥å¹¶åˆ é™¤CentOSè‡ªå¸¦çš„Mariadbç›¸å…³ä¾èµ–ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rpm</span><span class="token plain"> -qa</span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> mariadb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rpm</span><span class="token plain"> -e --nodeps mariadb-libs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="2"><li>è§£å‹mysql-5.7.28-1.el7.x86_64.rpm-bundle.tarï¼Œå¾—åˆ°å¤šä¸ªrmpåŒ…å¹¶å®‰è£…ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> -xf mysql-5.7.28-1.el7.x86_64.rpm-bundle.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## æŒ‰åºæ‰§è¡Œï¼Œåé¢çš„ä¾èµ–äºå‰é¢</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rpm</span><span class="token plain"> -ivh mysql-community-common-5.7.28-1.el7.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rpm</span><span class="token plain"> -ivh mysql-community-libs-5.7.28-1.el7.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rpm</span><span class="token plain"> -ivh mysql-community-libs-compat-5.7.28-1.el7.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rpm</span><span class="token plain"> -ivh mysql-community-client-5.7.28-1.el7.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rpm</span><span class="token plain"> -ivh mysql-community-server-5.7.28-1.el7.x86_64.rpm</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="3"><li>åˆ é™¤<code>/etc/my.cnf</code>æ–‡ä»¶ä¸­datadirå‚æ•°æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹</li><li>åˆå§‹åŒ–MySQLæ•°æ®åº“ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> mysqld --initialize --user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mysql</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="5"><li>åœ¨MySQLæ—¥å¿—ä¸­æ‰¾åˆ°ç”Ÿæˆçš„rootå¯†ç (æœ¬æ¬¡ä¸º<code>Mzn7/gl.i!-4</code>)ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /var/log/mysqld.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-18T10:29:24.176884Z </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Warning</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">see documentation </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">more</span><span class="token plain"> details</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-18T10:29:24.545101Z </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Warning</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> InnoDB: New log files created, </span><span class="token assign-left variable" style="color:#36acaa">LSN</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">45790</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-18T10:29:24.593907Z </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Warning</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> InnoDB: Creating foreign key constraint system tables.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-18T10:29:24.655737Z </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Warning</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> No existing UUID has been found, so we assume that this is the first </span><span class="token function" style="color:#d73a49">time</span><span class="token plain"> that this server has been started. Generating a new UUID: a49026e8-90a5-11ec-af0f-000c293a2d67.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-18T10:29:24.658007Z </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Warning</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Gtid table is not ready to be used. Table </span><span class="token string" style="color:#e3116c">'mysql.gtid_executed'</span><span class="token plain"> cannot be opened.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-18T10:29:25.387668Z </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Warning</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> CA certificate ca.pem is self signed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-18T10:29:26.020911Z </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Note</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> A temporary password is generated </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> root@localhost: Mzn7/gl.i</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">-4</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="6"><li>å¯åŠ¨MySQLæœåŠ¡ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl start mysqld</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="7"><li>ä¿®æ”¹rootå¯†ç ä¸º<code>root123</code>å¹¶è®¾ç½®rootè´¦å·ä»¥ä»»æ„ipç™»å½•ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">kayhaw@hadoop102 module</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ mysql -u root -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter password: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">è¾“å…¥Mzn7/gl.i</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">-4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> password </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> password</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"root123"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> update mysql.user </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'%'</span><span class="token plain"> where </span><span class="token assign-left variable" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'root'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> flush privileges</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ç°åœ¨MySQLå·²ç»é…ç½®å¥½äº†ï¼Œæ¥ä¸‹æ¥è¿›è¡ŒHiveç›¸å…³é…ç½®ï¼š</p><ol><li>å°†MySQL JDBCé©±åŠ¨æ‹·è´åˆ°Hiveçš„libç›®å½•ä¸‹ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> -zxvf mysql-connector-java-5.1.37.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> mysql-connector-java-5.1.37/mysql-connector-java-5.1.37-bin.jar </span><span class="token variable" style="color:#36acaa">$HIVE_HOME</span><span class="token plain">/lib</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="2"><li>åœ¨<code>$HIVE_HOME/conf</code>ç›®å½•ä¸‹æ–°å»º<code>hive-site.xml</code>æ–‡ä»¶å¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</li></ol><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">$HIVE_HOME/conf/hive-site.xml</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version="1.0"?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- jdbc è¿æ¥çš„ URL --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">javax.jdo.option.ConnectionURL</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jdbc:mysql://hadoop102:3306/metastore?useSSL=false</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- jdbc è¿æ¥çš„ Driver--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">javax.jdo.option.ConnectionDriverName</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.mysql.jdbc.Driver</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- jdbc è¿æ¥çš„ username--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">javax.jdo.option.ConnectionUserName</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">root</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- jdbc è¿æ¥çš„ password --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">javax.jdo.option.ConnectionPassword</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">root123</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Hive å…ƒæ•°æ®å­˜å‚¨ç‰ˆæœ¬çš„éªŒè¯ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hive.metastore.schema.verification</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">false</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--å…ƒæ•°æ®å­˜å‚¨æˆæƒ--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hive.metastore.event.db.notification.api.auth</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">false</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Hive é»˜è®¤åœ¨ HDFS çš„å·¥ä½œç›®å½• --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hive.metastore.warehouse.dir</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">/user/hive/warehouse</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="3"><li>ç™»å½•MySQLå¹¶åˆ›å»ºHiveå…ƒæ•°æ®åº“<code>metastore</code>ï¼Œ<strong>æ³¨æ„åç§°å’Œé…ç½®æ–‡ä»¶ä¸­çš„ä¿æŒä¸€è‡´</strong>ã€‚</li><li>åˆå§‹åŒ–Hiveå…ƒæ•°æ®åº“ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">schematool -initSchema -dbType mysql -verbose</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¼€å¯metastoreæœåŠ¡">å¼€å¯metastoreæœåŠ¡<a class="hash-link" href="#å¼€å¯metastoreæœåŠ¡" title="Direct link to heading">â€‹</a></h3><p>åˆ°ç›®å‰ä¸ºæ­¢åªæ˜¯åœ¨æœ¬åœ°ä½¿ç”¨hiveå‘½ä»¤å¼€å¯ä¼šè¯è¿›è¡Œäº¤äº’ï¼Œæ¥ä¸‹æ¥å¼€å¯å…ƒæ•°æ®æœåŠ¡è®©è¿œç¨‹å®¢æˆ·ç«¯èƒ½å¤Ÿè®¿é—®HiveæœåŠ¡ï¼›</p><ol><li><code>hive-site.xml</code>æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</li></ol><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">$HIVE_HOME/conf/hive-site.xml</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- æŒ‡å®šå­˜å‚¨å…ƒæ•°æ®è¦è¿æ¥çš„åœ°å€ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hive.metastore.uris</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">thrift://hadoop102:9083</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="2"><li>å¯åŠ¨metastoreæœåŠ¡ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">kayhaw@hadoop102 conf</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ hive --service metastore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-19 </span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:32:28: Starting Hive Metastore Server</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>æ³¨æ„å‘½ä»¤å¼€å¯å‰å°è¿›ç¨‹æœåŠ¡ï¼Œä¸èƒ½é€€å‡ºï¼Œæ­¤æ—¶é€šè¿‡<code>hive</code>å‘½ä»¤è®¿é—®çš„å…ƒæ•°æ®æœåŠ¡ç”±hadoop102:9083æä¾›ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¼€å¯hiveserver2æœåŠ¡">å¼€å¯hiveserver2æœåŠ¡<a class="hash-link" href="#å¼€å¯hiveserver2æœåŠ¡" title="Direct link to heading">â€‹</a></h3><p>ä¸ºäº†è®©è¿œç¨‹å®¢æˆ·ç«¯èƒ½ä»¥JDBCæ–¹å¼è®¿é—®Hiveï¼Œè¿˜éœ€è¦å¼€å¯hiveserver2æœåŠ¡ï¼š</p><ol><li><code>hive-site.xml</code>æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</li></ol><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">$HIVE_HOME/conf/hive-site.xml</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- æŒ‡å®š hiveserver2 è¿æ¥çš„ host --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hive.server2.thrift.bind.host</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hadoop102</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- æŒ‡å®š hiveserver2 è¿æ¥çš„ç«¯å£å· --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hive.server2.thrift.port</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">10000</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="2"><li>å¯åŠ¨hiveserver2æœåŠ¡ï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">kayhaw@hadoop102 conf</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ hive --service metastore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-19 </span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:32:28: Starting Hive Metastore Server</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="3"><li>ä½¿ç”¨beelineè¿æ¥hiveï¼š</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">beeline -u jdbc:hive2://hadoop102:10000 -n kayhaw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to jdbc:hive2://hadoop102:10000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connected to: Apache Hive </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token number" style="color:#36acaa">3.1</span><span class="token plain">.2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Driver: Hive JDBC </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token number" style="color:#36acaa">3.1</span><span class="token plain">.2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Transaction isolation: TRANSACTION_REPEATABLE_READ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Beeline version </span><span class="token number" style="color:#36acaa">3.1</span><span class="token plain">.2 by Apache Hive</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è¿™é‡Œé€šè¿‡beelineè¿æ¥Hiveæ—¶æŠ¥é”™<code>Error: Could not open client transport with JDBC Uri: jdbc:hive2://hadoop102:10000: Failed to open new session: java.lang.RuntimeException</code>ï¼Œéœ€è¦ä¿®æ”¹Hadoopä¸­çš„core-site.xmlæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹å<strong>é‡å¯HadoopæœåŠ¡</strong>ã€‚</p><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- kayhawæ¢æˆå®é™…ç™»å½•ç”¨æˆ·å --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hadoop.proxyuser.kayhaw.hosts</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">*</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hadoop.proxyuser.kayhaw.groups</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">*</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¯åŠ¨æœåŠ¡è„šæœ¬">å¯åŠ¨æœåŠ¡è„šæœ¬<a class="hash-link" href="#å¯åŠ¨æœåŠ¡è„šæœ¬" title="Direct link to heading">â€‹</a></h3><p>ä¸ºäº†å¿«é€Ÿå¯åŠ¨metastoreå’Œhiveserver2æœåŠ¡ï¼Œå°è£…å¦‚ä¸‹è„šæœ¬ï¼š</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">$HOME/bin/hiveservice.sh</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">HIVE_LOG_DIR</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$HIVE_HOME</span><span class="token plain">/logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> -d </span><span class="token variable" style="color:#36acaa">$HIVE_LOG_DIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p </span><span class="token variable" style="color:#36acaa">$HIVE_LOG_DIR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#æ£€æŸ¥è¿›ç¨‹æ˜¯å¦è¿è¡Œæ­£å¸¸ï¼Œå‚æ•° 1 ä¸ºè¿›ç¨‹åï¼Œå‚æ•° 2 ä¸ºè¿›ç¨‹ç«¯å£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function-name function" style="color:#d73a49">check_process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">pid</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">ps</span><span class="token variable" style="color:#36acaa"> -ef </span><span class="token variable operator file-descriptor important" style="color:#393A34">2</span><span class="token variable operator" style="color:#393A34">&gt;</span><span class="token variable" style="color:#36acaa">/dev/null </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> -v </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> -i $1 </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">'{print $2}'</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ppid</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">netstat</span><span class="token variable" style="color:#36acaa"> -nltp </span><span class="token variable operator file-descriptor important" style="color:#393A34">2</span><span class="token variable operator" style="color:#393A34">&gt;</span><span class="token variable" style="color:#36acaa">/dev/null </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> $2 </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">'{print $7}'</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">cut</span><span class="token variable" style="color:#36acaa"> -d </span><span class="token variable string" style="color:#e3116c">'/'</span><span class="token variable" style="color:#36acaa"> -f </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$pid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$pid</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=~</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$ppid</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$ppid</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function-name function" style="color:#d73a49">hive_start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">metapid</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">check_process HiveMetastore </span><span class="token variable number" style="color:#36acaa">9083</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">cmd</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"nohup hive --service metastore &gt;</span><span class="token string variable" style="color:#36acaa">$HIVE_LOG_DIR</span><span class="token string" style="color:#e3116c">/metastore.log 2&gt;&amp;1 &amp;"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> -z </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$metapid</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">eval</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$cmd</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Metastroe æœåŠ¡å·²å¯åŠ¨"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">server2pid</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">check_process HiveServer2 </span><span class="token variable number" style="color:#36acaa">10000</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">cmd</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"nohup hiveserver2 &gt;</span><span class="token string variable" style="color:#36acaa">$HIVE_LOG_DIR</span><span class="token string" style="color:#e3116c">/hiveServer2.log 2&gt;&amp;1 &amp;"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> -z </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$server2pid</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">eval</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$cmd</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"HiveServer2 æœåŠ¡å·²å¯åŠ¨"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function-name function" style="color:#d73a49">hive_stop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">metapid</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">check_process HiveMetastore </span><span class="token variable number" style="color:#36acaa">9083</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$metapid</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$metapid</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Metastore æœåŠ¡æœªå¯åŠ¨"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">server2pid</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">check_process HiveServer2 </span><span class="token variable number" style="color:#36acaa">10000</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$server2pid</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$server2pid</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"HiveServer2 æœåŠ¡æœªå¯åŠ¨"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">"start"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> hive_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">"stop"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> hive_stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">"restart"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> hive_stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> hive_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">"status"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> check_process HiveMetastore </span><span class="token number" style="color:#36acaa">9083</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/dev/null </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Metastore æœåŠ¡è¿è¡Œæ­£å¸¸"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Metastore æœåŠ¡è¿è¡Œå¼‚å¸¸"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> check_process HiveServer2 </span><span class="token number" style="color:#36acaa">10000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/dev/null </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"HiveServer2 æœåŠ¡è¿è¡Œæ­£å¸¸"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"HiveServer2 æœåŠ¡è¿è¡Œå¼‚å¸¸"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> Invalid Args</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Usage: '</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">basename</span><span class="token variable" style="color:#36acaa"> $0</span><span class="token variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">' start|stop|restart|status'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">esac</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><ol><li>å®‰è£…Hiveä¹‹å‰éœ€è¦æ­å»ºHadoopç¯å¢ƒï¼Œå¯åŠ¨HiveæœåŠ¡å‰ç¡®ä¿HadoopæœåŠ¡å¯åŠ¨ï¼›</li><li>metastoreæœåŠ¡ç”¨äºè¿œç¨‹è®¿é—®HiveæœåŠ¡ï¼Œhiveserver2æœåŠ¡ç”¨äºJDBCè®¿é—®HiveæœåŠ¡ï¼Œåè€…ä¾èµ–äºå‰è€…ï¼›</li><li>å®‰è£…å¯åŠ¨Hiveæ—¶çš„ä¸€äº›å°é—®é¢˜ï¼šåŒ…ç‰ˆæœ¬å·®å¼‚ã€core-site.xmlæ–‡ä»¶ç­‰ï¼›</li><li>å¦‚æœé…ç½®äº†<code>hive.metastore.uris</code>å‚æ•°ï¼Œå°±ä¸€å®šè¦å¼€å¯metaserveræœåŠ¡ã€‚</li></ol>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Hive" term="Hive"/>
        <category label="BigData" term="BigData"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[2022å¹´2æœˆä»½å·¥ä½œæ€»ç»“]]></title>
        <id>/2022/02/19/WorkJournal</id>
        <link href="https://kayhaw.github.io/blog/2022/02/19/WorkJournal"/>
        <updated>2022-02-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[2021å¹´2æœˆä»½å·¥ä½œæ€»ç»“]]></summary>
        <content type="html"><![CDATA[<p>ä»2021å¹´9æœˆä»½åˆ°2022å¹´2æœˆä»½çš„å·¥ä½œæ—¥å¿—æ€»ç»“</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ—¥å¸¸">æ—¥å¸¸ğŸ¤¡<a class="hash-link" href="#æ—¥å¸¸" title="Direct link to heading">â€‹</a></h2><p>æµ‹è¯•äººå‘˜å‘ç°é¡¹ç›®å‡çº§åï¼Œä»¥å‰è·‘çš„ä»»åŠ¡è¿è¡Œæ—¥å¿—æ²¡æœ‰æ•°æ®äº†ï¼Œä½†æ˜¯ç°åœ¨éªŒè¯çš„ä»»åŠ¡å¯ä»¥çœ‹åˆ°è¿è¡Œæ—¥å¿—ã€‚ä½¿ç”¨CerebroæŸ¥è¯¢æ•°æ®åå‘ç°ESä¸­ç¡®å®æ²¡æœ‰è¿è¡Œæ—¥å¿—ï¼Œå¯ä»¥ç¡®è®¤ESè¿ç§»æ²¡æœ‰æŠŠæ•°æ®è½¬è¿‡æ¥ï¼Œæˆ–è€…ESé…ç½®åªä¿ç•™æœ€è¿‘Nå¤©çš„æ—¥å¿—ã€‚é‚å°†BUGæ ‡è®°ä¸ºå¤–éƒ¨åŸå› ï¼Œè®©æµ‹è¯•å»é—®è¿ç»´ã€‚æ¥ä¸‹æ¥ç®€å•è®²ä¸‹æ€ä¹ˆä½¿ç”¨Cerebroæ¥æŸ¥è¯¢ESæ—¥å¿—ã€‚</p><p>ä¸‹è½½<a href="https://github.com/lmenezes/cerebro/releases" target="_blank" rel="noopener noreferrer">Cerebroå‹ç¼©åŒ…</a>ï¼Œè§£å‹ååŒå‡»è¿›å…¥binç›®å½•åŒå‡»<code>cerebro.bat</code>æ–‡ä»¶ã€‚å¼¹å‡ºé»‘æ¡†æ˜¾ç¤ºå¦‚ä¸‹å†…å®¹è¡¨ç¤ºæœåŠ¡å¯åŠ¨ï¼Œç„¶ååœ¨æµè§ˆå™¨è¾“å…¥<code>http://localhost:9000</code>å¼€å§‹ä½¿ç”¨ã€‚</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> play.api.Play - Application started </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Prod</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">no global state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> p.c.s.AkkaHttpServer - Listening </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> HTTP on /0:0:0:0:0:0:0:0:9000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><strong>ç„¶ååœ¨å¼€ç€CerebroæœåŠ¡çš„æƒ…å†µä¸‹å°è¯•åœ¨æœ¬åœ°èµ·åŒæ­¥å¼•æ“æœåŠ¡ï¼Œä½†æ˜¯æœåŠ¡ç«¯å£å·ä¹Ÿæ˜¯9000ï¼Œå¯¼è‡´é¡¹ç›®å¯åŠ¨å¤±è´¥</strong>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ä»»åŠ¡è¿è¡Œæ—¶é—´è¶…é•¿">ä»»åŠ¡è¿è¡Œæ—¶é—´è¶…é•¿<a class="hash-link" href="#ä»»åŠ¡è¿è¡Œæ—¶é—´è¶…é•¿" title="Direct link to heading">â€‹</a></h2><p>æŸé¡¹ç›®å¾®æœåŠ¡å‡çº§ï¼ŒåŒæ­¥å¼•æ“æ‰§è¡ŒèŠ‚ç‚¹å’ŒåŒæ­¥å¼•æ“provideræœåŠ¡éƒ½è¿ç§»åˆ°äº†å¦ä¸€ä¸ªipåœ°å€ï¼Œä½†æ˜¯è¿ç§»çš„æ—¶å€™è¿˜æœ‰ä»»åŠ¡åœ¨è¿è¡Œï¼Œä»»åŠ¡å®ŒæˆåprovideræœåŠ¡å›è°ƒæ›´æ–°ä»»åŠ¡çŠ¶æ€ï¼Œä½†æ›´æ–°çš„æ˜¯æ—§ä¸šåŠ¡åº“ï¼Œæ–°ä¸šåŠ¡åº“ä¸€ç›´æ²¡æœ‰å¾—åˆ°æ›´æ–°ï¼Œå› æ­¤ä¸€ç›´æ˜¾ç¤ºè¿è¡Œä¸­å¯¼è‡´è¿è¡Œæ—¶é—´è¶…é•¿ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="è„æ•°æ®å’Œè„ä»£ç ">è„æ•°æ®å’Œè„ä»£ç <a class="hash-link" href="#è„æ•°æ®å’Œè„ä»£ç " title="Direct link to heading">â€‹</a></h2><p>ä»»åŠ¡ä¿¡æ¯å¯¼å‡ºä¸ºExcelæ–‡ä»¶ï¼Œè¯¥æ–¹æ³•æ‰§è¡Œæ—¶é‡åˆ°è„æ•°æ®å­—æ®µä¸ºç©ºæŠ›å‡ºäº†ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä½†æ˜¯ä»£ç æ²¡æœ‰catchå¼‚å¸¸è€Œæ˜¯ç›´æ¥åœ¨finalå—ä¸­å…³é—­è¾“å‡ºæµï¼Œå¯¼è‡´å‰ç«¯ä¸‹è½½çš„Excelæ–‡ä»¶æ ¼å¼æŸåä¸èƒ½æ‰“å¼€(çœ‹èµ·æ¥æ–‡ä»¶èƒ½ä¸‹è½½ä½†å°±æ˜¯æ‰“ä¸å¼€)ã€‚è§£å†³æ–¹æ¡ˆï¼šåœ¨å†™Excelæ–‡ä»¶æ—¶åˆ¤æ–­æ˜¯å¦æœ‰è„æ•°æ®ï¼Œæœ‰çš„è¯ç›´æ¥è·³è¿‡ã€‚</p><p>Redis Database(RDB)æ–¹å¼Redisæ¯éš”ä¸€æ®µæ—¶é—´å°†å†…å­˜ä¸­æ•°æ®é›†ä¸­å†™å…¥ç£ç›˜å¿«ç…§ï¼Œæ¢å¤æ—¶å°†å¿«ç…§æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ã€‚è¯¥å¿«ç…§æ–‡ä»¶åé»˜è®¤ä¸ºdump.rdbï¼Œä½¿ç”¨redis-serverå¯åŠ¨redisæœåŠ¡æ—¶ï¼Œä¼šåœ¨<strong>å½“å‰ç›®å½•ç”Ÿæˆ</strong>dump.rdbæ–‡ä»¶ï¼Œåœ¨redis.confä¸­ä¸rdbç›¸å…³çš„é…ç½®æœ‰ï¼š</p><ol><li>dirï¼šrbdæ–‡ä»¶ç›®å½•</li><li>dbfilenameï¼šrdbæ–‡ä»¶å
3</li></ol>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Work Journal" term="Work Journal"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[è®¡ç®—æœºç½‘ç»œçŸ¥è¯†æ€»ç»“(1)]]></title>
        <id>/2022/02/15/NetworkingSummary-01</id>
        <link href="https://kayhaw.github.io/blog/2022/02/15/NetworkingSummary-01"/>
        <updated>2022-02-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[è®¡ç®—æœºç½‘ç»œçŸ¥è¯†æ€»ç»“(1)ï¼šTCP/IP]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“è®¡ç®—æœºç½‘ç»œçŸ¥è¯†æ€»ç»“(1)ï¼šTCP/IPã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ä¼ è¾“å±‚">ä¼ è¾“å±‚<a class="hash-link" href="#ä¼ è¾“å±‚" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="tcp3æ¬¡æ¡æ‰‹">TCP3æ¬¡æ¡æ‰‹<a class="hash-link" href="#tcp3æ¬¡æ¡æ‰‹" title="Direct link to heading">â€‹</a></h3><p>3æ¬¡æ¡æ‰‹æŒ‡å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹TCPè¿æ¥çš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><ol><li>Clientå‘Serverå‘é€è¯·æ±‚è¿æ¥æŠ¥æ–‡(æ ‡å¿—ä½SYN=1ï¼Œåºåˆ—å·seqnum=xï¼Œxä¸ºéšæœºæ•°)ï¼Œå‘é€åClientè¿›å…¥<code>SYN_SENT</code>çŠ¶æ€ï¼›</li><li>Serveræ¥æ”¶åˆ°SYN=1çš„TCPæŠ¥æ–‡ï¼Œå›å¤ç¡®è®¤æŠ¥æ–‡(æ ‡å¿—ä½SYN=1ï¼ŒACK=1ï¼Œack=x+1ï¼Œseqnum=yï¼Œyä¸ºéšæœºæ•°)ï¼Œå‘é€åServerè¿›å…¥<code>SYN_RCVD</code>çŠ¶æ€ï¼›</li><li>Clientæ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ï¼Œæ£€æŸ¥acknumæ˜¯å¦ä¸ºx+1ï¼ŒACKæ˜¯å¦ä¸º1ï¼Œå¦‚æœæ­£ç¡®åˆ™æ¢å¤ç¡®è®¤æŠ¥æ–‡(ACK=1ï¼Œack=y+1)ï¼Œå‘é€åClientè¿›å…¥<code>ESTABLISHED</code>çŠ¶æ€ï¼›Serveræ”¶åˆ°Clientçš„å›å¤æŠ¥æ–‡åä¹Ÿæ£€æŸ¥ACKä¸º1å’Œackä¸ºy+1ï¼Œæ­£ç¡®åˆ™Serverè¿›å…¥<code>ESTABLISHED</code>çŠ¶æ€ã€‚</li></ol><p>å¤§å†™çš„ACKè¡¨ç¤ºæ ‡å¿—ä½ï¼Œå°å†™çš„ackè¡¨ç¤ºç¡®è®¤å·ã€‚</p><p>â“ <strong>3æ¬¡æ¡æ‰‹æ˜¯å¦å¯ä»¥å‡ä¸º2æ¬¡æ¡æ‰‹</strong>ï¼šä¸å¯ä»¥ã€‚3æ¬¡æ¡æ‰‹æ˜¯è¿æ¥åŒæ–¹äº’ç›¸å‘ŠçŸ¥åºåˆ—å·ackå¹¶ç¡®è®¤çš„è¿‡ç¨‹ï¼Œå¦‚æœåªæœ‰2æ¬¡æ¡æ‰‹ï¼Œåˆ™åªæœ‰è¿æ¥å‘èµ·æ–¹çš„åºåˆ—å·è¢«ç¡®è®¤ï¼Œç”±æ­¤äº§ç”Ÿé—®é¢˜ï¼šå·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚åˆä¼ åˆ°äº†Serverï¼ŒæœåŠ¡å™¨è®¤ä¸ºæ˜¯Clientå‘é€è¿æ¥è¯·æ±‚é©¬ä¸Šå»ºç«‹è¿æ¥ï¼Œç„¶åå‘é€ç¡®è®¤æŠ¥æ–‡ï¼Œä½†Clientä¸ä¼šç†ç¬ç¡®è®¤æŠ¥æ–‡è€ŒServerè®¤ä¸ºè¿æ¥å·²ç»å»ºç«‹ï¼Œæ­¤æ—¶Serverä¸€ç›´ç­‰å¾…Clientå‘é€æ•°æ®ï¼Œé€ æˆèµ„æºæµªè´¹ã€‚</p><p>â“ <strong>3æ¬¡æ¡æ‰‹æ˜¯å¦å¯ä»¥å¢åŠ ä¸º4æ¬¡æ¡æ‰‹</strong>ï¼šå¯ä»¥ï¼Œæ—¢ç„¶3æ¬¡æ¡æ‰‹å·²ç»ç¡®ä¿è¿æ¥æ­£ç¡®å»ºç«‹ï¼Œé‚£4æ¬¡æ›´ä¸åœ¨è¯ä¸‹ï¼Œä¸ºäº†æé«˜ä¼ è¾“æ•ˆç‡é€‰æ‹©æ»¡è¶³æ¡ä»¶çš„æœ€å°æ¬¡æ•°3ã€‚</p><p>â“ <strong>ç¬¬3æ¬¡æ¡æ‰‹å®¢æˆ·ç«¯çš„ACKç¡®è®¤æŠ¥æ–‡ä¸¢å¤±ä¼šæ€æ ·</strong>ï¼šå¯¹äºServerï¼Œå®ƒæ²¡æœ‰æ”¶åˆ°ACKç¡®è®¤åé‡å‘ä¹‹å‰çš„SYN+ACKæŠ¥æ–‡5æ¬¡ï¼Œç„¶åè¿›å…¥<code>CLOSED</code>çŠ¶æ€ï¼Œæ­¤æ—¶Clientæ”¶åˆ°é‡å‘æŠ¥æ–‡ä¼šé‡æ–°ä¼ ACKç»™Serverï¼›å¯¹äºClientï¼Œå¦‚æœServeråœ¨è¶…æ—¶é‡å‘è¿‡ç¨‹ä¸­ï¼Œæ­¤æ—¶Clienté‡å‘ACKç¡®è®¤æŠ¥æ–‡ï¼ŒServeræ¥æ”¶åè¿›å…¥<code>ESTABLISHED</code>çŠ¶æ€ï¼Œå¦‚æœServerå·²ç»å¤„äº<code>CLOSED</code>çŠ¶æ€ï¼Œåˆ™Clientå‘é€æ•°æ®Serverä¼šä»¥RSTæŠ¥æ–‡åº”ç­”ã€‚</p><p>â“ <strong>å·²ç»å»ºç«‹è¿æ¥ä½†å®¢æˆ·ç«¯æ•…éšœä¼šæ€æ ·</strong>ï¼šServeræ¯æ”¶åˆ°Clientçš„è¯·æ±‚åéƒ½ä¼šå¤ä½ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œé»˜è®¤ä¸º2å°æ—¶ï¼Œè‹¥è®¡æ—¶å™¨åˆ°ç‚¹åè¿˜æœªæ”¶åˆ°Clientæ•°æ®ï¼ŒServerå‘Clientå‘é€æ¢æµ‹æŠ¥æ–‡ï¼Œä»¥åæ¯éš”75ç§’å‘é€ä¸€æ¬¡ï¼Œå¦‚æœå‘é€10ä¸ªæ¢æµ‹æŠ¥æ–‡åClientä»æ— å“åº”åˆ™Serverè®¤ä¸ºClientæ•…éšœå¹¶å…³é—­è¿æ¥ã€‚</p><p>â“ <strong>ç¬¬3æ¬¡æ¡æ‰‹æ˜¯å¦å¯ä»¥æºå¸¦æ•°æ®</strong>ï¼šå¯ä»¥ï¼Œæ­¤æ—¶Clientå·²ç»ç¡®è®¤Serveræ¥æ”¶ã€å‘é€æ­£å¸¸ï¼Œä½†ç¬¬1æ¬¡æ¡æ‰‹ä¸èƒ½æºå¸¦æ•°æ®ï¼Œå¦åˆ™å¯ä»¥é€šè¿‡å‘é€å«å¤§é‡æ•°æ®çš„SYNæŠ¥æ–‡æ¥æ”»å‡»Serverã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="åŠè¿æ¥é˜Ÿåˆ—ä¸syn-floodingæ”»å‡»">åŠè¿æ¥é˜Ÿåˆ—ä¸SYN Floodingæ”»å‡»<a class="hash-link" href="#åŠè¿æ¥é˜Ÿåˆ—ä¸syn-floodingæ”»å‡»" title="Direct link to heading">â€‹</a></h4><p>Serverä¸Clientç¬¬1æ¬¡æ¡æ‰‹åè¿›å…¥<code>SYN_RCVD</code>çŠ¶æ€ï¼Œæ­¤æ—¶åŒæ–¹è¿˜æœªå®Œå…¨å»ºç«‹è¿æ¥ï¼ŒServerå°†è¯¥çŠ¶æ€ä¸‹çš„è¯·æ±‚è¿æ¥æ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œç§°ä¹‹ä¸º<strong>åŠè¿æ¥é˜Ÿåˆ—</strong>ã€‚SYN Floodingæ”»å‡»æŒ‡é€šè¿‡å‘é€å¤§é‡çš„åŠè¿æ¥è¯·æ±‚ï¼Œè®©ServerèŠ±è´¹å¤§é‡CPUå’Œå†…å­˜èµ„æºæ¥ç»´æŠ¤åŠè¿æ¥é˜Ÿåˆ—ï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿè¿è¡Œç¼“æ…¢ç”šè‡³å´©æºƒï¼Œé˜²èŒƒæªæ–½æœ‰è®¾ç½®ç½‘å…³è¶…æ—¶ã€ä½¿ç”¨SYNç½‘å…³ã€SYNä»£ç†ç­‰ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="tcp4æ¬¡æŒ¥æ‰‹">TCP4æ¬¡æŒ¥æ‰‹<a class="hash-link" href="#tcp4æ¬¡æŒ¥æ‰‹" title="Direct link to heading">â€‹</a></h3><p>4æ¬¡æŒ¥æ‰‹æŒ‡å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ–­å¼€TCPè¿æ¥çš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><ol><li>Clientå‘Serverå‘é€è¯·æ±‚æ–­å¼€æŠ¥æ–‡(FIN=1ï¼Œseq=x)ï¼Œå‘é€åè¿›å…¥<code>FIN_WAIT_1</code>çŠ¶æ€ï¼›</li><li>Serveræ¥æ”¶åˆ°FINæŠ¥æ–‡ï¼Œè¿”å›ç¡®è®¤æŠ¥æ–‡(ACK=1, ack=x+1)ï¼Œå‘é€åè¿›å…¥<code>CLOSE_WAIT</code>çŠ¶æ€ï¼Œè€ŒClientè¿›å…¥<code>FIN_WAIT_2</code>çŠ¶æ€ï¼›</li><li>Serverå‘Clientå‘é€è¯·æ±‚å…³é—­æŠ¥æ–‡(FIN=1, seq=y)ï¼Œå‘é€åè¿›å…¥<code>LAST_ACK</code>çŠ¶æ€ï¼›</li><li>Clientæ¥æ”¶åˆ°FINæŠ¥æ–‡ï¼Œè¿”å›ç¡®è®¤æŠ¥æ–‡(ACK=1ï¼Œseq=y+1)ï¼Œè¿›å…¥<code>TIME_WAIT</code>çŠ¶æ€ï¼›Serveræ”¶åˆ°åè¿›å…¥<code>CLOSED</code>çŠ¶æ€ï¼Œå®¢æˆ·ç«¯ç­‰å¾…2*MSLåä¹Ÿè¿›å…¥<code>CLOSED</code>çŠ¶æ€ã€‚</li></ol><p>ç®€å•æ¥è¯´ï¼Œ4æ¬¡æŒ¥æ‰‹å°±æ˜¯2è½®çš„FINå‘é€å’ŒACKå›å¤ã€‚</p><p>â“ <strong>ç¬¬2ã€3æ¬¡æ¡æ‰‹æ˜¯å¦å¯ä»¥åˆå¹¶ä¸º1æ¬¡</strong>ï¼šä¸å¯ä»¥ï¼Serveræ¥æ”¶åˆ°Clientçš„FINæŠ¥æ–‡æ—¶ï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›æ•°æ®æ²¡æœ‰å‘å®Œï¼Œå› æ­¤å…ˆå›ACKè¡¨ç¤ºæ¥æ”¶åˆ°äº†Clientçš„FINè¯·æ±‚ï¼Œç­‰åˆ°å…¶æ•°æ®å‘é€å®Œæ¯•åå†å‘é€FINè¡¨ç¤ºServerä¹Ÿè¦æ–­å¼€è¿æ¥ã€‚</p><p>â“ <strong>ä¸ºä»€ä¹ˆClientè¿›å…¥<code>TIME_WAIT</code>çŠ¶æ€åè¦ç­‰å¾…2<!-- -->*<!-- -->MSLæ‰å…³é—­è€Œä¸æ˜¯ç›´æ¥è¿›å…¥<code>CLOSED</code>çŠ¶æ€</strong>ï¼šMSL(Maximum Segment Lifetime)sæ˜¯æŠ¥æ–‡åœ¨ç½‘ç»œä¸­å­˜åœ¨çš„æœ€é•¿æ—¶é—´ï¼Œè¶…è¿‡æ”¹æ—¶é—´çš„æŠ¥æ–‡ä¼šè¢«ä¸¢å¼ƒã€‚ç­‰å¾…2*MSLæœ‰ä¸¤ä¸ªåŸå› ï¼šç¬¬ä¸€ï¼Œ<strong>ç¡®è®¤Serverèƒ½æ”¶åˆ°Clientçš„ACKæŠ¥æ–‡</strong>ï¼ŒServerå¯èƒ½æ²¡æœ‰æ”¶åˆ°Clientç¬¬4æ¬¡æŒ¥æ‰‹çš„ACKæŠ¥æ–‡ï¼Œæ­¤æ—¶Serverä¼šé‡å‘FINæŠ¥æ–‡ï¼Œå¦‚æœæ­¤æ—¶Clientå¤„äº<code>CLOSED</code>çŠ¶æ€é‚£ä¹ˆé‡å‘çš„FINæŠ¥æ–‡å°±æ‰¾ä¸åˆ°å¯¹åº”çš„è¿æ¥ï¼Œè®©Clientå¤„äº<code>TIME_WAIT</code>èƒ½ç¡®ä¿å“åº”é‡å‘çš„FINæŠ¥æ–‡ï¼Œä»è€Œä¿è¯Serverèƒ½æ”¶åˆ°ACKï¼›ç¬¬äºŒï¼Œ<strong>ä¿è¯æœ¬æ¬¡è¿æ¥çš„æ•°æ®æŠ¥æ–‡ä»ç½‘ç»œä¸­æ¶ˆå¤±</strong>ï¼Œå¦‚æœClientå‘é€ACKåç›´æ¥è¿›å…¥<code>CLOSED</code>çŠ¶æ€ï¼Œç„¶ååˆå‘Serverå‘é€æ–°è¯·æ±‚è¿æ¥ï¼Œå‡è®¾ç«¯å£å·ä¸å˜ï¼Œæ—§è¿æ¥çš„æŠ¥æ–‡å»¶è¿Ÿåˆ°æ–°è¿æ¥è¾¾åˆ°Serverï¼Œæ­¤æ—¶Serverè®¤ä¸ºå»¶è¿ŸæŠ¥æ–‡æ˜¯æ–°è¿æ¥çš„ï¼Œç”±æ­¤äº§ç”Ÿè„æ•°æ®ï¼Œå› æ­¤Clientéœ€è¦ç­‰2<!-- -->*<!-- -->MSLæ¥ç¡®ä¿æœ¬æ¬¡è¿æ¥çš„æ‰€æœ‰æŠ¥æ–‡åœ¨ç½‘ç»œä¸­æ¶ˆå¤±ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç²˜åŒ…å’Œæ‹†åŒ…">ç²˜åŒ…å’Œæ‹†åŒ…<a class="hash-link" href="#ç²˜åŒ…å’Œæ‹†åŒ…" title="Direct link to heading">â€‹</a></h3><p>TCPåè®®é¢å‘å­—èŠ‚æµï¼Œå‘é€æ•°æ®åŒ…å¤§å°ä¸å›ºå®šï¼Œå¹¶ä¸”æŠ¥æ–‡ä¹Ÿä¸å­˜åœ¨æŒ‡å®šæ•°æ®åŒ…å¤§å°çš„å­—æ®µã€‚ç”±äºTCPæ ¹æ®ç¼“å†²åŒºçš„å¤§å°è¿›è¡ŒåŒ…çš„åˆ’åˆ†ï¼Œæ‰€ä»¥åœ¨ä¸šåŠ¡ä¸Šä¸€ä¸ªå®Œæ•´çš„åŒ…å¯èƒ½ä¼šè¢«æ‹†åˆ†ä¸ºå¤šä¸ªåŒ…å‘é€ï¼Œæˆ–è€…å¤šä¸ªå°çš„æ•°æ®åŒ…åˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„å‘é€ï¼Œå³TCPç²˜åŒ…å’Œæ‹†åŒ…ã€‚è§£å†³æ–¹æ³•æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ol><li>æ¶ˆæ¯å®šé•¿ï¼šå‘é€æ•°æ®åŒ…å¤§å°å›ºå®šï¼Œä¸è¶³éƒ¨åˆ†ç”¨ç©ºæ ¼è¡¥å……ï¼›</li><li>ä½¿ç”¨åˆ†éš”ç¬¦ï¼šä¾‹å¦‚åœ¨æ•°æ®æœ«å°¾æ·»åŠ æ¢è¡Œç¬¦è¡¨ç¤ºå®Œæ•´æ¶ˆæ¯ï¼Œæ•°æ®åŒ…å«åˆ†éš”ç¬¦æ—¶ä¸é€‚ç”¨ï¼›</li><li>å¤´éƒ¨æŒ‡å®šï¼šå°†æ¶ˆæ¯åˆ†ä¸ºæ¶ˆæ¯å¤´å’Œæ¶ˆæ¯å°¾ä¸¤éƒ¨åˆ†ï¼Œæ¶ˆæ¯å¤´æŒ‡å®šé•¿åº¦ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶">æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶<a class="hash-link" href="#æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶" title="Direct link to heading">â€‹</a></h3><p>æµé‡æ§åˆ¶æ˜¯TCPå‘é€æ–¹å’Œæ¥æ”¶æ–¹ç”¨äºç¡®è®¤å¯¹æ–¹èƒ½å¤Ÿæ¥æ”¶æ•°æ®å¤§å°çš„æœºåˆ¶ï¼Œé€šè¿‡æ»‘åŠ¨çª—å£å®ç°ï¼šåœ¨TCPæŠ¥æ–‡å¤´éƒ¨è®¾è®¡äº†rwnd(Receiver Window)å­—æ®µï¼Œç”±æ¥æ”¶æ–¹ç”¨äºé€šçŸ¥å‘é€æ–¹è‡ªå·±å‰©ä½™å¯æ¥æ”¶æ•°æ®çš„ç¼“å†²åŒºå¤§å°ï¼Œå‘é€æ–¹æ ¹æ®è¯¥å€¼æ¥ç¡®è®¤å‘é€æ•°æ®çš„å¤§å°ï¼Œç¡®ä¿æ¥æ”¶æ–¹å¯ä»¥åŠæ—¶å¤„ç†(<strong>æ¥æ”¶æ–¹ä¼šä¸¢å¤±æ¥ä¸åŠå¤„ç†çš„æ•°æ®</strong>)ã€‚å‘é€æ–¹ç»´æŠ¤å‘é€çª—å£ï¼Œæ¥æ”¶æ–¹ç»´æŠ¤æ¥æ”¶çª—å£ï¼Œå‘é€çª—å£å’Œæ¥æ”¶çª—å£çš„åºå·çš„ä¸Šä¸‹ç•Œä¸ä¸€å®šè¦ä¸€æ ·ï¼Œç”šè‡³å¤§å°ä¹Ÿå¯ä»¥ä¸åŒã€‚</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>æµé‡æ§åˆ¶å¼•å‘çš„æ­»é”</h5></div><div class="admonition-content"><p>å½“å‘é€æ–¹æ”¶åˆ°äº†çª—å£ä¸º0çš„åº”ç­”ï¼Œä¾¿åœæ­¢å‘é€æ•°æ®ç­‰å¾…æ¥æ”¶æ–¹çš„ä¸‹ä¸€ä¸ªåº”ç­”ï¼›ä½†ä¸å¹¸åœ°æ˜¯ä¸‹ä¸€ä¸ªçª—å£ä¸ä¸º0åº”ç­”åœ¨ä¼ è¾“ä¸­ä¸¢å¤±ï¼Œç”±æ­¤å‘é€æ–¹ä¸€ç›´ç­‰å¾…è€Œæ¥æ”¶æ–¹ä»¥ä¸ºå‘é€æ–¹å·²ç»æ”¶åˆ°åº”ç­”ä¹Ÿåœ¨ç­‰å¾…ï¼Œæœ€ç»ˆå¯¼è‡´åŒæ–¹äº’ç›¸ç­‰å¾…ï¼Œå½¢æˆæ­»é”ã€‚è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨æŒç»­è®¡æ—¶å™¨ï¼Œæ¯å½“å‘é€æ–¹æ¥æ”¶åˆ°å¤§å°ä¸º0çš„çª—å£åº”ç­”åå°±å¼€å¯è¯¥è®¡æ—¶å™¨ï¼Œæ—¶é—´ä¸€åˆ°å°±ä¸»åŠ¨å‘é€æŠ¥æ–‡æŸ¥è¯¢æ¥æ”¶æ–¹çª—å£å¤§å°ï¼Œè‹¥æ¥æ”¶æ–¹ä»è¿”å›é›¶çª—å£åˆ™é‡ç½®è®¡æ—¶å™¨å¹¶ç­‰å¾…ï¼Œå¦åˆ™è¯´æ˜åº”ç­”æŠ¥æ–‡ä¸¢å¤±ï¼Œæ­¤æ—¶é‡ç½®å‘é€çª—å£åé‡æ–°å¼€å§‹å‘é€ã€‚</p></div></div><p>æ»‘åŠ¨çª—å£åªè€ƒè™‘å¯¹æ–¹çš„å¤„ç†èƒ½åŠ›ï¼Œä½†æ²¡æœ‰è€ƒè™‘æ•´ä¸ªç½‘ç»œçš„è´Ÿè½½ï¼Œå› æ­¤åˆè®¾è®¡äº†æ‹¥å¡æ§åˆ¶ï¼Œå®ƒåŒ…å«æ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é‡ä¼ å’Œå¿«é€Ÿæ¢å¤4ç§ç®—æ³•ã€‚å…¶ä¸­ï¼Œå‰2ä¸ªç®—æ³•ç”¨äºæ‹¥å¡å‘ç”Ÿå‰ï¼Œç¬¬3ä¸ªç”¨äºæ‹¥å¡å‘ç”Ÿæ—¶ï¼Œç¬¬4ä¸ªç”¨äºæ‹¥å¡è§£å†³åã€‚åœ¨TCPæŠ¥æ–‡ä¸­è®¾ç½®cwnd(Congestion Window)å­—æ®µè¡¨ç¤ºæ‹¥å¡çª—å£å¤§å°ï¼Œå®ƒç”±å‘é€æ–¹æ¢æµ‹ç½‘ç»œæƒ…å†µä¸»åŠ¨è°ƒæ•´ã€‚å®é™…ä¸­ä¼šåŒæ—¶è€ƒè™‘æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ï¼Œå› æ­¤<strong>å‘é€æ–¹çš„çª—å£å¤§å°ä¸è¶…è¿‡min(rwnd, cwnd)</strong>ã€‚</p><ol><li><p><strong>æ…¢å¯åŠ¨</strong>ï¼šä¸€å¼€å§‹è®¾ç½®cwndä¸º1ï¼Œæ¯ç»è¿‡ä¸€ä¸ªä¼ è¾“è½®æ¬¡ï¼ŒcwndåŠ å€ã€‚ä¸ºäº†é˜²æ­¢cwndå¢é•¿è¿‡å¤§ï¼Œè¿˜è®¾ç½®äº†æ…¢å¼€å§‹é˜ˆå€¼ssthreshï¼šcwndå°äºssthreshæ—¶ä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•ï¼Œå¤§äºæ—¶ä½¿ç”¨æ‹¥å¡é¿å…ç®—æ³•ï¼Œç­‰äºä»»é€‰æ…¢å¼€å§‹å’Œæ‹¥å¡é¿å…ã€‚</p></li><li><p><strong>æ‹¥å¡é¿å…</strong>ï¼šåˆ°cwndåˆ°è¾¾ssthreshåï¼Œcwndæ¯ç»è¿‡ä¸€æ¬¡ä¼ è¾“è½®æ¬¡åŠ 1è€Œä¸æ˜¯åŠ å€ã€‚æ— è®ºæ˜¯æ…¢å¯åŠ¨è¿˜æ˜¯æ‹¥å¡é¿å…é˜¶æ®µï¼Œ<strong>åªè¦å‘é€æ–¹åˆ¤æ–­å‡ºç°ç½‘ç»œæ‹¥å¡(åˆ¤æ–­ä¾æ®æ˜¯æœªæŒ‰æ—¶æ”¶åˆ°åº”ç­”)å°±æŠŠssthreshè®¾ç½®ä¸ºå‡ºç°æ‹¥å¡æ—¶çš„ä¸€åŠ(ä½†ä¸å°äº2)</strong>ï¼Œç„¶åé‡æ–°å°†cwndè®¾ç½®ä¸º1ï¼Œæ‰§è¡Œæ…¢å¯åŠ¨ã€‚</p></li></ol>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Networking Basic" term="Networking Basic"/>
        <category label="Summary" term="Summary"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hadoop 3.xå­¦ä¹ ç¬”è®°(6)]]></title>
        <id>/2022/02/10/Learning-Hadoop3.x-06</id>
        <link href="https://kayhaw.github.io/blog/2022/02/10/Learning-Hadoop3.x-06"/>
        <updated>2022-02-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Hadoop 3.1.3å­¦ä¹ ç¬”è®°(6)]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“Hadoop 3.1.3å­¦ä¹ ç¬”è®°ç¬¬6ç¯‡ï¼šæºç åˆ†æã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="namenodeå¯åŠ¨æºç åˆ†æ">NameNodeå¯åŠ¨æºç åˆ†æ<a class="hash-link" href="#namenodeå¯åŠ¨æºç åˆ†æ" title="Direct link to heading">â€‹</a></h2><p>åˆ†æNameNode.java(åœ¨hadoop-hdfs.jaråŒ…ä¸‹)ï¼Œä¸»è¦æœ‰ä»¥ä¸‹æµç¨‹ï¼šå¯åŠ¨WebæœåŠ¡ã€åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ—¥å¿—ã€åˆå§‹åŒ–RPCæœåŠ¡å™¨ã€å¯åŠ¨èµ„æºæ£€æŸ¥ã€å¿ƒè·³æ£€æµ‹å’Œå®‰å…¨æ¨¡å¼ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¯åŠ¨webæœåŠ¡">å¯åŠ¨WebæœåŠ¡<a class="hash-link" href="#å¯åŠ¨webæœåŠ¡" title="Direct link to heading">â€‹</a></h3><p>ä»NameNode.javaçš„main() -&gt; createNameNode -&gt; NameNodeæ„é€ æ–¹æ³• -&gt; initialize -&gt; <strong>startHttpServer</strong>æ–¹æ³•å¯åŠ¨NameNodeæœåŠ¡ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">startHttpServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Configuration</span><span class="token plain"> conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpServer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">NameNodeHttpServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getHttpServerBindAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpServer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpServer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setStartupProgress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">startupProgress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token class-name">InetSocketAddress</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getHttpServerBindAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Configuration</span><span class="token plain"> conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">InetSocketAddress</span><span class="token plain"> bindAddress </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getHttpServerAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// If DFS_NAMENODE_HTTP_BIND_HOST_KEY exists then it overrides the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// host name portion of DFS_NAMENODE_HTTP_ADDRESS_KEY.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> bindHost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getTrimmed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DFS_NAMENODE_HTTP_BIND_HOST_KEY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bindHost </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">bindHost</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      bindAddress </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">InetSocketAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bindHost</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bindAddress</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> bindAddress</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å…¶ä¸­getHttpServerBindAddressä»confè·å–<code>dfs.namenode.http-address</code>æ¥è®¾ç½®æœåŠ¡çš„åœ°å€å’Œç«¯å£å·ï¼Œè‹¥æ²¡æœ‰è®¾ç½®åˆ™é»˜è®¤ä¸º<code>0.0.0.0:9870</code>ï¼›æ¥ç€åˆ¤æ–­æ˜¯å¦é…ç½®<code>dfs.namenode.http-bind-host</code>ï¼Œè‹¥æœ‰è®¾ç½®åˆ™ç”¨å…¶ä½œä¸ºæœåŠ¡åœ°å€ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶">åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶<a class="hash-link" href="#åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶" title="Direct link to heading">â€‹</a></h3><p>NameNode.javaçš„loadNameSystemæ–¹æ³•ï¼Œåˆè°ƒç”¨FSNamesystem.loadFromDiskæ–¹æ³•ï¼Œæ³¨æ„åŠ è½½ä¼ å…¥é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ–‡ä»¶ä¸¤ä¸ªåœ°å€ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">FSNamesystem</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loadFromDisk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Configuration</span><span class="token plain"> conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">checkConfiguration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">FSImage</span><span class="token plain"> fsImage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FSImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">FSNamesystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getNamespaceDirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">FSNamesystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getNamespaceEditsDirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="åˆ›å»ºrpcæœåŠ¡">åˆ›å»ºRPCæœåŠ¡<a class="hash-link" href="#åˆ›å»ºrpcæœåŠ¡" title="Direct link to heading">â€‹</a></h3><p>initializeæ–¹æ³•è°ƒç”¨createRpcServeræ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªNameNodeRpcServerå¯¹è±¡ï¼Œå…¶æ„é€ æ–¹æ³•åŒ…å«å¦‚ä¸‹ä»£ç æ¥åˆ›å»ºRpcæœåŠ¡å™¨ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lifelineRpcServer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">RPC</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Builder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setProtocol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HAServiceProtocolPB</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">haPbService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setBindAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bindHost</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lifelineRpcAddr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setNumHandlers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lifelineHandlerCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setVerbose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setSecretManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">namesystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDelegationTokenSecretManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="èµ„æºæ£€æµ‹">èµ„æºæ£€æµ‹<a class="hash-link" href="#èµ„æºæ£€æµ‹" title="Direct link to heading">â€‹</a></h3><p>initializeæ–¹æ³•è°ƒç”¨startCommonServicesæ–¹æ³•ï¼Œè°ƒç”¨FSNamesystemçš„startCommonServicesæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åŒ…å«æ“ä½œï¼š</p><ol><li>åˆ›å»ºNameNodeResourceCheckerå¯¹è±¡ï¼Œæ£€æŸ¥å…ƒæ•°æ®å­˜å‚¨ç©ºé—´æ˜¯å¦å‰©ä½™100MBå¯ç”¨</li><li>checkAvailableResources-&gt;hasAvailableDiskSpace-&gt;areResourcesAvailable-&gt;isResourceAvailableï¼Œæ£€æŸ¥èµ„æºæ˜¯å¦å‰©ä½™100MBç©ºé—´</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¿ƒè·³æ£€æµ‹">å¿ƒè·³æ£€æµ‹<a class="hash-link" href="#å¿ƒè·³æ£€æµ‹" title="Direct link to heading">â€‹</a></h3><p>startCommonServicesé€šè¿‡blockManager.activate-&gt;datanodeManager.activate(conf)-&gt;heartbeatManager.activate()-&gt;heartbeatThread.start()-&gt;Monitor.run()-&gt;heartbeatCheck()-&gt;isDatanodeDead()ï¼Œåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æŒ‚æ‰çš„å¿ƒè·³æ—¶é•¿<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mo>=</mo><mn>2</mn><mo>âˆ—</mo><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>R</mi><mi>e</mi><mi>c</mi><mi>h</mi><mi>e</mi><mi>c</mi><mi>k</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mo>+</mo><mn>10</mn><mo>âˆ—</mo><mn>1000</mn><mo>âˆ—</mo><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>S</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>n</mi><mi>d</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">heartbeatExpireInterval=2*heartbeatRecheckInterval+10*1000*heartbeatIntervalSeconds</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">s</span></span></span></span></span>ï¼Œå…¶ä¸­<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>R</mi><mi>e</mi><mi>c</mi><mi>h</mi><mi>e</mi><mi>c</mi><mi>k</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">heartbeatRecheckInterval</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span></span></span></span></span>é»˜è®¤ä¸º5åˆ†é’Ÿï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>S</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>n</mi><mi>d</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">heartbeatIntervalSeconds</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">s</span></span></span></span></span>é»˜è®¤ä¸º3ï¼Œå³åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æŒ‚æ‰çš„å¿ƒè·³æ—¶é•¿é»˜è®¤ä¸º10åˆ†é’ŸåŠ 30ç§’ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å®‰å…¨æ¨¡å¼å¼€å¯">å®‰å…¨æ¨¡å¼å¼€å¯<a class="hash-link" href="#å®‰å…¨æ¨¡å¼å¼€å¯" title="Direct link to heading">â€‹</a></h3><p>FSNamesystemçš„startCommonServicesæ–¹æ³•è°ƒç”¨blockManager.activate-&gt;bmSafeMode.activate(blockTotal)ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œè°ƒç”¨setBlockTotalæ–¹æ³•è®¾ç½®æ‰€æœ‰å—çš„æ€»æ•°å’Œå®‰å…¨é˜ˆå€¼ï¼Œè°ƒç”¨areThresholdsMetåˆ¤æ–­æ˜¯å¦æ»¡è¶³å¯ç”¨é˜ˆå€¼ï¼Œç›¸åº”çš„è®¾ç½®æ˜¯å¦è¿›å…¥å®‰å…¨æ¨¡å¼ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">activate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> total</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> namesystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasWriteLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token class-name">BMSafeModeStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OFF</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  startTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">monotonicNow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setBlockTotal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">total</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">areThresholdsMet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> exitResult </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">leaveSafeMode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Preconditions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">checkState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">exitResult</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Failed to leave safe mode."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// enter safe mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">BMSafeModeStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PENDING_THRESHOLD</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">initializeReplQueuesIfNecessary</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">reportStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"STATE* Safe mode ON."</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastStatusReport </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">monotonicNow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="datanodeå¯åŠ¨æºç åˆ†æ">DataNodeå¯åŠ¨æºç åˆ†æ<a class="hash-link" href="#datanodeå¯åŠ¨æºç åˆ†æ" title="Direct link to heading">â€‹</a></h2><p>DataNodeå¯åŠ¨åï¼Œé¦–å…ˆå‘NameNodeæ³¨å†Œè‡ªå·±ï¼Œç„¶åå®šæœŸ(6å°æ—¶)å‘NNä¸ŠæŠ¥æ‰€æœ‰å—ä¿¡æ¯ï¼Œæ¯éš”3ç§’å‘NNå‘é€å¿ƒè·³ï¼Œå¦‚æœNNè¶…è¿‡10åˆ†30ç§’æ²¡æœ‰æ”¶åˆ°DataNodeå¿ƒè·³åˆ™è®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸å¯ç”¨ã€‚å¯åŠ¨æµç¨‹å¦‚ä¸‹ï¼š</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="åˆå§‹åŒ–dataxceiverserver">åˆå§‹åŒ–DataXceiverServer<a class="hash-link" href="#åˆå§‹åŒ–dataxceiverserver" title="Direct link to heading">â€‹</a></h3><p>ä»¥DataNode.javaçš„mainæ–¹æ³•ä¸ºå…¥å£ï¼šsecureMain-&gt;createDataNode-&gt;instantiateDataNode-&gt;makeInstance-&gt;new DataNode-&gt;startDataNode-&gt;initDataXceiverï¼Œè°ƒç”¨<code>this.dataXceiverServer = new Daemon(threadGroup, xserver);</code>å¼€å¯æœåŠ¡çº¿ç¨‹ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="åˆå§‹åŒ–httpæœåŠ¡">åˆå§‹åŒ–HTTPæœåŠ¡<a class="hash-link" href="#åˆå§‹åŒ–httpæœåŠ¡" title="Direct link to heading">â€‹</a></h3><p>startDataNodeæ–¹æ³•è°ƒç”¨startInfoServerä¸ºå…¥å£ï¼šnew DatanodeHttpServer-&gt;new HttpServer2ï¼Œç„¶åå¼€å¯httpæœåŠ¡ï¼Œæä¾›è®¿é—®DataNodeä¿¡æ¯çš„endpointã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="åˆå§‹åŒ–rpcæœåŠ¡">åˆå§‹åŒ–RpcæœåŠ¡<a class="hash-link" href="#åˆå§‹åŒ–rpcæœåŠ¡" title="Direct link to heading">â€‹</a></h3><p>startDataNodeæ–¹æ³•è°ƒç”¨initIpcServerä¸ºå…¥å£ï¼Œåˆ›å»ºRPCå¯¹è±¡ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å‘namenodeæ³¨å†Œ">å‘NameNodeæ³¨å†Œ<a class="hash-link" href="#å‘namenodeæ³¨å†Œ" title="Direct link to heading">â€‹</a></h3><p>startDataNodeæ–¹æ³•è°ƒç”¨BlockPoolManager.refreshNamenodesæ–¹æ³•ä¸ºå…¥å£ï¼šdoRefreshNamenodes-&gt;createBPOS-&gt;new BPOfferService-&gt;new BPServiceActorï¼Œæœ‰å¤šå°‘ä¸ªNameNodeå°±æ·»åŠ å¤šå°‘ä¸ªBPServiceActorï¼Œåœ¨è°ƒç”¨createBPOSåï¼Œè°ƒç”¨startAllæ–¹æ³•è¿›å…¥æ³¨å†Œï¼šbpos.start()-&gt;actor.start()-&gt;BPServiceActor.run()-&gt;connectToNNAndHandshake()-&gt;db.connectToNN()-&gt;new DatanodeProtocolClientSideTranslatorPB()-&gt;createNamenode()-&gt;RPC.getProxy()ï¼Œæœ€ç»ˆå¾—åˆ°ä»£ç†å¯¹è±¡ã€‚ç„¶åå¼€å§‹æ³¨å†ŒDataNodeä¿¡æ¯ï¼šregister()-&gt;bpNamenode.registerDatanode(newBpRegistration)-&gt;rpcProxy.registerDatanode()ï¼Œé€šè¿‡rpcè°ƒç”¨<strong>NameNode</strong>çš„registerDatanodeæ–¹æ³•ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å‘é€å¿ƒè·³">å‘é€å¿ƒè·³<a class="hash-link" href="#å‘é€å¿ƒè·³" title="Direct link to heading">â€‹</a></h3><p>å›åˆ°BPServiceActor.run()æ–¹æ³•ï¼Œè°ƒç”¨offerServiceä¸ºå…¥å£ï¼šsendHeartBeat-&gt;bpNamenode.sendHeartbeat-&gt;NameNodeRpcServer.sendHeartbeat-&gt;namesystem.handleHeartbeat-&gt;blockManager.getDatanodeManager().handleHeartbeat-&gt;heartbeatManager.updateHeartbeat-&gt;blockManager.updateHeartbeat-&gt;node.updateHeartbeat-&gt;updateHeartbeatStateï¼Œç”±NameNodeè¿”å›ä¸€ä¸ªHeartbeatResponseå¯¹è±¡ä½œä¸ºå¿ƒè·³å“åº”ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">updateHeartbeatState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StorageReport</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> reports</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> cacheCapacity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> cacheUsed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> xceiverCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> volFailures</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">VolumeFailureSummary</span><span class="token plain"> volumeFailureSummary</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">updateStorageStats</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reports</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cacheCapacity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cacheUsed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> xceiverCount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volFailures</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> volumeFailureSummary</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setLastUpdate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setLastUpdateMonotonic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">monotonicNow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">rollBlocksScheduled</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getLastUpdateMonotonic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="hdfsæ–‡ä»¶ä¸Šä¼ æºç åˆ†æ">HDFSæ–‡ä»¶ä¸Šä¼ æºç åˆ†æ<a class="hash-link" href="#hdfsæ–‡ä»¶ä¸Šä¼ æºç åˆ†æ" title="Direct link to heading">â€‹</a></h2><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šæ–°å¢æ–‡ä»¶å…ƒä¿¡æ¯ã€‚ä»¥FileSystem.create(Path path, boolean overwrite)æ–¹æ³•ä¸ºå…¥å£ï¼Œè°ƒç”¨æŠ½è±¡æ–¹æ³•create-&gt;DistributedFileSystem.create()-&gt;dfs.create-&gt;DFSOutputStream.newStreamForCreate-&gt;dfsClient.namenode.create(è°ƒç”¨å®¢æˆ·ç«¯çš„Rpcåˆ›å»ºæ–¹æ³•)-&gt;namesystem.startFile()<!-- -->[NameNodeRpcServer.java, Line 791]<!-- -->-&gt;startFileInt(FSNamesystem.java, Line 2375)-&gt;FSDirWriteFileOp.startFile-&gt;FSDirWriteFileOp.addFile-&gt;fsd.addINode(Line 568)ï¼Œæœ€åé€šè¿‡addINodeæ–¹æ³•å°†è·¯å¾„æ·»åŠ åˆ°æ–‡ä»¶ç³»ç»Ÿå…ƒä¿¡æ¯ä¸­ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">testPut2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">FSDataOutputStream</span><span class="token plain"> fos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/input2"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"hello world"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å›åˆ°DFSOutputStream.javaçš„276è¡Œï¼Œåœ¨æ·»åŠ å®Œæ–‡ä»¶å…ƒä¿¡æ¯åï¼Œåœ¨313è¡Œåˆ›å»ºæ–‡ä»¶è¾“å‡ºæµDFSOutputStreamå¯¹è±¡outï¼Œè¯¥ç±»çš„æ„é€ æ–¹æ³•è°ƒç”¨äº†å¦‚ä¸‹computePacketChunkSizeæ–¹æ³•æ¥è®¡ç®—PacketåŒ…å«çš„chunkæ•°é‡å’Œpacketçš„å¤§å°ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">computePacketChunkSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> psize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> csize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> bodySize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> psize </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token class-name">PacketHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PKT_MAX_HEADER_LEN</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> chunkSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> csize </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getChecksumSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  chunksPerPacket </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bodySize</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">chunkSize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  packetSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> chunkSize</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">chunksPerPacket</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">DFSClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LOG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"computePacketChunkSize: src={}, chunkSize={}, "</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"chunksPerPacket={}, packetSize={}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      src</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chunkSize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chunksPerPacket</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> packetSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>é»˜è®¤Packetå¤§å°ä¸º64KBï¼Œchunkå¤§å°ä¸º512Byteï¼Œchunksumå¤§å°ä¸º4Byteã€‚åˆ›å»ºå®Œoutå¯¹è±¡åï¼Œæ¥ç€è°ƒç”¨å…¶startæ–¹æ³•ï¼šDataStreamer.start()-&gt;DataStreamer.run()-&gt;dataQueue.wait()ã€‚å…¶ä¸­dataQueueæ˜¯<code>LinkedList&lt;DFSPacket&gt;</code>ç±»å‹å¯¹è±¡ï¼Œè°ƒç”¨waitæ–¹æ³•é˜»å¡é˜Ÿåˆ—ç›´åˆ°æœ‰packetå…¥é˜Ÿã€‚</p><p>ç¬¬äºŒéƒ¨åˆ†ï¼šå†™æ•°æ®ã€‚ç¬¬ä¸€æ­¥æ˜¯å†™packetï¼Œä»¥FSDataOutputStream.writeæ–¹æ³•ä¸ºå…¥å£ï¼šFilterOutputStream.write-&gt;FSOutputSummer.write-&gt;FSOutputSummer.flushBuffer-&gt;FSOutputSummer.writeChecksumChunks-&gt;DFSOutputStream.writeChunk-&gt;DFSOutputStream.enqueueCurrentPacketFull-&gt;DFSOutputStream.enqueueCurrentPacket-&gt;DataStreamer.waitAndQueuePacketï¼Œç¬¬ä¸€æ¬¡å†™æ•°æ®é˜Ÿåˆ—ä¸ºç©ºï¼Œå› æ­¤æ¥ä¸‹æ¥è°ƒç”¨queuePacketæ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹æ‰€æœ‰ï¼Œå®ƒå°†packetæ·»åŠ åœ¨é˜Ÿåˆ—æœ«å°¾ï¼Œç„¶åè°ƒç”¨notifyAllå”¤é†’æ‰€æœ‰é˜»å¡çº¿ç¨‹ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">queuePacket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DFSPacket</span><span class="token plain"> packet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataQueue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">packet </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addTraceParent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Tracer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCurrentSpanId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">packet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastQueuedSeqno </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> packet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getSeqno</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Queued {}, {}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> packet</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">notifyAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ç¬¬äºŒæ­¥ï¼Œå»ºç«‹æ•°æ®ä¼ è¾“ç®¡ç†pipelineã€‚å›åˆ°DataStreamerçš„runæ–¹æ³•ï¼Œä»¥setPipelineæ–¹æ³•ä¸ºå…¥å£ï¼šDataStreamer.nextBlockOutputStream-&gt;DataStreamer.locateFollowingBlock-&gt;DFSOutputStream.addBlock-&gt;dfsClient.namenode.addBlock(NameNodeRpcServer.addBlock)-&gt;FSNamesystem.getAdditionalBlock-&gt;FSDirWriteFileOp.chooseTargetForNewBlock-&gt;BlockManager.chooseTarget4NewBlock-&gt;BlockPlacementPolicyDefault.chooseTarget-&gt;BlockPlacementPolicyDefault.chooseTargetInOrder-&gt;</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chooseTargetInOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> numOfReplicas</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token class-name">Node</span><span class="token plain"> writer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Node</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">DatanodeStorageInfo</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> newBlock</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token class-name">EnumMap</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">StorageType</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> storageTypes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">NotEnoughReplicasException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> numOfResults </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">numOfResults </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">DatanodeStorageInfo</span><span class="token plain"> storageInfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chooseLocalStorage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">writer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        storageTypes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    writer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">storageInfo </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> storageInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDatanodeDescriptor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">numOfReplicas </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> writer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">DatanodeDescriptor</span><span class="token plain"> dn0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDatanodeDescriptor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">numOfResults </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">chooseRemoteRack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dn0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> storageTypes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">numOfReplicas </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> writer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">numOfResults </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">DatanodeDescriptor</span><span class="token plain"> dn1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDatanodeDescriptor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clusterMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isOnSameRack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dn0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dn1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">chooseRemoteRack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dn0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> storageTypes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newBlock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">chooseLocalRack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dn1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> storageTypes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">chooseLocalRack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">writer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> storageTypes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">numOfReplicas </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> writer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">chooseRandom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">numOfReplicas</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">NodeBase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ROOT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> excludedNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blocksize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      maxNodesPerRack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avoidStaleNodes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> storageTypes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> writer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å›åˆ°DataStreamer.nextBlockOutputStreamæ–¹æ³•ï¼Œåœ¨è°ƒç”¨locateFollowingBlockåå¾—åˆ°ä¸Šä¼ èŠ‚ç‚¹çš„ä½ç½®ä¿¡æ¯åï¼Œæ¥ç€ä»¥createBlockOutputStreamæ–¹æ³•ä¸ºå…¥å£ï¼šnew Sender(out).writeBlock-&gt;Sender.send(out, Op.WRITE_BLOCK, proto.build()å‘é€æ•°æ®ã€‚å¯¹åº”åœ°ï¼ŒDataXceiverServerçš„runæ–¹æ³•æ‰§è¡ŒDataXceiverçš„runæ–¹æ³•ï¼Œæ ¹æ®å‘é€ç«¯çš„opç±»å‹è°ƒç”¨processOpè¿›è¡Œå¤„ç†ã€‚ç”±äºå‘é€ç«¯opç±»å‹ä¸ºWRITE_BLOCKï¼Œè°ƒç”¨Receiver.opWriteBlock(DataInputStream in)æ–¹æ³•ï¼Œç»§è€Œè°ƒç”¨DataXceiver.writeBlockæ–¹æ³•ï¼šé¦–å…ˆé€šè¿‡setCurrentBlockReceiverå†™å—æ–‡ä»¶ï¼Œç„¶ååˆ¤æ–­ç›®æ ‡èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¦å¤§äº0ï¼Œæ˜¯çš„è¯åˆç”¨new Sender(mirrorOut).writeBlockå†™æ•°æ®ï¼ˆè§¦å‘å†™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„é“¾å¼è°ƒç”¨ï¼‰ã€‚</p><p>å›åˆ°DataStreamerçš„runæ–¹æ³•ï¼Œåœ¨717è¡Œè°ƒç”¨setPipelineåï¼Œæ¥ç€è°ƒç”¨initDataStreamingæ–¹æ³•ï¼Œé€šè¿‡ResponseProcessorçº¿ç¨‹å¯¹è±¡å¤„ç†å†™æˆåŠŸå“åº”ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">ResponseProcessor.run(), Line 1179-1183</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lastAckedSeqno </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> seqno</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipelineRecoveryCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ackQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">removeFirst</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">packetSendTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">seqno</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dataQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">notifyAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>åœ¨å‘é€packetåï¼Œä¸ä¼šå°†è¯¥packetåˆ é™¤è€Œæ˜¯æ·»åŠ åˆ°ackQueueä¸­ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">DataStreamer.run(), Line 753-767</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataQueue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// move packet from dataQueue to ackQueue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">one</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isHeartbeatPacket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scope </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      spanId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> scope</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getSpanId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      scope</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">detach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      one</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setTraceScope</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scope </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">removeFirst</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ackQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">one</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packetSendTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">one</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getSeqno</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">monotonicNow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">notifyAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="yarnå·¥ä½œæœºåˆ¶">Yarnå·¥ä½œæœºåˆ¶<a class="hash-link" href="#yarnå·¥ä½œæœºåˆ¶" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä»»åŠ¡æäº¤">ä»»åŠ¡æäº¤<a class="hash-link" href="#ä»»åŠ¡æäº¤" title="Direct link to heading">â€‹</a></h3><p>Job.waitForCompletionä¸ºå…¥å£ï¼šJob.submit-&gt;submitter.submitJobInternal-&gt;submitClient.submitJob-&gt;YARNRunner.submitJobï¼Œè¯¥æ–¹æ³•æœ‰2ä¸ªä¸»è¦æ–¹æ³•è°ƒç”¨ï¼šcreateApplicationSubmissionContextå’ŒsubmitApplicationã€‚å…ˆçœ‹åˆ›å»ºåº”ç”¨æ‰§è¡Œç¯å¢ƒæ–¹æ³•ï¼šå®ƒä¼šè°ƒç”¨setupAMCommandæ–¹æ³•æ„å»ºApp masterçš„å¯åŠ¨å‘½ä»¤ï¼Œè¯¥æ–¹æ³•è®¾ç½®ä¸€å †javaå¯åŠ¨å‚æ•°åï¼Œè®¾ç½®å¯åŠ¨ç±»ä¸º<code>org.apache.hadoop.mapreduce.v2.app.MRAppMaster</code>ï¼Œå¹¶å°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°å¯¹åº”æ–‡ä»¶å¤¹ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">YARNRunner.java, Line 498-502</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">vargs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">MRJobConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">APPLICATION_MASTER_CLASS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vargs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"1&gt;"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token class-name">ApplicationConstants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LOG_DIR_EXPANSION_VAR </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SEPARATOR </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token class-name">ApplicationConstants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">STDOUT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vargs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"2&gt;"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token class-name">ApplicationConstants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LOG_DIR_EXPANSION_VAR </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SEPARATOR </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token class-name">ApplicationConstants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">STDERR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>åœ¨åˆ›å»ºå¥½åº”ç”¨æäº¤ä¸Šä¸‹æ–‡ç¯å¢ƒå¯¹è±¡appContextåï¼Œæ¥ç€è°ƒç”¨submitApplicationæäº¤ï¼Œè¯¥æ–¹æ³•è¿›è€Œè°ƒç”¨YarnClinetImpl.submitApplicationæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆè°ƒç”¨ClientRMService.submitApplicationæ–¹æ³•(åˆ°äº†ResourceManageræœåŠ¡)ï¼Œå°†æäº¤ä¸Šä¸‹æ–‡ä¿¡æ¯æ’å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="mrappmasterå¯åŠ¨">MRAppMasterå¯åŠ¨<a class="hash-link" href="#mrappmasterå¯åŠ¨" title="Direct link to heading">â€‹</a></h3><p>å°†ä»»åŠ¡ä¿¡æ¯æ’å…¥åˆ°é˜Ÿåˆ—åï¼Œç”±MRAppMasteræ¥è·å–é˜Ÿåˆ—ä»»åŠ¡å¹¶å®‰æ’æ‰§è¡Œã€‚ä»¥MRAppMaster.mainæ–¹æ³•ä¸ºå…¥å£ï¼šinitAndStartAppMaster-&gt;init-&gt;serviceInit-&gt;createDispatcheråˆ›å»ºè°ƒåº¦å™¨ã€‚åœ¨initæ–¹æ³•åè°ƒç”¨startæ–¹æ³•å¯åŠ¨æœåŠ¡ï¼šserviceStart-&gt;startJobs-&gt;dispatcher.getEventHandler().handle(startJobEvent)-&gt;GenericEventHandler.eventQueue.put(event)ï¼Œå°†ä»»åŠ¡æäº¤åˆ°è¿è¡Œé˜Ÿåˆ—ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="yarnchildæ‰§è¡Œä»»åŠ¡">YarnChildæ‰§è¡Œä»»åŠ¡<a class="hash-link" href="#yarnchildæ‰§è¡Œä»»åŠ¡" title="Direct link to heading">â€‹</a></h3><p>YarnChildæ˜¯MRAppMasterä¸­æ‰§è¡Œä»»åŠ¡çš„å°è£…ï¼Œä»¥å…¶mainæ–¹æ³•ä¸ºå…¥å£ï¼šTask.run-&gt;MapTask.run/ReduceTask.runã€‚ä»¥MapTaskRunä¸ºä¾‹ï¼Œè°ƒç”¨runNewMapper-&gt;mapper.run-&gt;è‡ªå®šä¹‰Mapper.runã€‚</p>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Hadoop" term="Hadoop"/>
        <category label="BigData" term="BigData"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hadoop 3.xå­¦ä¹ ç¬”è®°(4)]]></title>
        <id>/2022/02/07/Learning-Hadoop3.x-04</id>
        <link href="https://kayhaw.github.io/blog/2022/02/07/Learning-Hadoop3.x-04"/>
        <updated>2022-02-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Hadoop 3.1.3å­¦ä¹ ç¬”è®°(4)]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“Hadoop 3.1.3å­¦ä¹ ç¬”è®°ç¬¬4ç¯‡ï¼šYarnã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="yarnç®€ä»‹">Yarnç®€ä»‹<a class="hash-link" href="#yarnç®€ä»‹" title="Direct link to heading">â€‹</a></h2><p>Yarnæ˜¯ä¸€ä¸ªèµ„æºè°ƒåº¦å¹³å°ï¼Œè´Ÿè´£ä¸ºè¿ç®—ç¨‹åºæä¾›æœåŠ¡å™¨è¿ç®—èµ„æºï¼Œç›¸å½“äºä¸€ä¸ªåˆ†å¸ƒå¼çš„æ“ä½œç³»ç»Ÿå¹³å°ï¼Œè€ŒMapReduceç­‰è¿ç®—ç¨‹åºåˆ™ç›¸å½“äºè¿è¡Œäºæ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„åº”ç”¨ç¨‹åºã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="åŸºæœ¬ç»„ä»¶">åŸºæœ¬ç»„ä»¶<a class="hash-link" href="#åŸºæœ¬ç»„ä»¶" title="Direct link to heading">â€‹</a></h3><ul><li>ResourceManager(RM)ï¼š<ul><li>å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼›</li><li>ç›‘æ§NodeManager</li><li>å¯åŠ¨æˆ–ç›‘æ§ApplicationMaster</li></ul></li><li>NodeManager(NM)ï¼š<ul><li>ç®¡ç†å•ä¸ªèŠ‚ç‚¹èµ„æº</li><li>å¤„ç†æ¥è‡ªResourceManagerçš„å‘½ä»¤</li><li>å¤„ç†æ¥è‡ªApplicationMasterçš„å‘½ä»¤</li></ul></li><li>ApplicationMaster(AM)ï¼š<ul><li>ä¸ºåº”ç”¨ç¨‹åºç”³è¯·èµ„æºå¹¶åˆ†é…ä»»åŠ¡</li><li>ä»»åŠ¡ç›‘æ§ä¸å®¹é”™</li></ul></li><li>Containerï¼šè®¡ç®—èµ„æºçš„æŠ½è±¡ï¼ŒåŒ…æ‹¬å†…å­˜ã€CPUã€ç£ç›˜ã€ç½‘ç»œç­‰</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="å·¥ä½œæµç¨‹">å·¥ä½œæµç¨‹<a class="hash-link" href="#å·¥ä½œæµç¨‹" title="Direct link to heading">â€‹</a></h3><ol><li>MapReduceç¨‹åºåœ¨å®¢æˆ·ç«¯èŠ‚ç‚¹è¢«æäº¤ï¼›</li><li>YarnRunnerå‘RMç”³è¯·ä¸€ä¸ªApplicationï¼›</li><li>RMå°†åº”ç”¨ç¨‹åºçš„èµ„æºè·¯å¾„è¿”å›ç»™YarnRunnerï¼›</li><li>MRç¨‹åºå°†è¿è¡Œèµ„æºæäº¤åˆ°HDFSä¸Šï¼›</li><li>èµ„æºæäº¤å®Œæ¯•åï¼Œç”³è¯·è¿è¡ŒmrAppMasterï¼›</li><li>RMå°†ç”¨æˆ·çš„è¯·æ±‚åˆå§‹åŒ–æˆä¸€ä¸ªTaskï¼›</li><li>å…¶ä¸­ä¸€ä¸ªNMé¢†å–åˆ°Taskä»»åŠ¡ï¼›</li><li>è¯¥NMåˆ›å»ºcontainerï¼Œå¹¶äº§ç”ŸMRAppmasterï¼›</li><li>Containerä»HDFSä¸Šæ‹·è´èµ„æºåˆ°æœ¬åœ°ï¼›</li><li>MRAppmasterå‘RMç”³è¯·è¿è¡ŒMapTaskèµ„æºï¼›</li><li>RMå°†è¿è¡ŒMapTaskä»»åŠ¡åˆ†é…ç»™å¦å¤–ä¸¤ä¸ªNodeManagerï¼Œå¦ä¸¤ä¸ªNodeManageråˆ†åˆ«é¢†å–ä»»åŠ¡å¹¶åˆ›å»ºå®¹å™¨ï¼›</li><li>MRå‘ä¸¤ä¸ªæ¥æ”¶åˆ°ä»»åŠ¡çš„NodeManagerå‘é€ç¨‹åºå¯åŠ¨è„šæœ¬ï¼Œè¿™ä¸¤ä¸ªNodeManageråˆ†åˆ«å¯åŠ¨MapTaskï¼ŒMapTaskå¯¹æ•°æ®åˆ†åŒºæ’åºï¼›</li><li>MrAppMasterç­‰å¾…æ‰€æœ‰MapTaskè¿è¡Œå®Œæ¯•åï¼Œå‘RMç”³è¯·å®¹å™¨ï¼Œè¿è¡ŒReduceTaskï¼›</li><li>ReduceTaskå‘MapTaskè·å–ç›¸åº”åˆ†åŒºçš„æ•°æ®ï¼›</li><li>ç¨‹åºè¿è¡Œå®Œæ¯•åï¼ŒMRä¼šå‘RMç”³è¯·æ³¨é”€è‡ªå·±ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="è°ƒåº¦ç­–ç•¥">è°ƒåº¦ç­–ç•¥<a class="hash-link" href="#è°ƒåº¦ç­–ç•¥" title="Direct link to heading">â€‹</a></h3><p>Hadoopä½œä¸šè°ƒåº¦å™¨ä¸»è¦æœ‰3ç§ï¼šFIFOã€å®¹é‡è°ƒåº¦å™¨(Capacity Scheduler)å’Œå…¬å¹³(Fair Scheduler)ã€‚Apache Hadoopé»˜è®¤ä½¿ç”¨å®¹é‡è°ƒåº¦å™¨ï¼ŒCDHé»˜è®¤ä½¿ç”¨å…¬å¹³è°ƒåº¦å™¨ï¼Œé…ç½®å‚æ•°è§yarn-default.xmlï¼š</p><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">The class to use as the resource scheduler.</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">yarn.resourcemanager.scheduler.class</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="fifo">FIFO<a class="hash-link" href="#fifo" title="Direct link to heading">â€‹</a></h4><p>æŒ‰ç…§ä»»åŠ¡æäº¤å…ˆåé¡ºåºä¾æ¬¡æœåŠ¡ï¼Œä¼˜ç‚¹æ˜¯ç®€å•æ˜“æ‡‚ï¼Œç¼ºç‚¹æ˜¯ä¸æ”¯æŒå¤šé˜Ÿåˆ—ï¼Œç”Ÿäº§ç¯å¢ƒå¾ˆå°‘ä½¿ç”¨ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="å®¹é‡è°ƒåº¦å™¨">å®¹é‡è°ƒåº¦å™¨<a class="hash-link" href="#å®¹é‡è°ƒåº¦å™¨" title="Direct link to heading">â€‹</a></h4><p>ç”±Yahooå¼€å‘ï¼Œå®¹é‡è°ƒåº¦å™¨çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><ol><li>å¤šé˜Ÿåˆ—ï¼šæ¯ä¸ªé˜Ÿåˆ—å¯é…ç½®ä¸€å®šçš„èµ„æºé‡ï¼Œæ¯ä¸ªé˜Ÿåˆ—é‡‡ç”¨FIFOè°ƒåº¦ç­–ç•¥ï¼›</li><li>å®¹é‡ä¿è¯ï¼šç®¡ç†å‘˜å¯ä¸ºæ¯ä¸ªé˜Ÿåˆ—è®¾ç½®èµ„æºæœ€ä½ä¿è¯å’Œèµ„æºä½¿ç”¨ä¸Šï¼›</li><li>çµæ´»æ€§ï¼šå¦‚æœä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„èµ„æºæœ‰å‰©ä½™ï¼Œå¯ä»¥æš‚æ—¶å…±äº«ç»™é‚£äº›éœ€è¦èµ„æºçš„é˜Ÿåˆ—ï¼Œè€Œä¸€æ—¦è¯¥é˜Ÿåˆ—æœ‰æ–°çš„åº”ç”¨ï¼Œç¨‹åºæäº¤ï¼Œåˆ™å…¶ä»–é˜Ÿåˆ—å€Ÿè°ƒçš„èµ„æºä¼šå½’è¿˜ç»™è¯¥é˜Ÿåˆ—ï¼›</li><li>å¤šç§Ÿæˆ·ï¼šæ”¯æŒå¤šç”¨æˆ·å…±äº«é›†ç¾¤å’Œå¤šåº”ç”¨ç¨‹åºåŒæ—¶è¿è¡Œã€‚ä¸ºäº†é˜²æ­¢åŒä¸€ä¸ªç”¨æˆ·çš„ä½œä¸šç‹¬å é˜Ÿåˆ—ä¸­çš„èµ„æºï¼Œè¯¥è°ƒåº¦å™¨ä¼šå¯¹åŒä¸€ç”¨æˆ·æäº¤çš„ä½œä¸šæ‰€å èµ„æºé‡è¿›è¡Œé™å®šã€‚</li></ol><p>å®¹é‡è°ƒåº¦å™¨çš„ç­–ç•¥å¦‚ä¸‹ï¼š</p><ol><li>é˜Ÿåˆ—èµ„æºåˆ†é…ï¼šä»rootå¼€å§‹ä½¿ç”¨æ·±åº¦ä¼˜å…ˆç®—æ³•ï¼Œæ‰¾åˆ°èµ„æºå ç”¨ç‡æœ€ä½çš„é˜Ÿåˆ—åˆ†é…ï¼›</li><li>ä½œä¸šèµ„æºåˆ†é…ï¼šé»˜è®¤æŒ‰ä½œä¸šçš„ä¼˜å…ˆçº§ã€æäº¤æ—¶é—´é¡ºåºåˆ†é…ï¼›</li><li>å®¹å™¨èµ„æºåˆ†é…ï¼šæŒ‰å®¹å™¨ä¼˜å…ˆçº§ï¼Œå¦‚æœç›¸åŒæŒ‰æ•°æ®æœ¬åœ°æ€§åŸåˆ™ï¼šä»»åŠ¡å’Œæ•°æ®åœ¨ç›¸åŒèŠ‚ç‚¹ã€ç›¸åŒæœºæ¶ã€ä¸åŒæœºæ¶ã€‚</li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="å…¬å¹³è°ƒåº¦å™¨">å…¬å¹³è°ƒåº¦å™¨<a class="hash-link" href="#å…¬å¹³è°ƒåº¦å™¨" title="Direct link to heading">â€‹</a></h4><p>åŒé˜Ÿåˆ—çš„æ‰€æœ‰ä½œä¸šå…±äº«èµ„æºï¼ŒæŒ‰æ—¶é—´è·å¾—å…¬å¹³çš„èµ„æºã€‚ä¸å®¹é‡è°ƒåº¦å™¨ç›¸æ¯”ï¼š</p><ul><li>ç›¸åŒç‚¹ï¼š<ul><li>æ”¯æŒå¤šé˜Ÿåˆ—ï¼›</li><li>å®¹é‡ä¿è¯ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªé˜Ÿåˆ—è®¾ç½®æœ€ä½ä¿è¯å’Œä¸Šé™ï¼›</li><li>çµæ´»æ€§ï¼šå…¶ä»–é˜Ÿåˆ—çš„å‰©ä½™èµ„æºå¯ä»¥å…±äº«ç»™å…¶ä»–é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—æœ‰ä½œä¸šæäº¤åèµ„æºå½’è¿˜ï¼›</li><li>å¤šç§Ÿæˆ·ï¼šæ”¯æŒå¤šç”¨æˆ·å…±äº«é›†ç¾¤å’Œå¤šåº”ç”¨ç¨‹åºåŒæ—¶è¿è¡Œï¼Œå¯é’ˆå¯¹åŒä¸€ç”¨æˆ·çš„ä½œä¸šèµ„æºæš‚ç”¨è¿›è¡Œé™åˆ¶ã€‚</li></ul></li><li>ä¸åŒç‚¹ï¼›<ul><li>æ ¸å¿ƒè°ƒåº¦ç­–ç•¥ï¼šå®¹é‡è°ƒåº¦å™¨ä¼˜å…ˆé€‰æ‹©èµ„æºåˆ©ç”¨ç‡ä½çš„é˜Ÿåˆ—å®‰æ’ä½œä¸šï¼Œå…¬å¹³è°ƒåº¦å™¨ä¼˜é€‰é€‰æ‹©èµ„æº<strong>ç¼ºé¢</strong>æ¯”ä¾‹å¤§çš„é˜Ÿåˆ—å®‰æ’ä½œä¸š</li><li>é˜Ÿåˆ—èµ„æºåˆ†é…ç­–ç•¥ï¼šå®¹é‡è°ƒåº¦å™¨æ”¯æŒFIFOå’ŒDRFï¼Œå…¬å¹³è°ƒåº¦å™¨æ”¯æŒFIFOã€FAIRã€DRFã€‚</li></ul></li></ul><p>å…¶ä¸­ï¼Œç¼ºé¢æŒ‡æŸä¸ªæ—¶åˆ»ä¸€ä¸ªä½œä¸šæŒ‰ç…§å…¬å¹³åˆ†é…çš„èµ„æºå’Œå®é™…è·å–èµ„æºçš„å·®è·ã€‚å½“ä½¿ç”¨FIFOç­–ç•¥æ—¶ï¼Œå…¬å¹³è°ƒåº¦å™¨å’Œå®¹é‡è°ƒåº¦å™¨åˆ«æ— å·®å¼‚ã€‚FAIRç­–ç•¥(é»˜è®¤)æ˜¯ä¸€ç§åŸºäºæœ€å¤§æœ€å°å…¬å¹³ç®—æ³•å®ç°çš„èµ„æºå¤šè·¯å¤ç”¨æ–¹å¼ï¼Œèµ„æºåˆ†é…æµç¨‹ä¸å®¹é‡è°ƒåº¦å™¨ä¸€è‡´ï¼šé€‰æ‹©é˜Ÿåˆ—ã€é€‰æ‹©ä½œä¸šã€é€‰æ‹©å®¹å™¨ã€‚æ¯æ­¥æŒ‰ç…§å¦‚ä¸‹æµç¨‹åˆ†é…èµ„æºï¼š</p><ol><li>è®¡ç®—å¦‚ä¸‹å‚æ•°ï¼šå®é™…æœ€å°èµ„æºä»½é¢minshare = Min(èµ„æºéœ€æ±‚é‡, é…ç½®çš„æœ€å°èµ„æºé‡)ï¼Œæ˜¯å¦é¥¥é¥¿isNeedy=èµ„æºä½¿ç”¨é‡ &lt; minshareï¼Œèµ„æºåˆ†é…æ¯”minShareRatio = èµ„æºä½¿ç”¨é‡ / Max(mindshare, 1)ï¼Œèµ„æºä½¿ç”¨æƒé‡æ¯”useToWeightRatio = èµ„æºä½¿ç”¨é‡ / æƒé‡ã€‚</li><li>åˆ¤æ–­å¯¹è±¡é¥¥é¥¿çŠ¶æ€ï¼Œä¸ä¸€è‡´çš„é¥¥é¥¿ä¼˜å…ˆï¼›</li><li>é¥¥é¥¿çŠ¶æ€ä¸€è‡´ï¼Œèµ„æºåˆ†é…æ¯”å°è€…ä¼˜å…ˆï¼›</li><li>èµ„æºåˆ†é…æ¯”ç›¸ç­‰ï¼ŒæŒ‰ç…§æäº¤é¡ºåºä¼˜å…ˆã€‚</li></ol><p>DRF(Dominant Resource Fairness)ï¼šä¹‹å‰æåˆ°çš„èµ„æºéƒ½æ˜¯å•ä¸€æ ‡å‡†ï¼Œæ¯”å¦‚åªè€ƒè™‘å†…å­˜(Yarné»˜è®¤)ï¼Œä½†å®é™…éœ€è¦è€ƒè™‘CPUã€ç½‘ç»œå¸¦å®½ç­‰å…¶ä»–å› ç´ ï¼Œæ­¤æ—¶ä½¿ç”¨DRFç­–ç•¥å¯¹ä¸åŒåº”ç”¨è¿›è¡Œä¸åŒèµ„æºçš„ä¸€ä¸ªä¸åŒæ¯”ä¾‹çš„é™åˆ¶ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="yarnå‘½ä»¤">Yarnå‘½ä»¤<a class="hash-link" href="#yarnå‘½ä»¤" title="Direct link to heading">â€‹</a></h2><p>é™¤äº†é€šè¿‡é¡µé¢æŸ¥çœ‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ç®¡ç†Yarnä½œä¸šï¼š</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä½œä¸šæŸ¥çœ‹">ä½œä¸šæŸ¥çœ‹<a class="hash-link" href="#ä½œä¸šæŸ¥çœ‹" title="Direct link to heading">â€‹</a></h3><ul><li><code>yarn application -list</code>ï¼šåˆ—å‡ºæ‰€æœ‰ä½œä¸šï¼›</li><li><code>yarn application -list -appStates &lt;state&gt;</code>ï¼šæ ¹æ®çŠ¶æ€æŸ¥çœ‹ä½œä¸šï¼Œå¯é€‰çŠ¶æ€æœ‰ALLã€NEWã€NEW_SAVINGã€SUBMITTEDã€ACCEPTEDã€RUNNINGã€FINISHEDã€FAILEDã€KILLEDï¼›</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ—¥å¿—æŸ¥çœ‹">æ—¥å¿—æŸ¥çœ‹<a class="hash-link" href="#æ—¥å¿—æŸ¥çœ‹" title="Direct link to heading">â€‹</a></h3><ul><li><code>yarn logs -applicationId &lt;id&gt;</code>ï¼šæŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼›</li><li><code>yarn logs -applicationId &lt;ApplicationId&gt; -containerId &lt;ContainerId&gt;</code>ï¼šæŸ¥çœ‹æŸä¸ªå®¹å™¨ä¸Šçš„åº”ç”¨æ—¥å¿—ã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="åº”ç”¨å°è¯•æŸ¥çœ‹">åº”ç”¨å°è¯•æŸ¥çœ‹<a class="hash-link" href="#åº”ç”¨å°è¯•æŸ¥çœ‹" title="Direct link to heading">â€‹</a></h3><ul><li><code>yarn applicationattempt -list &lt;ApplicationId&gt;</code>ï¼šæŸ¥çœ‹å°è¯•åº”ç”¨åˆ—è¡¨ï¼›</li><li><code>yarn applicationattempt -status &lt;ApplicationAttemptId&gt;</code>ï¼šæŸ¥çœ‹å°è¯•åº”ç”¨çŠ¶æ€ã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="å®¹å™¨æŸ¥çœ‹">å®¹å™¨æŸ¥çœ‹<a class="hash-link" href="#å®¹å™¨æŸ¥çœ‹" title="Direct link to heading">â€‹</a></h3><ul><li><code>yarn container -list &lt;ApplicationAttemptId&gt;</code>ï¼šåˆ—å‡ºæ‰€æœ‰å®¹å™¨ï¼›</li><li><code>yarn container -status &lt;ContainerId&gt;</code>ï¼šæŸ¥çœ‹å®¹å™¨çŠ¶æ€ã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="èŠ‚ç‚¹æŸ¥çœ‹">èŠ‚ç‚¹æŸ¥çœ‹<a class="hash-link" href="#èŠ‚ç‚¹æŸ¥çœ‹" title="Direct link to heading">â€‹</a></h3><ul><li><code>yarn node -list -all</code>ï¼šåˆ—å‡ºæ‰€æœ‰èŠ‚ç‚¹ï¼›</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ›´æ–°é˜Ÿåˆ—é…ç½®">æ›´æ–°é˜Ÿåˆ—é…ç½®<a class="hash-link" href="#æ›´æ–°é˜Ÿåˆ—é…ç½®" title="Direct link to heading">â€‹</a></h3><ul><li><code>yarn rmadmin -refreshQueues</code>ï¼šæ›´æ–°åŠ è½½é˜Ÿåˆ—é…ç½®ï¼›</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="é˜Ÿåˆ—æŸ¥çœ‹">é˜Ÿåˆ—æŸ¥çœ‹<a class="hash-link" href="#é˜Ÿåˆ—æŸ¥çœ‹" title="Direct link to heading">â€‹</a></h3><ul><li><code>yarn queue -status &lt;Queuename&gt;</code>ã€‚</li></ul>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Hadoop" term="Hadoop"/>
        <category label="BigData" term="BigData"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hadoop 3.xå­¦ä¹ ç¬”è®°(3)]]></title>
        <id>/2022/01/31/Learning-Hadoop3.x-03</id>
        <link href="https://kayhaw.github.io/blog/2022/01/31/Learning-Hadoop3.x-03"/>
        <updated>2022-01-31T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Hadoop 3.1.3å­¦ä¹ ç¬”è®°(3)]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“Hadoop 3.1.3å­¦ä¹ ç¬”è®°ç¬¬3ç¯‡ï¼šMapReduceã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="mapreduceç®€ä»‹">MapReduceç®€ä»‹<a class="hash-link" href="#mapreduceç®€ä»‹" title="Direct link to heading">â€‹</a></h2><p>MapReduceæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶ï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯å°†ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦ç»„ä»¶æ•´åˆæˆå®Œæ•´çš„åˆ†å¸ƒå¼è¿ç®—ç¨‹åºï¼Œç„¶ååœ¨Hadoopé›†ç¾¤ä¸Šå¹¶å‘è¿è¡Œã€‚</p><p>ä¼˜ç‚¹ğŸ˜„ï¼š</p><ol><li>æ˜“äºç¼–ç¨‹ï¼Œç”¨æˆ·åªéœ€è¦å…³ç³»ä¸šåŠ¡é€»è¾‘ï¼›</li><li>æ‰©å±•æ€§å¥½ï¼Œå¯ä»¥åŠ¨æ€å¢åŠ æœåŠ¡å™¨ï¼›</li><li>é«˜å®¹é”™æ€§ï¼Œè®¡ç®—èŠ‚ç‚¹æŒ‚ç‚¹å¯ä»¥å°†ä»»åŠ¡è½¬ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ï¼›</li><li>é€‚åˆæµ·é‡æ•°æ®è®¡ç®—(TB/PB)ã€‚</li></ol><p>ç¼ºç‚¹ğŸ˜ ï¼š</p><ol><li>ä¸é€‚åˆå®æ—¶è®¡ç®—ï¼›</li><li>ä¸é€‚åˆæµå¼è®¡ç®—ï¼›</li><li>ä¸é€‚åˆDAGæœ‰å‘æ— ç¯å›¾è®¡ç®—ã€‚</li></ol><p>MapReduceç¨‹åºåˆ†ä¸º2ä¸ªé˜¶æ®µï¼šMapé˜¶æ®µå’ŒReduceé˜¶æ®µã€‚Mapé˜¶æ®µçš„MapTaskå¹¶å‘è¿è¡Œäº’ä¸ç›¸å¹²ï¼ŒReduceé˜¶æ®µçš„ReduceTaskä¹Ÿäº’ä¸ç›¸å…³ï¼Œä½†ä¾èµ–äºMapTaskçš„è¾“å‡ºã€‚MapReduceç¨‹åºåªèƒ½åŒ…å«ä¸€ä¸ªMapé˜¶æ®µå’Œä¸€ä¸ªReduceé˜¶æ®µï¼Œå¦‚æœä¸šåŠ¡é€»è¾‘éå¸¸å¤æ‚ï¼Œé‚£ä¹ˆåªèƒ½å¤šä¸ªMapReduceç¨‹åºä¸²è¡Œæ‰§è¡Œã€‚</p><p>MRç¨‹åºç¼–å†™åˆ†ä¸º3éƒ¨åˆ†ï¼šMapperã€Reducerå’ŒDriverã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="mapperç±»">Mapperç±»<a class="hash-link" href="#mapperç±»" title="Direct link to heading">â€‹</a></h3><ol><li>è‡ªå®šä¹‰ç±»ç»§æ‰¿<code>org.apache.hadoop.mapreduce.Mapper</code>ç±»ï¼›</li><li>å®šä¹‰è¾“å…¥K-Væ³›å‹ï¼Œå³æ³›å‹å‚æ•°åˆ—è¡¨çš„ç¬¬1ã€2ä¸ªå‚æ•°ï¼›</li><li>å®šä¹‰è¾“å‡ºK-Væ³›å‹ï¼Œå³æ³›å‹åˆ—è¡¨çš„ç¬¬3ã€4ä¸ªå‚æ•°ï¼›</li><li>mapæ–¹æ³•ä¸­å®ç°ä¸šåŠ¡é€»è¾‘ï¼›</li><li><strong>map()æ–¹æ³•ï¼ˆMapTaskè¿›ç¨‹ï¼‰å¯¹æ¯ä¸€ä¸ªK-Vå¯¹è°ƒç”¨ä¸€æ¬¡</strong>ã€‚</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">WordCountMapper.java</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">WordCountMapper</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">Mapper</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">LongWritable</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Text</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Text</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">IntWritable</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å‡å°‘å¯¹è±¡åˆ›å»ºæ¬¡æ•°ï¼Œä¸è¦æ”¾åˆ°mapé‡Œé¢</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token plain"> outK </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">IntWritable</span><span class="token plain"> outV </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IntWritable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">LongWritable</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Context</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 1. è·å–ä¸€è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain"> line </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 2. åˆ‡åˆ†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> words </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> line</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">" "</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 3. å¾ªç¯å†™å‡º</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> word </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> words</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            outK</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">word</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">outK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> outV</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="reducerç±»">Reducerç±»<a class="hash-link" href="#reducerç±»" title="Direct link to heading">â€‹</a></h3><ol><li>è‡ªå®šä¹‰ç±»ç»§æ‰¿<code>org.apache.hadoop.mapreduce.Reducer</code>ç±»ï¼›</li><li>è¾“å…¥K-Væ³›å‹æ˜¯å¯¹åº”Mapperçš„è¾“å‡ºK-Væ³›å‹ï¼›</li><li>reduceæ–¹æ³•å®ç°ä¸šåŠ¡é€»è¾‘ï¼›</li><li><strong>ReduceTaskè¿›ç¨‹å¯¹æ¯ä¸€ç»„ç›¸åŒkeyçš„K-Vç»„è°ƒç”¨ä¸€æ¬¡reduce()æ–¹æ³•</strong>ã€‚</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">WordCountReducer.java</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">WordCountReducer</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">Reducer</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Text</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">IntWritable</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Text</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">IntWritable</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">IntWritable</span><span class="token plain"> outV </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IntWritable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">reduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Text</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Iterable</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">IntWritable</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> values</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Context</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> sum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">IntWritable</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> values</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sum </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        outV</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sum</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> outV</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="driverç±»">Driverç±»<a class="hash-link" href="#driverç±»" title="Direct link to heading">â€‹</a></h3><p>ç›¸å½“äºYARNé›†ç¾¤çš„å®¢æˆ·ç«¯ï¼Œç”¨äºæäº¤MRä»»åŠ¡åˆ°YARNé›†ç¾¤ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">WordCountDriver</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">ClassNotFoundException</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 1. è·å–Job</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Configuration</span><span class="token plain"> conf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Configuration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Job</span><span class="token plain"> job </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 2. è®¾ç½®jarè·¯å¾„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setJarByClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">WordCountDriver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 3. å…³è”mapperå’Œreducer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setMapperClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">WordCountMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setReducerClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">WordCountReducer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 4. è®¾ç½®mapperè¾“å‡ºKVç±»å‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setMapOutputKeyClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setMapOutputValueClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">IntWritable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 5. è®¾ç½®æœ€ç»ˆè¾“å‡ºçš„KVç±»å‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setOutputKeyClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setOutputValueClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">IntWritable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 6. è®¾ç½®è¾“å…¥è¾“å‡ºè·¯å¾„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">FileInputFormat</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setInputPaths</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"wcinput\\words.txt"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">FileOutputFormat</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setOutputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"wcoutput"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 7. æäº¤Job</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">waitForCompletion</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>æ³¨æ„</h5></div><div class="admonition-content"><ol><li>æ³¨æ„å¯¼å…¥org.apache.hadoop.mapreduce.<!-- -->*<!-- -->è€Œä¸æ˜¯org.apache.hadoop.mapred.*ï¼Œå‰è€…æ˜¯Hadoop 2.x/3.xä½¿ç”¨ï¼Œåè€…æ˜¯Hadoop 1.xï¼›</li><li>WordCountDriverä¸­è®¾ç½®è¾“å‡ºKVç±»å‹ä»£ç å†™é”™ï¼Œå¯¼è‡´ç±»å‹ä¸ä¸€è‡´æŠ¥é”™ã€‚</li></ol></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="åºåˆ—åŒ–">åºåˆ—åŒ–<a class="hash-link" href="#åºåˆ—åŒ–" title="Direct link to heading">â€‹</a></h2><p>åºåˆ—åŒ–æ˜¯å°†å†…å­˜ä¸­å¯¹è±¡è½¬ä¸ºå­—èŠ‚åºåˆ—ä»¥ä¾¿äºæŒä¹…åŒ–å’Œç½‘ç»œä¼ è¾“çš„è¿‡ç¨‹ï¼Œååºåˆ—åŒ–æ˜¯å°†å­—èŠ‚åºåˆ—è½¬ä¸ºå†…å­˜ä¸­å¯¹è±¡çš„è¿‡ç¨‹ã€‚Javaåºåˆ—åŒ–æœºåˆ¶(Serializable)è¿‡äºé‡é‡ï¼Œé™„å¸¦æ ¡éªŒä¿¡æ¯ã€Headerã€ç»§æ‰¿ä½“ç³»ç­‰ï¼Œä¸ä¾¿äºç½‘ç»œä¸­é«˜æ•ˆä¼ è¾“ï¼Œå› æ­¤Hadoopè‡ªå®šä¹‰äº†åºåˆ—åŒ–æœºåˆ¶(Writable)ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ol><li>ç´§å‡‘ï¼šé«˜æ•ˆä½¿ç”¨å­˜å‚¨ç©ºé—´ï¼›</li><li>å¿«é€Ÿï¼šè¯»å†™æ•°æ®å¼€é”€å°ï¼›</li><li>äº’æ“ä½œï¼šæ”¯æŒå¤šè¯­è¨€äº¤äº’ã€‚</li></ol><p>å¯¹äºJavaä¸­çš„åŸºæœ¬ç±»å‹ï¼ŒHadoopæä¾›å¦‚ä¸‹å¯¹åº”åºåˆ—åŒ–ç±»ï¼š</p><table><thead><tr><th>Javaç±»å‹</th><th>Hadoop Writableç±»å‹</th></tr></thead><tbody><tr><td>Boolean</td><td>BooleanWritable</td></tr><tr><td>Byte</td><td>ByteWritable</td></tr><tr><td>Int</td><td>IntWritable</td></tr><tr><td>Float</td><td>FloatWritable</td></tr><tr><td>Long</td><td>LongWritable</td></tr><tr><td>Double</td><td>DoubleWritable</td></tr><tr><td>String</td><td>Text</td></tr><tr><td>Map</td><td>MapWritable</td></tr><tr><td>Array</td><td>ArrayWritable</td></tr><tr><td>Null</td><td>NullWritable</td></tr></tbody></table><p>æ„å»ºç¬¦åˆHadoopåºåˆ—åŒ–æœºåˆ¶çš„Beanç±»éœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š</p><ol><li>å®ç°Writableæ¥å£ï¼›</li><li>æä¾›ä¸€ä¸ªç©ºå‚æ„é€ å™¨(åºåˆ—åŒ–åå°„æ—¶ç”¨)ï¼›</li><li>é‡å†™writeå’ŒreadFieldsæ–¹æ³•ï¼Œ<strong>æ³¨æ„å­—æ®µè¯»å†™é¡ºåºä¸€è‡´</strong>ï¼›</li><li><strong>å½“Beanç±»ä½œä¸ºKeyä½¿ç”¨æ—¶è¿˜éœ€è¦å®ç°Comparableæ¥å£</strong>(Shuffleè¿‡ç¨‹ä½¿ç”¨)ï¼›</li><li>å½“éœ€è¦åºåˆ—åŒ–åˆ°æ–‡ä»¶æ—¶éœ€è¦é‡å†™toStringæ–¹æ³•ã€‚</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="mapreduceæ¡†æ¶">MapReduceæ¡†æ¶<a class="hash-link" href="#mapreduceæ¡†æ¶" title="Direct link to heading">â€‹</a></h2><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒMRæ¡†æ¶åŒ…å«4ä¸ªç»„ä»¶ï¼šInputFormatã€Mapperã€Reducerå’ŒOutputFormatã€‚MapReduceç¨‹åºæ‰§è¡Œæµç¨‹ä¸ºï¼šç”±InputFormatå°†è¾“å…¥æ•°æ®åˆ†ä¸ºåˆ‡ç‰‡(Split)ï¼ŒMapperè°ƒç”¨mapæ–¹æ³•å¤„ç†æ¯ä¸ªåˆ‡ç‰‡ä¸­æ•°æ®ï¼Œé€šè¿‡Shuffleå°†å¤„ç†åç»“æœäº¤ç»™Reducerï¼Œå®ƒåˆè°ƒç”¨reduceæ–¹æ³•åˆå¹¶åˆ‡ç‰‡ç»“æœï¼Œæœ€åé€šè¿‡OutputFormatå°†åˆå¹¶ç»“æœè¾“å‡ºã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="jobæäº¤æµç¨‹">Jobæäº¤æµç¨‹<a class="hash-link" href="#jobæäº¤æµç¨‹" title="Direct link to heading">â€‹</a></h3><p>åœ¨WordCountDriverä¸­è°ƒç”¨waitForCompletionæ–¹æ³•æ¥æäº¤ä½œä¸šå¹¶è·å–ç»“æœï¼Œè¯¥æ–¹æ³•è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>è°ƒç”¨submitæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>è°ƒç”¨ensureStateæ–¹æ³•åˆ¤æ–­å½“å‰æäº¤çŠ¶æ€ï¼Œå¿…é¡»æ˜¯JobState.DEFINEï¼›</li><li>è°ƒç”¨setUseNewAPIæ–¹æ³•å¤„ç†æ–°è€mapreduce APIçš„å…¼å®¹æ€§ï¼›</li><li>è°ƒç”¨connectæ–¹æ³•åˆ›å»ºClusterå¯¹è±¡ï¼Œè¯¥ç±»çš„æ„é€ æ–¹æ³•è°ƒç”¨initializeæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆä¾æ¬¡éå†YarnClientProtocolProviderå’ŒLocalClientProtocolProviderï¼Œç¡®å®šå®¢æˆ·ç«¯ä¸ºLocalJobRunnerï¼›</li><li>è°ƒç”¨submitJobInternalæ–¹æ³•ã€‚</li></ol></li><li><p>å±•å¼€åˆ†æsubmitJobInternalæ–¹æ³•æµç¨‹ï¼š</p><ol><li>è°ƒç”¨checkSpecsæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è°ƒç”¨OutputFormatçš„checkOutputSpecsæ–¹æ³•æ£€æŸ¥è¾“å‡ºé…ç½®(<strong>å¯¹äºFileOutputFormatæ¥è¯´å®ƒæ£€æŸ¥è¾“å‡ºè·¯å¾„ä¸èƒ½ä¸ºç©ºå¹¶ä¸”ä¸èƒ½å·²ç»å­˜åœ¨</strong>)ï¼›</li><li>è°ƒç”¨JobSubmissionFiles.getStagingDir()æ–¹æ³•ç”Ÿæˆä¸€ä¸ªstageæ–‡ä»¶å¤¹ï¼›</li><li>è°ƒç”¨ClientProtocol.getNewJobID()ç”ŸæˆjobIdï¼›</li><li>stageè·¯å¾„å’ŒjobIdç»„æˆè·¯å¾„submitJobDir(ä¾‹å¦‚/tmp/hadoop/mapred/staging/xiaok1378532364/.staging/job_local1378532364_0001)ï¼›</li><li>é€šè¿‡è°ƒç”¨é“¾copyAndConfigureFiles-&gt;uploadResources-&gt;uploadResourcesInternalæ–¹æ³•ï¼Œè¿›è¡Œç”ŸæˆsubmitJobDiræ–‡ä»¶å¤¹ï¼Œå°†ç¨‹åºjaråŒ…ä¸Šä¼ åˆ°é›†ç¾¤(uploadJobJar)ç­‰æ“ä½œï¼›</li><li>è°ƒç”¨InputFormatçš„writeSplitsæ–¹æ³•å¾—åˆ°åˆ‡ç‰‡æ•°mapsï¼Œåœ¨submitJobDirä¸‹ç”Ÿæˆåˆ‡ç‰‡ä¿¡æ¯æ–‡ä»¶(<code>.job.split.crc</code>ã€<code>.job.splitmetainfo.crc</code>ã€<code>job.split</code>ã€<code>job.splitmetainfo</code>)ï¼Œéšåå°†åˆ‡ç‰‡æ•°è®¾ç½®åˆ°Configurationä¸­ï¼›</li><li>è°ƒç”¨writeConfæ–¹æ³•ï¼Œåœ¨submitJobDirä¸‹ç”Ÿæˆ<code>job.xml</code>(åŒ…å«æœ¬æ¬¡ä½œä¸šæ‰§è¡Œæ‰€æœ‰çš„é…ç½®ä¿¡æ¯)å’Œ<code>.job.xml.crc</code>ï¼›</li><li>è°ƒç”¨ClientProtocol.submitJobæ–¹æ³•æäº¤ä½œä¸šï¼›</li></ol></li><li><p>å°†stateè®¾ç½®ä¸ºJobState.RUNNINGï¼Œå›åˆ°waitForCompletionï¼›</p></li><li><p>æœ€åè¿”å›isSuccessful()æ–¹æ³•ç»“æœã€‚</p></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="fileinputformatåˆ‡ç‰‡">FileInputFormatåˆ‡ç‰‡<a class="hash-link" href="#fileinputformatåˆ‡ç‰‡" title="Direct link to heading">â€‹</a></h3><p>writeSplitsæ–¹æ³•æ ¹æ®æ˜¯å¦ä½¿ç”¨æ–°MapReduce APIé€‰æ‹©è°ƒç”¨writeNewSplitsæ–¹æ³•æˆ–è€…writeOldSplitsï¼Œè¿™é‡Œåˆ†æwriteNewSplitsä»£ç ï¼Œå®ƒè°ƒç”¨InputFormatçš„getSplitsæŠ½è±¡æ–¹æ³•ã€‚æŠ½è±¡ç±»InputFormatçš„å„ä¸ªå­ç±»xxxInputFormatä¼šå®ç°getSplitsæ–¹æ³•ï¼Œä»¥FileInputFormatçš„getSplitsæ–¹æ³•ä¸ºä¾‹åˆ†æå¦‚ä¸‹ï¼š</p><ol><li>è·å¾—minSize=1ï¼ŒmaxSize=Long.MAX_VALUEï¼›</li><li>å¾ªç¯éå†è¾“å…¥è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ‰§è¡Œæ­¥éª¤3-6ï¼›</li><li>ç”±isSplitableæ–¹æ³•åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å¯åˆ‡ç‰‡ï¼ŒFileInputFormaté»˜è®¤ä¸ºtrueï¼›</li><li>è·å–å—å¤§å°blockSizeï¼Œé»˜è®¤æ˜¯33554432(æœ¬åœ°è°ƒè¯•ä¸º32MB)ï¼›</li><li>è®¡ç®—åˆ‡ç‰‡å¤§å°splitSize=Math.max(minSize, Math.min(maxSize, blockSize))ï¼Œå› æ­¤é»˜è®¤åˆ‡ç‰‡å¤§å°å°±æ˜¯å—å¤§å°ï¼›</li><li>whileå¾ªç¯ç”Ÿæˆåˆ‡ç‰‡ä¿¡æ¯InputSplitåˆ—è¡¨ï¼Œæ³¨æ„åªæœ‰å‰©ä½™é•¿åº¦/splitSizeå¤§äºSPLIT_SLOP(é»˜è®¤0.1)æ—¶æ‰ä¼šåˆ‡ç‰‡ã€‚</li></ol><p>æ¥ç€è°ƒç”¨JobSplitWriter.createSplitFilesåœ¨subJobDirä¸­ç”Ÿæˆåˆ‡ç‰‡è§„åˆ’æ–‡ä»¶ï¼Œå°†å…¶æäº¤åˆ°YARNä¸Šåï¼ŒMrAppMasteræ ¹æ®åˆ‡ç‰‡è§„åˆ’æ–‡ä»¶æ¥è®¡ç®—MapTaskä¸ªæ•°ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="textinputformatå’Œcombinefileinputformat">TextInputFormatå’ŒCombineFileInputFormat<a class="hash-link" href="#textinputformatå’Œcombinefileinputformat" title="Direct link to heading">â€‹</a></h3><p>FileInputFormatæŠ½è±¡ç±»ä¸‹é’ˆå¯¹ä¸åŒä½¿ç”¨åœºæ™¯æ´¾ç”Ÿäº†NLineInputFormatã€TextInputFormatã€CombineFileInputFormatã€KeyValueTextInputFormatç­‰å­ç±»ï¼Œæœ¬èŠ‚ä»‹ç»å¸¸ç”¨çš„TextInputFormatå’ŒCombineFileInputFormatã€‚</p><p>TextInputFormatæ˜¯FileInputFormatçš„é»˜è®¤å®ç°ç±»ï¼Œæºç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">TextInputFormat</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">FileInputFormat</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">LongWritable</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Text</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">RecordReader</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">LongWritable</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Text</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">createRecordReader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">InputSplit</span><span class="token plain"> split</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token class-name">TaskAttemptContext</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> delimiter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getConfiguration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"textinputformat.record.delimiter"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> recordDelimiterBytes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> delimiter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      recordDelimiterBytes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> delimiter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Charsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UTF_8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LineRecordReader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">recordDelimiterBytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isSplitable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">JobContext</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token plain"> file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">CompressionCodec</span><span class="token plain"> codec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">CompressionCodecFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getConfiguration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCodec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> codec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> codec </span><span class="token keyword" style="color:#00009f">instanceof</span><span class="token plain"> </span><span class="token class-name">SplittableCompressionCodec</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>TextInputFormatåˆ‡ç‰‡æŒ‰ç…§æ–‡ä»¶ä¸€ä¸ªä¸€ä¸ªæ¥ï¼Œä¸ç®¡æ–‡ä»¶æœ‰å¤šå°éƒ½è‡³å°‘æ˜¯ä¸€ä¸ªåˆ‡ç‰‡ï¼Œå¯¹äºå¤§é‡å°æ–‡ä»¶è€Œè¨€è¿™å›äº§ç”Ÿå¤§é‡MapTaské™ä½å¤„ç†æ•ˆç‡ã€‚è€ŒCombineFileInputFormatç”¨äºå¤„ç†è¿™ç§å¤§é‡å°æ–‡ä»¶çš„æƒ…å†µï¼Œé€šè¿‡CombineTextInputFormat.setMaxInputSplitSizeè®¾ç½®è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡å¤§å°maxInputSplitSizeï¼Œå¹¶æŒ‰ç…§å¦‚ä¸‹è¿‡ç¨‹åˆ‡ç‰‡ï¼š</p><ol><li>å¾ªç¯éå†è¾“å…¥æ–‡ä»¶ï¼Œå¾—åˆ°æ–‡ä»¶å¤§å°fileSizeï¼›</li><li>fileSize &lt; maxInputSplitSizeï¼Œé€»è¾‘ä¸Šåˆ’åˆ†ä¸ºä¸€å—è™šæ‹Ÿå­˜å‚¨ï¼›</li><li>2 * maxInputSplitSize &lt; fileSizeï¼Œä»¥maxInputSplitSizeåˆ‡åˆ†ä¸€å—ï¼›</li><li>maxInputSplitSize &lt; fileSize &lt;  2 * maxInputSplitSizeï¼Œå¹³å‡åˆ†æˆ2å—ï¼›</li><li>éå†æ‰€æœ‰è™šæ‹Ÿå­˜å‚¨å—ï¼Œåˆ¤æ–­å¤§å°virtBlockSizeæ˜¯å¦å¤§äºmaxInputSplitSize</li><li>virtBlockSizeå¤§äºç­‰äºmaxInputSplitSizeï¼Œå½¢æˆä¸€ä¸ªåˆ‡ç‰‡ï¼›</li><li>virtBlockSizeå°äºmaxInputSplitSizeï¼Œä¸ä¸‹ä¸€ä¸ªè™šæ‹Ÿå­˜å‚¨å—åˆå¹¶å½¢æˆä¸€ä¸ªåˆ‡ç‰‡ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="shuffle">Shuffle<a class="hash-link" href="#shuffle" title="Direct link to heading">â€‹</a></h3><p>mapæ–¹æ³•ä¹‹åreduceæ–¹æ³•ä¹‹å‰çš„æ•°æ®å¤„ç†è¿‡ç¨‹ï¼ŒåŒ…å«åˆ†åŒºã€æ’åºã€Combinerç­‰æ“ä½œã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="åˆ†åŒºç­–ç•¥">åˆ†åŒºç­–ç•¥<a class="hash-link" href="#åˆ†åŒºç­–ç•¥" title="Direct link to heading">â€‹</a></h4><p>å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œå½“æœªé€šè¿‡<code>Job.setNumReduceTasks(int tasks)</code>è®¾ç½®ä»»åŠ¡æ•°é‡æ—¶ï¼Œé»˜è®¤partitionsä¸º1ï¼Œæ­¤æ—¶getPartitionè¿”å›0ï¼Œå³åªæœ‰ä¸€ä¸ªåˆ†åŒºã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token class-name">NewOutputCollector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name namespace" style="opacity:0.7">org</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name namespace" style="opacity:0.7">apache</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name namespace" style="opacity:0.7">hadoop</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name namespace" style="opacity:0.7">mapreduce</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name">JobContext</span><span class="token plain"> jobContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token class-name">JobConf</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token class-name">TaskUmbilicalProtocol</span><span class="token plain"> umbilical</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token class-name">TaskReporter</span><span class="token plain"> reporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">ClassNotFoundException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  collector </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createSortingCollector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reporter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  partitions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jobContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getNumReduceTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">partitions </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    partitioner </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name namespace" style="opacity:0.7">org</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name namespace" style="opacity:0.7">apache</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name namespace" style="opacity:0.7">hadoop</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name namespace" style="opacity:0.7">mapreduce</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name">Partitioner</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">ReflectionUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jobContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPartitionerClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    partitioner </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name namespace" style="opacity:0.7">org</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name namespace" style="opacity:0.7">apache</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name namespace" style="opacity:0.7">hadoop</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name namespace" style="opacity:0.7">mapreduce</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name">Partitioner</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getPartition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">K</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">V</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> numPartitions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> partitions </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è‹¥è®¾ç½®æ•°é‡å¤§äº1ï¼Œåˆ™é€šè¿‡getPartitionerClass()æ–¹æ³•è·å–åˆ†åŒºç±»å¹¶é€šè¿‡åå°„å®ä¾‹åŒ–ï¼Œé»˜è®¤ä½¿ç”¨HashPartitionerï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°<code>mapreduce.job.partitioner.class</code>æŒ‡å®šã€‚æ­¤æ—¶è·å–åˆ†åŒºç¼–å·é€šè¿‡keyçš„hashå€¼å¯¹ä»»åŠ¡æ•°é‡å–æ¨¡å¾—åˆ°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">HashPartitioner.java</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">HashPartitioner</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">Partitioner</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">K</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">V</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Use {@link Object#hashCode()} to partition. */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getPartition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">K</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">V</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> numReduceTasks</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hashCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token class-name">Integer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MAX_VALUE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> numReduceTasks</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å› æ­¤ï¼Œè‡ªå®šä¹‰åˆ†åŒºç­–ç•¥æœ‰å¦‚ä¸‹3æ­¥ï¼š</p><ol><li>è‡ªå®šä¹‰CustomPartitionerç±»ç»§æ‰¿PartitioneræŠ½è±¡ç±»ï¼Œå®ç°getPartitionæŠ½è±¡æ–¹æ³•ï¼›</li><li>åœ¨é©±åŠ¨ç±»ä¸­æ³¨å†Œä½¿ç”¨ï¼Œ<code>job.setPartitionerClass(CustomPartitioner.class)</code>ï¼›</li><li>è®¾ç½®reduceä»»åŠ¡æ•°é‡ï¼Œ<code>job.setNumReduceTasks(2)</code>ã€‚</li></ol><p>æ³¨æ„getPartitionæ–¹æ³•è¿”å›çš„åˆ†åŒºå·å¿…é¡»ä»0å¼€å§‹ï¼Œé€ä¸€å¢åŠ ã€‚å¦‚æœè®¾ç½®reduceä»»åŠ¡æ•°é‡å’ŒgetPartitionè¿”å›å€¼ä¸åŒï¼Œæ ¹æ®ä¸¤è€…å…³ç³»æœ‰å¦‚ä¸‹æƒ…å†µï¼š</p><ol><li>å¦‚æœreduceä»»åŠ¡æ•°é‡å¤§äºgetPartitionè¿”å›çš„æœ€å¤§å€¼ï¼Œåˆ™äº§ç”Ÿç©ºçš„è¾“å‡ºæ–‡ä»¶part-r-000xxï¼›</li><li>å¦‚æœ1 &lt; reduceä»»åŠ¡æ•°é‡ &lt; getPartitionæ•°é‡ï¼Œåˆ™æŠ›å‡ºIOExceptionå¼‚å¸¸ï¼›</li><li>å¦‚æœreduceä»»åŠ¡æ•°é‡ä¸º1ï¼Œåˆ™åªç”Ÿæˆä¸€ä¸ªè¾“å‡ºæ–‡ä»¶part-r-00000ã€‚</li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="æ’åº">æ’åº<a class="hash-link" href="#æ’åº" title="Direct link to heading">â€‹</a></h4><p>MapTaskå’ŒReduceTaskå‡ä¼šå¯¹æ•°æ®æŒ‰ç…§keyè¿›è¡Œæ’åºï¼Œè¿™æ˜¯Hadoopçš„é»˜è®¤è¡Œä¸ºï¼Œä¸ç®¡ç¨‹åºé€»è¾‘ä¸Šæ˜¯å¦éœ€è¦ã€‚</p><p>å¯¹äºMapTaskï¼Œå®ƒä¼šå°†å¤„ç†çš„ç»“æœæš‚æ—¶æ”¾åˆ°ç¯å½¢ç¼“å†²åŒºä¸­ï¼Œå½“ç¯å½¢ç¼“å†²åŒºä½¿ç”¨ç‡è¾¾åˆ°ä¸€å®šé˜ˆå€¼åï¼Œå†å¯¹ç¼“å†²åŒºä¸­çš„æ•°æ®è¿›è¡Œä¸€æ¬¡å¿«é€Ÿæ’åºï¼Œå¹¶å°†è¿™äº›æœ‰åºæ•°æ®æº¢å†™åˆ°ç£ç›˜ä¸Šï¼Œè€Œå½“æ•°æ®å¤„ç†å®Œæ¯•åï¼Œå®ƒä¼šå¯¹ç£ç›˜ä¸Šæ‰€æœ‰æ–‡ä»¶è¿›è¡Œå½’å¹¶æ’åºã€‚</p><p>å¯¹äºReduceTaskï¼Œå®ƒä»æ¯ä¸ªMapTaskä¸Šè¿œç¨‹æ‹·è´ç›¸åº”çš„æ•°æ®æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å¤§å°è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œåˆ™æº¢å†™ç£ç›˜ä¸Šï¼Œå¦åˆ™å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚å¦‚æœç£ç›˜ä¸Šæ–‡ä»¶æ•°ç›®è¾¾åˆ°ä¸€å®šé˜ˆå€¼ï¼Œåˆ™è¿›è¡Œä¸€æ¬¡å½’å¹¶æ’åºä»¥ç”Ÿæˆä¸€ä¸ªæ›´å¤§æ–‡ä»¶ï¼›å¦‚æœå†…å­˜ä¸­æ–‡ä»¶å¤§å°æˆ–è€…æ•°ç›®è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œåˆ™è¿›è¡Œä¸€æ¬¡åˆå¹¶åå°†æ•°æ®æº¢å†™åˆ°ç£ç›˜ä¸Šã€‚å½“æ‰€æœ‰æ•°æ®æ‹·è´å®Œæ¯•åï¼ŒReduceTaskç»Ÿä¸€å¯¹å†…å­˜å’Œç£ç›˜ä¸Šçš„æ‰€æœ‰æ•°æ®è¿›è¡Œä¸€æ¬¡å½’å¹¶æ’åºã€‚</p><p>æ’åºè¦æ±‚keyç±»å‹å®ç°WritableComparableæ¥å£ï¼Œå³åœ¨Writableæ¥å£çš„åŸºç¡€ä¸Šå®ç°Comparableæ¥å£ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="combiner">Combiner<a class="hash-link" href="#combiner" title="Direct link to heading">â€‹</a></h4><p>Combinerä½œä¸ºReducerçš„å­ç±»ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„Reducerã€‚Combineråœ¨æ¯ä¸€ä¸ªMapTaskæ‰€åœ¨çš„èŠ‚ç‚¹è¿è¡Œï¼Œè€ŒReduceræ¥æ”¶å…¨å±€æ‰€æœ‰Mapperçš„è¾“å‡ºç»“æœã€‚Combinerå¯¹æ¯ä¸ªMapTaskçš„è¾“å‡ºè¿›è¡Œå±€éƒ¨æ±‡æ€»ï¼Œä»¥å‡å°‘ç½‘ç»œä¼ è¾“é‡ã€‚<strong>æ³¨æ„ä½¿ç”¨Combinerçš„å‰ææ˜¯ä¸å½±å“æœ€ç»ˆçš„ä¸šåŠ¡é€»è¾‘(æ¯”å¦‚è®¡ç®—å¹³å‡æ•°å°±ä¸è¡Œ)</strong>ï¼Œè¾“å‡ºK-Vå’ŒReducerçš„è¾“å…¥K-VåŒ¹é…ã€‚</p><p>è®¾ç½®setNumReduceTasksä¸º0ï¼ŒShuffleé˜¶æ®µä¸å­˜åœ¨ï¼Œå› æ­¤Combinerä¹Ÿä¸ç”Ÿæ•ˆã€‚ä¸šåŠ¡é€»è¾‘ç›¸åŒçš„å¯ä»¥ç›´æ¥ä½¿ç”¨Reducerä½œä¸ºCombinerã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="maptaskå·¥ä½œæœºåˆ¶">MapTaskå·¥ä½œæœºåˆ¶<a class="hash-link" href="#maptaskå·¥ä½œæœºåˆ¶" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="maptaskæºç åˆ†æ">MapTaskæºç åˆ†æ<a class="hash-link" href="#maptaskæºç åˆ†æ" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">è‡ªå®šä¹‰</span><span class="token class-name">Mapper</span><span class="token plain">ç±»çš„mapæ–¹æ³•è°ƒç”¨`context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">`ï¼›</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">WrappedMapper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">TaskInputOutputContextImpl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">MapTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> partitioner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPartition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> partitions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        é»˜è®¤ä½¿ç”¨</span><span class="token class-name">HashPartitioner</span><span class="token plain">çš„getPartitionæ–¹æ³•</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">MapTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">collect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">æ–¹æ³•å°†æ‰€æœ‰</span><span class="token class-name">K</span><span class="token operator" style="color:#393A34">-</span><span class="token class-name">V</span><span class="token plain">å†™å‡º</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å›åˆ°runNewMapperæ–¹æ³•ä¸­è°ƒç”¨output</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">MapTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">805</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è°ƒç”¨collector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">flush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">MapTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">735</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            è°ƒç”¨</span><span class="token function" style="color:#d73a49">sortAndSpill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">æ–¹æ³• </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">MapTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1505</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">ï¼Œ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                è°ƒç”¨sorter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">æ–¹æ³• </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">MapTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1625</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            è°ƒç”¨</span><span class="token function" style="color:#d73a49">mergeParts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">æ–¹æ³•åˆå¹¶æ–‡ä»¶ </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">MapTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1527</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        è°ƒç”¨collector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">ï¼Œå…³é—­æ”¶é›†å™¨ï¼Œè¿›å…¥</span><span class="token class-name">ReduceTask</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">MapTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">739</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="reducetaskæºç åˆ†æ">ReduceTaskæºç åˆ†æ<a class="hash-link" href="#reducetaskæºç åˆ†æ" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ä»¥</span><span class="token class-name">ReduceTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">ä¸ºå…¥å£</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">initialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">ReduceTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line333</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shuffleConsumerPlugin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shuffleContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">ReduceTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">375</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ShuffleSchedulerImpl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">Shuffle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line77</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        totalMaps </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getNumMapTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">ShuffleSchedulerImpl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">120</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    merger </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createMergeManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">Shuffle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">MergeManagerImpl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">Shuffle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">85</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">inMemoryMerger </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createInMemoryMerger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">MergeManagerImpl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">232</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">onDiskMerger </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">OnDiskMerger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">MergeManagerImpl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">235</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rIter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> shuffleConsumerPlugin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">ReduceTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">375</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eventFetcher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">å¼€å§‹æŠ“å–æ•°æ®ï¼Œ</span><span class="token class-name">Shuffle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">107</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eventFetcher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">shutDown</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">æŠ“å–å®Œæ¯•ï¼Œ</span><span class="token class-name">Shuffle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">141</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    copyPhase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">complete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">copyå®Œæˆ</span><span class="token class-name">Shuffle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">151</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    taskStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPhase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TaskStatus</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Phase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">å¼€å§‹æ’åºé˜¶æ®µï¼Œ</span><span class="token class-name">Shuffle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">152</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortPhase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">complete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">æ’åºé˜¶æ®µå®Œæˆï¼Œè¿›å…¥reduceï¼Œ</span><span class="token class-name">ReduceTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">382</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">runNewReducer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">è¿›å…¥reducerï¼Œ</span><span class="token class-name">ReduceTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">390</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reducer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">ReduceTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">628</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">setup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">Reduce</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">168</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">reduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">Reduce</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">171</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">cleanup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">Reduce</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">java</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Line</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">179</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="join">Join<a class="hash-link" href="#join" title="Direct link to heading">â€‹</a></h2><p>MapReduceç¨‹åºçš„Joinæ“ä½œåˆ†ä¸ºReduce Joinå’ŒMap Joinä¸¤ç§ï¼š</p><ul><li><strong>Reduce Join</strong>ï¼šmapæ–¹æ³•å¯¹è®°å½•æ‰“æ ‡ç­¾ï¼Œä»¥è¿æ¥å­—æ®µä¸ºkeyï¼Œå…¶ä½™å­—æ®µåŠ æ ‡ç­¾ä¸ºvalueï¼›reduceæ–¹æ³•é€šè¿‡æ ‡ç­¾åŒºåˆ†ä¸åŒæ¥æºï¼Œç„¶ååˆå¹¶ã€‚ç¼ºç‚¹æ˜¯æ‰€æœ‰åˆå¹¶æ“ä½œåœ¨Reduceé˜¶æ®µå®Œæˆï¼ŒMapé˜¶æ®µå‹åŠ›å°ä½†Reduceé˜¶æ®µå‹åŠ›å¤§ï¼Œå®¹æ˜“äº§ç”Ÿ<strong>æ•°æ®å€¾æ–œ</strong>ï¼›</li><li><strong>Map Join</strong>ï¼šåœ¨Mapé˜¶æ®µç¼“å­˜å¤šå¼ è¡¨ï¼Œæå‰å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œ<strong>é€‚åˆå°è¡¨å…³è”å¤§è¡¨</strong>ã€‚
å‰è€…é€šè¿‡æ‰“æ ‡ç­¾æ¥åŒºåˆ†ä¸åŒæ¥æºçš„è®°å½•ï¼Œç„¶åç”¨è¿æ¥å­—æ®µä¸ºkeyï¼Œå…¶ä½™éƒ¨åˆ†åŠ æ ‡ç­¾ä¸ºvalueè¿›è¡Œreduceè¾“å‡ºã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</li></ul><ol><li>Driverç±»æ·»åŠ ç¼“å­˜æ–‡ä»¶ï¼š<code>job.addCacheFile(new URI)</code>ï¼›</li><li>è®¾ç½®ReduceTaskæ•°é‡ä¸º0ï¼š<code>job.setNumberReduceTasks(0)</code>ï¼›</li><li>Mapperç±»çš„setupæ–¹æ³•è¯»å–ç¼“å­˜æ–‡ä»¶å¹¶ä¿å­˜ä¸ºé›†åˆï¼›</li><li>mapæ–¹æ³•æ ¹æ®é›†åˆå’Œæ•°æ®å®Œæˆå…³è”åˆå¹¶ã€‚</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="etl">ETL<a class="hash-link" href="#etl" title="Direct link to heading">â€‹</a></h2><p>ETL(Extract-Transform-Load)æŒ‡æ•°æ®ä»æºç«¯ç»è¿‡æŠ½å–ã€è½¬æ¢å’ŒåŠ è½½åˆ°ç›®æ ‡ç«¯çš„è¿‡ç¨‹ï¼Œåœ¨è¿è¡Œæ ¸å¿ƒä¸šåŠ¡MapReduceç¨‹åºä¹‹å‰éƒ½éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ï¼Œ<strong>ETLå¾€å¾€åªéœ€è¦è¿è¡ŒMapperè€Œä¸éœ€è¦Reducer</strong>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="å‹ç¼©">å‹ç¼©<a class="hash-link" href="#å‹ç¼©" title="Direct link to heading">â€‹</a></h2><p>Hadoopæ•°æ®å‹ç¼©çš„ä¼˜ç‚¹æ˜¯å‡å°‘IOæ¬¡æ•°ã€å‡å°‘å­˜å‚¨ç©ºé—´ï¼Œä½†ç¼ºç‚¹æ˜¯å¢åŠ CPUå¼€é”€ã€‚å› æ­¤ä½¿ç”¨å‹ç¼©çš„åŸåˆ™æ˜¯CPUå¯†é›†å‹åº”ç”¨å°‘ç”¨å‹ç¼©ï¼Œè€ŒIOå¯†é›†å‹åº”ç”¨å¤šç”¨å‹ç¼©ã€‚</p><table><thead><tr><th>å‹ç¼©æ ¼å¼</th><th>Hadoopæ˜¯å¦è‡ªå¸¦</th><th>ç®—æ³•</th><th>æ‰©å±•å</th><th>æ˜¯å¦å¯åˆ‡ç‰‡</th><th>æ˜¯å¦éœ€è¦ä¿®æ”¹ç¨‹åº</th></tr></thead><tbody><tr><td>DEFALTE</td><td>æ˜¯</td><td>DEFLATE</td><td>.deflate</td><td>å¦</td><td>å¦</td></tr><tr><td>GZIP</td><td>æ˜¯</td><td>DEFLATE</td><td>.gz</td><td>å¦</td><td>å¦</td></tr><tr><td>bzip2</td><td>æ˜¯</td><td>bzip2</td><td>.bz2</td><td><strong>æ˜¯</strong></td><td>å¦</td></tr><tr><td>LZO</td><td><strong>å¦</strong></td><td>LZO</td><td>.lzo</td><td><strong>æ˜¯</strong></td><td>éœ€è¦å»ºç´¢å¼•ï¼ŒæŒ‡å®šè¾“å…¥æ ¼å¼</td></tr><tr><td>snappy</td><td>æ˜¯</td><td>Snappy</td><td>.snappy</td><td>å¦</td><td>å¦</td></tr></tbody></table><p>å½“å‹ç¼©åº”ç”¨äºInputFormatï¼Œæ— é¡»æ˜¾ç¤ºæŒ‡å®šä½¿ç”¨çš„ç¼–ç æ–¹æ³•ï¼ŒHadoopä¼šè‡ªåŠ¨æ£€æŸ¥æ–‡ä»¶æ‰©å±•åé€‰æ‹©åˆé€‚çš„è§£ç¼–ç æ–¹å¼å¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©å’Œè§£å‹ã€‚åœ¨å¼€å‘ä¸­è‹¥æ•°æ®é‡å°äºå—å¤§å°ï¼Œé‡ç‚¹è€ƒè™‘å‹ç¼©å’Œè§£å‹æ¯”è¾ƒå¿«çš„LZO/Snappyï¼Œè‹¥æ•°æ®é‡éå¸¸å¤§ï¼Œé‡ç‚¹è€ƒè™‘æ”¯æŒåˆ‡ç‰‡çš„Bzip2å’ŒLZOã€‚å½“å‹ç¼©åº”ç”¨äºShuffleé˜¶æ®µï¼Œé‡ç‚¹è€ƒè™‘å‹ç¼©å’Œè§£å‹å¿«çš„LZO/Snappyã€‚å½“å‹ç¼©åº”ç”¨äºOutputFormatï¼Œå¦‚æœæ•°æ®æ°¸ä¹…ä¿å­˜åˆ™è€ƒè™‘å‹ç¼©ç‡é«˜çš„bzip2å’ŒGzipï¼Œå¦‚æœä½œä¸ºä¸‹ä¸€ä¸ªMapReduceç¨‹åºçš„è¾“å…¥ï¼Œéœ€è¦è€ƒè™‘æ˜¯å¦æ”¯æŒåˆ‡ç‰‡ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å‹ç¼©é…ç½®">å‹ç¼©é…ç½®<a class="hash-link" href="#å‹ç¼©é…ç½®" title="Direct link to heading">â€‹</a></h3><table><thead><tr><th>å‚æ•°</th><th>é»˜è®¤å€¼</th><th>é˜¶æ®µ</th><th>å»ºè®®</th></tr></thead><tbody><tr><td>io.compression.codecs(core-site.xml)</td><td>æ— ï¼Œè¾“å…¥<code>hadoop checknative</code>æŸ¥çœ‹</td><td>è¾“å…¥å‹ç¼©</td><td></td></tr><tr><td>mapreduce.map.output.compress(mapred-site.xml)</td><td>false</td><td>mapperè¾“å‡º</td><td>è®¾ç½®ä¸ºtrueå¼€å¯å‹ç¼©</td></tr><tr><td>mapreduce.map.output.compress.codec(mapred-site.xml)</td><td>org.apache.hadoop.io.compress.DefaultCodec</td><td>mapperè¾“å‡º</td><td>è®¾ç½®LZOæˆ–Snappy</td></tr><tr><td>mapreduce.output.fileoutputformat.compress(mapred-site.xml)</td><td>false</td><td>reducerè¾“å‡º</td><td>è®¾ç½®ä¸ºtrueå¼€å¯å‹ç¼©</td></tr><tr><td>mapreduce.output.fileoutputformat.compress.codec(mapred-site.xml)</td><td>org.apache.hadoop.io.compress.DefaultCodec</td><td>reducerè¾“å‡º</td><td>ä½¿ç”¨gzipæˆ–bzip2</td></tr></tbody></table>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Hadoop" term="Hadoop"/>
        <category label="BigData" term="BigData"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hadoop 3.xå­¦ä¹ ç¬”è®°(2)]]></title>
        <id>/2022/01/30/Learning-Hadoop3.x-02</id>
        <link href="https://kayhaw.github.io/blog/2022/01/30/Learning-Hadoop3.x-02"/>
        <updated>2022-01-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Hadoop 3.1.3å­¦ä¹ ç¬”è®°(2)]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“Hadoop 3.1.3å­¦ä¹ ç¬”è®°ç¬¬2ç¯‡ï¼šHDFSã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="hdfsç®€ä»‹">HDFSç®€ä»‹<a class="hash-link" href="#hdfsç®€ä»‹" title="Direct link to heading">â€‹</a></h2><p>HDFS(Hadoop Distributed File System)æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œé€‚ç”¨äºä¸€æ¬¡å†™å…¥ï¼Œå¤šæ¬¡è¯»å‡ºçš„åœºæ™¯ã€‚</p><p>ä¼˜ç‚¹ğŸ˜„ï¼š</p><ol><li>é«˜å®¹é”™æ€§ï¼šæ•°æ®å¤šå‰¯æœ¬ä¿å­˜ï¼ŒæŸä¸ªå‰¯æœ¬ä¸¢å¤±åèƒ½å¤Ÿè‡ªåŠ¨æ¢å¤ï¼›</li><li>é€‚åˆå¤„ç†å¤§æ•°æ®ï¼šå¤§å°è§„æ¨¡æ”¯æŒTBç”šè‡³PBï¼Œæ•°é‡è§„æ¨¡æ”¯æŒç™¾ä¸‡çº§ï¼›</li><li>æ„å»ºæˆæœ¬ä½ï¼šå¯ä»¥åœ¨å¤šä¸ªå»‰ä»·æœºå™¨ä¸Šæ„å»ºå‰¯æœ¬ã€‚</li></ol><p>ç¼ºç‚¹ğŸ˜ ï¼š</p><ol><li>æ•°æ®è®¿é—®å»¶è¿Ÿé«˜ï¼›</li><li>æ— æ³•é«˜æ•ˆå¯¹å¤§é‡å°æ–‡ä»¶è¿›è¡Œå­˜å‚¨ï¼šå ç”¨NameNodeå†…å­˜æ¥å­˜å‚¨æ–‡ä»¶ç›®å½•å’Œå—ä¿¡æ¯ï¼Œå¹¶ä¸”å¯»å€æ—¶é—´è¶…è¿‡è¯»å–æ—¶é—´ï¼Œè¿åHDFSè®¾è®¡ç›®æ ‡ï¼›</li><li>ä¸æ”¯æŒå¹¶å‘å†™å…¥ã€éšæœºä¿®æ”¹ï¼šä¸€ä¸ªæ–‡ä»¶ä¸èƒ½å¤šçº¿ç¨‹åŒæ—¶å†™ï¼Œä»…æ”¯æŒæ•°æ®è¿½åŠ ï¼Œä¸æ”¯æŒéšæœºä¿®æ”¹ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç»„æˆæ¶æ„">ç»„æˆæ¶æ„<a class="hash-link" href="#ç»„æˆæ¶æ„" title="Direct link to heading">â€‹</a></h3><img loading="lazy" style="width:80%;height:80%" src="/static/img/blog/HadoopNotes/hdfsarchitecture.png" title="Hadoop Architecture" class="img_E7b_"><ul><li>NameNode(NN)ï¼šç®¡ç†HDFSå‘½åç©ºé—´ï¼Œé…ç½®å‰¯æœ¬ç­–ç•¥ï¼Œç®¡ç†æ•°æ®å—æ˜ å°„ä¿¡æ¯ï¼Œå¤„ç†å®¢æˆ·ç«¯è¯»å†™è¯·æ±‚ï¼›</li><li>DataNodeï¼šå­˜å‚¨æ•°æ®å—ï¼Œæ‰§è¡Œæ•°æ®å—è¯»å†™æ“ä½œï¼›</li><li>SecondaryNameNodeï¼šå¹¶éNNçš„çƒ­å¤‡ï¼Œåœ¨NNæŒ‚æ‰æ—¶ä¸èƒ½é©¬ä¸Šæ›¿æ¢å…¶åŠŸèƒ½ï¼Œç”¨äºåˆ†æ‹…NNå·¥ä½œï¼Œæ¯”å¦‚å®šæœŸåˆå¹¶Fsimageå’ŒEditså¹¶æ¨é€ç»™NNã€‚åœ¨ç´§æ€¥æƒ…å†µä¸‹å¯è¾…åŠ©æ¢å¤NameNodeï¼›</li><li>Clientï¼šåˆ‡åˆ†æ–‡ä»¶ã€ä¸NameNodeäº¤äº’è·å–æ–‡ä»¶ä½ç½®ä¿¡æ¯ã€ä¸DataNodeäº¤äº’è¯»å†™æ•°æ®ã€æä¾›HDFSç®¡ç†å‘½ä»¤ã€æä¾›HDFSå¢åˆ æ”¹æŸ¥å‘½ä»¤ã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="å—å¤§å°">å—å¤§å°<a class="hash-link" href="#å—å¤§å°" title="Direct link to heading">â€‹</a></h3><p>HDFSæ–‡ä»¶åœ¨ç‰©ç†å­˜å‚¨ä¸Šæ˜¯åˆ†å—(Block)å­˜å‚¨ï¼Œé€šè¿‡å‚æ•°<code>dfs.blocksize</code>æŒ‡å®šï¼Œé»˜è®¤å¤§å°ä¸º128MB(Hadoop 2.x/3.xï¼ŒHadoop 1.xä¸º64MB)ã€‚</p><p>å½“å¯»å€æ—¶é—´ä¸ºä¼ è¾“æ—¶é—´çš„1%æ—¶è®¤ä¸ºè¾¾åˆ°æœ€ä½³çŠ¶æ€(â“)ï¼šå¦‚æœå—è®¾ç½®è¿‡å°ï¼Œå¢åŠ å¯»å€æ—¶é—´ï¼Œå¦‚æœå—è®¾ç½®è¿‡å¤§åˆ™ä»ç£ç›˜ä¼ è¾“æ•°æ®çš„æ—¶é—´å¤§äºå¯»å€æ—¶é—´ã€‚å› æ­¤ï¼Œå—å¤§å°è®¾ç½®å–å†³äºç£ç›˜ä¼ è¾“é€Ÿç‡ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="hdfs-shellæ“ä½œ">HDFS Shellæ“ä½œ<a class="hash-link" href="#hdfs-shellæ“ä½œ" title="Direct link to heading">â€‹</a></h2><p>ä¸¤ç§å‘½ä»¤æ ¼å¼ï¼š<code>hadoop fs [options] ...</code>å’Œ<code>hdfs dfs [options] ...</code>ï¼Œé€šè¿‡<code>hadoop fs -help &lt;é€‰é¡¹å&gt;</code>æ¥æŸ¥çœ‹å‘½ä»¤ç”¨æ³•ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä¸Šä¼ æ–‡ä»¶">ä¸Šä¼ æ–‡ä»¶<a class="hash-link" href="#ä¸Šä¼ æ–‡ä»¶" title="Direct link to heading">â€‹</a></h3><ul><li><code>-moveFromLocal &lt;local_file_path&gt; &lt;hadoop_file_path&gt;</code>ï¼šä»æœ¬åœ°<strong>å‰ªåˆ‡</strong>æ–‡ä»¶åˆ°HDFSï¼›</li><li><code>-copyFromLocal &lt;local_file_path&gt; &lt;hadoop_file_path&gt;</code>ï¼šä»æœ¬åœ°<strong>å¤åˆ¶</strong>æ–‡ä»¶åˆ°HDFSï¼›</li><li><code>-put &lt;local_file_path&gt; &lt;hadoop_file_path&gt;</code>ï¼šåŒcopyFromLocalï¼Œæ¨èä½¿ç”¨ï¼›</li><li><code>-appendToFile &lt;local_file_path&gt; &lt;hadoop_file_path&gt;</code>ï¼šè¿½åŠ æ–‡ä»¶å†…å®¹åˆ°HDFSæ–‡ä»¶ï¼Œæœ¬åœ°æ–‡ä»¶ä¸åˆ é™¤ã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä¸‹è½½æ–‡ä»¶">ä¸‹è½½æ–‡ä»¶<a class="hash-link" href="#ä¸‹è½½æ–‡ä»¶" title="Direct link to heading">â€‹</a></h3><ul><li><code>-copyToLocal &lt;hadoop_file_path&gt; &lt;local_file_path&gt;</code>ï¼šä»HDFS<strong>æ‹·è´</strong>æ–‡ä»¶åˆ°æœ¬åœ°ï¼›</li><li><code>-get &lt;hadoop_file_path&gt; &lt;local_file_path&gt;</code>ï¼šåŒ<code>-copyToLocal</code>ï¼Œæ¨èä½¿ç”¨ã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="hdfsæ–‡ä»¶ç³»ç»Ÿæ“ä½œ">HDFSæ–‡ä»¶ç³»ç»Ÿæ“ä½œ<a class="hash-link" href="#hdfsæ–‡ä»¶ç³»ç»Ÿæ“ä½œ" title="Direct link to heading">â€‹</a></h3><ul><li><code>-ls</code>ï¼šæ˜¾ç¤ºç›®å½•ä¿¡æ¯ï¼›</li><li><code>-cat</code>ï¼šæ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼›</li><li><code>-chgrp</code>ã€<code>-chmod</code>ã€<code>-chown</code>ï¼šä¿®æ”¹æ–‡ä»¶å±æ€§ï¼›</li><li><code>-mkdir</code>ï¼šåˆ›å»ºç›®å½•ï¼›</li><li><code>-cp</code>ï¼šHDFSå†…æ–‡ä»¶æ‹·è´ï¼›</li><li><code>-mv</code>ï¼šHDFSå†…æ–‡ä»¶ç§»åŠ¨ï¼›</li><li><code>-tail</code>ï¼šæ˜¾ç¤ºæ–‡ä»¶æœ«å°¾1KBæ•°æ®ï¼›</li><li><code>-rm</code>ï¼šåˆ é™¤æ–‡ä»¶ï¼ŒåŠ ä¸Š<code>-r</code>å‚æ•°é€’å½’åˆ é™¤æ–‡ä»¶å¤¹ï¼›</li><li><code>-du</code>ï¼šç»Ÿè®¡æ–‡ä»¶å¤§å°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå‰è€…è¡¨ç¤ºå•ä¸ªæ–‡ä»¶å¤§å°14ï¼Œåè€…è¡¨ç¤º14*3ä¸ªå‰¯æœ¬æ€»å¤§å°ï¼›</li></ul><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">kayhaw@hadoop102 hadoop-3.1.3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ hadoop fs -du -h /sanguo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">14</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">42</span><span class="token plain">  /sanguo/shu.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">21</span><span class="token plain">  /sanguo/weiguo.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">6</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">18</span><span class="token plain">  /sanguo/wu.txt</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ul><li><code>-setrep</code>ï¼šè®¾ç½®æ–‡ä»¶å‰¯æœ¬æ•°é‡ï¼Œåªæ˜¯è®°å½•åœ¨NameNodeçš„å…ƒæ•°æ®ä¸­ï¼Œå®é™…å‰¯æœ¬æ•°é‡ä¾èµ–äºDataNodeæ•°é‡ã€‚</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="hdfs-apiæ“ä½œ">HDFS APIæ“ä½œ<a class="hash-link" href="#hdfs-apiæ“ä½œ" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="windowså¼€å‘ç¯å¢ƒå‡†å¤‡">Windowså¼€å‘ç¯å¢ƒå‡†å¤‡<a class="hash-link" href="#windowså¼€å‘ç¯å¢ƒå‡†å¤‡" title="Direct link to heading">â€‹</a></h3><p>ä»<a href="https://github.com/cdarlint/winutils" target="_blank" rel="noopener noreferrer">cdarlint/winutils</a>å¤„ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ä¾èµ–åŒ…hadoop-3.1.0/binï¼Œé…ç½®ç¯å¢ƒå˜é‡%HADOOP_HOME%\binã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="filesystem-java-api">FileSystem Java API<a class="hash-link" href="#filesystem-java-api" title="Direct link to heading">â€‹</a></h3><p>è°ƒç”¨HDFS APIçš„æ¨¡æ¿ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">template</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">URISyntaxException</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 1. é›†ç¾¤è¿æ¥ä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">URI</span><span class="token plain"> uri </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">URI</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"hdfs://hadoop102:8020"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 2. åˆ›å»ºé…ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Configuration</span><span class="token plain"> config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Configuration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 2.1 é…ç½®ä¸€äº›å‚æ•°ï¼Œä¼˜å…ˆçº§æœ€é«˜</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"dfs.replication"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"2"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 3. è·å–å®¢æˆ·ç«¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">FileSystem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kayhaw"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 4. è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">xxx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 5. å…³é—­èµ„æº</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å…¶ä¸­ï¼Œå‚æ•°ä¼˜å…ˆçº§æŒ‰å¦‚ä¸‹é¡ºåºä¼˜å…ˆçº§ä¾æ¬¡å¢é«˜ï¼š</p><ol><li>hadoopé›†ç¾¤ä¸­hdfs-default.xml</li><li>hadoopé›†ç¾¤ä¸­hdfs-site.xml</li><li>ç¨‹åºresourceç›®å½•ä¸‹hdfs-site.xml</li><li>ä»£ç ä¸­é€šè¿‡Configuration.set()æ–¹æ³•è®¾ç½®</li></ol><p>å¸¸ç”¨çš„APIæœ‰ï¼š</p><ol><li>åˆ›å»ºæ–‡ä»¶å¤¹ï¼š<code>boolean mkdirs(Path f) throws IOException</code>ï¼›</li><li>ä¸Šä¼ æ–‡ä»¶(é‡è½½ç‰ˆæ”¯æŒPathæ•°ç»„srcè¿›è¡Œå¤šæ–‡ä»¶ä¸Šä¼ )ï¼š</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * The src file is on the local disk.  Add it to the filesystem at</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * the given dst name.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * delSrc indicates if the source should be removed</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * @param delSrc whether to delete the src</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * @param overwrite whether to overwrite an existing file</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * @param src path</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * @param dst path</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * @throws IOException IO failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">copyFromLocalFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> delSrc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> overwrite</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token class-name">Path</span><span class="token plain"> src</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token plain"> dst</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="3"><li>ä¸‹è½½æ–‡ä»¶ï¼š</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * The src file is under this filesystem, and the dst is on the local disk.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * Copy it from the remote filesystem to the local dst name.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * delSrc indicates if the src will be removed</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * or not. useRawLocalFileSystem indicates whether to use RawLocalFileSystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * as the local file system or not. RawLocalFileSystem is non checksumming,</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * So, It will not create any crc files at local.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * @param delSrc whether to delete the src</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * @param src path</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * @param dst path</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * @param useRawLocalFileSystem whether to use RawLocalFileSystem as local file system or not.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * @throws IOException for any IO error</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">copyToLocalFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> delSrc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token plain"> src</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token plain"> dst</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> useRawLocalFileSystem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="4"><li>åˆ é™¤æ–‡ä»¶</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** Delete a file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">* @param f </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">* @param recursive æ˜¯å¦é€’å½’åˆ é™¤æ–‡ä»¶å¤¹</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">* @return  true if delete is successful else false.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">* @throws IOException IO failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">abstract</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">delete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Path</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> recursive</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="5"><li>æ–‡ä»¶é‡å‘½å(ç§»åŠ¨)</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">abstract</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rename</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Path</span><span class="token plain"> src</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token plain"> dst</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="6"><li>éå†æ–‡ä»¶å¤¹è·å–æ–‡ä»¶ä¿¡æ¯ï¼š</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fileInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è·å–æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">RemoteIterator</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">LocatedFileStatus</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> listFiles </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">listFiles</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// éå†æ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listFiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">LocatedFileStatus</span><span class="token plain"> fileStatus </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> listFiles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"======="</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> fileStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"======="</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fileStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPermission</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fileStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getOwner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fileStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getGroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fileStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getLen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fileStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getModificationTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fileStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getReplication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fileStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBlockSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fileStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// è·å–å—ä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">BlockLocation</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> blockLocations </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fileStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBlockLocations</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Arrays</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">blockLocations</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="7"><li>åˆ¤æ–­æ˜¯æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹ï¼š</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isDirectory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å•ä¸ªæ–‡ä»¶æŸ¥çœ‹çŠ¶æ€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">FileStatus</span><span class="token plain"> file </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getFileStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/test/heke"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isDirectory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ–‡ä»¶å¤¹åˆ—è¡¨æŸ¥çœ‹çŠ¶æ€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">FileStatus</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> fileStatuses </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">listStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">FileStatus</span><span class="token plain"> fileStatus </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> fileStatuses</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fileStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isDirectory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"ç›®å½•ï¼š"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> fileStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"æ–‡ä»¶ï¼š"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> fileStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="hdfsè¯»å†™æµç¨‹">HDFSè¯»å†™æµç¨‹<a class="hash-link" href="#hdfsè¯»å†™æµç¨‹" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="å†™æ•°æ®">å†™æ•°æ®<a class="hash-link" href="#å†™æ•°æ®" title="Direct link to heading">â€‹</a></h3><ol><li>å®¢æˆ·ç«¯å‘NameNodeè¯·æ±‚ä¸Šä¼ æ–‡ä»¶</li><li>NameNodeæ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨ã€æ˜¯å¦å…·æœ‰æƒé™ï¼Œå“åº”å¯ä»¥ä¸Šä¼ æ–‡ä»¶</li><li>å®¢æˆ·ç«¯è¯·æ±‚ä¸Šä¼ ç¬¬ä¸€ä¸ªblockï¼Œç”±NameNodeè¿”å›DataNodeåœ°å€</li><li>NameNodeè¿”å›dn1ã€dn2ã€dn3èŠ‚ç‚¹åœ°å€</li><li>å®¢æˆ·ç«¯å‘å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹dn1è¯·æ±‚å»ºç«‹blockä¼ é€é€šé“ï¼Œç”±è¯¥èŠ‚ç‚¹å‘å…¶ä»–èŠ‚ç‚¹è¯·æ±‚å½¢æˆä¼ è¾“é€šé“</li><li>dn1å“åº”æˆåŠŸ</li><li>å®¢æˆ·ç«¯ä»¥packetä¸ºå•ä½(64KB)ä¼ è¾“æ•°æ®ï¼Œæ¯ä¸ªpacketç”±chunkç»„æˆ(chunk:512B+chunksum:4B)</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="èŠ‚ç‚¹è·ç¦»è®¡ç®—">èŠ‚ç‚¹è·ç¦»è®¡ç®—<a class="hash-link" href="#èŠ‚ç‚¹è·ç¦»è®¡ç®—" title="Direct link to heading">â€‹</a></h3><p>NameNodeå°†èŠ‚ç‚¹è·ç¦»æœ€è¿‘çš„DataNodeè¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒèŠ‚ç‚¹è·ç¦»=ä¸¤ä¸ªèŠ‚ç‚¹åˆ°è¾¾æœ€è¿‘çš„å…¬å…±ç¥–å…ˆçš„è·ç¦»æ€»å’Œï¼Œç”±æ­¤å¾—åˆ°ï¼š</p><ol><li>åŒä¸€èŠ‚ç‚¹ä¸Šçš„è¿›ç¨‹è·ç¦»ä¸º0ï¼›</li><li>åŒä¸€æœºæ¶ä¸Šçš„ä¸åŒèŠ‚ç‚¹è·ç¦»ä¸º2ï¼›</li><li>åŒä¸€æ•°æ®ä¸­å¿ƒä¸åŒæœºæ¶ä¸Šçš„èŠ‚ç‚¹è·ç¦»ä¸º4ï¼›</li><li>ä¸åŒæ•°æ®ä¸­å¿ƒçš„èŠ‚ç‚¹è·ç¦»ä¸º6ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="æœºæ¶æ„ŸçŸ¥">æœºæ¶æ„ŸçŸ¥<a class="hash-link" href="#æœºæ¶æ„ŸçŸ¥" title="Direct link to heading">â€‹</a></h3><p>NameNodeè¿”å›<a href="https://hadoop.apache.org/docs/r3.1.3/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html#Data_Replication" target="_blank" rel="noopener noreferrer">æ•°æ®å‰¯æœ¬</a>çš„å­˜æ”¾ä½ç½®æ—¶ï¼Œé€šå¸¸å‰¯æœ¬ä¸ªæ•°ä¸º3ï¼ŒæŒ‰ç…§å¦‚ä¸‹é¡ºåºæŒ‡å®š3ä¸ªèŠ‚ç‚¹ï¼šé¦–å…ˆå®¢æˆ·ç«¯åœ¨DataNodeä¸Šï¼ŒæŒ‡å®šä¸€ä¸ªèŠ‚ç‚¹ä¸ºæœ¬åœ°æœºå™¨ï¼Œå¦åˆ™éšæœºé€‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªæœºæ¶Aä¸Šé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹aï¼Œæœ€ååœ¨æœºæ¶Aä¸Šé€‰æ‹©ä¸€ä¸ªä¸åŒèŠ‚ç‚¹bã€‚å¯¹åº”æºç è§BlockPlacementPolicyDefaultç±»çš„chooseTargetInOrderæ–¹æ³•ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="è¯»æ•°æ®">è¯»æ•°æ®<a class="hash-link" href="#è¯»æ•°æ®" title="Direct link to heading">â€‹</a></h3><ol><li>å®¢æˆ·ç«¯é€šè¿‡DistributedFileSystemå‘NameNodeè¯·æ±‚ä¸‹è½½æ–‡ä»¶ï¼ŒNameNodeé€šè¿‡æŸ¥
è¯¢å…ƒæ•°æ®ï¼Œæ‰¾åˆ°æ–‡ä»¶å—æ‰€åœ¨çš„DataNodeåœ°å€ï¼›</li><li>æŒ‘é€‰ä¸€å°DataNode(å°±è¿‘åŸåˆ™ï¼Œç„¶åéšæœº)æœåŠ¡å™¨ï¼Œè¯·æ±‚è¯»å–æ•°æ®ï¼›</li><li>DataNodeå¼€å§‹ä¼ è¾“æ•°æ®ç»™å®¢æˆ·ç«¯(ä»ç£ç›˜é‡Œé¢è¯»å–æ•°æ®è¾“å…¥æµï¼Œä»¥Packetä¸ºå•ä½æ¥åšæ ¡éªŒ)ï¼›</li><li>å®¢æˆ·ç«¯ä»¥Packetä¸ºå•ä½æ¥æ”¶ï¼Œå…ˆåœ¨æœ¬åœ°ç¼“å­˜ï¼Œç„¶åå†™å…¥ç›®æ ‡æ–‡ä»¶ã€‚</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="nnå’Œ2nn">NNå’Œ2NN<a class="hash-link" href="#nnå’Œ2nn" title="Direct link to heading">â€‹</a></h2><p>NameNodeçš„å…ƒæ•°æ®åˆ†ä¸º2éƒ¨åˆ†ï¼šç£ç›˜ä¸­çš„å…ƒæ•°æ®å¤‡ä»½fsimageå’Œå†…å­˜ä¸­çš„å¢é‡æ–‡ä»¶editsã€‚ä½†é•¿æ—¶é—´åœ°æ·»åŠ è¿½å‰§åˆ°editsä¼šå¯¼é™ä½æ•ˆç‡ï¼Œå› æ­¤ç”±SeconaryNameNodeä¸“é—¨åˆå¹¶fsimageå’Œeditsã€‚Fsimageå’ŒEditsæ–‡ä»¶å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><p>ç¬¬ä¸€é˜¶æ®µï¼ŒNameNodeå¯åŠ¨ï¼š</p><ol><li>å¦‚æœNameNodeç¬¬1æ¬¡åˆå§‹åŒ–åˆ™åˆ›å»ºfsimageå’Œeditsæ–‡ä»¶ï¼Œå¦åˆ™åŠ è½½fsimageå’Œeditsåˆ°å†…å­˜ï¼›</li><li>å®¢æˆ·ç«¯å¯¹å…ƒæ•°æ®è¿›è¡Œå¢åˆ æ”¹çš„è¯·æ±‚ï¼›</li><li>NameNodeè®°å½•æ“ä½œæ—¥å¿—ï¼Œæ›´æ–°æ»šåŠ¨æ—¥å¿—ï¼›</li><li>NameNodeåœ¨å†…å­˜ä¸­å¯¹å…ƒæ•°æ®è¿›è¡Œå¢åˆ æ”¹ã€‚</li></ol><p>ç¬¬äºŒé˜¶æ®µï¼ŒSecondary NameNodeå·¥ä½œï¼š</p><ol><li>2NNè¯¢é—®NNæ˜¯å¦éœ€è¦checkpointï¼›</li><li>2NNè¯·æ±‚æ‰§è¡Œcheckpointï¼›</li><li>NNæ»šåŠ¨æ­£åœ¨å†™çš„editsæ—¥å¿—ï¼›</li><li>å°†æ»šåŠ¨å‰çš„editså’Œfsimageæ‹·è´åˆ°2NNï¼›</li><li>2NNåŠ è½½editså’Œfsimageåˆ°å†…å­˜è¿›è¡Œåˆå¹¶ï¼›</li><li>2NNåˆå¹¶ç”Ÿæˆfsimage.checkpointï¼›</li><li>2NNå°†fsimage.checkpointæ‹·è´åˆ°NNï¼›</li><li>NNå°†fsimage.checkpointé‡å‘½åä¸ºfsimageã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="fsimageå’Œedits">fsimageå’ŒEdits<a class="hash-link" href="#fsimageå’Œedits" title="Direct link to heading">â€‹</a></h3><p>æ ¼å¼åŒ–NameNodeåï¼Œåœ¨<code>${hadoop.tmp.dir}/dfs/name/current</code>ç›®å½•ä¸‹ç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶ï¼š</p><ul><li>fsimage_0000000000000001081</li><li>fsimage_0000000000000001081.md5</li><li>seen_txid</li><li>VERSION</li></ul><p>fsimageæ–‡ä»¶æ˜¯HDFSå…ƒæ•°æ®çš„ä¸€ä¸ªæ°¸ä¹…æ€§æ£€æŸ¥ç‚¹ï¼ŒåŒ…å«HDFSæ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶inodeçš„åºåˆ—åŒ–ä¿¡æ¯ã€‚editsæ–‡ä»¶å­˜æ”¾HDFSæ‰€æœ‰<strong>æ›´æ–°</strong>æ“ä½œçš„è·¯å¾„ï¼Œå®¢æˆ·ç«¯çš„æ‰€æœ‰å†™æ“ä½œè¢«è®°å½•åˆ°editsä¸­ã€‚seen_txidæ–‡ä»¶åªä¿å­˜ä¸€ä¸ªæ•°å­—ï¼Œå³æœ€æ–°edit_inprogressæ–‡ä»¶åçš„ç‰ˆæœ¬åç¼€ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="oivå’Œoev">oivå’Œoev<a class="hash-link" href="#oivå’Œoev" title="Direct link to heading">â€‹</a></h3><p>Hadoopæä¾›oiv(<strong>o</strong>ffline fs<strong>i</strong>mage <strong>v</strong>iewer)ã€oev(<strong>o</strong>ffline <strong>e</strong>dits <strong>v</strong>iewer)å‘½ä»¤åˆ†åˆ«ç”¨äºæŸ¥çœ‹fsimageå’Œeditsæ–‡ä»¶ï¼ŒåŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">hdfs oiv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">oev</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> -p </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">è½¬æ¢è¾“å‡ºæ–‡ä»¶ç±»å‹</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> -i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">fsimage/editsæ–‡ä»¶å</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> -o </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">è½¬æ¢è¾“å‡ºæ–‡ä»¶å</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="checkpointè®¾ç½®">Checkpointè®¾ç½®<a class="hash-link" href="#checkpointè®¾ç½®" title="Direct link to heading">â€‹</a></h3><p>2NNè§¦å‘checkpointçš„æ¡ä»¶æœ‰2ç§ï¼Œç¬¬ä¸€ç§æ˜¯å®šæ—¶è§¦å‘ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ2NNæ¯éš”ä¸€ä¸ªå°æ—¶æ‰§è¡Œä¸€æ¬¡checkpointï¼š</p><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">hdfs-default.xml</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">dfs.namenode.checkpoint.period</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3600s</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ç¬¬äºŒç§æ˜¯å®šé‡è§¦å‘ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´(é»˜è®¤60s)æ£€æŸ¥æ“ä½œæ¬¡æ•°æ˜¯å¦è¾¾åˆ°å®šé‡(é»˜è®¤100ä¸‡)æ¥å†³å®šæ˜¯å¦æ‰§è¡Œcheckpointï¼š</p><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">hdfs-default.xml</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">dfs.namenode.checkpoint.txns</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1000000</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">æ“ä½œåŠ¨ä½œæ¬¡æ•°</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">dfs.namenode.checkpoint.check.period</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">60s</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ“ä½œæ¬¡æ•°</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="datanodeå·¥ä½œæœºåˆ¶">DataNodeå·¥ä½œæœºåˆ¶<a class="hash-link" href="#datanodeå·¥ä½œæœºåˆ¶" title="Direct link to heading">â€‹</a></h2><p>æ•°æ®å—åœ¨DataNodeä¸Šå­˜å‚¨åŒ…å«2ä¸ªæ–‡ä»¶ï¼Œæ•°æ®æœ¬èº«å’Œå…ƒæ•°æ®æ–‡ä»¶ï¼Œåè€…åŒ…å«æ•°æ®å—çš„é•¿åº¦ã€æ£€éªŒå’Œä»¥åŠæ—¶é—´æˆ³ã€‚DataNodeå·¥ä½œæœºåˆ¶å¦‚ä¸‹ï¼š</p><ol><li>DataNodeå¯åŠ¨åå‘NameNodeæ³¨å†Œï¼›</li><li>DataNodeæ³¨å†ŒæˆåŠŸï¼›</li><li>DataNodeå‘¨æœŸæ€§(é»˜è®¤6å°æ—¶)åœ°å‘NNæŠ¥å‘Šæ‰€æœ‰å—ä¿¡æ¯ï¼›</li></ol><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">dfs.blockreport.intervalMsec</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">21600000</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Determines block reporting interval in </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    milliseconds.</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">dfs.datanode.directoryscan.interval</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">21600s</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Interval in seconds for Datanode to scan data </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    directories and reconcile the difference between blocks in memory and on </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    the disk.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Support multiple time unit suffix(case insensitive), as described</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    in dfs.heartbeat.interval.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="4"><li>DataNodeæ¯éš”3så‘NNå‘é€å¿ƒè·³ï¼Œå¦‚æœè¶…è¿‡10åˆ†é’Ÿ+30ç§’æ²¡æœ‰æ”¶åˆ°æ¥è‡ªDataNodeçš„å¿ƒè·³ï¼ŒNNè®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸å¯ç”¨ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ•°æ®å®Œæ•´æ€§">æ•°æ®å®Œæ•´æ€§<a class="hash-link" href="#æ•°æ®å®Œæ•´æ€§" title="Direct link to heading">â€‹</a></h3><p>DataNodeä½¿ç”¨crc32ç®—æ³•å¯¹blockè¿›è¡Œæ ¡éªŒï¼ŒcopyToLocalFileæ–¹æ³•æœ€åä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºfalseï¼Œä¸‹è½½åå¤šä¸€ä¸ªcrcæ–‡ä»¶ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="è¶…æ—¶è®¾ç½®">è¶…æ—¶è®¾ç½®<a class="hash-link" href="#è¶…æ—¶è®¾ç½®" title="Direct link to heading">â€‹</a></h3><p>å½“DataNodeè¿›ç¨‹æ­»äº¡æˆ–è€…ç”±ç½‘ç»œæ•…éšœé€ æˆDataNodeä¸NameNodeæ— æ³•é€šä¿¡æ—¶ï¼ŒNNä¸ä¼šç«‹å³åˆ¤æ–­è¯¥DataNodeä¸å¯ç”¨ï¼Œè€Œæ˜¯ç»è¿‡ä¸€æ®µè¶…æ—¶æ—¶é•¿timeoutåæ‰åˆ¤å®šï¼š</p><p>timeout=2 <!-- -->*<!-- --> dfs.namenode.heartbeat.recheck-interval + 10 <!-- -->*<!-- --> dfs.heartbeat.interval</p><p>é»˜è®¤recheck-intervalå¤§å°ä¸º5åˆ†é’Ÿï¼Œdfs.heartbeat.intervalä¸º3ç§’ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><ol><li>Blockå¤§å°ä¸ç£ç›˜è¯»å†™é€Ÿåº¦ç›¸å…³ï¼Œä¸€èˆ¬è®¾ç½®128MBæˆ–è€…256MBï¼›</li><li>HDFS Shellæ“ä½œï¼›</li><li>HDFSè¯»å†™æµç¨‹â­ã€‚</li></ol>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Hadoop" term="Hadoop"/>
        <category label="BigData" term="BigData"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hadoop 3.xå­¦ä¹ ç¬”è®°(1)]]></title>
        <id>/2022/01/29/Learning-Hadoop3.x-01</id>
        <link href="https://kayhaw.github.io/blog/2022/01/29/Learning-Hadoop3.x-01"/>
        <updated>2022-01-29T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Hadoop 3.1.3å­¦ä¹ ç¬”è®°(1)]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“Hadoop 3.1.3å­¦ä¹ ç¬”è®°ç¬¬1ç¯‡ï¼šåŸºäºVMWareè™šæ‹Ÿæœºçš„Hadoopé›†ç¾¤ç¯å¢ƒæ­å»ºã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="åŸºç¡€ç¯å¢ƒå‡†å¤‡">åŸºç¡€ç¯å¢ƒå‡†å¤‡<a class="hash-link" href="#åŸºç¡€ç¯å¢ƒå‡†å¤‡" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="å‹ç¼©åŒ…ä¸‹è½½ä¸ç³»ç»Ÿç¯å¢ƒ">å‹ç¼©åŒ…ä¸‹è½½ä¸ç³»ç»Ÿç¯å¢ƒ<a class="hash-link" href="#å‹ç¼©åŒ…ä¸‹è½½ä¸ç³»ç»Ÿç¯å¢ƒ" title="Direct link to heading">â€‹</a></h3><p>ä»<a href="http://archive.apache.org/dist/hadoop/common/" target="_blank" rel="noopener noreferrer">Hadoop Releases</a>ä¸‹è½½Hadoop 3.1.3å‹ç¼©åŒ…å¹¶æ‹·è´åˆ°è™šæ‹Ÿæœºä¸­ï¼Œç„¶åè§£å‹åˆ°<code>/opt/module</code>ç›®å½•ã€‚ä»<a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html" target="_blank" rel="noopener noreferrer">Java SE 8 Archive Downloads</a>ä¸‹è½½JDk 8å‹ç¼©åŒ…å¹¶æ‹·è´åˆ°è™šæ‹Ÿæœºä¸­ï¼ŒåŒæ ·è§£å‹åˆ°<code>/opt/module</code>ç›®å½•ã€‚</p><p>åœ¨<code>/etc/profile.d</code>æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºmy_env.shæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œ<strong>æ‰§è¡Œå‘½ä»¤<code>source /etc/profile</code>ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</strong>ã€‚</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># JAVA_HOME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">JAVA_HOME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/opt/module/jdk1.8.0_212</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$JAVA_HOME</span><span class="token plain">/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># HADOOP_HOME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">HADOOP_HOME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/opt/module/hadoop-3.1.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$HADOOP_HOME</span><span class="token plain">/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$HADOOP_HOME</span><span class="token plain">/sbin</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ–‡ä»¶åŒæ­¥è„šæœ¬">æ–‡ä»¶åŒæ­¥è„šæœ¬<a class="hash-link" href="#æ–‡ä»¶åŒæ­¥è„šæœ¬" title="Direct link to heading">â€‹</a></h3><p>ä¸ºäº†æ–¹ä¾¿åœ¨é›†ç¾¤ä¸Šçš„å„ä¸ªèŠ‚ç‚¹é—´åŒæ­¥é…ç½®æ–‡ä»¶ï¼Œç¼–å†™xsyncè„šæœ¬å¦‚ä¸‹æ‰€ç¤ºã€‚è¯¥è„šæœ¬å®é™…æ˜¯å¯¹rsyncå‘½ä»¤çš„å°è£…ï¼Œä¸scpç›¸æ¯”ï¼ŒrsyncåªåŒæ­¥å·®å¼‚æ–‡ä»¶è€ŒscpåŒæ­¥æ‰€æœ‰æ–‡ä»¶ã€‚æ³¨æ„åŒæ­¥æ–‡ä»¶çš„åŒæ–¹éƒ½å®‰è£…rsyncï¼Œå¹¶<strong>å°†xysncè„šæœ¬æ”¾åœ¨${HOME}/binç›®å½•ä¸‹</strong>ä»¥ä¾¿éšå¤„è°ƒç”¨ã€‚</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">xsync.sh</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#1. åˆ¤æ–­å‚æ•°ä¸ªæ•°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$#</span><span class="token plain"> -lt </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> Not Enough Arguement</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">exit</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#2. éå†é›†ç¾¤æ‰€æœ‰æœºå™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">host</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> hadoop102 hadoop103 hadoop104</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$host</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#3. éå†æ‰€æœ‰ç›®å½•ï¼ŒæŒ¨ä¸ªå‘é€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">file</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$@</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#4. åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> -e </span><span class="token variable" style="color:#36acaa">$file</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#5. è·å–çˆ¶ç›®å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># dirnameæ˜¯shellå‘½ä»¤ï¼Œåˆ—å‡ºæ–‡ä»¶ç»å¯¹è·¯å¾„ï¼Œcd -Pï¼šå¯¹äºè½¯è¿æ¥è¿›å…¥å®é™…ç›®å½•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">pdir</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable builtin class-name" style="color:#36acaa">cd</span><span class="token variable" style="color:#36acaa"> -P </span><span class="token variable punctuation" style="color:#393A34">$(</span><span class="token variable" style="color:#36acaa">dirname $file</span><span class="token variable punctuation" style="color:#393A34">)</span><span class="token variable punctuation" style="color:#393A34">;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable builtin class-name" style="color:#36acaa">pwd</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#6. è·å–å½“å‰æ–‡ä»¶çš„åç§°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">fname</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">basename</span><span class="token variable" style="color:#36acaa"> $file</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$host</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mkdir -p </span><span class="token string variable" style="color:#36acaa">$pdir</span><span class="token string" style="color:#e3116c">"</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># mkdir -p åœ¨æ–‡ä»¶å¤¹å·²ç»å­˜åœ¨æ—¶ä¸æŠ¥é”™</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">rsync</span><span class="token plain"> -av </span><span class="token variable" style="color:#36acaa">$pdir</span><span class="token plain">/</span><span class="token variable" style="color:#36acaa">$fname</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$host</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$pdir</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$file</span><span class="token plain"> does not exists</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="å…å¯†ç™»å½•">å…å¯†ç™»å½•<a class="hash-link" href="#å…å¯†ç™»å½•" title="Direct link to heading">â€‹</a></h3><p>åœ¨xsyncè„šæœ¬ä¸­ä½¿ç”¨sshç™»å½•ç›®æ ‡ç«¯å¹¶åˆ›å»ºç›®å½•ï¼Œä¸ºäº†å®ç°å…å¯†ç™»å½•ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-genkey -t rsa        </span><span class="token comment" style="color:#999988;font-style:italic"># ç”Ÿæˆæœ¬æœºå¯†é’¥å¯¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-copy-id hadoop103    </span><span class="token comment" style="color:#999988;font-style:italic"># æœ¬æœºå…¬é’¥ä¼ åˆ°hadoop103ï¼Œå®ç°å…å¯†ç™»å½•</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="hadoopé…ç½®ä¸å¯åŠ¨">Hadoopé…ç½®ä¸å¯åŠ¨<a class="hash-link" href="#hadoopé…ç½®ä¸å¯åŠ¨" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="èŠ‚ç‚¹è§„åˆ’">èŠ‚ç‚¹è§„åˆ’<a class="hash-link" href="#èŠ‚ç‚¹è§„åˆ’" title="Direct link to heading">â€‹</a></h3><table><thead><tr><th>èŠ‚ç‚¹è§’è‰²</th><th>hadoop102</th><th>hadoop103</th><th>hadoop104</th></tr></thead><tbody><tr><td>HDFS</td><td>NameNode DataNode</td><td>DataNode</td><td>SecondaryNameNode DataNode</td></tr><tr><td>YARN</td><td>NodeManager</td><td>ResourceManager NodeManager</td><td>NodeManager</td></tr></tbody></table><p>æ³¨æ„NameNodeå’ŒSecondaryNameNodeä¸èƒ½åœ¨ç›¸åŒèŠ‚ç‚¹ï¼ŒResourceManagerå¼€é”€é«˜ï¼Œä¸èƒ½å’ŒNameNodeã€SecondaryNameNodeåœ¨ç›¸åŒèŠ‚ç‚¹ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶<a class="hash-link" href="#é…ç½®æ–‡ä»¶" title="Direct link to heading">â€‹</a></h3><p>Hadoopé…ç½®æ–‡ä»¶éƒ½åœ¨<code>${HADOOP_HOME}/etc/hadoop</code>ç›®å½•ä¸‹ï¼Œæ­å»ºé›†ç¾¤ç¯å¢ƒéœ€è¦ä¿®æ”¹çš„é…ç½®æ–‡ä»¶æœ‰core-site.xmlã€hdfs-site.xmlã€yarn-site.xmlã€mapred-site.xmlå’Œworkersï¼Œé…ç½®å†…å®¹å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">core-site.xml</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- æŒ‡å®šNameNodeåœ°å€(Hadoopå†…éƒ¨é€šä¿¡ç”¨) --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">fs.defaultFS</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hdfs://hadoop102:8020</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- æŒ‡å®šHadoopæ•°æ®çš„å­˜å‚¨ç›®å½• --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hadoop.tmp.dir</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">/opt/module/hadoop-3.1.3/data</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- æŒ‡å®šHDFSç½‘é¡µç™»å½•ä½¿ç”¨çš„é™æ€ç”¨æˆ·ä¸ºkayhaw --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hadoop.http.staticuser.user</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">kayhaw</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">hdfs-site.xml</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- nn webç«¯è®¿é—®åœ°å€(å¤–éƒ¨è®¿é—®ç”¨) --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">dfs.namenode.http-address</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hadoop102:9870</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 2nn webç«¯è®¿é—®åœ°å€ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">dfs.namenode.secondary.http-address</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hadoop104:9868</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">yarn-site.xml</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- æŒ‡å®šMRèµ°shuffle --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">yarn.nodemanager.aux-services</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mapreduce_shuffle</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- æŒ‡å®šResourceManagerçš„åœ°å€ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">yarn.resourcemanager.hostname</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hadoop103</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- ç¯å¢ƒå˜é‡çš„ç»§æ‰¿ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">yarn.nodemanager.env-whitelist</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RED_HOME</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- å¼€å¯æ—¥å¿—èšé›†åŠŸèƒ½ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">yarn.log-aggregation-enable</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- è®¾ç½®æ—¥å¿—èšé›†æœåŠ¡å™¨åœ°å€ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">yarn.log.server.url</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://hadoop102:19888/jobhistory/logs</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- è®¾ç½®æ—¥å¿—ä¿ç•™æ—¶é—´ä¸º7å¤© --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">yarn.log-aggregation.retain-seconds</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">604800</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- è®¾ç½®è™šæ‹Ÿ/ç‰©ç†å†…å­˜æ¯”ä¾‹ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">yarn.nodemanager.vmem-pmem-ratio</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å…¶ä¸­ï¼Œè®¾ç½®è™šæ‹Ÿ/ç‰©ç†å†…å­˜æ¯”ä¾‹æ˜¯å› ä¸ºåœ¨è¿è¡Œmrä»»åŠ¡ä¸­å‡ºç°å¦‚ä¸‹æƒ…å†µï¼šHadoopæ ¹æ®é»˜è®¤é…ç½®çš„æ‰€éœ€ç‰©ç†å†…å­˜å¤§å°(1GB)æŒ‰ç…§æ¯”ä¾‹2.1(é»˜è®¤)åˆ†é…è™šæ‹Ÿå†…å­˜2.1GBï¼Œå®é™…ç¨‹åºç”¨åˆ°2.4GBè¶…è¿‡åˆ†é…å¤§å°ï¼Œå› æ­¤è¿™é‡Œå°†æ¯”ä¾‹å¢è‡³3ã€‚æ—¥å¿—èšé›†å°†åº”ç”¨æ—¥å¿—ä¿å­˜åˆ°HDFSä¸Šï¼Œæ–¹ä¾¿æŸ¥çœ‹ç¨‹åºè¿è¡Œè¯¦æƒ…ã€‚</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-01-29 </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:45:55,708 INFO mapreduce.Job: Task Id </span><span class="token builtin class-name">:</span><span class="token plain"> attempt_1643428629319_0003_m_000000_2, Status </span><span class="token builtin class-name">:</span><span class="token plain"> FAILED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-01-29 </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:45:55.069</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">Container </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pid</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5003</span><span class="token plain">,containerID</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">container_1643428629319_0003_01_000004</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> is running 299792896B beyond the </span><span class="token string" style="color:#e3116c">'VIRTUAL'</span><span class="token plain"> memory limit. Current usage: </span><span class="token number" style="color:#36acaa">137.7</span><span class="token plain"> MB of </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> GB physical memory used</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.4</span><span class="token plain"> GB of </span><span class="token number" style="color:#36acaa">2.1</span><span class="token plain"> GB virtual memory used. Killing container.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">mapred-site.xml</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- æŒ‡å®šMapReduceç¨‹åºè¿è¡Œåœ¨Yarnä¸Š --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mapreduce.framework.name</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">yarn</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- æŒ‡å®šMRç¯å¢ƒå˜é‡ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">yarn.app.mapreduce.am.env</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">HADOOP_MAPRED_HOME=/opt/module/hadoop-3.1.3/</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mapreduce.map.env</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">HADOOP_MAPRED_HOME=/opt/module/hadoop-3.1.3/</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mapreduce.reduce.env</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">HADOOP_MAPRED_HOME=/opt/module/hadoop-3.1.3/</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- å†å²æœåŠ¡å™¨ç«¯åœ°å€ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mapreduce.jobhistory.address</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hadoop102:10020</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- å†å²æœåŠ¡å™¨webç«¯åœ°å€ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mapreduce.jobhistory.webapp.address</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hadoop102:19888</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><strong>å†å²æ—¥å¿—æœåŠ¡éœ€è¦æ‰‹åŠ¨è¾“å…¥å‘½ä»¤<code>mapred --daemon start historyserver</code>å¯åŠ¨</strong>ã€‚</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">workers</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># æ³¨æ„ä¸å…è®¸å‡ºç°ç©ºè¡Œæˆ–è¡Œå°¾ç©ºæ ¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hadoop102</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hadoop103</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hadoop104</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å®Œæˆå¦‚ä¸Šé…ç½®åï¼Œä¸€å®šè¦è®°å¾—<strong>ä½¿ç”¨xsyncå·¥å…·å°†æ‰€æœ‰é…ç½®æ–‡ä»¶åŒæ­¥åˆ°å„ä¸ªèŠ‚ç‚¹</strong>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¯åŠ¨é›†ç¾¤">å¯åŠ¨é›†ç¾¤<a class="hash-link" href="#å¯åŠ¨é›†ç¾¤" title="Direct link to heading">â€‹</a></h3><ol><li>æ ¼å¼åŒ–namenodeèŠ‚ç‚¹ï¼š<code>hdfs namenode -format</code>ï¼Œ<strong>ä»…ç¬¬ä¸€æ¬¡å¯åŠ¨Hadoopç¯å¢ƒéœ€è¦</strong>ï¼›</li><li>åœ¨namenodeèŠ‚ç‚¹ä¸Šå¯åŠ¨HDFSï¼š<code>start-dfs.sh</code>ï¼Œæ³¨æ„ä¸æ˜¯hdfsğŸ˜ï¼›</li><li>åœ¨resourcemanagerèŠ‚ç‚¹ä¸Šå¯åŠ¨YARNï¼š<code>start-yarn.sh</code>ï¼›</li><li>æµè§ˆå™¨è¾“å…¥åœ°å€<code>http://hadoop102:9870</code>å’Œ<code>http://hadoop103}:8088</code>åˆ†åˆ«æŸ¥çœ‹HDFSå’ŒYARNæƒ…å†µã€‚</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="è„šæœ¬å·¥å…·">è„šæœ¬å·¥å…·<a class="hash-link" href="#è„šæœ¬å·¥å…·" title="Direct link to heading">â€‹</a></h2><p>ä¸ºäº†æ–¹ä¾¿åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šå¯åŠ¨ã€å…³é—­é›†ç¾¤ï¼Œç¼–å†™å¦‚ä¸‹è„šæœ¬ï¼š</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">myhadoop.sh</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$#</span><span class="token plain"> -lt </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"No Args Input..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">"start"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" =================== å¯åŠ¨ hadoop é›†ç¾¤ ==================="</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" --------------- å¯åŠ¨ hdfs ---------------"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> hadoop102 </span><span class="token string" style="color:#e3116c">"/opt/module/hadoop-3.1.3/sbin/start-dfs.sh"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" --------------- å¯åŠ¨ yarn ---------------"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> hadoop103 </span><span class="token string" style="color:#e3116c">"/opt/module/hadoop-3.1.3/sbin/start-yarn.sh"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" --------------- å¯åŠ¨ historyserver ---------------"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> hadoop102 </span><span class="token string" style="color:#e3116c">"/opt/module/hadoop-3.1.3/bin/mapred --daemon start historyserver"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">"stop"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" =================== å…³é—­ hadoop é›†ç¾¤ ==================="</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" --------------- å…³é—­ historyserver ---------------"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> hadoop102 </span><span class="token string" style="color:#e3116c">"/opt/module/hadoop-3.1.3/bin/mapred --daemon stop historyserver"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" --------------- å…³é—­ yarn ---------------"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> hadoop103 </span><span class="token string" style="color:#e3116c">"/opt/module/hadoop-3.1.3/sbin/stop-yarn.sh"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" --------------- å…³é—­ hdfs ---------------"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> hadoop102 </span><span class="token string" style="color:#e3116c">"/opt/module/hadoop-3.1.3/sbin/stop-dfs.sh"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Input Args Error..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">esac</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä¸ºäº†æŸ¥çœ‹å„èŠ‚ç‚¹javaè¿›ç¨‹ï¼Œç¼–å†™å¦‚ä¸‹è„šæœ¬ï¼š</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">jpsall.sh</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">host</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> hadoop102 hadoop103 hadoop104</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$host</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$host</span><span class="token plain"> jps </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>æœ€åå°†myhadoop.shå’Œjpsall.shæ”¾åœ¨${HOME}/binç›®å½•ä¸‹ï¼Œä»¥ä¾¿éšå¤„å¯ç”¨ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†<a class="hash-link" href="#å¼‚å¸¸å¤„ç†" title="Direct link to heading">â€‹</a></h2><p>æ ¼å¼åŒ–NameNodeä¼šäº§ç”Ÿæ–°é›†ç¾¤idï¼Œå¯¼è‡´NameNodeå’ŒDataNodeçš„é›†ç¾¤idä¸ä¸€è‡´ï¼Œä»è€Œå‡ºç°å¼‚å¸¸(DataNodeä¸ªæ•°ä¸º0)ï¼Œæ­¤æ—¶å¯ä»¥ï¼š</p><ol><li>åœæ­¢é›†ç¾¤æœåŠ¡ï¼›</li><li>åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„dataå’Œlogsç›®å½•ï¼›</li><li>é‡æ–°æ ¼å¼åŒ–nnèŠ‚ç‚¹ï¼›</li><li>é‡å¯é›†ç¾¤æœåŠ¡ã€‚</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ—¶é—´åŒæ­¥å¯é€‰">æ—¶é—´åŒæ­¥<!-- -->[<!-- -->å¯é€‰<!-- -->]<a class="hash-link" href="#æ—¶é—´åŒæ­¥å¯é€‰" title="Direct link to heading">â€‹</a></h2><p>å½“éƒ¨ç½²åœ¨å†…ç½‘æ—¶ï¼ŒHadoopé›†ç¾¤éœ€è¦é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡ï¼Œå¦åˆ™äº§ç”ŸèŠ‚ç‚¹æ—¶é—´åå·®ï¼Œå¯¼è‡´é›†ç¾¤æ‰§è¡Œä»»åŠ¡æ—¶é—´ä¸ä¸€è‡´ã€‚å¦‚ä¸‹æ“ä½œä»¥hadoop102ä¸ºæ—¶é—´æœåŠ¡å™¨ï¼Œè®©hadoop103ã€hadoop104æ¯éš”1så‘å…¶å¯¹å‡†æ—¶é—´ï¼š</p><ol><li>åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…ntpæœåŠ¡ï¼š<code>yum -y install ntp</code>ï¼›</li><li>åœ¨hadoop102ä¸Šè®¾ç½®å¼€æœºè‡ªå¯ntpdæœåŠ¡ï¼š<code>systemctl start ntpd</code>ï¼Œ<code>systemctl enable ntpd</code>ï¼›</li><li>ä¿®æ”¹<code>/etc/ntp.conf</code>æ–‡ä»¶ï¼š<ol><li>å°†restrictä¸€è¡Œä¸­çš„192.168.1.0æ”¹ä¸ºhadoop10xçš„ç½‘å…³192.168.10.0ï¼›</li><li>æ³¨é‡Š4è¡Œ<code>server 0[1,2,3].centos.pool.ntp.org iburst</code>ï¼Œä¸ä¸å¤–ç½‘æ—¶é—´åŒæ­¥ï¼›</li><li>æœ«å°¾æ·»åŠ <code>server 127.127.1.0</code>ï¼›</li><li>æœ«å°¾æ·»åŠ <code>fudge 127.127.1.0 stratum 10</code>ï¼›</li></ol></li><li>ä¿®æ”¹hadoop102çš„<code>/etc/sysconf/ntpd</code>æ–‡ä»¶ï¼Œæ·»åŠ <code>SYNC_HWCLOCK=yes</code>ï¼›</li><li>hadoop102é‡å¯ntpdæœåŠ¡ï¼Œ<code>systemctl restart ntpd</code>ï¼›</li><li><strong>å…¶ä»–èŠ‚ç‚¹å…³é—­ntpdæœåŠ¡</strong>ï¼Œé€šè¿‡å‘½ä»¤<code>sudo crontab -e</code>æ‰“å¼€é…ç½®æ–‡ä»¶å¹¶æ·»åŠ ä¸€è¡Œ<code>*/1 * * * * /usr/sbin/ntpdate hadoop102</code>ã€‚</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><ol><li>é›†ç¾¤æœåŠ¡çš„å¯åŠ¨/ç»ˆæ­¢ï¼š<code>start[stop]-dfs.sh</code>ã€<code>start[stop]-yarn.sh</code>ï¼›èŠ‚ç‚¹æœåŠ¡çš„å¯åŠ¨/ç»ˆæ­¢ï¼š<code>hdfs --daemon start[stop] namenode[datanode][secondarynode]</code>ã€<code>yarn --daemon start[stop] resourcemanager[nodemanager]</code>ï¼›</li><li>ä¿®æ”¹é…ç½®æ–‡ä»¶åè¦é‡å¯é›†ç¾¤æœåŠ¡ï¼Œä¿®æ”¹ç¯å¢ƒå˜é‡è¦sourceä¸€ä¸‹ä½¿å…¶ç”Ÿæ•ˆï¼›</li><li>é›†ç¾¤å¼‚å¸¸æƒ…å†µåˆ†æï¼š<ol><li>æ ¼å¼åŒ–NameNodeç”Ÿæˆé›†ç¾¤idï¼›</li><li>å¯åŠ¨HDFSåDataNodeç”Ÿæˆå’ŒNameNodeç›¸åŒçš„é›†ç¾¤idï¼›</li><li>å†æ¬¡æ ¼å¼åŒ–NameNodeç”Ÿæˆå¦ä¸€ä¸ªé›†ç¾¤idï¼Œä¸æœªåˆ é™¤DataNodeçš„idä¸ä¸€è‡´ï¼›</li><li>è§£å†³æ–¹æ³•æ˜¯åœ¨ç¬¬2æ¬¡æ ¼å¼åŒ–ä¹‹å‰åˆ é™¤DataNodeä¸­çš„ä¿¡æ¯(dataç›®å½•)ã€‚</li></ol></li></ol>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Hadoop" term="Hadoop"/>
        <category label="BigData" term="BigData"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[FlinkXæºç å‰–æ(2)]]></title>
        <id>/2022/01/17/FlinkX-Source-Code-Dissection-02</id>
        <link href="https://kayhaw.github.io/blog/2022/01/17/FlinkX-Source-Code-Dissection-02"/>
        <updated>2022-01-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[FlinkXæºç å‰–æ(2)]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“FlinkXæºç å‰–æ(2)ï¼šåŸºäºJDBCçš„Sourceå’ŒSinkç®—å­æ„é€ æµç¨‹ã€‚ä»£ç æ³¨é‡Šè§<a href="https://github.com/kayhaw/flinkx/tree/1.12_release_dissection" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="https://img.shields.io/badge/flinkx-1.12__release__dissection-blue" alt="FlinkX Dissection" class="img_E7b_"></a>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="sourceç®—å­çš„æ„é€ ">Sourceç®—å­çš„æ„é€ <a class="hash-link" href="#sourceç®—å­çš„æ„é€ " title="Direct link to heading">â€‹</a></h2><p>ä¸Šä¸€ç¯‡æ–‡ç« åˆ†æåˆ°ï¼ŒFlinkXé€šè¿‡<code>SourceFactory.createSource()</code>æ¥åˆ›å»ºsourceç®—å­å¹¶è¿”å›DataStream&lt;RowData<!-- -->&gt;<!-- -->ã€‚ç”±äºSourceFactoryæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå¹¶ä¸”createSourceæ–¹æ³•æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå› æ­¤å¿…å®šç”±SourceFactoryçš„å…·ä½“å­ç±»æ¥å®ç°createSourceæ–¹æ³•(æ¯”å¦‚MysqlSourceFactory)ã€‚å®é™…ä¸Šï¼Œå‡ ä¹æ‰€æœ‰å…³ç³»å‹æ•°æ®åº“éƒ½ç»§æ‰¿è‡ªJdbcSourceFactoryå¹¶å¤ç”¨å…¶æ–¹æ³•ï¼Œæ¥ä¸‹æ¥å…·ä½“åˆ†æJdbcSourceFactoryæºç (å¦‚Kafkaå’ŒHDFSç­‰Sourceå…¶ä»–ç®—å­ä¹‹åå†çœ‹)ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">com/dtstack/flinkx/connector/jdbc/source/JdbcSourceFactory.java</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">DataStream</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">RowData</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">JdbcInputFormatBuilder</span><span class="token plain"> builder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getBuilder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// fetchSizeå’ŒqueryTimeOutä¸å¯ä»¥ä¸º0ï¼Œå¦åˆ™ç”¨é»˜è®¤è®¾ç½®æ›¿æ¢</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> fetchSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jdbcConf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getFetchSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jdbcConf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setFetchSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fetchSize </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getDefaultFetchSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> fetchSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> queryTimeOut </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jdbcConf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getQueryTimeOut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jdbcConf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setQueryTimeOut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">queryTimeOut </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> DEFAULT_QUERY_TIMEOUT </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> queryTimeOut</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ç»™builderè®¾ç½®jdbcConfã€jdbcDialectå’ŒrowConverter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setJdbcConf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jdbcConf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setJdbcDialect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jdbcDialect</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">AbstractRowConverter</span><span class="token plain"> rowConverter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">useAbstractBaseColumn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">checkConstant</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jdbcConf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">RowType</span><span class="token plain"> rowType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">TableUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createRowType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jdbcConf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getRawTypeConverter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rowConverter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jdbcDialect</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getRowConverter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rowType</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setRowConverter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rowConverter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createInput</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">finish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>createSourceçš„é€»è¾‘å¯ä»¥åˆ†ä¸º3æ­¥ï¼š1.è®¾ç½®JdbcInputFormatBuilder.è®¾ç½®RowConverterï¼›3.åˆ›å»ºè¾“å‡ºæµã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="jdbcinputformatbuilder">JdbcInputFormatBuilder<a class="hash-link" href="#jdbcinputformatbuilder" title="Direct link to heading">â€‹</a></h3><p>ä»å…¶åç§°åç¼€å¯ä»¥çœ‹å‡ºï¼ŒJdbcInputFormatBuilderæ˜¯JdbcInputFormatçš„æ„é€ ç±»ï¼Œå³FlinkXä½¿ç”¨Builderè®¾è®¡æ¨¡å¼æ¥åˆ›å»ºJdbcInputFormatå¯¹è±¡ã€‚getBuilderæ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token class-name">JdbcInputFormatBuilder</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getBuilder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">JdbcInputFormatBuilder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">JdbcInputFormat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>JdbcSourceFactoryçš„å­ç±»å¯ä»¥é€šè¿‡é‡å†™getBuilderæ–¹æ³•æ¥è¿”å›è‡ªå®šä¹‰çš„JdbcInputFormatï¼Œæ¯”å¦‚Db2SourceFactoryã€‚è€ŒJdbcInputFormatç»§æ‰¿è‡ªBaseRichInputFormatï¼Œå®ƒæ˜¯FlinkXæ‰€æœ‰sourceç®—å­çš„åŸºç¡€ï¼Œå¹¶ç»§æ‰¿è‡ªFlink API æä¾›çš„RichInputFormatç±»ã€‚ç°åœ¨åªéœ€è¦å…ˆè®°ç€æˆ‘ä»¬æ„é€ çš„InputFormatæ˜¯JdbcInputFormatå®ä¾‹ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="rowconverter">RowConverter<a class="hash-link" href="#rowconverter" title="Direct link to heading">â€‹</a></h3><p>RowConverterè´Ÿè´£å°†JDBCè¯»å–çš„æ•°æ®è½¬ä¸ºFlink APIä¸­çš„RowDataå½¢å¼ï¼Œæ›´å…·ä½“ç‚¹ï¼Œ<strong>å®ƒå°†JDBCå­—æ®µç±»å‹æ˜ å°„ä¸ºFlinkä¸­çš„DataTypeç±»å‹</strong>ã€‚ä»¥MySQLä¸ºä¾‹åˆ†æï¼ŒTableUtil.createRowTypeæ–¹æ³•æºç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">RowType</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createRowType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">FieldConf</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> fields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">RawTypeConverter</span><span class="token plain"> converter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> fieldNames </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fields</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">stream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">FieldConf</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">getName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">::</span><span class="token keyword" style="color:#00009f">new</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> fieldTypes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fields</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">stream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">FieldConf</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">getType</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">::</span><span class="token keyword" style="color:#00009f">new</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">TableSchema</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Builder</span><span class="token plain"> builder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">TableSchema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">builder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> fieldTypes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">DataType</span><span class="token plain"> dataType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> converter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fieldTypes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TableColumn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">physical</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fieldNames</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dataType</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RowType</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toRowDataType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getLogicalType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è¯¥æ–¹æ³•éå†å­—æ®µç±»å‹åˆ—è¡¨ï¼Œç”±RawTypeConverter.applyæ–¹æ³•è¿”å›æ¯ä¸ªç±»å‹åº”è¯¥å¯¹åº”çš„DataTypeç±»å‹ã€‚å› æ­¤ï¼Œå‡½æ•°å¼æ¥å£RawTypeConverterçš„å®ç°å°±å°¤ä¸ºé‡è¦ï¼Œå¹¶ä¸”æ¯ç§æ•°æ®åº“çš„åº”è¯¥å„ä¸ç›¸åŒã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼ŒRawTypeConverterç”±JdbcSourceFactoryç±»çš„æˆå‘˜å˜é‡jdbcDialectç»™å‡ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">RawTypeConverter</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getRawTypeConverter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> jdbcDialect</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getRawTypeConverter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è€ŒjdbcDialectåˆæ˜¯åœ¨JdbcSourceFactoryå”¯ä¸€çš„æ„é€ å‡½æ•°ä¸­è¢«è®¾ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">JdbcSourceFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">SyncConf</span><span class="token plain"> syncConf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">StreamExecutionEnvironment</span><span class="token plain"> env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">JdbcDialect</span><span class="token plain"> jdbcDialect</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åˆåˆ†äº†ä¸€å±‚ï¼Œçˆ¶ç±»è°ƒç”¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">syncConf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> env</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// jdbcDialectç”±æ¯ä¸ªå­ç±»è‡ªå·±å®ç°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">jdbcDialect </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jdbcDialect</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å›é¡¾ä¸Šä¸€ç¯‡æ–‡ç« çš„å†…å®¹ï¼Œé€šè¿‡åå°„æ¥åˆ›å»ºSourceFactoryå¯¹è±¡çš„ä»£ç ä¸º<code>Constructor&lt;?&gt; constructor =clazz.getConstructor(SyncConf.class, StreamExecutionEnvironment.class)</code>ã€‚è¯¶ï¼Œæ€ä¹ˆå°‘äº†ä¸€ä¸ªJdbcDialectå‚æ•°ï¼Ÿæ³¨æ„å®é™…è°ƒç”¨çš„æ˜¯å­ç±»xxxSourceFactoryçš„æ„é€ æ–¹æ³•ï¼Œä»¥MysqlSourceFactoryä¸ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ˜¯ä¼ å…¥äº†è‡ªå·±å®šä¹‰çš„MysqlDialectå¯¹è±¡ï¼Œè€ŒMysqlDialectçš„getRawTypeConverterè¿”å›çš„æ˜¯MysqlRawTypeConverterç±»çš„applyæ–¹æ³•å¼•ç”¨ï¼Œç”±å®ƒæ¥å†³å®šMySQLçš„JDBCå­—æ®µç±»å‹åº”è¯¥å¯¹åº”å“ªä¸€ç§Flink DataTypesã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">MysqlSourceFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SyncConf</span><span class="token plain"> syncConf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">StreamExecutionEnvironment</span><span class="token plain"> env</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// JdbcSourceFactoryå®Œæˆé€šç”¨å…³ç³»å‹æ•°æ®åº“çš„å…¬å…±åŠŸèƒ½</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">syncConf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">MysqlDialect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// é¿å…result.nexté˜»å¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jdbcConf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isPolling</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token class-name">StringUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jdbcConf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getStartLocation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> jdbcConf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getFetchSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jdbcConf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setFetchSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>å°ç»“</h5></div><div class="admonition-content"><p>åªéœ€è¦å®ç°è‡ªå®šä¹‰çš„xxxSourceFactoryã€xxxDialectå’ŒxxxRawTypeConverterç±»å°±å¯ä»¥è½»æ¾åœ°æ·»åŠ ä¸€ç§JDBCæ•°æ®æºçš„sourceç®—å­ï¼Œè¿™æ˜¯ç­–ç•¥æ¨¡å¼+æ¨¡æ¿æ¨¡å¼çš„å¥½å¤„ã€‚</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="åˆ›å»ºè¾“å‡ºæµ">åˆ›å»ºè¾“å‡ºæµ<a class="hash-link" href="#åˆ›å»ºè¾“å‡ºæµ" title="Direct link to heading">â€‹</a></h3><p>JdbcSourceFactoryé€šè¿‡<code>createInput(builder.finish())</code>æ¥åˆ›å»ºè¾“å‡ºæµï¼Œè¯¥æ–¹æ³•åˆè°ƒç”¨æ¥è‡ªçˆ¶ç±»SourceFactoryçš„createInputæ–¹æ³•ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">com/dtstack/flinkx/source/SourceFactory.java</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token class-name">DataStream</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">RowData</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createInput</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">InputFormat</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">RowData</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">InputSplit</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> inputFormat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createInput</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputFormat</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getSimpleName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toLowerCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>SourceFactoryç±»createInputæ–¹æ³•ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨æ£€æŸ¥ä¼ å…¥å‚æ•°éç©ºåï¼Œé€šè¿‡ä¼ å…¥çš„inputformatå’ŒgetTypeInformation()æ–¹æ³•çš„è¿”å›å€¼æ„é€ DtInputFormatSourceFunctionï¼Œè‡³æ­¤ç»ˆäºå¾—åˆ°äº†SourceFunctionæ–¹æ³•ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨env.addæ–¹æ³•å°†å…¶æ·»åŠ åˆ°æµæ‰§è¡Œç¯å¢ƒï¼Œå¹¶è¿”å›è¾“å‡ºæµã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token class-name">DataStream</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">RowData</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createInput</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">InputFormat</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">RowData</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">InputSplit</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> inputFormat</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> sourceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Preconditions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">checkNotNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sourceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Preconditions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">checkNotNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputFormat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">DtInputFormatSourceFunction</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">RowData</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> function </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">DtInputFormatSourceFunction</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputFormat</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getTypeInformation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ·»åŠ sourceç®—å­ï¼Œç®—å­åç§°æ˜¯å·¥å‚ç±»åçš„å…¨å°å†™æ¨¡å¼ï¼Œå¦‚mysqlsourcefactory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">function</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sourceName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getTypeInformation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="dtinputformatsourcefunction">DtInputFormatSourceFunction<a class="hash-link" href="#dtinputformatsourcefunction" title="Direct link to heading">â€‹</a></h2><p>DtInputFormatSourceFunctionç»§æ‰¿è‡ªFlink DataStream APIä¸­çš„InputFormatSourceFunctionï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒä¾èµ–äºInputFormatæ¥æä¾›æ•°æ®ã€‚DtInputFormatSourceFunctioné‡å†™äº†å¦‚ä¸‹ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// å‡†å¤‡è¾“å‡ºç¯å¢ƒ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Configuration</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ‰§è¡Œè¾“å‡ºæ•°æ®æµçš„å‡½æ•°ä½“</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SourceContext</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">OUT</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// å–æ¶ˆæ‰§è¡Œï¼Œå°±æ˜¯å°†runæ–¹æ³•çš„è¿è¡Œæ ‡å¿—å€¼ä¸ºfalse</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cancel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// å…³é—­è¾“å‡ºæµï¼Œè°ƒç”¨gracefulCloseä»£åŠ³</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å…¶ä¸­ï¼Œæœ€é‡è¦çš„runæ–¹æ³•ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚é¦–å…ˆè°ƒç”¨formatçš„openInputFormatæ–¹æ³•è®¾ç½®è®¾ç½®jobNameã€jobIdå’Œä»»åŠ¡ç¼–å·ï¼Œå¹¶ä¸”è¿˜è®¾ç½®äº†è¯»å–çš„å¼€å§‹æ—¶é—´ã€‚æ¥ç€åœ¨whileå¾ªç¯ä¸­ä¸æ–­äº§ç”Ÿä¸€æ¡è¾“å‡ºæ•°æ®ï¼Œå…³é”®æ–¹æ³•åˆ†åˆ«æ˜¯format.open()ã€format.nextRecordï¼Œæ¥ä¸‹æ¥å…·ä½“åˆ†æã€‚</p><details class="details_lb9f alert alert--info details_BAp3" data-collapsed="true"><summary>DtInputFormatSourceFunction.run()</summary><div><div class="collapsibleContent_i85q"><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SourceContext</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">OUT</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Exception</span><span class="token plain"> tryException </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Counter</span><span class="token plain"> completedSplitsCounter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">getRuntimeContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMetricGroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">counter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"numSplitsProcessed"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isRunning </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> format </span><span class="token keyword" style="color:#00009f">instanceof</span><span class="token plain"> </span><span class="token class-name">RichInputFormat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// openInputFormatè®¾ç½®jobNameã€jobIdå’Œä»»åŠ¡ç¼–å·ï¼Œå¹¶ä¸”å¼€å¯è‡ªå®šä¹‰reporter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// å¹¶ä¸”è®¾ç½®è¯»å–çš„å¼€å§‹æ—¶é—´</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RichInputFormat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> format</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">openInputFormat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">OUT</span><span class="token plain"> nextElement </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> serializer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isRunning</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// è°ƒç”¨BaseRichInputFormat.openæ–¹æ³•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            format</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">splitIterator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// for each element we also check if cancel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// was called by checking the isRunning flag</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isRunning </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">format</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">reachedEnd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCheckpointLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    nextElement </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> format</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">nextRecord</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nextElement</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nextElement </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">collect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nextElement</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            format</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            completedSplitsCounter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">inc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isRunning</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                isRunning </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> splitIterator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Exception</span><span class="token plain"> exception</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tryException </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> exception</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        LOG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Exception happened, start to close format"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exception</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isRunning </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">gracefulClose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> tryException</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> tryException</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></details><h3 class="anchor anchorWithStickyNavbar_mojV" id="baserichinputformatopenæ–¹æ³•">BaseRichInputFormat.openæ–¹æ³•<a class="hash-link" href="#baserichinputformatopenæ–¹æ³•" title="Direct link to heading">â€‹</a></h3><p>è¯¥æ–¹æ³•æ ¸å¿ƒåŠŸèƒ½é€šè¿‡è°ƒç”¨æŠ½è±¡æ–¹æ³•openInternalå®ç°ï¼Œå³ç”±æ¯ä¸ªå­ç±»æ ¹æ®è‡ªèº«æƒ…å†µå®ç°ã€‚å¯¹äºå…³ç³»å‹æ•°æ®åº“ï¼ŒJdbcInputFormatç±»åœ¨openInternalæ–¹æ³•ä¸­å®ç°æ‰“å¼€æ•°æ®åº“è¿æ¥å¹¶æŸ¥è¯¢è®°å½•çš„é€»è¾‘ï¼Œå…·ä½“çš„å¯ä»¥åˆ†ä¸º3æ­¥ï¼šè·å–è¿æ¥ã€æ„é€ æŸ¥è¯¢SQLã€æ‰§è¡ŒSQLã€‚</p><p><strong>ç¬¬ä¸€æ­¥</strong>ï¼šè·å–JDBCè¿æ¥ï¼Œç”±getConnectionæ–¹æ³•å®ç°ï¼Œæ³¨æ„ç´§æ¥ç€å°†autocommitè®¾ç½®ä¸ºfalseã€‚</p><p><strong>ç¬¬äºŒæ­¥</strong>ï¼šæ„é€ æŸ¥è¯¢SQLï¼ŒFlinkXæ ¹æ®è‡ªèº«è®¾è®¡çš„ä¸šåŠ¡é€»è¾‘<strong>åˆ†å±‚</strong>æ„é€ sqlã€‚</p>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="FlinkX" term="FlinkX"/>
        <category label="Source code dissection" term="Source code dissection"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[FlinkXæºç å‰–æ(1)]]></title>
        <id>/2022/01/09/FlinkX-Source-Code-Dissection-01</id>
        <link href="https://kayhaw.github.io/blog/2022/01/09/FlinkX-Source-Code-Dissection-01"/>
        <updated>2022-01-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[FlinkXæºç å‰–æ(1)]]></summary>
        <content type="html"><![CDATA[<p>ğŸ“FlinkXæºç å‰–æ(1)ï¼šä¸»æµç¨‹åˆ†æã€‚ä»¥localæ¨¡å¼è¿è¡Œä¸ºä¾‹åˆ†æFlinkXä¸»æµç¨‹æ‰§è¡Œé€»è¾‘ï¼šä»è¿è¡Œè„šæœ¬å¼€å§‹åˆ°é…ç½®å‚æ•°çš„è§£æã€<strong>æ’ä»¶ç±»åŠ è½½</strong>ï¼Œæœ€ååˆ°Flinkæµåº”ç”¨æ„å»ºæ‰§è¡Œã€‚ä»£ç æ³¨é‡Šè§<a href="https://github.com/kayhaw/flinkx/tree/1.12_release_dissection" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="https://img.shields.io/badge/flinkx-1.12__release__dissection-blue" alt="FlinkX Dissection" class="img_E7b_"></a>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="å¯åŠ¨è„šæœ¬">å¯åŠ¨è„šæœ¬<a class="hash-link" href="#å¯åŠ¨è„šæœ¬" title="Direct link to heading">â€‹</a></h2><p>FlinkXæä¾›äº†<code>bin/flinkx</code>è„šæœ¬ç”¨äºåœ¨å‘½ä»¤è¡Œå¿«é€Ÿå¯åŠ¨åŒæ­¥ä»»åŠ¡ï¼Œå®ƒæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªjavaå‘½ä»¤çš„å°è£…ï¼Œä½†è¿˜æ˜¯è¦å±•å¼€æ¥ä»”ç»†åœ°è®²è®²å®ƒç”¨åˆ°çš„ä¸€äº›bashçŸ¥è¯†ã€‚</p><p>é¦–å…ˆç¬¬ä¸€è¡Œ<code>set -e</code>ï¼Œä½œç”¨æ˜¯è®©è„šæœ¬æ‰§è¡Œé”™è¯¯æ—¶ç«‹å³é€€å‡ºï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œå‘½ä»¤é”™è¯¯åä¼šç»§ç»­æ‰§è¡Œï¼Œå»ºè®®åœ¨æ‰€æœ‰è„šæœ¬å¤´éƒ¨éƒ½åŠ ä¸Šã€‚æ¥ä¸‹æ¥è¿™ä¸ªè®¾ç½®ç¯å¢ƒå˜é‡çš„ä»£ç å°±å¾ˆğŸ˜äº†ï¼š</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">FLINKX_HOME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable builtin class-name" style="color:#36acaa">cd</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">"</span><span class="token string variable string variable" style="color:#36acaa">`</span><span class="token string variable string variable function" style="color:#d73a49">dirname</span><span class="token string variable string variable" style="color:#36acaa"> </span><span class="token string variable string variable string" style="color:#e3116c">"</span><span class="token string variable string variable string variable" style="color:#36acaa">$0</span><span class="token string variable string variable string" style="color:#e3116c">"</span><span class="token string variable string variable" style="color:#36acaa">`</span><span class="token string variable string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">/</span><span class="token string variable punctuation" style="color:#393A34">..</span><span class="token string variable punctuation" style="color:#393A34">;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable builtin class-name" style="color:#36acaa">pwd</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">"</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä»å¤–åˆ°å†…åˆ†æï¼Œä½¿ç”¨<code>$()</code>æ‰§è¡Œ2æ¡å‘½ä»¤<code>cd "`dirname "$0"`"/..</code>å’Œ<code>pwd</code>ã€‚ç¬¬ä¸€æ¡cdå‘½ä»¤çš„å‚æ•°åˆç”±å‘½ä»¤<code>`dirname "$0"`</code>ç»™å‡ºï¼Œ<code>dirname</code>æ˜¯bashå†…ç½®å‘½ä»¤ï¼Œè¾“å‡ºåé¢å‚æ•°æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•è·¯å¾„ï¼Œè€Œå‚æ•°<code>"$0"</code>è¡¨ç¤ºè„šæœ¬æ–‡ä»¶<code>flinkx</code>ã€‚ç»“åˆèµ·æ¥çš„å«ä¹‰å°±æ˜¯åˆ‡æ¢åˆ°flinkxè¿™ä¸ªè„šæœ¬æ–‡ä»¶æ‰€åœ¨çš„çˆ¶ç›®å½•binä¸‹ï¼Œç„¶åå†åˆ‡æ¢åˆ°ä¸Šä¸€å±‚ç›®å½•åˆ°é¡¹ç›®ç›®å½•ï¼Œæœ€åæ‰“å°ç»å¯¹è·¯å¾„ï¼Œå³è®¾ç½®ç”¨æˆ·å˜é‡FLINKX_HOMEä¸ºé¡¹ç›®æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„ã€‚</p><ul class="contains-task-list contains-task-list_tsSF"><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->setã€envã€exportçš„åŒºåˆ«</li></ul><p>æ¥ä¸‹æ¥çœ‹å½“å‰ç³»ç»Ÿèƒ½ä¸èƒ½ä½¿ç”¨javaç¨‹åºï¼Œå…ˆçœ‹<code>JAVA_HOME</code>ç¯å¢ƒæ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨å†ç”¨<code>command -v java</code>çœ‹èƒ½ä¸èƒ½ç›´æ¥æ‰§è¡Œjavaç¨‹åºï¼Œå†æ²¡æœ‰å°±æŠ¥é”™é€€å‡ºã€‚æ¥ä¸‹æ¥è®¾ç½®ä¸¤ä¸ªshellå˜é‡<code>JAR_DIR</code>å’Œå…¥å£ç±»å<code>CLASS_NAME</code>ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ï¼š</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">nohup</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$JAVA_RUN</span><span class="token plain"> -cp </span><span class="token variable" style="color:#36acaa">$JAR_DIR</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$CLASS_NAME</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$@</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>nohupå‘½ä»¤æ˜¯no hang upå‘½ä»¤çš„ç¼©å†™ï¼Œå®ƒå°†åé¢è·Ÿç€çš„å‘½ä»¤æŒ‚åˆ°åå°è¿è¡Œå¹¶å°†è¾“å‡ºé‡å®šå‘åˆ°nohup.outæ–‡ä»¶ï¼Œé€šå¸¸è·Ÿ<code>&amp;</code>æ­é…ä½¿ç”¨ï¼Œè®©å‘½ä»¤æ‰§è¡ŒåŒæ—¶å¿½ç•¥SIGINTå’ŒSIGHUPä¿¡å·ã€‚å˜é‡æ›¿æ¢åçš„å‘½ä»¤å¦‚ä¸‹ï¼Œ<code>$@</code>è¡¨ç¤ºæ‰§è¡Œflinkxè„šæœ¬åé¢è·Ÿç€çš„æ‰€æœ‰å‚æ•°ã€‚</p><ul class="contains-task-list contains-task-list_tsSF"><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->nohupå’Œ&amp;çš„åŒºåˆ«</li><li class="task-list-item"><input type="checkbox" disabled=""> <code>$@</code>ï¼Œ<code>$#</code>ï¼Œ<code>$1</code>...<code>$n</code>çš„å«ä¹‰</li></ul><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">java -cp /path-to-flinkx/lib/* com.dtstack.flinkx.client.Launcher </span><span class="token variable" style="color:#36acaa">$@</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä»¥è¿è¡Œä¸€ä¸ªMySQLåˆ°Hiveçš„åŒæ­¥ä»»åŠ¡ä¸ºä¾‹ï¼Œåœ¨Linuxæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">bin/flinkx -mode </span><span class="token builtin class-name">local</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         -jobType </span><span class="token function" style="color:#d73a49">sync</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         -jobName test_kayhaw </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         -job E:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">flinkx_job</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">new_mysql_hive.json </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         -flinkxDistDir E:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">flinkx</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">flinkx-dist </span><span class="token punctuation" style="color:#393A34">\</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>åœ¨IEDAè¿è¡ŒFlinkXåŒæ­¥ä»»åŠ¡é…ç½®è¿è¡Œå‚æ•°å‘½ä»¤å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­Program argumentså†…å®¹å³ä¸Šè¿°å‘½ä»¤å‚æ•°å†…å®¹ã€‚</p><img loading="lazy" style="width:100%;height:100%" src="/img/blog/FlinkXDissection/FlinkX_IDEA_RunConfig.png" title="FlinkX IDEA Run Configuration" class="img_E7b_"><h2 class="anchor anchorWithStickyNavbar_mojV" id="å‘½ä»¤è¡Œå…¥å£launcher">å‘½ä»¤è¡Œå…¥å£Launcher<a class="hash-link" href="#å‘½ä»¤è¡Œå…¥å£launcher" title="Direct link to heading">â€‹</a></h2><p>ä»<code>bin/flinx</code>è„šæœ¬å¾—çŸ¥è¯¥å‘½ä»¤è¡Œè¿è¡Œå…¥å£ä¸ºLauncherç±»ï¼Œå®ƒä½äºflinkx-clientsæ¨¡å—ï¼Œæ¥ä¸‹æ¥å¯¹å…¶mainæ–¹æ³•å±•å¼€åˆ†æã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å‚æ•°è§£æ">å‚æ•°è§£æ<a class="hash-link" href="#å‚æ•°è§£æ" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆå¯¹å‘½ä»¤åé¢çš„ä¸€å¤§å¨å‚æ•°è¿›è¡Œè§£æï¼Œå€ŸåŠ©äºApache Commons CLIåŒ…æ¥å®Œæˆã€‚ä¸ºäº†å°†å‚æ•°å­—ç¬¦ä¸²è½¬ä¸º<code>com.dtstack.flinkx.options.Options</code>å¯¹è±¡ï¼Œä½¿ç”¨åå°„è·å–Optionsçš„å­—æ®µï¼Œç»“åˆCommon CLIæä¾›çš„<code>DefaultParser.parse()</code>æ–¹æ³•å°†å­—ç¬¦ä¸²è½¬ä¸ºCommandLineå¯¹è±¡ï¼Œç„¶åå†éå†Optionsçš„å­—æ®µåç§°nameï¼Œé€šè¿‡<code>CommandLine.getOptionValue(name)</code>è·å–å‚æ•°å€¼ï¼Œæœ€åè®¾ç½®å›ç»™Optionså¯¹è±¡ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="é»˜è®¤å‚æ•°é…ç½®">é»˜è®¤å‚æ•°é…ç½®<a class="hash-link" href="#é»˜è®¤å‚æ•°é…ç½®" title="Direct link to heading">â€‹</a></h3><p>æ¥ä¸‹æ¥findDefaultConfigDir()æ–¹æ³•ç”¨äºåœ¨å‘½ä»¤è¡Œæ²¡æœ‰æä¾›çš„æƒ…å†µä¸‹ï¼Œè®¾ç½®3ä¸ªæ–‡ä»¶å¤¹è·¯å¾„å‚æ•°é»˜è®¤å€¼ï¼Œåˆ†åˆ«æ˜¯FlinkXè¯»å†™æ’ä»¶åŒ…æ–‡ä»¶å¤¹ã€Flinké…ç½®æ–‡ä»¶å¤¹å’ŒHadoopé…ç½®æ–‡ä»¶å¤¹ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">findDefaultConfigDir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Options</span><span class="token plain"> launcherOptions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">findDefaultFlinkxDistDir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">launcherOptions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// localæ¨¡å¼åªéœ€è¦é…ç½®FlinkXDistDirè¿™ä¸€ä¸ªå°±å¯ä»¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ClusterMode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">local</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">equalsIgnoreCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">launcherOptions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">findDefaultFlinkConf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">launcherOptions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">findDefaultHadoopConf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">launcherOptions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä»¥findDefaultFlinkxDistDir()ä»£ç ä¸ºä¾‹ï¼šå½“å‘½ä»¤è¡Œå‚æ•°æ²¡æœ‰flinkDistDiræ—¶ï¼Œçœ‹ç¯å¢ƒå˜é‡ä¸­æœ‰æ²¡æœ‰é…ç½®<code>FLINX_HOME</code>ï¼Œè¿™ä¸ªæŸ¥çœ‹ç¯å¢ƒå˜é‡æ–¹æ³•getSystemProperty()ä¹Ÿæœ‰è®²ç©¶ï¼Œå…ˆè°ƒç”¨System.getenv()çœ‹æœ‰æ²¡æœ‰ï¼Œæ²¡æœ‰å†çœ‹System.getProperty()ã€‚å¦‚æœæœ‰ç¯å¢ƒå˜é‡<code>FLINKX_HOME</code>ï¼Œæ ¹æ®å®ƒè®¾ç½®flinkxæ’ä»¶åŒ…è·¯å¾„ï¼Œå¹¶æ³¨å†Œä¸ºç¯å¢ƒå˜é‡<code>ConfigConstants.ENV_FLINK_PLUGINS_DIR</code>ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">findDefaultFlinkxDistDir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Options</span><span class="token plain"> launcherOptions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> distDir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> launcherOptions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getFlinkxDistDir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœè¿è¡Œå‚æ•°è¿˜æœªè®¾ç½®ï¼Œé€šè¿‡ç³»ç»Ÿå˜é‡æ¥è‡ªå·±æ‰¾</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StringUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">distDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain"> flinkxHome </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getSystemProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">KEY_FLINKX_HOME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StringUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isNotEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flinkxHome</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            flinkxHome </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> flinkxHome</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">trim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// è¿˜è€ƒè™‘åˆ°è·¯å¾„æœ€æœ«å°¾æœ‰æ²¡æœ‰åŠ è·¯å¾„åˆ†éš”ç¬¦ï¼Œç»†ï¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flinkxHome</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">endsWith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">File</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">separator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                distDir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> flinkxHome </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> PLUGINS_DIR_NAME</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                distDir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> flinkxHome </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token class-name">File</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">separator </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> PLUGINS_DIR_NAME</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            launcherOptions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setFlinkxDistDir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">distDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ConfigConstants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ENV_FLINK_PLUGINS_DIR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> distDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>findDefaultFlinkConf()æ–¹æ³•åœ¨æœ‰ç¯å¢ƒå˜é‡FLIN<strong>K</strong>_HOMEè®¾ç½®çš„æƒ…å†µä¸‹ï¼Œè¡¥å……è®¾ç½®Flinkçš„confç›®å½•å’Œlibç›®å½•å‚æ•°ã€‚findDefaultHadoopConf()æ–¹æ³•ç±»ä¼¼æŸ¥çœ‹HADOOP_HOMEç¯å¢ƒå˜é‡å¹¶è®¾Hadoop confç›®å½•å‚æ•°ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å‚æ•°è½¬ä¸ºstringåˆ—è¡¨">å‚æ•°è½¬ä¸ºStringåˆ—è¡¨<a class="hash-link" href="#å‚æ•°è½¬ä¸ºstringåˆ—è¡¨" title="Direct link to heading">â€‹</a></h3><p>è¿™ä¸€éƒ¨åˆ†çš„ä»£ç æœ‰ç‚¹è¿·ï¼Œé¦–å…ˆè°ƒç”¨getProgramExeArgList()æ–¹æ³•æŠŠè§£æå¥½çš„Optionså‚æ•°å¯¹è±¡è½¬ä¸ºStringåˆ—è¡¨ï¼Œå…·ä½“æ“ä½œï¼š</p><ol><li>æŸ¥çœ‹<code>-job</code>é€‰é¡¹é…ç½®ï¼Œ<strong>æŠŠæ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²æ›¿æ¢ä¸ºæ–‡ä»¶å†…å®¹å­—ç¬¦ä¸²</strong>ï¼Œè¿™ä¸ªé€»è¾‘è—å¾—æœ‰ç‚¹æ·±ï¼›</li><li>æŸ¥çœ‹æ¯ä¸ªé€‰é¡¹åï¼ŒåŠ ä¸Š"-"å‰ç¼€åŠ å…¥Stringåˆ—è¡¨ï¼Œå†åŠ å…¥é€‰é¡¹å€¼ï¼Œå½¢æˆä¸¤ä¸¤ä¸€å¯¹çš„åˆ—è¡¨ã€‚</li></ol><p>æ¥ä¸‹æ¥æŠŠè¿™ä¸ªStringåˆ—è¡¨æ”¾åˆ°HashMapä¸­ä¾¿äºæŒ‰é”®è·å–ï¼Œç„¶åå–å‡º<code>-p</code>é€‰é¡¹å€¼sï¼Œè¿™æ˜¯FlinkXæä¾›çš„ç‰¹æ€§ï¼Œsæ˜¯<code>"å‚æ•°å1=å‚æ•°å€¼1,å‚æ•°å2=å‚æ•°å€¼2..."</code>æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ‹†è§£æˆé”®å€¼å¯¹ï¼Œç”¨äºæ›¿æ¢<code>-job</code>å‚æ•°å€¼jsonå­—ç¬¦ä¸²ä¸­ç±»ä¼¼<code>${name}</code>çš„å ä½ç¬¦ã€‚æ¯”å¦‚s="name=kay"ï¼Œjsonå­—ç¬¦ä¸²ä¸º<code>{"name": "${name}"}</code>ï¼Œç»“æœæ›¿æ¢åjsonä¸º<code>{"name": "kayhaw"}</code>ã€‚</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>çœŸçš„å¥½å—ï¼Ÿ</h5></div><div class="admonition-content"><p>è¿™é‡Œä¸ºäº†å®ç°<code>-p</code>å‚æ•°æä¾›çš„ç‰¹æ€§ï¼ŒæŠŠOptionsè½¬ä¸ºStringåˆ—è¡¨ï¼Œåˆè½¬ä¸ºHashMapï¼Œè¿™æ ·æ¥å›å€’è…¾ï¼Œä¸å¦‚ä¸€å¼€å§‹ä»Optionsé‡Œå–å‡ºjobæ–‡ä»¶åå’Œsï¼Œç„¶åè¯»å–jsonæ–‡ä»¶å†…å®¹ä¸ºStringï¼Œç„¶åå†æ›¿æ¢å˜é‡ï¼Œå¯ä»¥çœç•¥æ²¡æœ‰æ„ä¹‰çš„è½¬ä¸ºHashMapå’ŒStringåˆ—è¡¨ã€‚</p></div></div><p>æ¥ç€æ„é€ JobDeployerå¯¹è±¡ï¼Œå°±æ˜¯Optionså¯¹è±¡å’Œå˜é‡æ›¿æ¢åå‚æ•°åˆ—è¡¨çš„å°è£…ã€‚ç„¶åæ ¹æ®å‚æ•°<code>-mode</code>çš„ç±»å‹æ„é€ å¯¹åº”çš„xxxClusterClientHelperå¯¹è±¡ï¼Œç”±äºä»¥localæ¨¡å¼è¿è¡Œï¼Œå¯¹åº”ä¸ºLocalClusterClientHelperå¯¹è±¡ã€‚</p><p>ç„¶åæ·»åŠ <code>-addJar</code>å‚æ•°æŒ‡å®šçš„æ‰©å±•åŒ…ï¼Œæˆ‘ä»¬æ²¡æœ‰æä¾›ï¼Œè·³è¿‡ã€‚æœ€åæ‰§è¡ŒLocalClusterClientHelperçš„submitæ–¹æ³•ï¼Œè‡³æ­¤Launcherç±»å·²ç»å®Œæˆäº†å®ƒçš„ä½¿å‘½ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="flinkxæ‰§è¡Œå…¥å£mainmain">FlinkXæ‰§è¡Œå…¥å£Main.main()<a class="hash-link" href="#flinkxæ‰§è¡Œå…¥å£mainmain" title="Direct link to heading">â€‹</a></h2><p>LocalClusterClientHelperçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œå®ƒçš„é€»è¾‘å¾ˆç®€å•ï¼šæŠŠJobDeployerè½¬ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨args(å§æ§½ï¼Œæ³¥åœ¨èµ£ç¥é­”ï¼ğŸ˜ ï¼Œåˆå›åˆ°å­—ç¬¦ä¸²äº†)ï¼Œç„¶åæ‰§è¡ŒMain.main(args)æ–¹æ³•(flinkx-coreæ¨¡å—ä¸‹)ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">LocalClusterClientHelper.java</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">LocalClusterClientHelper</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">ClusterClientHelper</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">ClusterClient</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">submit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">JobDeployer</span><span class="token plain"> jobDeployer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ä»clients.Launcherçš„mainæ–¹æ³•åˆ°coreåŒ…ä¸‹Mainç±»çš„mainæ–¹æ³•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// åˆæŠŠå¯¹è±¡è½¬æˆäº†ç»™mainæ–¹æ³•çš„argså­—ç¬¦ä¸²æ•°ç»„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jobDeployer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getProgramArgs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Main.main()æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼šé¦–å…ˆåˆæŠŠä¼ å…¥çš„å­—ç¬¦ä¸²è½¬ä¸ºOptionså¯¹è±¡ï¼Œå¹¶ä¸”ç»™jobå­—ç¬¦ä¸²æŒ‰UF-8é‡æ–°ç¼–ç ï¼Œé˜²æ­¢åç»­ä½¿ç”¨gsonè½¬ä¸ºjsonå¯¹è±¡æ—¶å‡ºé”™ã€‚æ¥ç€è·å–<code>-confProp</code>å‚æ•°å€¼ï¼Œæˆ‘ä¹ˆæ²¡æœ‰ç»™å‡ºï¼Œè·³è¿‡ã€‚æ¥ç€ä½¿ç”¨EnvFactoryå·¥å‚ç±»åˆ†åˆ«åˆ›å»ºæ™®é€šçš„æµæ‰§è¡Œç¯å¢ƒenvå’Œè¡¨æ‰§è¡Œç¯å¢ƒtEnv(å¯æ˜¯ä½¿ç”¨æ›´åŠ çµæ´»çš„SQLè€Œä¸æ˜¯json)ï¼Œç”±äºæä¾›çš„ä»»åŠ¡ç±»å‹ä¸ºsyncï¼Œå› æ­¤è¿›å…¥åˆ°exeSyncJobæ–¹æ³•ã€‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">flinkx-core/src/main/java/com/dtstack/flinkx/Main.java</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"------------program params-------------------------"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Arrays</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">stream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arg </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> LOG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"{}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> arg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"-------------------------------------------"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// åˆæŠŠstringå­—ç¬¦ä¸²è½¬ä¸ºOptionså¯¹è±¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Options</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">OptionParser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getOptions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å°†jsonå­—ç¬¦ä¸²é‡æ–°ç¼–ç ä¸ºUTF-8ï¼Œåé¢gsonè§£æéœ€è¦</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> job </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">URLDecoder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getJob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Charsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UTF_8</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ç¯å¢ƒå˜é‡ï¼Œåªç”¨äºtableæ‰§è¡Œç¯å¢ƒ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Properties</span><span class="token plain"> confProperties </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">PropertiesUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">parseConf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getConfProp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// envç”¨äºæ‰§è¡Œæ™®é€šåŒæ­¥ä»»åŠ¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">StreamExecutionEnvironment</span><span class="token plain"> env </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">EnvFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createStreamExecutionEnvironment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// tenvç”¨äºæ‰§è¡Œflink sqlåŒæ­¥ä»»åŠ¡ï¼Œä¾èµ–äºenv</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">StreamTableEnvironment</span><span class="token plain"> tEnv </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">EnvFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createStreamTableEnvironment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> confProperties</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getJobName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">EJobType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getByName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getJobType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> SQL</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">exeSqlJob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tEnv</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// å…¶å®æˆ‘è§‰å¾—è¿™é‡Œå¯ä»¥æ”¹åå«JSON</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> SYNC</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// å¼€å§‹æ­£å¼æ‰§è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">exeSyncJob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tEnv</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FlinkxRuntimeException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">"unknown jobType: ["</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getJobType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"], jobType must in [SQL, SYNC]."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"program {} execution success"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getJobName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="åˆ›å»ºæµæ‰§è¡Œç¯å¢ƒ">åˆ›å»ºæµæ‰§è¡Œç¯å¢ƒ<a class="hash-link" href="#åˆ›å»ºæµæ‰§è¡Œç¯å¢ƒ" title="Direct link to heading">â€‹</a></h3><p>EnvFactoryå·¥å‚ç±»çš„createStreamExecutionEnvironmentå’ŒcreateStreamTableEnvironmentæ–¹æ³•åˆ†åˆ«ç”¨äºåˆ›å»ºæ™®é€šçš„æµæ‰§è¡Œç¯å¢ƒenvå’Œä»¥è¡¨å½¢å¼çš„æ‰§è¡Œç¯å¢ƒtEnvã€‚ä»¥å‰è€…ä¸ºä¾‹åˆ†æï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">StreamExecutionEnvironment</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createStreamExecutionEnvironment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Options</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Configuration</span><span class="token plain"> flinkConf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Configuration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StringUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isNotEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getFlinkConfDir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ç»™å‡ºflink confæ–‡ä»¶å¤¹è·¯å¾„å¹¶åŠ è½½ï¼ŒloadConfigurationé‡è½½ç‰ˆæœ¬è¿˜å¯ä»¥å†åŠ ä¸€ä¸ªConfigurationå¯¹è±¡æ¥è¡¥å……é…ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        flinkConf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GlobalConfiguration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">loadConfiguration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getFlinkConfDir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">StreamExecutionEnvironment</span><span class="token plain"> env</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StringUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">equalsIgnoreCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ClusterMode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">local</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// localæ¨¡å¼ä¸‹ï¼Œè¿è¡Œå‚æ•°-flinkConfDir=path_to_flink_confç»™å‡ºæœ¬åœ°flinké…ç½®ç›®å½•çš„è·¯å¾„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// è¿›è€Œé…ç½®flinkæ‰§è¡Œç¯å¢ƒ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        env </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">MyLocalStreamEnvironment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flinkConf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å…¶ä»–è¿è¡Œæ¨¡å¼ä¸‹ï¼Œè¿è¡Œå‚æ•°-confProp=&lt;jsonå­—ç¬¦ä¸²&gt;ç»™å‡ºæ¥é…ç½®flinkæ‰§è¡Œç¯å¢ƒ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Configuration</span><span class="token plain"> cfg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">Configuration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">fromMap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">PropertiesUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">confToMap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getConfProp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        env </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getExecutionEnvironment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å…³é—­é—­åŒ…æ¸…ç†ï¼Œuser codeå·²ç»åœ¨æ¯ä¸ªworkerèŠ‚ç‚¹ä¸‹ï¼Ÿ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">disableClosureCleaner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> env</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>é¦–å…ˆè°ƒç”¨GlobalConfiguration.loadConfiguration(String conf_dir)æ–¹æ³•å¾—åˆ°é…ç½®ç±»ï¼Œè¯¥æ–¹æ³•ç”±Flink CoreåŒ…æä¾›ï¼Œç”¨äºè§£ææŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ä¸ºConfigurationå¯¹è±¡flinkConfã€‚å¦‚æœæ˜¯localæ¨¡å¼æäº¤ä»»åŠ¡ï¼Œä½¿ç”¨flinkConfé…ç½®ç”Ÿæˆçš„MyLocalStreamEnvironmentï¼Œè¯¥ç±»æ˜¯FlinkXè‡ªå®šä¹‰çš„ã€‚å…¶ä»–æ¨¡å¼ä¸‹ï¼Œç¯å¢ƒçš„é…ç½®å‚æ•°ç”±<code>-confProp</code>æŒ‡å®šã€‚</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>localæ¨¡å¼æäº¤ä»»åŠ¡åˆ™ä½¿ç”¨æœ¬åœ°çš„FlinkX confç›®å½•ä¸‹é…ç½®æ–‡ä»¶ä½œä¸ºæµæ‰§è¡Œç¯å¢ƒçš„é…ç½®ï¼Œå…¶ä»–æ¨¡å¼è¿œç¨‹æäº¤åˆ°Flinké›†ç¾¤ï¼Œæ­¤æ—¶é€šè¿‡<code>-confProp</code>å‚æ•°æä¾›é¢å¤–çš„æ‰§è¡Œç¯å¢ƒé…ç½®ã€‚</p></div></div><p>æ¥ç€è°ƒç”¨disableClosureCleaner()æ–¹æ³•å…³é—­é—­åŒ…æ¸…ç†å™¨åŠŸèƒ½(é»˜è®¤å¼€å¯)ï¼Œä»€ä¹ˆæ˜¯ClosureCleanerï¼ŸFlink Java API Docç»™å‡ºçš„è§£é‡Šå¦‚ä¸‹ï¼š</p><blockquote><p>The closure cleaner is a utility that tries to truncate the closure (enclosing instance) of non-static inner classes (created for inline transformation functions). That makes non-static inner classes in many cases serializable, where Java's default behavior renders them non-serializable without good reason.</p></blockquote><p>åœ¨Javaç¼–ç¨‹ä¸­ï¼Œå†…éƒ¨ç±»æ‰€åœ¨çš„å¤–éƒ¨ç±»ç§°ä¹‹ä¸ºé—­åŒ…(closure)ã€‚å½“å¼€å¯é—­åŒ…æ¸…ç†ï¼ŒFlinkä¼šåˆ†æç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä¸­æ²¡æœ‰ç”¨åˆ°çš„å­—æ®µï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºnullï¼Œè¿™æ ·ä½¿å¾—é—­åŒ…æˆ–è€…åŒ¿åå†…éƒ¨ç±»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œè€ŒæŸäº›Javaå·¥å…·åŒ…ä¸ä¼šå°†å…¶åºåˆ—åŒ–ã€‚è€Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°éœ€è¦é€šè¿‡åºåˆ—åŒ–å°†å…¶åˆ†å‘åˆ°Flinké›†ç¾¤çš„workerèŠ‚ç‚¹ä¸Šã€‚è¿™é‡Œå…³é—­äº†é—­åŒ…æ¸…ç†ï¼Œæ˜¯å› ä¸ºå·²ç»åœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šéƒ¨ç½²äº†FlinkX jaråŒ…ğŸ¤”ï¼Ÿ</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ‰§è¡Œä½œä¸šexesyncjob">æ‰§è¡Œä½œä¸šexeSyncJob<a class="hash-link" href="#æ‰§è¡Œä½œä¸šexesyncjob" title="Direct link to heading">â€‹</a></h3><p>Main.exeSyncJob()æ–¹æ³•çš„ä»£ç é€»è¾‘å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><p><strong>ç¬¬ä¸€æ­¥</strong>ï¼Œè§£æå‘½ä»¤è¡Œå‚æ•°å¾—åˆ°é…ç½®ç±»å¯¹è±¡SyncConfï¼Œé€šè¿‡GSON.fromJson()æ–¹æ³•è§£æï¼Œ<strong>é¡ºä¾¿åšäº†å‚æ•°éç©ºæ ¡éªŒ</strong>ï¼›</p><p><strong>ç¬¬äºŒæ­¥</strong>ï¼Œç”±configStreamExecutionEnvironmentæ–¹æ³•é…ç½®æµæ‰§è¡Œç¯å¢ƒï¼Œå…¶ä¸­æ ¸å¿ƒä»£ç æ˜¯<code>PluginUtil.registerPluginUrlToCachedFile(config, env)</code>ï¼Œå±•å¼€åˆ†æä¸€ä¸‹è¿™ä¸ªæ–¹æ³•(å¾ˆé‡è¦ï¼)</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">registerPluginUrlToCachedFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">SyncConf</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">StreamExecutionEnvironment</span><span class="token plain"> env</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Set</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">URL</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> urlSet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">HashSet</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™é‡Œå›ºå®šæ­»äº†è¿œç¨‹æ’ä»¶åŒ…è·¯å¾„ä¸ºnullï¼ŒgetJarFileDirPathä¹Ÿåªä¼šå–æœ¬åœ°æ’ä»¶åŒ…è·¯å¾„äº†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Set</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">URL</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> coreUrlList </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getJarFileDirPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPluginRoot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Set</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">URL</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> formatsUrlList </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getJarFileDirPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FORMATS_SUFFIX</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPluginRoot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Set</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">URL</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> sourceUrlList </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">getJarFileDirPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getReader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// æ³¨æ„è¿™é‡Œæ’ä»¶æœç´¢æ ¹è·¯å¾„æ¢äº†ï¼Œåœ¨connectorç›®å½•ä¸‹é¢æ‰¾ï¼ŒsinkåŒç†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPluginRoot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> SP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> CONNECTOR_DIR_NAME</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Set</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">URL</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> sinkUrlList </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">getJarFileDirPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getWriter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPluginRoot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> SP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> CONNECTOR_DIR_NAME</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Set</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">URL</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> metricUrlList </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">getJarFileDirPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMetricPluginConf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPluginName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// æŒ‡æ ‡æ’ä»¶åœ¨metricsç›®å½•ä¸‹é¢æ‰¾</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPluginRoot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> SP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> METRIC_SUFFIX</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    urlSet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">coreUrlList</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    urlSet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">formatsUrlList</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    urlSet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sourceUrlList</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    urlSet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sinkUrlList</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    urlSet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metricUrlList</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">URL url </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> urlSet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain"> classFileName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CLASS_FILE_NAME_FMT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// æ³¨å†Œæ‰€æœ‰çš„jaråŒ…</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">registerCachedFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> classFileName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœæ˜¯æœ¬åœ°æ‰§è¡Œç¯å¢ƒåˆ™ç›´æ¥åŠ è½½ï¼Œæ¯ä¸ªçº¿ç¨‹åŠ è½½è‡ªå·±çš„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">env </span><span class="token keyword" style="color:#00009f">instanceof</span><span class="token plain"> </span><span class="token class-name">MyLocalStreamEnvironment</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">MyLocalStreamEnvironment</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> env</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setClasspaths</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">urlSet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isNotEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">coreUrlList</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">ClassLoader</span><span class="token plain"> contextClassLoader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentThread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getContextClassLoader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸ºä»€ä¹ˆè¦ç”¨åå°„åŠ è½½jaråŒ…ï¼Ÿï¼Ÿï¼Ÿ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">Method</span><span class="token plain"> add </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">URLClassLoader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDeclaredMethod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"addURL"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> URL</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                add</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setAccessible</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                add</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">invoke</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">contextClassLoader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">coreUrlList</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Exception</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                LOG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">warn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token string" style="color:#e3116c">"cannot add core jar into contextClassLoader, coreUrlList = {}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token class-name">GsonUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toJson</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">coreUrlList</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è¯¥æ–¹æ³•ä¸»è¦åŠŸèƒ½æ˜¯é€šè¿‡getJarFileDirPathå¾—åˆ°ä¸åŒåŠŸèƒ½æ’ä»¶åŒ…çš„URLåˆ—è¡¨ï¼Œç„¶åå°†æ‰€æœ‰URLåˆ—è¡¨åˆå¹¶ï¼Œæœ€åé€šè¿‡Flinkæä¾›çš„æ–¹æ³•registerCachedFile(String filePath, String name, boolean executable)å°†jaræ–‡ä»¶æ³¨å†Œåˆ°ç¼“å­˜ä¸­ã€‚getJarFileDirPathçš„ä»£ç é€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>å°†è¯»å†™æ’ä»¶åç§°ä¸­çš„<code>reader</code>ã€<code>source</code>ã€<code>writer</code>å’Œ<code>sink</code>è¿™4ä¸­åç¼€å»æ‰å¾—åˆ°æ’ä»¶åï¼›</li><li>æœç´¢<code>&lt;FlinkXæ’ä»¶åŒ…ç›®å½•&gt;/connector/&lt;æ’ä»¶å&gt;</code>ä¸‹çš„<strong>æ‰€æœ‰ä»¥flinkxå¼€å¤´ï¼Œä»¥.jarç»“å°¾çš„æ–‡ä»¶å</strong>ï¼Œå³è¯»å†™æ’ä»¶jaråŒ…ï¼›</li><li>è¿”å›æ–‡ä»¶URLã€‚</li></ol><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>æ³¨æ„</h5></div><div class="admonition-content"><p>è¿™é‡ŒgetJarFileDirPathçš„ç¬¬3ä¸ªå‚æ•°ï¼ŒremotePluginPathä¼ å…¥ä¸ºnullï¼Œå¦åˆ™ä¼˜å…ˆä»è¯¥è·¯å¾„ä¸‹æœç´¢jaræ–‡ä»¶</p></div></div><p>å½“ç»™envæ³¨å†Œå®Œç¼“å­˜æ–‡ä»¶åï¼Œå¦‚æœè¿˜æ˜¯localæ¨¡å¼ï¼Œåˆ™åŠ è½½flinkx coreåŒ…ï¼š<strong>ä½¿ç”¨çº¿ç¨‹åŠ è½½å™¨ï¼Œå¹¶ä»¥åå°„å½¢å¼è°ƒç”¨å…¶addURLæ–¹æ³•()</strong>ã€‚è¿™é‡Œä½¿ç”¨åå°„æ˜¯å› ä¸ºaddURLæ–¹æ³•æ˜¯URLClassLoaderç±»çš„ï¼ŒClassLoaderç±»å¹¶æ²¡æœ‰è¯¥æ–¹æ³•ã€‚åœ¨è¿è¡Œæ—¶ï¼Œè·å¾—çš„çº¿ç¨‹åŠ è½½å™¨æœ¬è´¨æ˜¯AppClassLoaderï¼Œå®ƒæ˜¯URLClassLoaderçš„å­ç±»ã€‚</p><p>å›åˆ°configStreamExecutionEnvironmentæ–¹æ³•ï¼Œå¦‚æœè§£æå‡ºæ¥çš„é…ç½®SyncConfä¸ºç©º(-jobå‚æ•°æ²¡æœ‰æä¾›)ï¼Œå¹¶ä¸”è¿è¡Œæ¨¡å¼ä¸æ˜¯localæˆ–è€…æ’ä»¶åŠ è½½æ¨¡å¼ä¸æ˜¯shipfile(å‚æ•°-shipfileä¸º1)å°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™æ„é€ ä¸€ä¸ªFactoryHelperæ³¨å†Œåˆ°FactoryUtilå’ŒTableFactoryServiceçš„ThreadLocalå¯¹è±¡(ç”±äºè¿è¡Œæ¨¡å¼ä¸ºlocalï¼Œè¿™æ­¥æ“ä½œçš„ä½œç”¨å…ˆç•¥è¿‡)ã€‚</p><p>æœ€åä¸€æ­¥æ˜¯registerShipfileToCachedFileæ–¹æ³•ï¼Œä¸Šé¢registerPluginUrlToCachedFileæ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œ<strong>å®ƒåœ¨è°ƒç”¨env.registerCachedFile()æ–¹æ³•æ—¶ç¬¬3ä¸ªå‚æ•°è®¾ç½®ä¸ºfalse</strong>ã€‚</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>registerPluginUrlToCachedFileå’ŒregisterShipfileToCachedFileçš„ä¸åŒï¼š</p><ol><li>æ³¨å†Œå¯¹è±¡ä¸åŒï¼Œå‰è€…æ˜¯flinx-distä¸‹çš„æ’ä»¶jaråŒ…ï¼Œåè€…æ˜¯å‚æ•°<code>-shipfile</code>å€¼(ä»¥é€—å·åˆ†éš”çš„jaråŒ…è·¯å¾„)æä¾›çš„jaråŒ…ï¼›</li><li>æ³¨å†Œæ–¹å¼ä¸åŒï¼Œå‰è€…æ³¨å†Œåä¸º<code>class_path_&lt;åºå·&gt;</code>ï¼Œåè€…ä»¥jaræ–‡ä»¶åæ³¨å†Œå› æ­¤ä¸èƒ½é‡åï¼›å‰è€…executableå‚æ•°ä¸ºtrueï¼Œåè€…ä¸ºfalseã€‚</li></ol></div></div><p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼šè°ƒç”¨discoverSourceæ–¹æ³•è·å–SourceFactoryå®ä¾‹ã€‚é¦–å…ˆç”± PluginUtil.getPluginClassNameæ–¹æ³•ç¡®å®šè¦å®ä¾‹åŒ–çš„å…¨è·¯å¾„å·¥å‚ç±»åï¼Œå…¶æ„é€ æ ¼å¼ä¸º<strong>com.dtstack.flinkx.connector.&lt;æ’ä»¶å&gt;.source.&lt;é¦–å­—æ¯å¤§å†™æ’ä»¶å&gt;SourceFactory</strong>ï¼›æ¥ç€é€šè¿‡getJarFileDirPathæœç´¢<code>${FLINK_DIST_DIR}/connector/&lt;æ’ä»¶å&gt;</code>çš„jaræ–‡ä»¶å’Œformatç›®å½•ä¸‹çš„jaræ–‡ä»¶ï¼Œåˆå¹¶æˆurlListåˆ—è¡¨ã€‚é€šè¿‡Flink APIé…ç½®æ‰§è¡Œç¯å¢ƒï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token class-name">ConfigUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">encodeCollectionToConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥env.getConfig()è€Œæ˜¯è¦é€šè¿‡åå°„ï¼Ÿ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Configuration</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">ReflectionUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDeclaredMethod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"getConfiguration"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">invoke</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™æ˜¯ç”¨äºpipelineçš„jaråŒ…</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">PipelineOptions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">JARS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        urlList</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        URL</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">ConfigUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">encodeCollectionToConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Configuration</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">ReflectionUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDeclaredMethod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"getConfiguration"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">invoke</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">PipelineOptions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CLASSPATHS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        urlList</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        URL</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>ä¸ºä»€ä¹ˆç”¨åå°„è°ƒç”¨getConfigurationæ–¹æ³•ï¼Ÿ</h5></div><div class="admonition-content"><p>getConfigurationæ–¹æ³•æ˜¯StreamExecutionEnvironmentçš„protectedæ–¹æ³•ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ã€‚</p></div></div><p>æœ€åè°ƒç”¨ç±»åŠ è½½å™¨åŠ è½½å·¥å‚ç±»å¹¶è°ƒç”¨å…¶ç‰¹å®šçš„æ„é€ æ–¹æ³•è¿”å›å®ä¾‹ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ClassLoaderManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸ºä»€ä¹ˆä¼ å…¥urlListï¼Ÿå®ƒä½œä¸ºkeyæ¥æ ‡è¯†ä¹‹å‰ä½¿ç”¨çš„classloader</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    urlList</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// clæ˜¯classloadç¼©å†™</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cl </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Class</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics operator" style="color:#393A34">?</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> clazz </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">loadClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pluginClassName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Constructor</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics operator" style="color:#393A34">?</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> constructor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                clazz</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getConstructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token class-name">SyncConf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// è°ƒç”¨ç‰¹å®šçš„æ„é€ æ–¹æ³•è¿”å›SourceFactoryå¯¹è±¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SourceFactory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> constructor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> env</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è¿™é‡Œä¹‹æ‰€ä»¥ä¼šä¼ å…¥urlListåˆ—è¡¨ï¼Œæ˜¯å› ä¸ºClassLoaderManagerä»¥urlä¸ºkeyç»´æŠ¤äº†ä¸€ä¸ªClassLoaderå¯¹è±¡ç¼“å­˜HashMapï¼Œé€šè¿‡lambdaè¡¨è¾¾å¼æ‰§è¡Œç±»åŠ è½½å’Œå®ä¾‹åŒ–ï¼Œæ³¨æ„ä½¿ç”¨clæ—¶éœ€è¦åˆ‡æ¢å½“å‰ç±»åŠ è½½å™¨ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">R</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token class-name">R</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callbackAndReset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">ClassLoaderSupplier</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">R</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> supplier</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">ClassLoader</span><span class="token plain"> toSetClassLoader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æš‚æ—¶åœ°å°†çº¿ç¨‹ç±»åŠ è½½å™¨æ›¿æ¢ä¸ºtoSetClassLoaderï¼Œç„¶åè°ƒç”¨supplier.getæ–¹æ³•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ClassLoader</span><span class="token plain"> oldClassLoader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentThread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getContextClassLoader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentThread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setContextClassLoader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">toSetClassLoader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> supplier</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">toSetClassLoader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// è¿˜åŸæ—§çš„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentThread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setContextClassLoader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">oldClassLoader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><strong>ç¬¬å››æ­¥</strong>ï¼šé€šè¿‡sourceFactory.createSource()å¾—åˆ°DataStream&lt;RowData<!-- -->&gt;<!-- -->ï¼Œç„¶åè®¾ç½®sourceç®—å­å¹¶è¡Œåº¦ã€‚è¿™éƒ¨åˆ†å†…å®¹æ¶‰åŠsourceç®—å­çš„å®ç°ï¼Œåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­åˆ†æã€‚</p><p><strong>ç¬¬äº”æ­¥</strong>ï¼šæ ¹æ®jsoné…ç½®transformerå°†æµç¯å¢ƒè½¬ä¸ºè¡¨ç¯å¢ƒï¼Œç”±syncStreamToTableå®ç°ï¼Œç”±äºæœªæä¾›transform sqlï¼Œå…ˆè·³è¿‡ã€‚</p><p><strong>ç¬¬å…­æ­¥</strong>ï¼šæ ¹æ®é…ç½®è®¾ç½®ä»sourceåˆ°sinkç®—å­çš„åˆ†å‘ç­–ç•¥ä¸ºrealance()ã€‚</p><p><strong>ç¬¬ä¸ƒæ­¥</strong>ï¼šæ„é€ SinkFactoryå¯¹è±¡å¹¶è°ƒç”¨createSinkæ–¹æ³•åˆ›å»ºsinkç®—å­ï¼Œç„¶åæ ¹æ®é…ç½®è®¾ç½®å…¶å¹¶è¡Œåº¦ï¼Œé€»è¾‘åŒsourceç®—å­ï¼Œè·³è¿‡ã€‚</p><p><strong>ç¬¬å…«æ­¥</strong>ï¼šæ‰§è¡Œä½œä¸šï¼Œä½œä¸šåç§°ç”±å‚æ•°<code>-jobName</code>ç»™å‡ºã€‚å¦‚æœæ˜¯localæ¨¡å¼è¿è¡Œè¿˜ä¼šæ‰“ç»Ÿè®¡æŒ‡æ ‡ç»“æœã€‚</p><p>è‡³æ­¤ï¼ŒFlinkXåŒæ­¥ä»»åŠ¡æäº¤çš„ä¸»å¹²æµç¨‹åˆ†æå®Œæ¯•ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><p>ä¸»å¹²æµç¨‹å¯ä»¥å½’çº³ä¸º3ä¸ªæ–¹é¢çš„åŠŸèƒ½ï¼š</p><ol><li>è¿è¡Œå‚æ•°çš„é»˜è®¤è®¾ç½®ã€è§£æå’Œä»»åŠ¡jsonå˜é‡æ›¿æ¢ç­‰æ“ä½œ</li><li>æµæ‰§è¡Œç¯å¢ƒçš„é…ç½®ï¼Œç”¨åˆ°çš„Flink APIæœ‰ï¼š</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 1. æŒ‡å®šé…ç½®ç›®å½•è§£æå¾—åˆ°Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">GlobalConfiguration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">loadConfiguration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> configDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 2. æ³¨å†Œç¼“å­˜jaræ–‡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">registerCachedFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> filePath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> executable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 3. ç”¨äºé…ç½®pipeline.jarså’Œpipeline.classpathså‚æ•°çš„å·¥å…·æ–¹æ³•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">ConfigUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">encodeCollectionToConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">WritableConfig</span><span class="token plain"> configurationï¼Œ </span><span class="token class-name">ConfigOption</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">OUT</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Nullable</span><span class="token plain"> </span><span class="token class-name">Collection</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">IN</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> values</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Function</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">IN</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> OUT</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> mapper</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="3"><li>åˆ›å»ºsourceå’Œsinkç®—å­ï¼Œå…ˆç”¨åå°„æœºåˆ¶æ„é€ å·¥å‚ç±»ï¼Œç„¶åé€šè¿‡å·¥å‚ç±»ç¤ºä¾‹åˆ›å»ºç®—å­å®ä¾‹ã€‚</li></ol><p>æ‰§è¡Œç¯å¢ƒé…ç½®å’Œç®—å­éƒ½å·²å‡†å¤‡å¥½ï¼Œè°ƒç”¨StreamExecutionEnvironment.execute()å³å¯æ‰§è¡Œä»»åŠ¡ã€‚æ€»ä½“ä¸‹æ¥å‚æ•°é…ç½®çš„å‡†å¤‡å·¥ä½œå±…å¤šï¼Œæœ€æ ¸å¿ƒéƒ¨åˆ†å°±æ˜¯é…ç½®è¿è¡Œç¯å¢ƒã€åŠ è½½ç®—å­å·¥å‚ç±»ç„¶ååˆ›å»ºç®—å­ã€‚</p>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="FlinkX" term="FlinkX"/>
        <category label="Source code dissection" term="Source code dissection"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[MySQLåŸºç¡€çŸ¥è¯†æ€»ç»“(1)]]></title>
        <id>/2021/10/26/MySQLSummary</id>
        <link href="https://kayhaw.github.io/blog/2021/10/26/MySQLSummary"/>
        <updated>2021-10-26T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[MySQLåŸºç¡€çŸ¥è¯†æ€»ç»“(1)]]></summary>
        <content type="html"><![CDATA[<p>MySQLåŸºç¡€çŸ¥è¯†æ€»ç»“-ç¬¬ä¸€ç¯‡</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="datetimeå’Œtimestampå¼‚åŒ">DATETIMEå’ŒTIMESTAMPå¼‚åŒ<a class="hash-link" href="#datetimeå’Œtimestampå¼‚åŒ" title="Direct link to heading">â€‹</a></h2><p>DATETIMEå’ŒTIMESTAMPéƒ½å¯ä»¥ç”¨æ¥è¡¨ç¤º<code>å¹´æœˆæ—¥æ—¶åˆ†ç§’</code>çš„æ—¶é—´ï¼ˆDATEç±»å‹åªèƒ½åˆ°<code>å¹´æœˆæ—¥</code>ï¼‰ï¼Œä½†ç»†ç©¶èµ·æ¥å®ƒä»¬è¿˜æœ‰å¦‚ä¸‹åŒºåˆ«ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>å­˜å‚¨é•¿åº¦</th><th>èŒƒå›´</th><th>ç²¾åº¦</th></tr></thead><tbody><tr><td>datetime</td><td>8å­—èŠ‚</td><td>1000-01-01 00:00:00.000000åˆ°9999-12-31 23:59:59.999999</td><td>6</td></tr><tr><td>timestamp</td><td>4å­—èŠ‚</td><td>1970-01-01 00:00:01.000000åˆ°2038-01-19 03:14:07.999999</td><td>6</td></tr></tbody></table><p>å½“TIMESTAMPå­—æ®µæ’å…¥ä¸€ä¸ªå€¼æ—¶ï¼Œæ ¹æ®<strong>å½“å‰æ—¶åŒº</strong>å°†æ’å…¥æ—¶é—´è½¬ä¸ºUTCæ—¶é—´ï¼›å½“è¯»å–TIMESTAMPå­—æ®µå€¼æ—¶ï¼Œåˆå°†UTCæ—¶é—´è½¬ä¸ºå®¢æˆ·ç«¯å½“å‰æ—¶åŒºè¿”å›ã€‚<strong>DATETIMEå­˜å‚¨å€¼ä¸æ—¶åŒºæ— å…³</strong>ã€‚</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>å…³äºæ—¶é—´ç²¾åº¦</h5></div><div class="admonition-content"><p>DATETIMEå’ŒTIMESTAMPéƒ½çš„ç²¾åº¦éƒ½æ˜¯6ä½ï¼Œè¡¨ç¤ºç§’çº§å¯ä»¥ç²¾ç¡®åˆ°å°æ•°ç‚¹å6ä½ï¼Œä½†åœ¨è¾ƒæ—©çš„MySQLç‰ˆæœ¬(5.6.5ä¹‹å‰)ä¸­ç§’çº§æ²¡æœ‰å°æ•°éƒ¨åˆ†ã€‚</p></div></div>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="MySQL Basic" term="MySQL Basic"/>
        <category label="Summary" term="Summary"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[æµæº(SourceFlow)é¡¹ç›®è®¡åˆ’è¡¨]]></title>
        <id>/2021/10/17/SourceflowProject</id>
        <link href="https://kayhaw.github.io/blog/2021/10/17/SourceflowProject"/>
        <updated>2021-10-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[æµæºé¡¹ç›®è®¡åˆ’è¡¨]]></summary>
        <content type="html"><![CDATA[<p>æµæº(SourceFlow)é¡¹ç›®è®¡åˆ’è¡¨</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="10æœˆä»½è®¡åˆ’">10æœˆä»½è®¡åˆ’<a class="hash-link" href="#10æœˆä»½è®¡åˆ’" title="Direct link to heading">â€‹</a></h2><ol><li>ç‰ˆæƒå£°æ˜å¤´ç¼–å†™</li><li>ç®€å•æµç¨‹æ¡†æ¶æ­å»º</li></ol>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="SourceFlow" term="SourceFlow"/>
        <category label="Data Integration" term="Data Integration"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ¯æ—¥ç®—æ³•é¢˜-å‰ç¼€å’Œ]]></title>
        <id>/2021/10/16/PrefixSum</id>
        <link href="https://kayhaw.github.io/blog/2021/10/16/PrefixSum"/>
        <updated>2021-10-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[æ¯æ—¥ç®—æ³•é¢˜-å‰ç¼€å’Œ]]></summary>
        <content type="html"><![CDATA[<p>æ€»ç»“å‰ç¼€å’Œç›¸å…³é—®é¢˜</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="å‰ç¼€å’Œå®šä¹‰">å‰ç¼€å’Œå®šä¹‰<a class="hash-link" href="#å‰ç¼€å’Œå®šä¹‰" title="Direct link to heading">â€‹</a></h2><p>ä»€ä¹ˆæ˜¯å‰ç¼€å’Œï¼Ÿé¡¾åæ€ä¹‰ï¼Œå®ƒè¡¨ç¤ºæ•°ç»„arrayçš„å‰ç¼€æ•°ç»„ä¹‹å’Œï¼Œå³</p><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>x</mi><mi>S</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><msubsup><mo>âˆ‘</mo><mn>0</mn><mi>i</mi></msubsup><mi>a</mi><mi>r</mi><mi>r</mi><mi>a</mi><mi>y</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">prefixSum[i]=\sum_{0}^iarray[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.264274em;vertical-align:-0.29971000000000003em"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.964564em"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span></span></p><p>å½“æ±‚å‡ºæ•°ç»„æ‰€æœ‰ä½ç½®çš„å‰ç¼€å’Œä¹‹åï¼Œé€šè¿‡prefixSum<!-- -->[i]<!-- -->-prefixSum<!-- -->[j-1]<!-- -->å³å¯å¿«é€Ÿå¾—åˆ°åŒºé—´<!-- -->[j,i]<!-- -->å†…å…ƒç´ ä¹‹å’Œï¼Œä»è€Œåœ¨O(1)æ—¶é—´å†…å¾—åˆ°æœ¬æ¥éœ€è¦O(n)æ—¶é—´è®¡ç®—çš„å€¼ã€‚æ¢è¨€ä¹‹ï¼Œä½¿ç”¨å‰ç¼€å’Œçš„æœ¬è´¨å°±æ˜¯ç”¨ç©ºé—´æ¢æ—¶é—´ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ä¸€ç»´æ•°ç»„å‰ç¼€å’Œ">ä¸€ç»´æ•°ç»„å‰ç¼€å’Œ<a class="hash-link" href="#ä¸€ç»´æ•°ç»„å‰ç¼€å’Œ" title="Direct link to heading">â€‹</a></h2><p><a href="https://leetcode-cn.com/problems/range-sum-query-immutable/" target="_blank" rel="noopener noreferrer">é¢˜ç›®æè¿°</a>ï¼šç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„numsï¼Œæ±‚å‡ºæ•°ç»„ä»ç´¢å¼•iåˆ°jï¼ˆi â‰¤ jï¼‰èŒƒå›´å†…å…ƒç´ çš„æ€»å’Œï¼ŒåŒ…å«iã€jä¸¤ç‚¹ã€‚</p><p>å…ˆæ±‚å‡ºå‰ç¼€å’Œæ•°ç»„prefixSumï¼Œæ ¹æ®æ¨å¯¼å…¬å¼<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>x</mi><mi>S</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>âˆ’</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>x</mi><mi>S</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">sum[i,j]=prefixSum[j]-prefixSum[i-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.05724em">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></span>å³å¯æ±‚è§£ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">NumArray</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> prefixSum</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">NumArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> nums</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> nums</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        prefixSum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">len</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> len</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            prefixSum</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prefixSum</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> nums</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sumRange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> prefixSum</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">right</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> prefixSum</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="äºŒç»´æ•°ç»„å‰ç¼€å’Œ">äºŒç»´æ•°ç»„å‰ç¼€å’Œ<a class="hash-link" href="#äºŒç»´æ•°ç»„å‰ç¼€å’Œ" title="Direct link to heading">â€‹</a></h2><p><a href="https://leetcode-cn.com/problems/range-sum-query-2d-immutable/" target="_blank" rel="noopener noreferrer">é¢˜ç›®æè¿°</a>ï¼šç»™å®šä¸€ä¸ªäºŒç»´çŸ©é˜µ matrixï¼Œå®ç°å¦‚ä¸‹æ–¹æ³•ï¼š</p><ul><li>NumMatrix(int<!-- -->[][]<!-- --> matrix)&nbsp;ç»™å®šæ•´æ•°çŸ©é˜µ matrix è¿›è¡Œåˆå§‹åŒ–</li><li>int sumRegion(int row1, int col1, int row2, int col2)&nbsp;è¿”å›å·¦ä¸Šè§’ (row1,&nbsp;col1)&nbsp;ã€å³ä¸‹è§’&nbsp;(row2,&nbsp;col2)&nbsp;çš„å­çŸ©é˜µçš„å…ƒç´ æ€»å’Œã€‚
é•¿åº¦</li></ul><p>è§£å†³è¿™é“é¢˜çš„æ€è·¯è¿˜æ˜¯å‰ç¼€å’Œï¼Œåªä¸è¿‡ä»ä¸€ç»´æ•°ç»„æ‰©å±•åˆ°äºŒç»´æ•°ç»„ã€‚å¯¹äºäºŒç»´æ•°ç»„ï¼Œå…¶å‰ç¼€å’ŒprefixMatrix<!-- -->[i][j]<!-- -->å®šä¹‰å…¬å¼å¦‚ä¸‹ï¼Œå®ƒè¡¨ç¤ºä»çŸ©é˜µå·¦ä¸Šé¡¶ç‚¹<!-- -->[0,0]<!-- -->åˆ°<!-- -->[i,j]<!-- -->æ‰€å›´æˆçš„å­çŸ©é˜µå†…å…ƒç´ ä¹‹å’Œï¼š</p><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>x</mi><mi>M</mi><mi>a</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>x</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><msubsup><mo>âˆ‘</mo><mn>0</mn><mi>i</mi></msubsup><msubsup><mo>âˆ‘</mo><mn>0</mn><mi>j</mi></msubsup><mi>m</mi><mi>a</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>x</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">prefixMatrix[i][j]=\sum_{0}^i\sum_{0}^jmatrix[i][j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.264274em;vertical-align:-0.29971000000000003em"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.964564em"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.964564em"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029000000000005em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em">j</span><span class="mclose">]</span></span></span></span></span></p><p>æ±‚çŸ©é˜µmatrixå¯¹åº”çš„å‰ç¼€å’ŒçŸ©é˜µprefixMatrixç›¸æ¯”äºä¸€ç»´æ•°ç»„æ›´åŠ å¤æ‚ï¼Œæ€è·¯è¿˜æ˜¯ä½¿ç”¨å®¹æ–¥åŸç†ï¼Œä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">NumMatrix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> matrix</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> row </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> matrix</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> col </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> matrix</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prefixMatrix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">row</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">col</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> row </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> col </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            prefixMatrix</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                    prefixMatrix</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> prefixMatrix</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                    </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> prefixMatrix</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> matrix</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>ç¼–ç¨‹æç¤º</h5></div><div class="admonition-content"><ul><li>å’Œä¸€ç»´æ•°ç»„ä¸€æ ·ï¼Œæ–°æ„é€ çš„å‰ç¼€å’ŒçŸ©é˜µåœ¨æ¯ä¸ªç»´åº¦ä¸Šçš„é•¿åº¦éƒ½æ˜¯åŸæ¥çŸ©é˜µåŠ 1</li><li>å› æ­¤éå†prefixMatrixçš„ä¸¤ä¸ªä¸‹æ ‡ä»1å¼€å§‹ï¼Œé¦–è¡Œå’Œé¦–åˆ—å…ƒç´ é»˜è®¤ä¸º0</li><li>æ³¨æ„è®¡ç®—å…¬å¼ä¸è¦å†™é”™</li></ul></div></div><p>æ¥ä¸‹æ¥éœ€è¦æ¨å¯¼å‡ºå­çŸ©é˜µå’ŒsumMatrix[<!-- -->[m,n][x,y]<!-- -->]ä¸prefixMatrix<!-- -->[i][j]<!-- -->ä¹‹é—´çš„å…³ç³»ï¼Œå…¶ä¸­<!-- -->[m,n]<!-- -->ï¼Œ<!-- -->[x,y]<!-- -->åˆ†åˆ«æ˜¯å­çŸ©é˜µå·¦ä¸Šã€å³ä¸‹é¡¶ç‚¹åæ ‡ã€‚æ ¹æ®å®¹æ–¥åŸç†ï¼Œå¾—åˆ°å…³ç³»å¦‚ä¸‹ï¼š</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mi>M</mi><mi>a</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>x</mi><mo stretchy="false">[</mo><mo stretchy="false">[</mo><mi>m</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">]</mo><mo stretchy="false">]</mo><mo>=</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>x</mi><mi>M</mi><mi>a</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>x</mi><mo stretchy="false">[</mo><mi>x</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>y</mi><mo stretchy="false">]</mo><mspace linebreak="newline"></mspace><mo>âˆ’</mo><mo stretchy="false">(</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>x</mi><mi>M</mi><mi>a</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>x</mi><mo stretchy="false">[</mo><mi>m</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>y</mi><mo stretchy="false">]</mo><mspace linebreak="newline"></mspace><mo>+</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>x</mi><mi>M</mi><mi>a</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>x</mi><mo stretchy="false">[</mo><mi>x</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mspace linebreak="newline"></mspace><mo>âˆ’</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>x</mi><mi>M</mi><mi>a</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>x</mi><mo stretchy="false">[</mo><mi>m</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">sumMatrix[[m,n][x,y]] = prefixMatrix[x][y] \\ - ( prefixMatrix[m-1][y] \\ + prefixMatrix[x][n-1] \\ - prefixMatrix[m-1][n-1])</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mopen">[</span><span class="mopen">[</span><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mclose">]</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mclose">]</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mopen">[</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mclose">]</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">+</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1</span><span class="mclose">]</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">âˆ’</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mopen">[</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1</span><span class="mclose">]</span><span class="mclose">)</span></span></span></span></span></div><p>å¯¹åº”çš„ä»£ç å®ç°ä¸ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sumRegion</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> row1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> col1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> row2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> col2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> sumMatrix</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">row2</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">col2</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sumMatrix</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">row1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">col2</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> sumMatrix</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">row2</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">col1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> sumMatrix</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">row1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">col1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><p>ä½¿ç”¨å‰ç¼€å’Œçš„ä¸¤ä¸ªè¦ç‚¹ï¼š</p><ol><li>æ„é€ èµ‹å€¼å‰ç¼€æ•°ç»„åœ¨ç»´åº¦ä¸ŠåŠ 1ï¼Œæ–¹ä¾¿åœ¨è®¡ç®—åŒºé—´å’Œæ—¶ä¸ç”¨è€ƒè™‘è¾¹ç•Œå€¼å¤„ç†</li><li>æ³¨æ„è®¡ç®—åŒºé—´å’Œå…¬å¼ä¸è¦è®°é”™</li></ol>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Algorithm" term="Algorithm"/>
        <category label="Prefix Sum" term="Prefix Sum"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ¯æ—¥ç®—æ³•é¢˜-é“¾è¡¨ç›¸å…³æ€»ç»“]]></title>
        <id>/2021/10/13/LinkedListAlogrithms</id>
        <link href="https://kayhaw.github.io/blog/2021/10/13/LinkedListAlogrithms"/>
        <updated>2021-10-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[æ¯æ—¥ç®—æ³•é¢˜-é“¾è¡¨ç›¸å…³æ€»ç»“]]></summary>
        <content type="html"><![CDATA[<p>æ€»ç»“åè½¬é“¾è¡¨ã€å¾ªç¯é“¾è¡¨ã€åˆ é™¤å€’æ•°èŠ‚ç‚¹ç­‰ç»å…¸ç®—æ³•é¢˜ç›®</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="åè½¬é“¾è¡¨">åè½¬é“¾è¡¨<a class="hash-link" href="#åè½¬é“¾è¡¨" title="Direct link to heading">â€‹</a></h2><p><a href="https://leetcode-cn.com/problems/reverse-linked-list/" target="_blank" rel="noopener noreferrer">é¢˜ç›®æè¿°</a>ï¼šç»™å®šå•å‘é“¾è¡¨çš„å¤´ç»“ç‚¹<code>head</code>ï¼Œå°±åœ°åè½¬é“¾è¡¨å¹¶è¿”å›æ–°çš„å¤´ç»“ç‚¹ã€‚</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>æ€è·¯</h5></div><div class="admonition-content"><p>å°±åœ°åè½¬éœ€è¦ç”¨åˆ°ä¸¤ä¸ªä¸´æ—¶å˜é‡æŒ‡é’ˆpreå’Œnextï¼Œpreä¿å­˜å½“å‰èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼ˆåŒæ—¶ä¹Ÿæ˜¯åè½¬é“¾è¡¨æ–°çš„å¤´ç»“ç‚¹ï¼‰ï¼Œnextä¿å­˜å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®©å½“å‰èŠ‚ç‚¹æŒ‡é’ˆcurèƒ½å¤Ÿè¿‡æ¸¡åˆ°å³è¾¹è¿˜æ²¡æœ‰åè½¬çš„éƒ¨åˆ†ã€‚</p></div></div><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Solution</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">ListNode</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">reverseList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListNode</span><span class="token plain"> head</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">ListNode</span><span class="token plain"> pre </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> next </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">head </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            next </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> head</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            head</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pre</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pre </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> head</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            head </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> next</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> pre</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="åˆ é™¤å€’æ•°ç¬¬nä¸ªèŠ‚ç‚¹">åˆ é™¤å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹<a class="hash-link" href="#åˆ é™¤å€’æ•°ç¬¬nä¸ªèŠ‚ç‚¹" title="Direct link to heading">â€‹</a></h2><p><a href="https://leetcode-cn.com/problems/remove-nth-node-from-end-of-list/" target="_blank" rel="noopener noreferrer">é¢˜ç›®æè¿°</a>ï¼šç»™ä½ ä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªç»“ç‚¹ï¼Œå¹¶ä¸”è¿”å›é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>æ€è·¯</h5></div><div class="admonition-content"><p>ç»å…¸å¿«æ…¢æŒ‡é’ˆæ–¹æ¡ˆï¼šfastæŒ‡é’ˆå…ˆèµ°næ­¥ï¼Œç„¶åslowæŒ‡é’ˆå’ŒfastæŒ‡é’ˆåŒæ­¥èµ°ï¼Œå½“faståˆ°è¾¾æœ«å°¾æ—¶slowæ‰€æŒ‡ä½ç½®ä¾¿æ˜¯å€’æ•°ç¬¬nä¸ªèŠ‚ç‚¹ã€‚<strong>ä¸ºäº†æ–¹ä¾¿åˆ é™¤å€’æ•°ç¬¬nä¸ªèŠ‚ç‚¹ï¼Œè®©slowå†æ…¢ä¸€æ­¥ï¼Œæœ€ç»ˆæŒ‡å‘æ‰€è¦åˆ é™¤èŠ‚ç‚¹çš„å‰é©±</strong>ï¼Œè¿™é‡Œä¸ºäº†è®©deletedèƒ½è¢«å›æ”¶å°†å…¶å®Œå…¨éš”ç¦»ï¼Œè€Œä¸æ˜¯ç®€å•çš„ä¸€è¡Œä»£ç <code>slow.next=slow.next.next</code>ã€‚</p></div></div><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Solution</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">ListNode</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">removeNthFromEnd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListNode</span><span class="token plain"> head</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">ListNode</span><span class="token plain"> tmpHead </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ListNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> head</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">ListNode</span><span class="token plain"> fast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> head</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> slow </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tmpHead</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> deleted</span><span class="token punctuation" style="color:#393A34">;</span><span class="token comment" style="color:#999988;font-style:italic">// æ³¨æ„fastå’Œslowçš„èµ·å§‹ä½ç½®ä¸åŒ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fast </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            slow </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> slow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        deleted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> slow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        slow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> deleted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        deleted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> tmpHead</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="é“¾è¡¨çš„ç¬¬ä¸€ä¸ªé‡åˆç‚¹">ğŸŒé“¾è¡¨çš„ç¬¬ä¸€ä¸ªé‡åˆç‚¹<a class="hash-link" href="#é“¾è¡¨çš„ç¬¬ä¸€ä¸ªé‡åˆç‚¹" title="Direct link to heading">â€‹</a></h2><p><a href="https://leetcode-cn.com/problems/intersection-of-two-linked-lists/" target="_blank" rel="noopener noreferrer">é¢˜ç›®æè¿°</a>ï¼šç»™ä½ ä¸¤ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹<code>headA</code>å’Œ<code>headB</code>ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚å¦‚æœä¸¤ä¸ªé“¾è¡¨æ²¡æœ‰äº¤ç‚¹ï¼Œè¿”å›<code>null</code>ã€‚</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>æ€è·¯</h5></div><div class="admonition-content"><ol><li><p>ä½¿ç”¨HashSetä¿å­˜Aé“¾è¡¨æ‰€æœ‰èŠ‚ç‚¹ï¼Œç„¶åéå†Bé“¾è¡¨ï¼Œåœ¨HashSetä¸­åŒ…å«çš„å³ä¸ºç›¸äº¤èŠ‚ç‚¹</p></li><li><p>ç‰¹æ®Šçš„åŒæŒ‡é’ˆéå†ï¼š<strong>å½“æŒ‡é’ˆaåˆ°è¾¾å®ŒAé“¾è¡¨æœ«å°¾ï¼Œè½¬è€Œéå†Bé“¾è¡¨ï¼ŒæŒ‡é’ˆbäº¦ç„¶ã€‚å½“aç­‰äºbæ—¶å³ä¸ºæ‰€æ±‚ç»“æœ</strong></p></li></ol><p>è¯æ˜ï¼šè®¾Aã€Bé“¾è¡¨é•¿åº¦åˆ†åˆ«ä¸ºmã€nï¼Œé‡å éƒ¨åˆ†é•¿åº¦ä¸ºkï¼Œå½“æŒ‡é’ˆaå’ŒæŒ‡é’ˆbéƒ½èµ°äº†(m+n-k)æ­¥æ—¶ï¼Œæ­¤æ—¶aã€béƒ½åœ¨é“¾è¡¨äº¤ç‚¹(å³a==b)ã€‚å¦‚æœæ²¡æœ‰äº¤ç‚¹ï¼Œæœ€åaå’Œbä¹Ÿéƒ½ä¼šä¸ºnullï¼Œæ­¤æ—¶ä¹Ÿæœ‰a==bã€‚</p><p><strong>åœ¨ç¼–å†™ä»£ç æ—¶æ³¨æ„ä¸¤ç‚¹ï¼šä¸€æ˜¯ç”¨ä¸´æ—¶èŠ‚ç‚¹ä¿å­˜å¤´ç»“ç‚¹å¦åˆ™æ‰¾ä¸åˆ°æœ€å¼€å§‹ä½ç½®ï¼ŒäºŒæ˜¯whileå¾ªç¯å†…çš„åˆ¤æ–­æ¡ä»¶æ˜¯<code>tmpA==tmpB</code>è€Œä¸æ˜¯<code>tmpA.next==tmpB.next</code>ã€‚</strong></p></div></div><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Solution</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">ListNode</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getIntersectionNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListNode</span><span class="token plain"> headA</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">ListNode</span><span class="token plain"> headB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">ListNode</span><span class="token plain"> tmpA </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> headA</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">ListNode</span><span class="token plain"> tmpB </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> headB</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmpA </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> tmpB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tmpA </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmpA </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> headB </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> tmpA</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tmpB </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmpB </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> headA </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> tmpB</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">next</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> tmpA</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Algorithm" term="Algorithm"/>
        <category label="LinkedList" term="LinkedList"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ¯æ—¥ç®—æ³•é¢˜-å­—ç¬¦ä¸²çš„æ’åˆ—]]></title>
        <id>/2021/10/10/CheckInclusion</id>
        <link href="https://kayhaw.github.io/blog/2021/10/10/CheckInclusion"/>
        <updated>2021-10-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[æ¯æ—¥ç®—æ³•é¢˜-å­—ç¬¦ä¸²çš„æ’åˆ—]]></summary>
        <content type="html"><![CDATA[<p>æ¯æ—¥ç®—æ³•é¢˜-å­—ç¬¦ä¸²çš„æ’åˆ—</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="åŸé¢˜æè¿°">åŸé¢˜æè¿°<a class="hash-link" href="#åŸé¢˜æè¿°" title="Direct link to heading">â€‹</a></h2><p>ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸²s1å’Œs2ï¼Œå†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­s2æ˜¯å¦åŒ…å«s1çš„æ’åˆ—ã€‚å¦‚æœæ˜¯ï¼Œè¿”å›trueï¼›å¦åˆ™ï¼Œè¿”å›falseã€‚æ¢å¥è¯è¯´ï¼Œs1çš„æ’åˆ—ä¹‹ä¸€æ˜¯s2çš„å­ä¸²ã€‚</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">ç¤ºä¾‹</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">è¾“å…¥ï¼šs1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ab"</span><span class="token plain"> s2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"eidbaooo"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">è¾“å‡ºï¼štrue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">è§£é‡Šï¼šs2 åŒ…å« s1 çš„æ’åˆ—ä¹‹ä¸€ </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"ba"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">è¾“å…¥ï¼šs1</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ab"</span><span class="token plain"> s2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"eidboaoo"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">è¾“å‡ºï¼šfalse</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><strong>æç¤ºï¼š1 &lt;= s1.length, s2.length &lt;= 10^4ï¼Œs1å’Œs2ä»…åŒ…å«å°å†™å­—æ¯</strong></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯<a class="hash-link" href="#è§£é¢˜æ€è·¯" title="Direct link to heading">â€‹</a></h2><p>é¢˜ç›®æ„æ€æ˜¯æ±‚è¯æ˜¯å¦å­˜åœ¨s2å­ä¸²sub2ï¼Œä½¿å¾—sub2ä¸ºs1çš„ä¸€ç§æ’åˆ—ï¼Œè¿™é‡Œåªéœ€è¦å…³å¿ƒsub2ä¸­å­—ç¬¦ç±»å‹å’Œä¸ªæ•°ä¸s1çš„ç›¸ç­‰å³å¯ï¼Œç”±äºå·²ç»æç¤ºs1å’Œs2ä»…åŒ…å«å°å†™å­—æ¯ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨é•¿åº¦ä¸º26çš„intæ•°ç»„æ¥è®°å½•æ¯ä¸ªå°å†™å­—æ¯å‡ºç°ä¸ªæ•°</p><p>å¯¹äºç›®æ ‡ä¸²s1å’Œå­ä¸²sub2ï¼Œåˆ†åˆ«ä½¿ç”¨<code>int pattern[26]</code>å’Œ<code>int window[26]</code>æ¥è®°å½•å­—ç¬¦å‡ºç°æƒ…å†µã€‚å¦‚æœparttern<!-- -->[26]<!-- -->æ¯ä¸ªå…ƒç´ ç­‰äºwindow<!-- -->[26]<!-- -->ï¼Œè¯´æ˜æ­¤æ—¶sub2æ˜¯s1çš„ä¸€ç§æ’åˆ—ã€‚æ¥ä¸‹æ¥è¿˜è¦ç¡®å®šsub2å†…å®¹ï¼Œç”±äºsub2é•¿åº¦ç­‰äºs1é•¿åº¦ï¼Œä½¿ç”¨å›ºå®šå¤§å°çš„æ»‘åŠ¨çª—å£åœ¨s2ä¸Šç§»åŠ¨å¾—åˆ°sub2ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Solution</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">checkInclusion</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> s1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> s2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> pattern </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">26</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> window </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">26</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> patternSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sourceSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">patternSize </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> sourceSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// åˆå§‹ç»Ÿè®¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> patternSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pattern</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">s1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token char">'a'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            window</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">s2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token char">'a'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// åˆ¤æ–­ä¸€å¼€å§‹çª—å£æ˜¯å¦æ»¡è¶³æ¡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Arrays</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">equals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pattern</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> window</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// çª—å£æ»‘åŠ¨ï¼Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³æ¡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> patternSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> sourceSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            window</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">s2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token char">'a'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// å·¦ä¾§å­—ç¬¦ä¸ªæ•°å‡1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            window</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">s2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">patternSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token char">'a'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">--</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// å³ä¾§å­—ç¬¦ä¸ªæ•°åŠ 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Arrays</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">equals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pattern</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> window</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>ç¼–ç¨‹äº‹é¡¹</h5></div><div class="admonition-content"><ul><li>å½“s1é•¿åº¦å¤§äºs2æ—¶ç›´æ¥è¿”å›false</li><li>é¦–å…ˆç¡®å®šç¬¬ä¸€ä¸ªæ»‘åŠ¨çª—å£å­—ç¬¦æƒ…å†µå¹¶åˆ¤æ–­æ¯”è¾ƒï¼Œç„¶åæ‰æ»‘åŠ¨çª—å£</li><li>ä½¿ç”¨Arrays.equals(int[], int[])æ–¹æ³•è¿›è¡Œæ•°ç»„æ¯”è¾ƒ</li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ–¹æ¡ˆä¼˜åŒ–">æ–¹æ¡ˆä¼˜åŒ–<a class="hash-link" href="#æ–¹æ¡ˆä¼˜åŒ–" title="Direct link to heading">â€‹</a></h2><p>ä¸Šè¿°è§£å†³æ–¹æ¡ˆæ¯æ¬¡ç¡®å®šsub2æ˜¯å¦ä¸ºs1çš„æ’åˆ—æ—¶ï¼Œéƒ½è¦å¯¹ä¸¤ä¸ªç»Ÿè®¡æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ä¾æ¬¡æ¯”è¾ƒå¤§å°ï¼Œå®é™…ä¸Šçª—å£æ»‘åŠ¨æ—¶ï¼Œåªä¼šå‡ºå»1ä¸ªå­—ç¬¦ï¼ŒåŠ å…¥1ä¸ªå­—ç¬¦ï¼Œå³windowæ•°ç»„åªä¼šæ”¹å˜2ï¼ˆæˆ–0ï¼Œå‡ºå»è¿›æ¥æ˜¯åŒä¸€ä¸ªå­—ç¬¦ï¼‰ä¸ªå…ƒç´ å€¼ï¼Œæ²¡æœ‰å¿…è¦é‡æ–°æ¯”è¾ƒè¿™26ä¸ªå…ƒç´ å¤§å°</p><p>ä¸ºæ­¤ï¼Œåªä½¿ç”¨ä¸€ä¸ª<code>int diff[26]</code>æ•°ç»„æ¥è¡¨ç¤ºs1å’Œsub2ä¸­æ¯ä¸ªå­—ç¬¦çš„ä¸ªæ•°å·®ï¼Œå†ç”¨å˜é‡diffCountè¡¨ç¤ºdiffæ•°ç»„ä¸­å…ƒç´ ä¸ä¸º0çš„ä¸ªæ•°ï¼Œå½“diffCountä¸º0æ—¶å³è¡¨æ˜sub2æ˜¯s1çš„ä¸€ç§æ’åˆ—ï¼Œå®ç°ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Solution</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">checkInclusion</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> s1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> s2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> diff </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">26</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> patternSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sourceSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> diffCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> right</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">patternSize </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> sourceSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// åˆå§‹ç»Ÿè®¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> patternSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">s1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token char">'a'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">s2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token char">'a'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">--</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">26</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                diffCount</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// åˆ¤æ–­ä¸€å¼€å§‹çª—å£æ˜¯å¦æ»¡è¶³æ¡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diffCount </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// æ»‘åŠ¨çª—å£ï¼Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³æ¡ä»¶</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> patternSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> sourceSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            left </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">patternSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token char">'a'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            right </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token char">'a'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">left </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                diffCount</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">// æ³¨æ„æ˜¯åŠ 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                diffCount</span><span class="token operator" style="color:#393A34">--</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                diffCount</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// æ³¨æ„æ˜¯å‡1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                diffCount</span><span class="token operator" style="color:#393A34">--</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diffCount </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>æ³¨æ„</h5></div><div class="admonition-content"><ul><li>é¦–å…ˆéœ€è¦åˆ¤æ–­å‡ºå»è¿›æ¥çš„å­—ç¬¦æ˜¯å¦ç›¸åŒï¼Œè‹¥ç›¸åŒç›´æ¥å¾€ä¸‹æ»‘</li><li>åœ¨æ›´æ–°å­—ç¬¦ä¸ªæ•°å·®ä¹‹å‰ï¼Œå¦‚æœå­—ç¬¦ä¸ªæ•°å·®ä¸º0ï¼Œæ­¤æ—¶éœ€è¦ç»™diffCountåŠ 1(å‡ºç°äº†æ–°çš„ä¸ªæ•°ä¸ç›¸åŒå­—ç¬¦)ï¼Œå¦åˆ™ä¸éœ€è¦</li><li>æ›´æ–°å­—ç¬¦ä¸ªæ•°å·®ï¼Œç”±äºdiffä¿å­˜çš„æ˜¯s1å­—ç¬¦ä¸ªæ•°å‡å»sub2å­—ç¬¦ä¸ªæ•°ï¼Œæ‰€ä»¥å‡ºå»çš„å­—ç¬¦ä½ç½®leftå¯¹åº”å…ƒç´ åŠ 1ï¼Œè€Œä¸æ˜¯å‡1ï¼Œç›¸ååœ°ï¼Œè¿›æ¥çš„å­—ç¬¦ä½ç½®rightå¯¹åº”å…ƒç´ å‡1</li><li>æ›´æ–°å®Œleftå’Œrightçš„å­—ç¬¦ä¸ªæ•°å·®åï¼Œå¦‚æœå­—ç¬¦ä¸ªæ•°å·®ä¸º0ï¼Œéœ€è¦å°†diffCountå‡1ï¼Œæœ€åçœ‹diffCountæ˜¯å¦ä¸º0</li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="é¢˜ç›®æ”¹è¿›">é¢˜ç›®æ”¹è¿›<a class="hash-link" href="#é¢˜ç›®æ”¹è¿›" title="Direct link to heading">â€‹</a></h2><p>å°†é¢˜ç›®æ”¹ä¸ºè¾“å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„å­ä¸²sub2çš„èµ·å§‹ä½ç½®ï¼Œä½œä¸ºæ•°ç»„è¿”å›ã€‚<strong>æ­¤æ—¶éœ€è¦æ³¨æ„ï¼Œå½“leftå’Œrightç›¸ç­‰æ—¶ä¸èƒ½<code>continue</code>è·³è¿‡</strong>ï¼Œå¦åˆ™ä¼šé”™å¤±æ­£ç¡®ç­”æ¡ˆï¼Œæ¯”å¦‚s1ä¸ºâ€œabâ€ï¼Œs2ä¸ºâ€œababâ€ï¼Œæ­¤æ—¶ä¼šå› ä¸ºè·³è¿‡è€Œæ¼æ‰äº†ä½ç½®1ï¼Œ2</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> patternLen</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token char">'a'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token char">'a'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> diff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">diffCount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diffCount </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ans</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> patternLen</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> sourceLen</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    left </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">patternLen</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token char">'a'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    right </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token char">'a'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">diffCount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// æ³¨æ„è¿™é‡Œæ˜¯+1ï¼Œdiff[]å«ä¹‰æ”¹å˜äº†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">diffCount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">diffCount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">diffCount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diffCount </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ans</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">patternLen</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ³¨æ„ç­”æ¡ˆä½ç½®çš„è®¡ç®—è¦åŠ 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><p>ä¼˜åŒ–æ–¹æ¡ˆæœ‰ä¸¤ä¸ªå‘ï¼Œä¸€æ˜¯éœ€è¦åˆ¤æ–­leftå’Œrightæ˜¯å¦ç›¸åŒ(ä¸å½±å“ç»“æœæ­£ç¡®æ€§ï¼Œè·³è¿‡å¯ä»¥å‡å°‘ä¸å¿…è¦çš„ä»£ç æ‰§è¡Œ)ï¼ŒäºŒæ˜¯æ›´æ–°diff<!-- -->[left]<!-- -->å’Œdiff<!-- -->[right]<!-- -->éœ€è¦ç†æ¸…æ¥šåˆ°åº•æ˜¯åŠ 1è¿˜æ˜¯å‡1</p>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Algorithm" term="Algorithm"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Flinkå…¥é—¨å­¦ä¹ (2)]]></title>
        <id>/2021/10/03/FlinkLearning-02</id>
        <link href="https://kayhaw.github.io/blog/2021/10/03/FlinkLearning-02"/>
        <updated>2021-10-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Flinkå…¥é—¨å­¦ä¹ (2)]]></summary>
        <content type="html"><![CDATA[<p>Flinkå…¥é—¨å­¦ä¹ ç¬¬ä¸€ç¯‡ï¼Œæµå¤„ç†API</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="keybyå’Œmaxby">keyByå’ŒmaxBy<a class="hash-link" href="#keybyå’Œmaxby" title="Direct link to heading">â€‹</a></h2><p>è¾“å…¥æ•°æ®æº</p><div class="codeBlockContainer_I0IT language-txt theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-txt codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sensor_04,1633264100,36.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sensor_04,1633264101,37.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sensor_04,1633264102,35.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sensor_04,1633264103,38.8</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>maxè¾“å‡ºç»“æœ:åªæ›´æ–°maxå­—æ®µï¼Œå…¶ä»–ä¸å˜</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Sensor{id='sensor_04', timestamp=1633264100, temperature=36.8}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sensor{id='sensor_04', timestamp=1633264100, temperature=37.8}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sensor{id='sensor_04', timestamp=1633264100, temperature=37.8}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sensor{id='sensor_04', timestamp=1633264100, temperature=38.8}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>maxByè¾“å‡ºç»“æœï¼šæ‰“å°maxå­—æ®µå¯¹åº”çš„è®°å½•</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Sensor{id='sensor_04', timestamp=1633264100, temperature=36.8}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sensor{id='sensor_04', timestamp=1633264101, temperature=37.8}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sensor{id='sensor_04', timestamp=1633264101, temperature=37.8}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sensor{id='sensor_04', timestamp=1633264103, temperature=38.8}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>reduceï¼šå½’çº¦æ•°æ®ï¼Œçµæ´»æ€§æ¯”maxï¼ŒmaxByæ›´å¼º</p><p>Flinkå¯¹POJOçš„è¦æ±‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="datastreamé‡åˆ†åŒºæ“ä½œ">DataStreamé‡åˆ†åŒºæ“ä½œ<a class="hash-link" href="#datastreamé‡åˆ†åŒºæ“ä½œ" title="Direct link to heading">â€‹</a></h2><ul><li>keyBy</li><li>rebalanceï¼šå¹³å‡åˆ†åŒºï¼Œä»¥round robbinsæ¨¡å¼</li><li>broadcast</li><li>shuffle</li><li>forward</li><li>rescale</li><li>global</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="flinkjedispoolconfig-è®¾è®¡æ¨¡å¼builder">FlinkJedisPoolConfig è®¾è®¡æ¨¡å¼Builder<a class="hash-link" href="#flinkjedispoolconfig-è®¾è®¡æ¨¡å¼builder" title="Direct link to heading">â€‹</a></h2><h2 class="anchor anchorWithStickyNavbar_mojV" id="window-api">window api<a class="hash-link" href="#window-api" title="Direct link to heading">â€‹</a></h2><ul><li><p>windowAllæ–¹æ³•</p></li><li><p>allowedLateness() å…è®¸çª—å£triggeråå†ç­‰ä¸€æ®µæ—¶é—´</p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ—¶é—´è¯­ä¹‰">æ—¶é—´è¯­ä¹‰<a class="hash-link" href="#æ—¶é—´è¯­ä¹‰" title="Direct link to heading">â€‹</a></h2><p>é»˜è®¤æ˜¯å¤„ç†æ—¶é—´</p>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Flink" term="Flink"/>
        <category label="BigData" term="BigData"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Flinkå…¥é—¨å­¦ä¹ (1)]]></title>
        <id>/2021/10/02/FlinkLearning-01</id>
        <link href="https://kayhaw.github.io/blog/2021/10/02/FlinkLearning-01"/>
        <updated>2021-10-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Flinkå…¥é—¨å­¦ä¹ (1)]]></summary>
        <content type="html"><![CDATA[<p>Flinkå…¥é—¨å­¦ä¹ ç¬¬ä¸€ç¯‡ï¼ŒåŸºæœ¬ä»‹ç»</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="flinkæ˜¯ä»€ä¹ˆ">Flinkæ˜¯ä»€ä¹ˆ<a class="hash-link" href="#flinkæ˜¯ä»€ä¹ˆ" title="Direct link to heading">â€‹</a></h2><p>Apache Flinkæ˜¯ä¸€ä¸ªå¯¹<strong>æœ‰ç•ŒåŠæ— ç•Œæ•°æ®æµ</strong>è¿›è¡Œ<strong>çŠ¶æ€è®¡ç®—</strong>çš„<strong>æ¡†æ¶å’Œåˆ†å¸ƒå¼å¤„ç†å¼•æ“</strong></p><blockquote><p>Apache Flink is a framework and distributed processing engine for stateful computations over unbounded and bounded data streams.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="ä¸ºä»€ä¹ˆæ˜¯flink">ä¸ºä»€ä¹ˆæ˜¯Flink<a class="hash-link" href="#ä¸ºä»€ä¹ˆæ˜¯flink" title="Direct link to heading">â€‹</a></h2><ul><li>å®é™…åœºæ™¯ä¸­æ•°æ®ä»¥æµçš„å½¢å¼äº§ç”Ÿï¼Œæ¯”å¦‚è§†é¢‘æµã€æ—¥å¿—æµï¼›</li><li>æ‰¹å¤„ç†æ”’ä¸€æ³¢æ•°æ®å†è®¡ç®—ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´æ”¶é›†æ•°æ®ï¼Œå®æ—¶æ€§ä½</li><li>è¦æ±‚ä½å»¶è¿Ÿã€é«˜ååã€å‡†ç¡®æ€§ã€å®¹é”™æ€§
éœ€è¦å¤„ç†æµæ•°æ®çš„åœºæ™¯ï¼šç”µå•†æ•°æ®æŠ¥è¡¨ã€ç‰©è”ç½‘ä¼ æ„Ÿå™¨å®æ—¶æ•°æ®é‡‡é›†å’Œæ˜¾ç¤ºã€é“¶è¡Œé‡‘èå®æ—¶ç»“ç®—å’Œé€šçŸ¥æ¨é€</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ•°æ®å¤„ç†æ¶æ„æ¼”å˜">æ•°æ®å¤„ç†æ¶æ„æ¼”å˜<a class="hash-link" href="#æ•°æ®å¤„ç†æ¶æ„æ¼”å˜" title="Direct link to heading">â€‹</a></h2><ul><li>æ—©æœŸï¼šäº‹åŠ¡å¤„ç†<ul><li>å®æ—¶æ€§å¥½</li><li>éš¾ä»¥å¤„ç†å¤§é‡æ•°æ®</li></ul></li><li>ç¦»çº¿åˆ†æå¤„ç†ï¼šå°†æ•°æ®ä»ä¸šåŠ¡æ•°æ®åº“å¤åˆ¶åˆ°æ•°æ®ä»“åº“ï¼Œå†è¿›è¡Œåˆ†æå’ŒæŸ¥è¯¢<ul><li>å®æ—¶æ€§å·®</li><li>é«˜å¹¶å‘</li></ul></li><li>æœ‰çŠ¶æ€çš„æµå¼å¤„ç†ï¼ˆæ—©æœŸç¬¬ä¸€ä»£ï¼‰<ul><li>ä½¿ç”¨å†…å­˜ä¿å­˜æœ¬åœ°çŠ¶æ€</li><li>æ— æ³•ä¿è¯ç»“æœæœ‰åºæ€§</li></ul></li><li>lambdaæ¶æ„ï¼ˆç¬¬äºŒä»£ï¼‰<ul><li>ä½¿ç”¨ä¸¤å¥—ç³»ç»Ÿï¼ŒåŒæ—¶ä¿è¯ä½å»¶è¿Ÿå’Œå‡†ç¡®æ€§</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="flinkç‰¹æ€§">Flinkç‰¹æ€§<a class="hash-link" href="#flinkç‰¹æ€§" title="Direct link to heading">â€‹</a></h2><ul><li>ä¸€åˆ‡éƒ½æ˜¯æµï¼šåœ¨Flinkä¸­ä¸€åˆ‡æ•°æ®éƒ½æ˜¯ä»¥æµå½¢å¼å­˜åœ¨ï¼Œç¦»çº¿æ•°æ®æ˜¯æœ‰ç•Œæµï¼Œå®æ—¶æ•°æ®æ˜¯æ— ç•Œæµ</li><li>åˆ†å±‚APIï¼šä¸Šå±‚æŠ½è±¡ï¼Œè¡¨è¾¾ç®€æ´ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œä¸‹å±‚å…·ä½“ï¼Œè¡¨è¾¾ä¸°å¯Œä½†ä½¿ç”¨çµæ´»</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="flinkå’ŒsparkåŒºåˆ†">Flinkå’ŒSparkåŒºåˆ†<a class="hash-link" href="#flinkå’ŒsparkåŒºåˆ†" title="Direct link to heading">â€‹</a></h2><ul><li>æ•°æ®æ¨¡å‹
Sparkä½¿ç”¨RDDæ¨¡å‹ï¼ŒFlinkåŸºæœ¬æ•°æ®æ¨¡å‹æ˜¯æ•°æ®æµï¼Œä»¥åŠäº‹ä»¶åºåˆ—</li><li>è¿è¡Œæ¶æ„
Sparkæ˜¯æ‰¹è®¡ç®—ï¼Œå°†DAGåˆ’åˆ†ä¸ºä¸åŒstageï¼Œä¸€ä¸ªå®Œæˆåæ‰å¯ä»¥è®¡ç®—ä¸‹ä¸€ä¸ªï¼›Flinkæ˜¯æ ‡å‡†æµå¤„ç†ï¼Œä¸€ä¸ªäº‹ä»¶åœ¨ä¸€ä¸ªèŠ‚ç‚¹å¤„ç†å®Œæˆåç›´æ¥å‘å¾€ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
æµstreamï¼Œå¾®æ‰¹ï¼ˆmicro-batchingï¼‰å¤„ç†</li></ul>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Flink" term="Flink"/>
        <category label="BigData" term="BigData"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Randomå¯¼è‡´çš„é˜»å¡é—®é¢˜]]></title>
        <id>/2021/09/21/AProblemCausedByRandom</id>
        <link href="https://kayhaw.github.io/blog/2021/09/21/AProblemCausedByRandom"/>
        <updated>2021-09-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[è®°ä¸€æ¬¡ç”±Randomå¯¼è‡´çš„é˜»å¡é—®é¢˜]]></summary>
        <content type="html"><![CDATA[<p>è®°ä¸€æ¬¡ç”±Randomä½¿ç”¨ä¸æ°å½“å¯¼è‡´çš„é˜»å¡é—®é¢˜</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="é—®é¢˜æè¿°">é—®é¢˜æè¿°<a class="hash-link" href="#é—®é¢˜æè¿°" title="Direct link to heading">â€‹</a></h2><p>æŸæ¬¡äº§å“åœ¨çº¿ç½‘é¡¹ç›®éƒ¨ç½²åï¼Œæ¯æ¬¡ç‚¹å‡»ç”³è¯·è¡¨å•æ—¶é¡µé¢éƒ½ä¼šå¡ä½ï¼Œæ—¥å¿—ä¹Ÿä¸è§å¼‚å¸¸ï¼Œä½¿ç”¨jstackè°ƒå‡ºæ—¥å¿—ï¼Œå‘ç°å¦‚ä¸‹å¼‚å¸¸</p><div class="codeBlockContainer_I0IT language-log theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-log codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">"http-nio-9903-exec-9" #104 daemon prio=5 os_prio=0 tid=0x00007fab00f4a800 nid=0x85 waiting for monitor entry [0x00007fa8efcf8000]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at sun.security.provider.NativePRNG$RandomIO.getMixRandom(NativePRNG.java:399)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - waiting to lock &lt;0x0000000080ad93f8&gt; (a java.lang.Object)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at sun.security.provider.NativePRNG$RandomIO.implNextBytes(NativePRNG.java:535)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at sun.security.provider.NativePRNG$RandomIO.access$400(NativePRNG.java:331)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at sun.security.provider.NativePRNG$Blocking.engineNextBytes(NativePRNG.java:268)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.security.SecureRandom.nextBytes(SecureRandom.java:468)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.security.SecureRandom.next(SecureRandom.java:491)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.util.Random.nextInt(Random.java:390)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è¿™é‡Œä»£ç è°ƒç”¨äº†Random.nextInt()æ–¹æ³•ï¼Œä¸ºä¸šåŠ¡ç”³è¯·è¡¨å•ç”Ÿæˆä¸€ä¸ª4ä½éšæœºå·ç ã€‚å¯ä»¥çœ‹åˆ°é˜»å¡åŸå› æ¥è‡ªSecureRandom</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="åŸå› åˆ†æ">åŸå› åˆ†æ<a class="hash-link" href="#åŸå› åˆ†æ" title="Direct link to heading">â€‹</a></h2><p>SecureRandomç”Ÿæˆéšæœºæ•°éœ€è¦éšæœºç§å­ï¼Œä¸€èˆ¬ä»/dev/randomæˆ–/dev/urandomä¸­è·å–ï¼Œåœ¨SecureRandomæºç ä¸Šæœ‰å¦‚ä¸‹æ³¨é‡Šï¼š</p><blockquote><p>Note: Depending on the implementation, the generateSeed and
nextBytes methods may block as entropy is being gathered,
for example, if they need to read from /dev/random on various
Unix-like operating systems.</p></blockquote><p>å¦‚æœå®ç°ç±»ä»/dev/randomä¸­è¯»å–ï¼Œé‚£ä¹ˆnextBytes()æ–¹æ³•å¯èƒ½ä¼šè¢«é˜»å¡ï¼Œç”±æ­¤å¯¼è‡´ä¸Šè¿°é—®é¢˜</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•<a class="hash-link" href="#è§£å†³æ–¹æ³•" title="Direct link to heading">â€‹</a></h2><ol><li>åœ¨è·å–SecureRandomå¯¹è±¡æ—¶ä¸è¦ç”¨<code>SecureRandom.getInstanceStrong()</code>ï¼Œæ”¹æˆ<code>SecureRandom.getInstance("NativePRNGNonBlocking")</code></li><li>å¯åŠ¨å‚æ•°æ·»åŠ -Djava.security.egd=file:/dev/urandom</li><li>ä¿®æ”¹$JAVA_HOME/jre/lib/security/java.securityæ–‡ä»¶ï¼Œå°†é…ç½®é¡¹securerandom.sourceä¿®æ”¹ä¸º<code>securerandom.source=file:/dev/random</code></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ·±å…¥ç ”ç©¶">æ·±å…¥ç ”ç©¶<a class="hash-link" href="#æ·±å…¥ç ”ç©¶" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="javautilrandom">java.util.Random<a class="hash-link" href="#javautilrandom" title="Direct link to heading">â€‹</a></h3><p>ä½¿ç”¨çº¿æ€§åŒä½™ä¼ªéšæœºæ•°ç”Ÿæˆå™¨(LGC)ï¼Œå…¶ç¼ºç‚¹æ˜¯å¯é¢„æµ‹çš„ï¼Œå› æ­¤æ³¨é‡å®‰å…¨æ—¶åº”ä½¿ç”¨SecureRandomä»£æ›¿Randomï¼ŒRandomé»˜è®¤ä½¿ç”¨ç³»ç»Ÿå½“å‰æ—¶é—´ä½œä¸ºç§å­ï¼Œ<strong>åªè¦ç§å­ä¸€æ ·ï¼Œäº§ç”Ÿéšæœºæ•°ä¹Ÿç›¸åŒ</strong></p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sameSeedTest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Random</span><span class="token plain"> r1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">123</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Random</span><span class="token plain"> r2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">123</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// è¾“å‡ºéƒ½ä¸ºtrue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">nextInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> r2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">nextInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Randomç”Ÿæˆéšæœºæ•°åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ol><li>ç”±æ—§seedç”Ÿæˆæ–°seed</li><li>ç”±æ–°seedç”Ÿæˆæ–°éšæœºæ•°
åœ¨Randomä¸­seedæ˜¯ä¸€ä¸ªAtomicLongå¯¹è±¡ï¼Œçœ‹nextæ–¹æ³•æºç </li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> bits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> oldseed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nextseed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">AtomicLong</span><span class="token plain"> seed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        oldseed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> seed</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nextseed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">oldseed </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> multiplier </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> addend</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> mask</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">compareAndSet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">oldseed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nextseed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nextseed </span><span class="token operator" style="color:#393A34">&gt;&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> bits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å½“è®¾ç½®æ–°seedæ—¶ä½¿ç”¨CASæ“ä½œæ›´æ–°ï¼Œå› æ­¤åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ä¸€ä¸ªå…±äº«çš„Randomå¯¹è±¡ç”Ÿæˆçš„éšæœºæ•°ä»ç„¶ä¸æ˜¯ç›¸åŒçš„</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="javautilconcurrentthreadlocalrandom">java.util.concurrent.ThreadLocalRandom<a class="hash-link" href="#javautilconcurrentthreadlocalrandom" title="Direct link to heading">â€‹</a></h3><p>Randomç±»ä½¿ç”¨CASæ“ä½œç¡®ä¿æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ›´æ–°seedï¼Œä½†æ˜¯å¢åŠ äº†å¼€é”€å’Œçº¿ç¨‹ç«äº‰ã€‚ä¸ºäº†é¿å…ç«äº‰ï¼ŒJDK 7å¼•å…¥ThreadLocalRandomç±»ï¼Œç»™æ¯ä¸ªçº¿ç¨‹éƒ½ä¿å­˜å®ƒè‡ªå·±çš„seedï¼Œä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">TLRDemo</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">RNGPrinter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">Thread</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">": "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token class-name">ThreadLocalRandom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">current</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">nextInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">RNGPrinter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>åˆ†æä¸€ä¸‹<code>ThreadLocalRandom.current().nextInt(100))</code>è¿™è¡Œä»£ç çš„å«ä¹‰</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">java/util/concurrent/ThreadLocalRandom.java</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/** The common ThreadLocalRandom */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">ThreadLocalRandom</span><span class="token plain"> instance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ThreadLocalRandom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">ThreadLocalRandom</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">current</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">UNSAFE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentThread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PROBE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">localInit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> instance</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä½¿ç”¨UNSAFT.getIntæ“ä½œè·å–å½“å‰Threadå¯¹è±¡threadLocalRandomProbeå­—æ®µçš„å€¼ï¼Œè¿™é‡ŒPROBEæ˜¯è¯¥å­—æ®µåœ¨Threadå¯¹è±¡ä¸­çš„åç§»åœ°å€ï¼Œå¦‚æœthreadLocalRandomProbeå€¼ä¸º0ï¼Œè¯´æ˜å½“å‰çº¿ç¨‹è¿˜æ²¡æœ‰ç”¨è¿‡éšæœºæ•°ç”Ÿæˆå™¨ï¼Œå…ˆåˆå§‹åŒ–ç„¶åè¿”å›é™æ€å˜é‡instanceï¼Œåˆå§‹åŒ–æ–¹æ³•localInit()ä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">localInit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> p </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> probeGenerator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addAndGet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PROBE_INCREMENT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> probe </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// skip 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> seed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mix64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">seeder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAndAdd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SEEDER_INCREMENT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Thread</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentThread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    UNSAFE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">putLong</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SEED</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> seed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    UNSAFE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">putInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PROBE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> probe</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è¿™ä¸ªé€šè¿‡UNSAFE.putXxxæ–¹æ³•ç»™å½“å‰çº¿ç¨‹çš„threadLocalRandomSeedå’ŒthreadLocalRandomProbeå­—æ®µè®¾ç½®åˆå§‹å€¼ï¼Œæ³¨æ„è®¾ç½®probeæ—¶å¦‚æœç”Ÿæˆäº†0å°±è®¾ç½®ä¸º1ï¼Œç¡®ä¿åˆå§‹åŒ–åçº¿ç¨‹çš„probeä¸€å®šæ˜¯é0å€¼ï¼Œæ¥ä¸‹æ¥å†çœ‹ThreadLocalRandom.nextIntæ–¹æ³•</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">nextInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> bound</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bound </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IllegalArgumentException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BadBound</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> r </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mix32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">nextSeed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> m </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bound </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bound </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> m</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// power of two</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        r </span><span class="token operator" style="color:#393A34">&amp;=</span><span class="token plain"> m</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// reject over-represented candidates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> u </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> r </span><span class="token operator" style="color:#393A34">&gt;&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              u </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> m </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> u </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> bound</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">              u </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mix32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">nextSeed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä¸»è¦å…³å¿ƒnextSeed()æ–¹æ³•ï¼Œå®ƒé€šè¿‡æ—§seedç”Ÿæˆæ–°seedå¹¶è¿”å›ï¼Œè¿˜æ˜¯ç”¨åˆ°äº†UNSAFEç±»çš„putXxxå’ŒgetXxxï¼Œæ³¨æ„è¿™é‡Œç”Ÿæˆæ–°seedå°±æ˜¯åœ¨æ—§seedå€¼ä¸ŠåŠ GAMMAï¼Œè¿™æ˜¯ä¸€ä¸ªå›ºå®šå€¼</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * The seed increment</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> GAMMA </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">x9e3779b97f4a7c15L</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">nextSeed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Thread</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// read and update per-thread seed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UNSAFE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">putLong</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentThread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SEED</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    r </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> UNSAFE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getLong</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SEED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> GAMMA</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>ThreadLocalRandomé”™è¯¯ä½¿ç”¨ğŸ˜ </h5></div><div class="admonition-content"><p>ä»¥ä¸‹ä»£ç æ¯ä¸ªçº¿ç¨‹äº§ç”Ÿçš„éšæœºæ•°éƒ½æ˜¯ç›¸åŒçš„ï¼Œ<strong>åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ThreadLocalRandom.current()æ–¹æ³•ï¼Œåˆ™æ–°seedå­˜æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­</strong>ï¼Œå› æ­¤ç¬¬ä¸€æ¬¡æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶å»æ‹¿è‡ªå·±çš„seedå€¼éƒ½ä¸º0ï¼Œäº§ç”Ÿçš„æ–°seedåˆæ˜¯ç›¸åŒçš„ï¼Œæ•…æ‰€æœ‰çº¿ç¨‹è°ƒç”¨ç›¸åŒæ¬¡æ•°nextInt()æ–¹æ³•äº§ç”Ÿçš„éšæœºæ•°éƒ½æ˜¯ç›¸åŒçš„</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ErrorTLRDEMO</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">RNGPrinter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">Thread</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">ThreadLocalRandom</span><span class="token plain"> tlr</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">RNGPrinter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ThreadLocalRandom</span><span class="token plain"> tlr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tlr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tlr</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">": "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> tlr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">nextInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">ThreadLocalRandom</span><span class="token plain"> tlr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ThreadLocalRandom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">current</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ErrorTLRDEMO</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">RNGPrinter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tlr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>æ€»ç»“</h5></div><div class="admonition-content"><p>ThreadLocalRandomå¹¶æ²¡æœ‰ä½¿ç”¨åˆ°synchronizedæˆ–è€…Lockç­‰åŒæ­¥æ“ä½œï¼Œå®ƒåªæ˜¯ç”Ÿæˆseedç„¶åé€šè¿‡UNSAFEå­˜æ”¾åˆ°Threadç±»çš„å­—æ®µä¸­ï¼Œå³ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹å•ç‹¬è®¾ç½®ä¸€ä¸ªseedï¼Œå½“æŸä¸ªçº¿ç¨‹éœ€è¦ç”Ÿæˆéšæœºæ•°æ—¶ï¼ŒThreadLocalRandomåˆä»è¯¥çº¿ç¨‹å–å‡ºseedç„¶åè®¡ç®—å¾—åˆ°éšæœºæ•°ï¼Œä»è€Œé¿å…å¤šçº¿ç¨‹ç«äº‰å’Œè‡ªæ—‹ç­‰å¾…</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="securerandom">SecureRandom<a class="hash-link" href="#securerandom" title="Direct link to heading">â€‹</a></h3><p>Randomå’ŒThreadLocalRandomäº§ç”Ÿéšæœºæ•°å¹¶ä¸æ˜¯å¯†ç å­¦å®‰å…¨çš„(not cryptographically secure)ï¼Œè€ŒSecureRandomæä¾›äº†æ»¡è¶³åŠ å¯†è¦æ±‚çš„å¼ºéšæœºæ•°ç”Ÿæˆå™¨ã€‚</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><ol><li>ä»Javaè¯­æ³•è§’åº¦ä¸Šçœ‹ï¼ŒSecureRandomå’ŒThreadLocalRandoméƒ½æ˜¯Randomå­ç±»</li><li>ThreadLocalRandom.current()ä¸€å®šè¦æœ‰å„ä¸ªçº¿ç¨‹è°ƒç”¨</li><li>é‡å¤ä½¿ç”¨SecureRandomç”Ÿæˆéšæœºæ•°å¯èƒ½ä¼šå¯¼è‡´é˜»å¡</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£<a class="hash-link" href="#å‚è€ƒæ–‡æ¡£" title="Direct link to heading">â€‹</a></h2><ol><li><a href="https://www.cnblogs.com/it-deepinmind/p/13344553.html" target="_blank" rel="noopener noreferrer">SecureRandomä½¿ç”¨ä¸å½“å¼•èµ·çš„çº¿ç¨‹é˜»å¡</a></li></ol>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Random" term="Random"/>
        <category label="OpenJDK" term="OpenJDK"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ±‚æœ€é•¿å›æ–‡å­ä¸²]]></title>
        <id>/2021/09/21/LongestPalindrome</id>
        <link href="https://kayhaw.github.io/blog/2021/09/21/LongestPalindrome"/>
        <updated>2021-09-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[æ±‚æœ€é•¿å›æ–‡å­ä¸²]]></summary>
        <content type="html"><![CDATA[<p>ç®—æ³•é¢˜ï¼šæ±‚æœ€é•¿å›æ–‡å­ä¸²</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°<a class="hash-link" href="#é¢˜ç›®æè¿°" title="Direct link to heading">â€‹</a></h2><p><a href="https://leetcode-cn.com/problems/longest-palindromic-substring/" target="_blank" rel="noopener noreferrer">æœ€é•¿å›æ–‡å­ä¸²</a>ï¼šç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²<code>s</code>ï¼Œæ‰¾åˆ°<code>s</code>ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ï¼Œç¤ºä¾‹ï¼šs="babad"ï¼Œè¾“å‡ºä¸º"bab"</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="manacherç®—æ³•">Manacherç®—æ³•<a class="hash-link" href="#manacherç®—æ³•" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ„é€ æ–°å­—ç¬¦ä¸²">æ„é€ æ–°å­—ç¬¦ä¸²<a class="hash-link" href="#æ„é€ æ–°å­—ç¬¦ä¸²" title="Direct link to heading">â€‹</a></h3><p>ç”±äºå¶æ•°é•¿åº¦çš„å›æ–‡ä¸²æ²¡æœ‰ä¸­å¿ƒå­—ç¬¦ï¼Œè¿™é‡Œç”±åŸå­—ç¬¦ä¸²sæ„é€ ä¸€ä¸ªæ–°å­—ç¬¦ä¸²strã€‚æ„é€ è§„åˆ™ï¼šå–ä¸‰ä¸ª<strong>äº’ä¸ç›¸åŒä¸”ä¸ä¼šåœ¨sä¸­å‡ºç°</strong>çš„å­—ç¬¦ï¼Œä»¥<code>^</code>ã€<code>$</code>ã€<code>#</code>ä¸ºä¾‹ï¼Œé¦–å…ˆç”¨<code>$</code>ä½œä¸ºé¦–å­—ç¬¦ï¼Œç„¶ååœ¨så­—ç¬¦ä¹‹é—´æ’å…¥<code>#</code>ï¼Œæœ€åæ’å…¥<code>^</code>ï¼Œè¿™æ ·æ–¹ä¾¿ååºçš„ä¸­å¿ƒæ‰©æ•£æ“ä½œæ—¶ä¸ç”¨åˆ¤æ–­æ˜¯å¦æº¢å‡ºè¾¹ç•Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initStr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">StringBuilder</span><span class="token plain"> sb </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">StringBuilder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"$#"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token char">'#'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token char">'^'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// æ³¨æ„è¿˜è¦åŠ å¦ä¸€ä¸ªä¸ç›¸å¹²çš„å­—ç¬¦ï¼Œè¿™æ ·ä¸‹é¢çš„æ‰©å±•ä¸ç”¨åˆ¤æ–­è¾¹ç•Œæ˜¯å¦æº¢å‡º</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> sb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ‰¾åˆ°å›æ–‡ä¸­å¿ƒå’Œæœ€å¤§é•¿åº¦">æ‰¾åˆ°å›æ–‡ä¸­å¿ƒå’Œæœ€å¤§é•¿åº¦<a class="hash-link" href="#æ‰¾åˆ°å›æ–‡ä¸­å¿ƒå’Œæœ€å¤§é•¿åº¦" title="Direct link to heading">â€‹</a></h3><ol><li>å½“iå°äºå½“å‰æœ€é•¿å›æ–‡çš„ä¸Šç•ŒupBoundæ—¶<ol><li>ä»¥iä¸ºä¸­å¿ƒçš„å›æ–‡é•¿åº¦è‡³å°‘ä¸ºå¯¹ç§°ç‚¹å›æ–‡é•¿åº¦æˆ–è€…upBound-i</li></ol></li><li>å½“iå¤§äºç­‰äºæœ€é•¿å›æ–‡çš„ä¸Šç•Œæ—¶<ol><li>æ²¡æœ‰è§„å¾‹ï¼Œåªå¥½ä»1å¼€å§‹</li></ol></li><li>whileå¾ªç¯ç”±ié€æ¸å‘ä¸¤ç«¯æ‰©å±•ï¼Œè¿™é‡Œä¸éœ€è¦åˆ¤æ–­iæ˜¯å¦è¶…è¿‡è¾¹ç•Œ</li><li>å½“i+expand<!-- -->[i]<!-- -->å¤§äºupBoundæ—¶ï¼Œæ›´æ–°upBoundå’Œcenter</li><li>å½“expand<!-- -->[i]<!-- -->å¤§äºæœ€å¤§é•¿åº¦maxLengthæ—¶ï¼Œæ›´æ–°finalCenterå’ŒmaxLength</li><li>è¿”å›ç»“æœï¼Œå­ä¸²èµ·å§‹ä½ç½®<code>start</code>ä¸º<code>(finalCenter-maxLength)/2</code>ï¼Œç»“æŸä½ç½®ä¸º<code>start+maxLength-1</code></li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">manacher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> center </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> upBound </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxLength </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> finalCenter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> str</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> expand </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">len</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// iä»1å¼€å§‹ï¼Œåˆ°len-1ç»“æŸï¼Œæ³¨æ„ï¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> len</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å¯ä»¥è·³è¿‡æ­¥æ•°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expand</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> upBound</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expand</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">center </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> upBound</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸¤ç«¯æ¯”è¾ƒï¼Œæ³¨æ„å…ˆåˆ¤æ–­è¾¹ç•Œæ¡ä»¶å†è·³</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">str</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">expand</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> str</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">expand</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            expand</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// æ›´æ–°ä¸­å¿ƒç‚¹å’Œä¸Šç•Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expand</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> upBound</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            center </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            upBound </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> expand</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// æ›´æ–°æœ€é•¿å›æ–‡ä¸²é•¿åº¦åŠå…¶ä¸‹æ ‡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expand</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> maxLength</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            maxLength </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> expand</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            finalCenter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ³¨æ„æœ€åè¿”å›æœ€å¤§é•¿åº¦æ—¶è¦å‡1ï¼Œä¸èƒ½ç›´æ¥è¿”å›upBound-centerï¼Œè¿™æ˜¯æœ€åä¸€ä¸ªå›æ–‡ä¸²é•¿åº¦ä¸æ˜¯æœ€é•¿å›æ–‡ä¸²é•¿åº¦</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// return maxLength-1;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è¿”å›æœ€é•¿å›æ–‡ä¸²</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">finalCenter</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">maxLength</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">finalCenter</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">maxLength</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> maxLength</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>ç¼–ç¨‹ç»†èŠ‚</h5></div><div class="admonition-content"><ol><li>forå¾ªç¯iä»1å¼€å§‹ï¼Œåˆ°len-1ç»“æŸ</li><li>æœ€é•¿å›æ–‡ä¸²é•¿åº¦æ˜¯maxLength-1è€Œä¸æ˜¯maxLength</li><li>å½“expand<!-- -->[i]<!-- -->+i&gt;upBoundæ—¶æ˜¯å±€éƒ¨æœ€é•¿å›æ–‡å­ä¸²è€Œä¸æ˜¯å…¨å±€å›æ–‡å­ä¸²ï¼Œåº”è¯¥åœ¨æ¯ä¸€æ¬¡éå†æ—¶ç»´æŠ¤ï¼Œè€Œä¸æ˜¯foré€€å‡ºåç›´æ¥æ‹¿iå½“åšæœ€é•¿å›æ–‡å­ä¸²ä¸­å¿ƒ</li><li>whileå¾ªç¯æ²¡æœ‰åˆ¤æ–­è¾¹ç•Œï¼Œæœ€é•¿å›æ–‡ä¸­å¿ƒæ˜¯(finalCenter-maxLength)/2éƒ½æ˜¯è¦é initStræ­£ç¡®å¤„ç†æ‰èƒ½ç¡®ä¿</li></ol></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="é¢˜ç›®å˜å½¢">é¢˜ç›®å˜å½¢<a class="hash-link" href="#é¢˜ç›®å˜å½¢" title="Direct link to heading">â€‹</a></h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²sï¼Œè¯·è®¡ç®—è¿™ä¸ªå­—ç¬¦ä¸²ä¸­æœ‰å¤šå°‘ä¸ªå›æ–‡å­å­—ç¬¦ä¸²ã€‚å…·æœ‰ä¸åŒå¼€å§‹ä½ç½®æˆ–ç»“æŸä½ç½®çš„å­ä¸²ï¼Œå³ä½¿æ˜¯ç”±ç›¸åŒçš„å­—ç¬¦ç»„æˆï¼Œä¹Ÿä¼šè¢«è§†ä½œä¸åŒçš„å­ä¸²ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ€è·¯åˆ†æ">æ€è·¯åˆ†æ<a class="hash-link" href="#æ€è·¯åˆ†æ" title="Direct link to heading">â€‹</a></h3><p>å›é¡¾å‰é¢åœ¨éå†stræ—¶ï¼Œå¾—åˆ°äº†strä¸Šæ¯ä¸ªå­—ç¬¦åœ¨iä½ç½®èƒ½å¤Ÿå»¶ä¼¸çš„æœ€å¤§å¯¹ç§°é•¿åº¦expand<!-- -->[i]<!-- -->ï¼Œé‚£ä¹ˆæŠŠæ‰€æœ‰expand<!-- -->[i]<!-- -->åŠ èµ·æ¥å°±å¾—åˆ°stræ‰€æœ‰å›æ–‡å­ä¸²çš„ä¸ªæ•°ã€‚å¯æ˜¯åˆè¦æ€ä¹ˆæ±‚sæ‰€æœ‰å›æ–‡å­ä¸²çš„ä¸ªæ•°å‘¢ï¼Ÿ</p><p>ç”±äºstræ˜¯åœ¨sçš„åŸºç¡€ä¸Šé—´éš”å­—ç¬¦æ’å…¥'#'ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼š<strong>å¯¹äºsæ¥è¯´ï¼Œstrçš„å›æ–‡å­ä¸²'#b#'å°±æ˜¯sçš„å›æ–‡ä¸²'b'åŒ…äº†å±‚çš®ï¼Œstrçš„å›æ–‡å­ä¸²'#a#b#a'å°±æ˜¯sçš„å›æ–‡ä¸²'abc'åŒ…äº†å±‚çš®</strong>ï¼Œå› æ­¤å¯ä»¥å¾—åˆ°<code>s_expand[i]=str_expand[i]/2</code>ã€‚æœ€åå®ç°ä»£ç å°±å¾ˆæ˜äº†ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">manacher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> len</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> center </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> radius </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ans </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> radArray </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">len</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        radArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">center </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> radius </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">radArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">center</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> center </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> radius </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">str</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> radArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> str</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> radArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">radArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">radArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> radius</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            center </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            radius </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> radArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ans </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> radArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ans</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>æ³¨æ„</h5></div><div class="admonition-content"><p>ä¸¥æ ¼æ¥è¯´ï¼Œä¸Šè¿°ä»£ç ä¸­è®¡ç®—å¾—åˆ°radArrayæ˜¯ä¸å‡†ç¡®çš„(é¦–å°¾å…ƒç´ éƒ½æ˜¯0)ï¼Œå®é™…ä¸Šåº”è¯¥ä¸º1ï¼Œåªä¸è¿‡å› ä¸º0å’Œ1è¢«2æ•´é™¤ç»“æœéƒ½æ˜¯0ï¼Œå¹¶ä¸å½±å“æœ€ç»ˆç»“æœ</p></div></div>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Algorithm" term="Algorithm"/>
        <category label="Palindrome" term="Palindrome"/>
        <category label="Manacher" term="Manacher"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç½‘ç»œåŸºç¡€çŸ¥è¯†(1)]]></title>
        <id>/2021/09/20/TCPBasic</id>
        <link href="https://kayhaw.github.io/blog/2021/09/20/TCPBasic"/>
        <updated>2021-09-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[ç½‘ç»œåŸºç¡€çŸ¥è¯†(1)]]></summary>
        <content type="html"><![CDATA[<p>æ¶è¡¥ç½‘ç»œåŸºç¡€çŸ¥è¯†ç¬¬ä¸€ç¯‡ï¼šTCPå’ŒIP</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="rstå‡ºç°æƒ…å†µ">RSTå‡ºç°æƒ…å†µ<a class="hash-link" href="#rstå‡ºç°æƒ…å†µ" title="Direct link to heading">â€‹</a></h2><ul><li>è¯·æ±‚ç«¯å£æœªæ‰“å¼€ï¼š
å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥3000ç«¯å£ï¼Œä½†æ˜¯æœåŠ¡ç«¯æ²¡æœ‰æ‰“å¼€3000ç«¯å£ï¼Œæ­¤æ—¶å‘å®¢æˆ·ç«¯è¿”å›RSTæŠ¥æ–‡ï¼›æ³¨æ„æœ‰äº›æ“ä½œç³»ç»Ÿä¸ä¼šç†ç¬è¯·æ±‚ç«¯å£ä¸å­˜åœ¨çš„æƒ…å†µ</li><li>è¯·æ±‚è¶…æ—¶ï¼š
å®¢æˆ·ç«¯å‘èµ·SYNè¯·æ±‚åæ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„å“åº”ï¼Œä½†æ˜¯æ¥æ”¶æ—¶é—´è¶…æ—¶ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ä¼šå‘é€RSTä¸»åŠ¨æ–­å¼€è¿æ¥</li><li>æå‰å…³é—­ï¼š
åº”ç”¨ç¨‹åºä¸æƒ³æ¥æ”¶æ•°æ®ï¼Œå‘å‘é€æ–¹ç›´æ¥å‘é€RSTè¯·æ±‚</li><li>å·²å…³é—­çš„è¿æ¥ä¸Šæ”¶åˆ°æ•°æ®ï¼š</li></ul>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Networking" term="Networking"/>
        <category label="TCP" term="TCP"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[2021å¹´9æœˆä»½å·¥ä½œæ—¥å¿—]]></title>
        <id>/2021/09/19/WorkJournal</id>
        <link href="https://kayhaw.github.io/blog/2021/09/19/WorkJournal"/>
        <updated>2021-09-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[2021å¹´9æœˆä»½å·¥ä½œæ—¥å¿—]]></summary>
        <content type="html"><![CDATA[<p>åŒ…å«ä»3æœˆä»½åˆ°9æœˆä»½çš„å·¥ä½œæ—¥å¿—ï¼Œä¸»è¦è®°å½•æ–°å­¦åˆ°çš„é›¶æ˜ŸæŠ€æœ¯ç‚¹</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>ğŸ”’å®‰å…¨é—®é¢˜</h5></div><div class="admonition-content"><p>åç«¯å¯¹ç”¨æˆ·å¯†ç åŠ å¯†ä¿å­˜æ—¶ï¼Œå®é™…åŠ å¯†çš„å­—æ®µæ˜¯<code>ç”¨æˆ·å+ç”¨æˆ·å¯†ç </code>ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢ç™»å½•æ•°æ®åº“å¤åˆ¶å¦ä¸€ä¸ªå·²çŸ¥çš„ç”¨æˆ·å¯†ç å­—æ®µä»è€Œä¿®æ”¹ç”¨æˆ·å¯†ç çš„è¡Œä¸º</p></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>âœ¨ShellæŠ€å·§</h5></div><div class="admonition-content"><p>åœ¨ç¼–å†™shellè„šæœ¬æ—¶ï¼Œå½“å‘½ä»¤è¿‡é•¿æ—¶å¾€å¾€ä½¿ç”¨ç©ºæ ¼åŠ <code>\</code>è¿›è¡Œåˆ†è¡Œä¹¦å†™ï¼Œé€šå¸¸æ¯ä¸€è¡Œå¯¹åº”ä¸€ä¸ªå‚æ•°é…ç½®ï¼Œå¦‚æœè¦æ³¨é‡Šè¿™è¡Œé…ç½®ï¼Œç›´æ¥åœ¨è¡Œé¦–åŠ ä¸Š<code>#</code>æ˜¯é”™è¯¯çš„ï¼Œè¿˜è¦ç”¨<code>`</code>åŒ…è£¹è¡¨ç¤ºæ‰§è¡Œå‘½ä»¤ï¼Œè€Œè¯¥å‘½ä»¤ä»¥<code>#</code>å¼€å¤´åˆç›¸å½“äºä¸æ‰§è¡Œ</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--code nginx </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--restart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">always </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">:80 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-v /opt/xxx/conf/:/etc/nginx/custom/conf/ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-v /opt/nginx.conf:/etc/nginx/nginx.conf </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">`</span><span class="token variable comment" style="color:#999988;font-style:italic"># -v /opt/volume/html:/usr/share/nginx/html \</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-v /opt:/usr/share/nginx/html </span><span class="token punctuation" style="color:#393A34">\</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>ğŸ“mkcertåŸºæœ¬ä½¿ç”¨</h5></div><div class="admonition-content"><p>Httpsè‡ªç­¾åè¯ä¹¦ç”Ÿæˆæ–¹å¼ï¼š</p><ol><li>githubé¡¹ç›®ä¸‹è½½è½¯ä»¶åŒ…mkcert-v1.4.3-linux-amd64</li><li><code>chmod +x mkcert-v1.4.3-linux-amd64</code></li><li><code>./mkcert-v1.4.3-linux-amd64 -install</code>ç”Ÿæˆæ ¹è¯ä¹¦ï¼Œå­˜æ”¾è·¯å¾„ç”± ./mkcert-v1.4.3-linux-amd64 xxxç»™å‡º</li><li><code>./mkcert-v1.4.3-linux-amd64 kayhaw.github.io</code>ä¸ºåŸŸååœ°å€ç”Ÿæˆè¯ä¹¦ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªåŸŸåã€ipåœ°å€ï¼Œä½¿ç”¨ç©ºæ ¼åˆ†å¼€</li></ol></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>ğŸ“SQLå’Œæ•°æ®åº“</h5></div><div class="admonition-content"><ol><li>å°äºã€å¤§äºå·åœ¨xmlæ–‡ä»¶ä¸­æ˜¯ç‰¹æ®Šç¬¦å·ï¼Œä¸èƒ½ç›´æ¥å†™<code>&gt;</code>ã€<code>&lt;</code>ï¼Œæ”¹æˆ<code>&amp;lt;</code>ã€<code>&amp;gt;</code></li><li>13ä½æ—¶é—´æˆ³æ ¼å¼åŒ–ä½¿ç”¨MySQLæä¾›çš„FROM_UNIXTIMEæ–¹æ³•ï¼Œæ³¨æ„å…ˆè¦é™¤ä»¥1000</li><li>MySQL timestampdiffç”¨æ³•ï¼š<code>TIMESTAMPDIFF(&lt;UNIT&gt;, &lt;time1&gt;, &lt;time2&gt;)</code>ï¼Œå…¶ä¸­<code>&lt;UNIT&gt;</code>æ˜¯å…³é”®å­—<code>HOUR</code>ã€<code>DAY</code>ç­‰</li><li>æ¨¡ç³ŠåŒ¹é…å¤šå­—æ®µï¼š<code>INSTR(CONCAT(A, B, C), &lt;åŒ¹é…å†…å®¹&gt;) &amp;gt; 0</code>æˆ–è€…<code>CONCAT(A, B, C) LIKE CONCAT('%', &lt;&gt;, '%')</code></li><li>ä½¿ç”¨<code>&lt;where&gt;</code>æ ‡ç­¾è€Œä¸æ˜¯<code>where 1=1</code></li><li>MyBatisæ¥å£æ–¹æ³•è¿”å›å‚æ•°ä¸ºListæˆ–Setï¼Œxmlæ–‡ä»¶ä¸­çš„resultTypeä¸è¦å†™java.util.Listï¼Œè€Œæ˜¯æ³›å‹å‚æ•°å…¨ç±»å</li><li>ifæµ‹è¯•æ¡ä»¶å†™æ³•ï¼Œç¬¬ä¸€ç§å†™æ³•æ˜¯é”™è¯¯çš„ï¼Œå•å¼•å·'0'ä¼šè¢«è§†ä¸ºå­—ç¬¦è€Œä¸æ˜¯Stringç±»å‹</li></ol><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">if</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">test</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">code != null and code != </span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c"> and code != </span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND user.code = #{code}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">if</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">if</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">test</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">code != null and code != </span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">.toString() and code != </span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">.toString()</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND user.code = #{code}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">if</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="8"><li>å¤šè¡¨è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå¯èƒ½å…·æœ‰ç›¸åŒçš„å­—æ®µåç§°ï¼Œéœ€è¦å¸¦ä¸Šè¡¨åå‰ç¼€</li><li>å¤šè¡¨left joinè¿æ¥æŸ¥è¯¢ï¼Œå³è¾¹è¡¨å­—æ®µéƒ½æ˜¯ç©ºï¼Œåé¢åˆåŠ äº†whereç­›é€‰æ¡ä»¶ï¼Œå¯¼è‡´éœ€è¦éƒ¨åˆ†å­—æ®µä¸ºç©ºçš„ç»„åˆè®°å½•è¢«è¿‡æ»¤å‡ºå»</li><li>mybatis listæ”¹in sqlè¯­å¥çš„å†™æ³•</li></ol><div class="codeBlockContainer_I0IT language-xml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-xml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">if</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">test</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">names != null and names.size() &gt; 0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND t.name IN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">foreach</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">collection</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">names</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">item</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">name</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">index</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">index</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">open</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">(</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">separator</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">,</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">close</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">)</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #{name}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">foreach</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">if</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="11"><li>ğŸš¨MySql JDBCçš„getIntã€getDoubleã€getBooleanç­‰æ–¹æ³•ï¼Œåœ¨è¡¨å­—æ®µå€¼ä¸ºnullæ—¶è¿”å›ç±»å‹é›¶å€¼ï¼Œä¸ºäº†é€»è¾‘æ­£ç¡®ä½¿ç”¨getObjectä»£æ›¿ï¼Œå®é™…ä¸Šè¿™äº›æ–¹æ³•çš„åº•å±‚å®ç°éƒ½æ˜¯ç”¨getObjectç„¶åå¼ºåˆ¶è½¬æ¢</li><li>ğŸ¤¡è¡¨åä¸èƒ½ç”¨æ¥åšPrepareStatementçš„å ä½ç¬¦ï¼š<code>PreparedStatement statement = connection.prepareStatement("SELECT * FROM ? LIMIT ?");</code>ï¼Œç»è¿‡è§£æä¹‹åæ˜¯<code>SELECT * FROM 'kayhaw_test' LIMIT 1000</code>ï¼Œè¡¨åå¸¦ä¸Šäº†åŒå¼•å·ï¼Œsqlæ‰§è¡ŒæŠ¥é”™</li><li>Hiveå»ºè¡¨<code>escaped by</code>å†™æˆäº†<code>escape by</code>ï¼Œæ²¡æœ‰åŠ <code>d</code>æ˜¯å› ä¸ºdbeaverè‡ªåŠ¨æç¤ºçš„ï¼Œä»¥ä¸ºæ˜¯æ­£ç¡®çš„</li><li>Hiveæ•°æ®åº“å­—æ®µåå¯èƒ½åŒ…å«å„ç§ç‰¹æ®Šå­—ç¬¦ï¼Œåœ¨selectæŸ¥è¯¢æ—¶ç”¨åå¼•å·å°†å­—æ®µååŒ…è£¹èµ·æ¥ï¼›ç±»ä¼¼ï¼Œå½“hiveç”¨æˆ·æŸ¥è¯¢å¦ä¸€è¡¨ç©ºé—´çš„è¡¨æ—¶ï¼Œéœ€è¦ç»™schemaå’Œè¡¨ååŠ ä¸Šåå¼•å·</li><li>MySqlå»ºåº“å»ºè¡¨é»˜è®¤å­—ç¬¦é›†æ’åºåº”è¯¥æ˜¯æ•æ„Ÿçš„ï¼Œç»“æœé€‰é”™ä»¥utf8bm4-ciå­—ç¬¦é›†å¯¼è‡´å¤§å°å†™ä¸æ•æ„Ÿï¼Œå»ºåº“å‘ä¸‹å½±å“å»ºè¡¨ï¼Œå³ä½¿æ”¹å›æ¥åä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œéœ€è¦é‡æ–°å»ºåº“å»ºè¡¨</li><li>è¾¾æ¢¦æ•°æ®åº“å’ŒOracleä¸€æ ·ï¼Œåœ¨selectå­—æ®µåˆ—è¡¨ä¸­çš„å­—æ®µä¹Ÿå¿…é¡»åŒ…å«åœ¨group byè¯­å¥ä¸­ï¼Œå¦åˆ™ä¼šæŠ¥é”™â€œä¸æ˜¯group byè¡¨è¾¾å¼â€ï¼Œå¹¶ä¸”æ’åºå­—æ®µä¹Ÿéœ€è¦å‡ºç°åœ¨group byåˆ—è¡¨ä¸­</li><li>MySQLçš„group byåæ¥å­—æ®µåˆ—è¡¨ä¸èƒ½ç”¨åœ†æ‹¬å·åŒ…èµ·ï¼Œå¦åˆ™æŠ¥é”™ï¼Œä½†æ˜¯è¾¾æ¢¦æ•°æ®åº“å¯ä»¥</li><li>HSQLä¸­<code>cast as integer</code>å¯¼è‡´é”™è¯¯ï¼Œå­—æ®µç±»å‹ä¸ºdecimalå¹¶ä¸”æœ‰ä¸ªå­—æ®µå€¼ä¸º9311054824å¤§äºintegerçš„èŒƒå›´ï¼Œæ”¹æˆ<code>cast as long</code>ï¼Œæ³¨æ„è¿™é‡Œæ˜¯Javaä¸­çš„ç±»å‹ï¼Œå…¨å°å†™</li></ol></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>â¬‡ï¸Harboræ‹‰å–é•œåƒå’Œä¿å­˜</h5></div><div class="admonition-content"><ol><li>ç™»å½•harborï¼Œé€‰æ‹©æœ€æ–°çš„åº”ç”¨é•œåƒ</li><li>æ—è¾¹æœ‰æ‹‰å–å‘½ä»¤ï¼Œç‚¹å‡»å¤åˆ¶å¾—åˆ°<code>docker pull example.com/demo helloworld@sha256:0c014719011a375c09d3167c119e24793b415354d0a02ddd4171014812b35ce7</code></li><li>ä½¿ç”¨shaæ ‡è®°æ‹‰å–çš„é•œåƒæ²¡æœ‰æ ‡ç­¾</li><li>ç‚¹å‡»è¯¦æƒ…ï¼Œé€‰æ‹©tagåç§°0.0.1-2021042019ï¼ŒæŠŠ@sha256xxxæ¢æˆ:0.0.1-2021042019ï¼Œæ³¨æ„åˆ«æ¼äº†å†’å·</li><li>ä¿å­˜æ‹‰å–é•œåƒä¸ºtaræ–‡ä»¶<code>docker save -o helloworld.tar example.com/demo/helloworld:0.0.1-2021042019</code>
æ³¨æ„è¿™é‡Œè¿˜æ˜¯ç”¨ä»“åº“å+å†’å·+tagçš„å½¢å¼ï¼Œä¸è¦ä½¿ç”¨docker imagesåˆ—å‡ºçš„idï¼Œå¦åˆ™ä¿å­˜çš„é•œåƒæ–‡ä»¶è¿˜æ˜¯æ²¡æœ‰ä»“åº“å’Œtagä¿¡æ¯</li><li><code>docker load -i api-appgateway.tar</code>åŠ è½½é•œåƒæ–‡ä»¶</li></ol></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>ğŸ“SpringBoot</h5></div><div class="admonition-content"><ul><li>é¡¹ç›®æŠ¥é”™<code>FactoryBean threw exception on object creation; nested exception is java.lang.IllegalStateException: RequestParam.value() was empty on parameter 0</code>ï¼ŒåŸå› æ˜¯@RequestParamæ³¨è§£æ²¡æœ‰åŠ valueå‚æ•°å€¼ï¼Œåœ¨feginæ¥å£æ–‡ä»¶ä¸­è¿™æ˜¯å¿…å¡«çš„</li><li>swaggerå‚æ•°å¯¹è±¡ä¸­ApiModelçš„valueæ³¨è§£ä¸èƒ½é‡å¤ï¼Œå¦åˆ™ä¼šæŠŠä¸¤ä¸ªçš„å­—æ®µåˆå¹¶ä½œä¸ºæ–‡æ¡£çš„å‚æ•°</li><li>æœåŠ¡æŠ¥é”™no such methodï¼ŒåŸå› æ˜¯è€ç‰ˆæœ¬çš„æœåŠ¡é‡æ–°æ³¨å†Œåˆ°nacosï¼Œè´Ÿè½½å‡è¡¡æ‰¾è¿™ä¸ªæœåŠ¡è°ƒç”¨æ–¹æ³•æŠ¥é”™ï¼Œè§£å†³æ–¹æ³•æ˜¯ä¸‹çº¿è¯¥æœåŠ¡</li></ul></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>â˜•è·å–ä»Šå¤©0ç‚¹æ—¶é—´æˆ³çš„ä¸¤ç§æ–¹å¼</h5></div><div class="admonition-content"><ul><li>æ–¹å¼1ï¼šå¾—åˆ°ç²¾ç¡®å–é›¶ç‚¹é›¶åˆ†é›¶ç§’</li></ul><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> current </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentTimeMillis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> zero </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> current</span><span class="token operator" style="color:#393A34">/</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">3600</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">3600</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token class-name">TimeZone</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getRawOffset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ul><li>æ–¹å¼2ï¼š</li></ul><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token class-name">Calendar</span><span class="token plain"> calendar </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Calendar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">calendar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">calendar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Calendar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HOUR_OF_DAY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">calendar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Calendar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MINUTE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">calendar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Calendar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SECOND</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">calendar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Calendar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MILLISECOND</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// åˆ«æ¼äº†æ¯«ç§’</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zero </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> calendar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>âœ…å¼€å‘æ³¨æ„äº‹é¡¹</h5></div><div class="admonition-content"><ol><li>æ¥å£ä¸€æ—¦ç¡®å®šå°±ä¸è¦å†æ”¹å‚æ•°åç§°</li><li>æ•°æ®è¡¨ä¸€æ—¦ç¡®å®šå°±ä¸è¦å†ä¿®æ”¹å­—æ®µåç§°</li><li>å½“è¿”å›åˆ†é¡µç»“æœæ—¶ç”¨PageåŒ…è£…è€Œä¸æ˜¯Listè¿”å›</li><li>æ¶‰åŠç”¨æˆ·idçš„å‚æ•°ä¸éœ€è¦å‰ç«¯ä¼ è¾“ï¼Œä½¿ç”¨æ³¨è§£ç»Ÿä¸€è·å–</li><li>Feignedæ¥å£å®šä¹‰çš„RequestParamæ³¨è§£éœ€è¦åŠ ä¸Švalueå±æ€§</li><li>æœåŠ¡æ¥å£å®ç°ç±»è¦åŠ ä¸Šserviceæ³¨è§£</li></ol></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>â˜•Java APIä½¿ç”¨</h5></div><div class="admonition-content"><ul><li>æ‘˜å–æ‹¬å·ä¹‹é—´çš„å†…å®¹å†™æ³•ï¼š<code>value.substring(value.indexOf('(')+1, value.lastIndexOf(')'))</code>ï¼Œæ³¨æ„å¼€å§‹ä½ç½®æ˜¯å·¦æ‹¬å·+1ï¼Œç»“æŸä½ç½®å°±æ˜¯å³æ‹¬å·</li><li>String splitçš„å‚æ•°æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œè€Œç‚¹å¥½åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­åŒ¹é…ä»»æ„1ä¸ªå­—ç¬¦ï¼Œä»¥ç‚¹å·åˆ†å‰²å†™æ³•æ˜¯ï¼š<code>String[] arr = str.split("\\.");</code></li><li>åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºnullï¼š<a href="https://zhuanlan.zhihu.com/p/347581992" target="_blank" rel="noopener noreferrer"><code>Objects.isNull()</code></a></li><li>JDBCçš„<code>getDate()</code>è¿”å›ç±»å‹æ˜¯java.sql.Dateï¼Œä¸æ˜¯java.utils.Dateï¼Œæ³¨æ„åŒºåˆ«ï¼ï¼ï¼</li><li>Guava APIï¼šä½¿ç”¨<code>Maps.newHashMapWithExpectedSize(c.size())</code>ç”Ÿæˆä¸€ä¸ªåˆå§‹åŒ–å¤§å°çš„HashMap</li></ul></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>æ—¥å¸¸ğŸ¤¡</h5></div><div class="admonition-content"><ol><li>bootstrap.propertiesç¯å¢ƒé…ç½®ï¼Œactiveæ–‡ä»¶ç”±localæ”¹ä¸ºäº†testï¼Œå¯¼è‡´æŸ¥è¯¢çš„æ•°æ®åº“æ˜¯æµ‹è¯•ç¯å¢ƒçš„ï¼Œä¸€ç›´æŠ¥é”™æ‰¾ä¸åˆ°ä½¿ç”¨çš„æ•°æ®è¡¨</li><li>æœ¬åœ°bootstrap.propertiesé…ç½®è¢«æ”¹ï¼Œlocalç¯å¢ƒçš„namespaceæ²¡æœ‰è®¾ç½®æˆæœ¬åœ°ç¯å¢ƒçš„é…ç½®ï¼Œå¯¼è‡´å¯åŠ¨æŠ¥é”™æ‰¾ä¸åˆ°redisé…ç½®</li><li>å¯¹è±¡æè¿°ï¼Œå¯¹è±¡åç§°ç­‰å­—æ®µåœ¨æ•°æ®åº“å­—æ®µè®¾è®¡æ—¶è¦å’Œå‰ç«¯ç¡®è®¤æœ€å¤§é•¿åº¦é™åˆ¶</li><li>flywayä¸€æ¬¡åªèƒ½æ¥å…¥ä¸€ä¸ªåç«¯ä¸šåŠ¡åº“ï¼Œå› ä¸ºä¸€ä¸ªå¾®æœåŠ¡åç«¯å¯¹åº”ä¸€ä¸ªä¸šåŠ¡åº“</li><li>ç»Ÿè®¡å½“å¤©æ—¥æœŸæ˜¯å¤§äºç­‰äºå½“å¤©0ç‚¹0åˆ†ï¼Œè€Œä¸æ˜¯å¤§äº</li><li>flywayæ‰§è¡Œsqlè„šæœ¬æŠ¥é”™ï¼ŒåŸå› æ˜¯ç»™longtextåŠ äº†é»˜è®¤å€¼ç©ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯longtextä¸èƒ½è®¾ç½®é»˜è®¤å€¼</li><li>åœ¨æ’åºæŸ¥è¯¢åä¸è¦å†æ ¹æ®ä¸šåŠ¡å•ç‹¬å¯¹å­—æ®µå€¼æ’åºï¼Œå¦åˆ™ä¹‹å‰çš„æ’åºå¤±æ•ˆï¼Œæ’åºå°±æ˜¯ä¸€èµ·çš„</li><li>DELETEè¯­å¥åé¢ä¸è·Ÿå­—æ®µï¼Œé”™è¯¯å†™æ³•ï¼š<code>DELETE * FROM STUDENT WHERE NAME = #{name}</code></li><li>pageHelperåˆ†é¡µå‚æ•°ç”±æ–¹æ³•å‚æ•°æŒ‡å®šæ—¶è¿˜æ˜¯è¦åŠ ä¸Š@Param("pageNum")æ³¨é‡Šï¼Œå•å•<code>Integer pageNum</code>ä¸ç”Ÿæ•ˆ</li><li>Nacosä¿®æ”¹é…ç½®ï¼Œéœ€è¦é‡å¯dockeræœåŠ¡ï¼Œéƒ¨ç½²å¤šä¸ªèŠ‚ç‚¹å…¨éƒ¨éƒ½è¦é‡å¯</li><li>MyBatisçš„xmlæ–‡ä»¶ä¸­ï¼Œæ›´æ–°æ–¹æ³•ä¸€æ—¶æ‰‹å¿«ä½¿ç”¨äº†<code>&lt;select&gt;</code>æ ‡ç­¾è€Œä¸æ˜¯<code>&lt;update&gt;</code>æ ‡ç­¾å¯¼è‡´å‡ºé”™</li><li>swaggeré¡µé¢å‚æ•°å¯¹è±¡æ²¡æœ‰æ˜¾å¼å­—æ®µåç§°å’Œç±»å‹ï¼ŒåŸå› æ˜¯ç±»å­—æ®µæ²¡æœ‰setterå’Œgetteræ–¹æ³•ï¼Œæˆ–è€…ä½¿ç”¨lombokçš„@Dataæ³¨è§£</li></ol></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>ğŸ”§å·¥å…·ä½¿ç”¨</h5></div><div class="admonition-content"><ul><li>Windowsä¸‹ä½¿ç”¨Docker Desktopå¯åŠ¨MySQLæœåŠ¡</li></ul><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># æ‹‰é•œåƒ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull mysql:5.7.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å¯åŠ¨å®¹å™¨ï¼Œ-pç«¯å£æ˜ å°„é…ç½®ä¸è¦æ”¾åœ¨-dé…ç½®é¡¹åé¢</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run --name mysql -p </span><span class="token number" style="color:#36acaa">3306</span><span class="token plain">:3306 -e </span><span class="token assign-left variable" style="color:#36acaa">MYSQL_ROOT_PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"> -d mysql:5.7.18</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Work Journal" term="Work Journal"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[çº¯æ•°å­¦çš„ç®—æ³•é¢˜(1)]]></title>
        <id>/2021/09/13/MathAlgorithms-01</id>
        <link href="https://kayhaw.github.io/blog/2021/09/13/MathAlgorithms-01"/>
        <updated>2021-09-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[çº¯æ•°å­¦çš„ç®—æ³•é¢˜(1)]]></summary>
        <content type="html"><![CDATA[<p>é‚£äº›éœ€è¦æ•°å­¦çŸ¥è¯†çš„ç®—æ³•é¢˜ï¼Œç¬¬ä¸€æ³¢</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ–æ³¢é‚£å¥‘æ•°åˆ—">æ–æ³¢é‚£å¥‘æ•°åˆ—<a class="hash-link" href="#æ–æ³¢é‚£å¥‘æ•°åˆ—" title="Direct link to heading">â€‹</a></h2><p>å¸¸è§çš„é¢˜ç›®å¦‚<a href="https://leetcode-cn.com/problems/climbing-stairs/" target="_blank" rel="noopener noreferrer">çˆ¬æ¥¼æ¢¯</a>ï¼Œæœ¬è´¨ä¸Šæ˜¯æ±‚f(n)=f(n-1)+f(n-2)çš„å€¼</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">climbStairs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>æ³¨æ„ï¼Œåœ¨å¦ä¸€é“é¢˜<a href="https://leetcode-cn.com/problems/fei-bo-na-qi-shu-lie-lcof/" target="_blank" rel="noopener noreferrer">æ±‚æ–æ³¢é‚£å¥‘æ•°åˆ—</a>ä¸­åˆå§‹å€¼æ˜¯ä»0å¼€å§‹çš„ï¼Œå¹¶ä¸”è¦æ±‚å¯¹ç»“æœå–æ¨¡</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fib</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000000007</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å®é™…å†™ä»£ç æ—¶éœ€è¦æ³¨æ„ï¼š</p><ol><li>äº¤æ›¿èµ‹å€¼é¡ºåºä¸èƒ½æé”™ï¼Œæ¯”å¦‚å†™æˆ<code>c=a+b, b=c, a=b</code></li><li>whileçš„é€€å‡ºæ¡ä»¶æ˜¯<code>--n &gt; 0</code>ï¼Œä¸€å®šæ˜¯<code>--</code>åœ¨å‰é¢</li><li>å–æ¨¡è¿™é‡Œæ¯”è¾ƒå‘ï¼Œä¸€å¼€å§‹æŒ‰ç…§çˆ¬æ¥¼æ¢¯çš„è§£é¢˜ä»£ç å°±å†™æˆäº†<code>c = (a+b)%1000000007, b=c, a=b</code>ï¼Œå¯¼è‡´éƒ¨åˆ†æµ‹è¯•ç”¨ä¾‹æ²¡æœ‰é€šè¿‡
æ€»ç»“èµ·æ¥è¿˜æ˜¯ç¬¬äºŒæ®µä»£ç æ›´ä¸ºå…¨é¢ï¼Œèƒ½å¤Ÿå¤„ç†f(0)çš„æƒ…å†µï¼Œç›´æ¥èƒŒä¸‹æ¥å§</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="ç¯æ³¡å¼€å…³">ç¯æ³¡å¼€å…³<a class="hash-link" href="#ç¯æ³¡å¼€å…³" title="Direct link to heading">â€‹</a></h2><p><a href="https://leetcode-cn.com/problems/bulb-switcher/" target="_blank" rel="noopener noreferrer">åŸé¢˜</a>æè¿°ï¼š</p><blockquote><p>åˆå§‹æ—¶æœ‰nä¸ªç¯æ³¡å¤„äºå…³é—­çŠ¶æ€ã€‚å¯¹æŸä¸ªç¯æ³¡åˆ‡æ¢å¼€å…³æ„å‘³ç€ï¼šå¦‚æœç¯æ³¡çŠ¶æ€ä¸ºå…³é—­ï¼Œé‚£è¯¥ç¯æ³¡å°±ä¼šè¢«å¼€å¯ï¼›è€Œç¯æ³¡çŠ¶æ€ä¸ºå¼€å¯ï¼Œé‚£è¯¥ç¯æ³¡å°±ä¼šè¢«å…³é—­ã€‚<br>
<!-- -->ç¬¬ 1 è½®ï¼Œæ¯ä¸ªç¯æ³¡åˆ‡æ¢ä¸€æ¬¡å¼€å…³ã€‚å³ï¼Œæ‰“å¼€æ‰€æœ‰çš„ç¯æ³¡ã€‚<br>
<!-- -->ç¬¬ 2 è½®ï¼Œæ¯ä¸¤ä¸ªç¯æ³¡åˆ‡æ¢ä¸€æ¬¡å¼€å…³ã€‚ å³ï¼Œæ¯ä¸¤ä¸ªç¯æ³¡å…³é—­ä¸€ä¸ªã€‚<br>
<!-- -->ç¬¬ 3 è½®ï¼Œæ¯ä¸‰ä¸ªç¯æ³¡åˆ‡æ¢ä¸€æ¬¡å¼€å…³ã€‚<br>
<!-- -->ç¬¬&nbsp;i è½®ï¼Œæ¯&nbsp;i&nbsp;ä¸ªç¯æ³¡åˆ‡æ¢ä¸€æ¬¡å¼€å…³ã€‚ è€Œç¬¬&nbsp;n&nbsp;è½®ï¼Œä½ åªåˆ‡æ¢æœ€åä¸€ä¸ªç¯æ³¡çš„å¼€å…³ã€‚<br>
<!-- -->æ‰¾å‡º&nbsp;n&nbsp;è½®åæœ‰å¤šå°‘ä¸ªäº®ç€çš„ç¯æ³¡ã€‚    </p></blockquote><p>ä¸€å¼€å§‹è¯•å›¾å¯¹1,2,3,4å‡ ç§è¾ƒå°æƒ…å†µåˆ†æå‡ºç»“æœç„¶ååˆ¤æ–­ç»“æœæ˜¯å¦æ˜¯æŸç§è§„åˆ™çš„æ•°åˆ—ï¼Œå®é™…ä¸Šæ²¡æœ‰ï¼Œæ¥ç€åˆä¸Šå¤´æƒ³ç€èƒ½ä¸èƒ½è½¬æˆåŠ¨æ€è§„åˆ’ï¼Œè¿˜æ˜¯ä¸è¡Œã€‚çœ‹äº†é¢˜è§£ï¼Œä»1å¼€å§‹å¯¹ç¯æ³¡ç¼–å·ï¼Œå¯¹äºç¯æ³¡kï¼Œå®ƒåœ¨ä»€ä¹ˆæ—¶å€™åˆ‡æ¢å¼€å…³å‘¢ï¼Ÿä»ç¬¬1,2,3,4åˆ°iï¼Œå‘ç°<strong>å½“kèƒ½æ•´é™¤iæ—¶ç¯æ³¡kåˆ‡æ¢ä¸€æ¬¡å¼€å…³</strong>ï¼Œå¹¶ä¸”åªéœ€è¦å…³æ³¨åˆ‡æ¢æ¬¡æ•°çš„å¥‡å¶æ€§ï¼Œé‚£åˆ‡æ¢å‡ æ¬¡å‘¢ï¼Ÿç”±äºè½®æ•°ä»1åˆ°kï¼Œé‚£åˆ‡æ¢æ¬¡æ•°å°±æ˜¯kçš„æ‰€æœ‰å› å­çš„ä¸ªæ•°ï¼Œåˆ°äº†è¿™é‡Œå°±éœ€è¦å¼•å…¥ä¸€ä¸ªé‡è¦çš„æ•°å­¦ç†è®º</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>å› æ•°ä¸ªæ•°çš„å¥‡å¶æ€§</h5></div><div class="admonition-content"><p>å½“æ•´æ•°kä¸ºå®Œå…¨å¹³æ–¹æ•°æ—¶ï¼Œå…¶å› æ•°ä¸ªæ•°ä¸ºå¥‡æ•°ï¼Œå¦åˆ™ä¸ºå¶æ•°</p></div></div><p>æ‰€ä»¥ï¼Œå¯¹äºç¯æ³¡kï¼Œå½“kä¸ºå®Œå…¨å¹³æ–¹æ•°æ—¶ï¼Œæ­¤æ—¶å®ƒåˆ‡æ¢å¼€å…³å¥‡æ•°æ¬¡ï¼Œæœ€åä¸ºç‚¹äº®çŠ¶æ€ï¼Œå¦åˆ™ä¸ºç†„ç­çŠ¶æ€ã€‚å› æ­¤é—®é¢˜å³è½¬æ¢ä¸ºæ±‚1åˆ°nä¸­å®Œå…¨å¹³æ–¹æ•°çš„ä¸ªæ•°ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bulbSwitch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> ans </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">ans</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ans</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="ç”¨rand7ç”Ÿæˆrand10">ç”¨rand7ç”Ÿæˆrand10<a class="hash-link" href="#ç”¨rand7ç”Ÿæˆrand10" title="Direct link to heading">â€‹</a></h2><p><a href="https://leetcode-cn.com/problems/implement-rand10-using-rand7/" target="_blank" rel="noopener noreferrer">åŸé¢˜</a>æè¿°ï¼š</p><blockquote><p>å·²æœ‰æ–¹æ³•<code>rand7</code>å¯ç”Ÿæˆ1åˆ°7èŒƒå›´å†…çš„å‡åŒ€éšæœºæ•´æ•°ï¼Œè¯•å†™ä¸€ä¸ªæ–¹æ³•<code>rand10</code>ç”Ÿæˆ1åˆ°10èŒƒå›´å†…çš„å‡åŒ€éšæœºæ•´æ•°ã€‚ä¸è¦ä½¿ç”¨ç³»ç»Ÿçš„<code>Math.random()</code>æ–¹æ³•ã€‚</p></blockquote><p>ä¸€å¼€å§‹æ˜¯æœ‰ç‚¹æ‡µé€¼çš„ï¼Œå†·é™åˆ†æåæ˜¯è¦å¯¹<code>rand7()</code>è¿›è¡Œä¸€äº›åŠ å‡ä¹˜é™¤è¿ç®—åè¿”å›ä¸€ä¸ªæ•°ã€‚é‚£æ€ä¹ˆè¿›è¡Œå››åˆ™è¿ç®—éšæœºäº§ç”Ÿ1åˆ°10çš„æ•°å‘¢ï¼Ÿè¿™é‡Œå¼•å‡º3ä¸ªé‡è¦æ¦‚ç‡å…¬å¼</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>å…¬å¼1</h5></div><div class="admonition-content"><p>ä»¤Rand_Nè¡¨ç¤ºéšæœºç”Ÿæˆ1åˆ°Nçš„æ–¹æ³•ï¼Œé‚£ä¹ˆæœ‰:<br>
<strong>Rand_XY = (Rand_X - 1) * Rand_Y + Rand_Y</strong><br>
<!-- -->å…¶ä¸­Rand_XYä¸­çš„XYè¡¨ç¤ºXä¹˜ä»¥Y</p></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>å…¬å¼2</h5></div><div class="admonition-content"><p>å¦‚æœXæ•´é™¤Nï¼Œé‚£ä¹ˆ(Rand_N) % X + 1= Rand_X</p></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>æ‹’ç»é‡‡æ ·</h5></div><div class="admonition-content"><p>Rand_Y() = (X &gt; Y) ? Rand_X - Y : Rand_X;</p></div></div><p>å…ˆæ ¹æ®å…¬å¼1ï¼Œå¯ä»¥ç”¨ä¸¤ä¸ª<code>rand7()</code>æ–¹æ³•å¾—åˆ°<code>rand49()</code>ï¼Œé€šè¿‡æ‹’ç»é‡‡æ ·ï¼Œåªè¦<code>rand49()</code>çš„è¿”å›å€¼å¤§äº10å°±ç»§ç»­é‡‡æ ·ï¼Œå¦åˆ™ç›´æ¥è¿”å›ã€‚è¿™é‡Œå¾—åˆ°äº†49ä¸ªéšæœºæ•°ä½†æ˜¯å´åªè¦10ä¸ªï¼Œä¸¢å¼ƒæ¦‚ç‡å¤ªå¤§ã€‚ç”±äº49å†…10çš„æœ€å¤§å…¬å€æ•°æ˜¯40ï¼Œæ ¹æ®å…¬å¼2ï¼Œå°†æ¡ä»¶æ”¹ä¸ºå¤§äº40æ‰æ‹’ç»é‡‡æ ·ï¼Œè¿™æ ·åªéœ€è¦ä¸¢å¼ƒ9ä¸ªæ•°ã€‚9ä¸ªè¿˜æ˜¯å¤ªå¤šï¼Œç”¨<code>rand49()</code>å‡å»40å¾—åˆ°<code>rand(9)</code>ï¼Œæ ¹æ®å…¬å¼1ç»§ç»­å¾—åˆ°<code>rand63()</code>ï¼Œè¿˜ä¸å¤Ÿï¼Œå‡60å¾—åˆ°<code>rand3()</code>ï¼Œæœ€åå¾—åˆ°<code>rand21()</code>ï¼Œæ­¤æ—¶åªéœ€è¦ä¸¢å¼ƒ1ä¸ªæ•°</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rand10</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rand7</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rand7</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> sum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sum </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> sum </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sum </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rand7</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sum </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> sum </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sum </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rand7</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sum </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> sum </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Math algorithm" term="Math algorithm"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Javaå•ä¾‹æ¨¡å¼çš„å®ç°]]></title>
        <id>/2021/09/12/JavaSingtion</id>
        <link href="https://kayhaw.github.io/blog/2021/09/12/JavaSingtion"/>
        <updated>2021-09-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Javaå•ä¾‹æ¨¡å¼å‡ ç§å®ç°]]></summary>
        <content type="html"><![CDATA[<p>Javaå•ä¾‹æ¨¡å¼å®ç°ï¼ŒåŒ…æ‹¬é¥¿æ±‰å¼å’Œæ‡’æ±‰å¼</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="å•ä¾‹æ¨¡å¼">å•ä¾‹æ¨¡å¼<a class="hash-link" href="#å•ä¾‹æ¨¡å¼" title="Direct link to heading">â€‹</a></h2><p>æŸä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ¯”å¦‚Runtimeç±»ï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹3ç‚¹è¦æ±‚ï¼š</p><ul><li>åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå³æ„é€ å™¨è¦ç§æœ‰åŒ–</li><li>ç±»å¿…é¡»è‡ªè¡Œåˆ›å»ºè¯¥å•ä¾‹ï¼Œå³ä½¿ç”¨é™æ€ä¿é‡ä¿å­˜è¯¥å®ä¾‹</li><li>ç±»å¿…é¡»è‡ªè¡Œæä¾›è¯¥å•ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨publicå…¬å¼€æˆ–è€…ä½¿ç”¨é™æ€æ–¹æ³•è¿”å›</li></ul><p>å•ä¾‹åˆ›å»ºæœ‰ä¸¤ç§æ–¹å¼ï¼šé¥¿æ±‰å¼å’Œæ‡’æ±‰å¼</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="é¥¿æ±‰å¼">é¥¿æ±‰å¼<a class="hash-link" href="#é¥¿æ±‰å¼" title="Direct link to heading">â€‹</a></h2><p>å•ä¾‹å¯¹è±¡çš„é¥¿æ±‰å¼åˆ›å»ºæŒ‡ç›´æ¥åˆ›å»ºå¯¹è±¡ï¼Œä¼˜ç‚¹æ˜¯ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œç¼ºç‚¹æ˜¯æ— è®ºå•ä¾‹æ˜¯å¦ä½¿ç”¨éƒ½ä¼šåˆ›å»º</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç›´æ¥å®ä¾‹åŒ–">ç›´æ¥å®ä¾‹åŒ–<a class="hash-link" href="#ç›´æ¥å®ä¾‹åŒ–" title="Direct link to heading">â€‹</a></h3><p>ç›´æ¥åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œä¸ç®¡æ˜¯å¦éœ€è¦è¿™ä¸ªå¯¹è±¡</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token plain"> INSTANCE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="æšä¸¾åˆ›å»º">æšä¸¾åˆ›å»º<a class="hash-link" href="#æšä¸¾åˆ›å»º" title="Direct link to heading">â€‹</a></h3><p>åˆ©ç”¨æšä¸¾ç±»çš„å¯¹è±¡æ˜¯æœ‰é™ä¸ªè¿™ä¸ªç‰¹æ€§ï¼Œåªæä¾›ä¸€ä¸ªå¯¹è±¡</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">EnumSingleton</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INSTANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="é™æ€ä»£ç å—åˆ›å»º">é™æ€ä»£ç å—åˆ›å»º<a class="hash-link" href="#é™æ€ä»£ç å—åˆ›å»º" title="Direct link to heading">â€‹</a></h3><p>å°†åˆ›å»ºå•ä¾‹çš„newè¯­å¥ç”±å­—æ®µåˆå§‹åŒ–æ¬åˆ°é™æ€ä»£ç å—ä¸­ï¼Œé€‚åˆå¤æ‚å®ä¾‹åŒ–å•ä¾‹ï¼Œæ¯”å¦‚å½“å¯¹è±¡åˆ›å»ºéœ€è¦ä»æ–‡ä»¶è¯»å–é…ç½®å¹¶è®¾ç½®</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">StaticSingleton</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">StaticSingleton</span><span class="token plain"> INSTANCE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// æ³¨æ„å»æ‰final</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> info</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Properties</span><span class="token plain"> pro </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Properties</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StaticSingleton</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getClassLoader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getResourceAsStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"config.properties"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            INSTANCE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">StaticSingleton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"info"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">IOException</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">printStackTrace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">StaticSingleton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> info</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> info</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>ä¸ºä»€ä¹ˆé¥¿æ±‰å¼æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</h5></div><div class="admonition-content"><p>ç±»åŠ è½½æœºåˆ¶çš„åˆå§‹åŒ–é˜¶æ®µï¼Œæ‰§è¡Œclinit()æ–¹æ³•æ—¶è™šæ‹Ÿæœºç¡®ä¿æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå³å¤šä¸ªçº¿ç¨‹æ‰§è¡Œclinit()æ–¹æ³•åªä¼šæœ‰ä¸€ä¸ªæ‰§è¡Œï¼Œå…¶ä»–è¢«é˜»å¡</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ‡’æ±‰å¼">æ‡’æ±‰å¼<a class="hash-link" href="#æ‡’æ±‰å¼" title="Direct link to heading">â€‹</a></h2><p>æ‡’æ±‰å¼æ˜¯åªæœ‰åœ¨ä½¿ç”¨åˆ°è¿™ä¸ªå•ä¾‹æ—¶æ‰åˆ›å»ºå¹¶è¿”å›ï¼Œå°½é‡å‡å°‘å†…å­˜å¼€é”€</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="åŸºæœ¬æ–¹å¼">åŸºæœ¬æ–¹å¼<a class="hash-link" href="#åŸºæœ¬æ–¹å¼" title="Direct link to heading">â€‹</a></h3><p>ä¸ºäº†å»¶è¿Ÿå•ä¾‹å¯¹è±¡çš„åˆ›å»ºï¼Œä¸åœ¨å•ä¾‹å˜é‡instanceå£°æ˜æ—¶å°±åˆå§‹åŒ–ï¼Œè€Œå°†instanceå£°æ˜ä¸ºprivateçš„ï¼Œç„¶åæŠŠåˆ›å»ºé€»è¾‘æŒªåˆ°å¦ä¸€ä¸ªé™æ€æ–¹æ³•getInstance()ä¸­ï¼Œè¯¥æ–¹æ³•åˆ¤æ–­instanceæ˜¯å¦ä¸ºnullï¼Œæ˜¯çš„è¯æ‰newåˆ›å»ºå¯¹è±¡ï¼Œå¦åˆ™è¯´æ˜å·²ç»åˆ›å»ºè¿‡å¯¹è±¡ï¼Œç›´æ¥è¿”å›ï¼Œå¦‚æ­¤ç¡®ä¿getInstance()æ–¹æ³•æ¯æ¬¡è¿”å›ç›¸åŒå¯¹è±¡ã€‚ç„¶è€Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä»¥ä¸‹ä»£ç æ˜¯ä¸å®‰å…¨çš„ï¼Œinstanceå¯èƒ½ä¼šè¢«åˆ›å»ºå¤šæ¬¡</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">çº¿ç¨‹ä¸å®‰å…¨çš„æ‡’æ±‰å¼å•ä¾‹åˆ›å»º</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token plain"> instance</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instance </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            instance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> instance</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> instance</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="çº¿ç¨‹å®‰å…¨æ–¹å¼">çº¿ç¨‹å®‰å…¨æ–¹å¼<a class="hash-link" href="#çº¿ç¨‹å®‰å…¨æ–¹å¼" title="Direct link to heading">â€‹</a></h3><p>ä¸ºäº†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åˆ›å»ºå•ä¾‹ï¼Œé¦–å…ˆä½¿ç”¨synchronizedå…³é”®å­—å°†getInstaceä¸­çš„ä»£ç å—åŒ…è£¹å¹¶è®¾ç½®åŒæ­¥å¯¹è±¡ä¸ºSingletonç±»ï¼Œä½†æ˜¯åœ¨åˆ›å»ºä¸€æ¬¡å•ä¾‹åï¼Œä»¥åæ¯æ¬¡è¿›å…¥åŒæ­¥å—å¸¦æ¥çš„å¼€é”€å°±æ˜¯å¤šä½™çš„ï¼Œå› æ­¤å†åŠ ä¸€å±‚ifåˆ¤æ–­é¿å…ä½¿ç”¨åŒæ­¥é”</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">ä½¿ç”¨DCLåˆ›å»ºå•ä¾‹</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// åˆ«å°‘äº†volatile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">volatile</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token plain"> instance</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instance </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Singleton</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instance </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    instance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Singleton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> instance</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è¿™ç§åˆ¤æ–­äº†2æ¬¡instanceæ˜¯å¦ä¸ºç©ºçš„æ–¹å¼ç§°ä¹‹ä¸º<strong>DCL(Double Check Lock)</strong>ã€‚è™½ç„¶synchronizedç¡®ä¿ä»£ç å—å†…çš„è¯­å¥è¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œï¼Œä½†æ˜¯new Singleton()åœ¨è™šæ‹Ÿæœºä¸­ä¼šè¢«æ‹†åˆ†ä¸ºå¤šæ¡æŒ‡ä»¤ï¼Œå†åŠ ä¸ŠæŒ‡ä»¤é‡æ’å°±ä¼šå¯¼è‡´é”™è¯¯ï¼Œä½¿ç”¨volatileå…³é”®å­—å¯ä»¥é¿å…æŒ‡ä»¤é‡æ’ï¼Œ<strong>æ³¨æ„åƒä¸‡ä¸èƒ½æ¼äº†volatileå…³é”®å­—</strong></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="é™æ€å†…éƒ¨ç±»">é™æ€å†…éƒ¨ç±»<a class="hash-link" href="#é™æ€å†…éƒ¨ç±»" title="Direct link to heading">â€‹</a></h3><p>ä½¿ç”¨synchronizedå…³é”®å­—çš„æ–¹å¼åˆ›å»ºå•ä¾‹ä»£ç å¤æ‚ï¼Œè¿˜å¯ä»¥ç”¨é™æ€å†…éƒ¨ç±»æ¥åˆ›å»ºå•ä¾‹ä»¥ç®€åŒ–ä»£ç ã€‚åˆ©ç”¨é™æ€å†…éƒ¨ç±»çš„ç‰¹æ€§ï¼š<strong>é™æ€å†…éƒ¨ç±»ä¸ä¼šéšå¤–éƒ¨ç±»çš„åŠ è½½å’Œåˆå§‹åŒ–è€ŒåŠ è½½ã€åˆå§‹åŒ–ï¼Œå½“ç”¨åˆ°å…¶æˆå‘˜æ—¶æ‰ä¼šåˆå§‹åŒ–</strong>ï¼Œå¹¶ä¸”æ˜¯åœ¨é™æ€å†…éƒ¨ç±»çš„clinitæ–¹æ³•æ‰§è¡Œåˆ›å»ºï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">InnerSingleton</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">InnerSingleton</span><span class="token plain"> instance</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">InnerSingleton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Inner</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">InnerSingleton</span><span class="token plain"> INSTANCE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">InnerSingleton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">InnerSingleton</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">Inner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">INSTANCE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>æ€»ç»“</h5></div><div class="admonition-content"><ol><li>é¥¿æ±‰å¼å•ä¾‹å˜é‡æ˜¯publicçš„ï¼Œæ‡’æ±‰å¼å•ä¾‹å˜é‡æ˜¯privateçš„</li><li>é¥¿æ±‰å¼å•ä¾‹åœ¨clinitæ–¹æ³•æ‰§è¡Œä¸­åˆ›å»ºï¼Œå› æ­¤çº¿ç¨‹å®‰å…¨ï¼Œè€Œæ‡’æ±‰å¼åŸºæœ¬æ–¹å¼åœ¨é™æ€æ–¹æ³•ä¸­åˆ›å»ºï¼Œçº¿ç¨‹ä¸å®‰å…¨</li><li>é¥¿æ±‰å¼ç”¨åˆ°çš„Javaç‰¹æ€§ï¼šæšä¸¾ï¼Œé™æ€ä»£ç å—ï¼›æ‡’æ±‰å¼ç”¨åˆ°çš„Javaç‰¹æ€§ï¼šsynchronizedã€volatileå…³é”®å­—ï¼Œé™æ€å†…éƒ¨ç±»</li><li>æ‡’æ±‰å¼è§£å†³çº¿ç¨‹ä¸å®‰å…¨çš„æ–¹å¼ï¼šæ˜¾å¼ä½¿ç”¨synchronizedå…³é”®å­—åŒæ­¥ï¼Œéšå¼ä½¿ç”¨é™æ€å†…éƒ¨ç±»åŒæ­¥</li></ol></div></div>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Singleton" term="Singleton"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[åŒäº²å§”æ´¾æœºåˆ¶ä»£ç è§£æ]]></title>
        <id>/2021/09/11/ParentsDelegationModel</id>
        <link href="https://kayhaw.github.io/blog/2021/09/11/ParentsDelegationModel"/>
        <updated>2021-09-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[åŒäº²å§”æ´¾æœºåˆ¶ä»£ç è§£æ]]></summary>
        <content type="html"><![CDATA[<p>åŒäº²å§”æ´¾æœºåˆ¶ä»£ç è§£æ</p><p>åŒäº²å§”æ´¾æœºåˆ¶</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token class-name">Class</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics operator" style="color:#393A34">?</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loadClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> resolve</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">ClassNotFoundException</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getClassLoadingLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// First, check if the class has already been loaded</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Class</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics operator" style="color:#393A34">?</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">findLoadedClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> t0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">nanoTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parent </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">loadClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">findBootstrapClassOrNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ClassNotFoundException</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// ClassNotFoundException thrown if class not found</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// from the non-null parent class loader</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// If still not found, then invoke findClass in order</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// to find the class.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> t1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">nanoTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">findClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// this is the defining class loader; record the stats</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name namespace" style="opacity:0.7">sun</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name namespace" style="opacity:0.7">misc</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name">PerfCounter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getParentDelegationTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t1 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> t0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name namespace" style="opacity:0.7">sun</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name namespace" style="opacity:0.7">misc</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name">PerfCounter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getFindClassTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addElapsedTimeFrom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name namespace" style="opacity:0.7">sun</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name namespace" style="opacity:0.7">misc</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name">PerfCounter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getFindClasses</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resolve</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">resolveClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Inorder Traversal" term="Inorder Traversal"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[äºŒå‰æ ‘ä¸­åºéå†çš„åº”ç”¨]]></title>
        <id>/2021/09/08/äºŒå‰æ ‘ä¸­åºéå†åº”ç”¨</id>
        <link href="https://kayhaw.github.io/blog/2021/09/08/äºŒå‰æ ‘ä¸­åºéå†åº”ç”¨"/>
        <updated>2021-09-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[äºŒå‰æ ‘ä¸­åºéå†çš„åº”ç”¨]]></summary>
        <content type="html"><![CDATA[<p>äºŒå‰æ ‘ä¸­åºéå†ç®—æ³•é¢˜ä¸­çš„å®é™…åº”ç”¨</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="éªŒè¯äºŒå‰æœç´¢æ ‘">éªŒè¯äºŒå‰æœç´¢æ ‘<a class="hash-link" href="#éªŒè¯äºŒå‰æœç´¢æ ‘" title="Direct link to heading">â€‹</a></h2><p>äºŒå‰æœç´¢æ ‘å®šä¹‰ä¸º</p><ul><li>èŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å«å°äºå½“å‰èŠ‚ç‚¹çš„æ•°</li><li>èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å«å¤§äºå½“å‰èŠ‚ç‚¹çš„æ•°</li><li>æ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘</li></ul><p>ç°åœ¨éœ€è¦<a href="https://leetcode-cn.com/problems/validate-binary-search-tree/" target="_blank" rel="noopener noreferrer">éªŒè¯äºŒå‰æœç´¢æ ‘</a>æ˜¯å¦æœ‰æ•ˆã€‚é¦–å…ˆä»å®šä¹‰ä¸Šå¾ˆæ˜æ˜¾å°±å¯ä»¥ç”¨é€’å½’æ–¹æ³•å»å®ç°ï¼Œä»£ç å¦‚ä¸‹</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isValidBST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isValidBST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Long</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MIN_VALUE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Long</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MAX_VALUE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isValidBST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> lower</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> upper</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> lower </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> upper</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isValidBST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lower</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isValidBST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> upper</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å¯¹äºéé€’å½’æ–¹å¼éªŒè¯ï¼Œåªéœ€è¦éœ€è¦ç‰¢è®°ä¸€ç‚¹ï¼š<strong>äºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†ç»“æœæ˜¯ä¸€ä¸ªé€’å¢æ•°ç»„</strong>ï¼Œå› æ­¤åœ¨ä¸­åºéå†è¿­ä»£æ–¹å¼ä»£ç çš„åŸºç¡€ä¸Šï¼Œå¼•å…¥ä¸€ä¸ªpreå˜é‡ä¿å­˜ä¸Šä¸€ä¸ªéå†èŠ‚ç‚¹çš„å€¼ï¼Œé€šè¿‡æ¯”è¾ƒå½“å‰éå†å…ƒç´ curå’Œpreçš„å¤§å°åˆ¤æ–­æ˜¯å¦ä¸ºäºŒå‰æ ‘ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isValidBST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> stack </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">TreeNode</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> pre </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token class-name">Double</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MAX_VALUE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pre</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pre </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>æ³¨æ„</h5></div><div class="admonition-content"><p>preçš„åˆå§‹å€¼å¿…é¡»ç¡®ä¿æ¯”å…ƒç´ ç±»å‹çš„æœ€å°å€¼è¿˜å°ï¼Œä¸€å¼€å§‹ç”¨çš„æ˜¯Integer.MIN_VALUEå¯¼è‡´ç»“æœé”™è¯¯ï¼ŒåŠ›æ‰£æœ‰ä¸ªæµ‹è¯•ç”¨ä¾‹å°±æ˜¯å•èŠ‚ç‚¹æ ‘ï¼Œå€¼ä¸º-2<sup>31</sup>(Integer.MIN_VALUE)</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="ä¸¤æ•°ä¹‹å’Œ">ä¸¤æ•°ä¹‹å’Œ<a class="hash-link" href="#ä¸¤æ•°ä¹‹å’Œ" title="Direct link to heading">â€‹</a></h2><p><a href="https://leetcode-cn.com/problems/two-sum-iv-input-is-a-bst/" target="_blank" rel="noopener noreferrer">é¢˜ç›®æè¿°</a>ï¼šç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘rootå’Œç›®æ ‡å€¼kï¼Œå¦‚æœBSTä¸­å­˜åœ¨ä¸¤ä¸ªå…ƒç´ ä¸”å®ƒä»¬çš„å’Œç­‰äºç»™å®šç›®æ ‡ç»“æœï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚äº†è§£äº†äºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†ç»“æœæ˜¯ä¸€ä¸ªé€’å¢æ•°ç»„è¿™ä¸ªç‰¹æ€§åï¼Œé—®é¢˜å°±è½¬æ¢ä¸ºæ±‚é€’å¢æ•°ç»„æ˜¯å¦å­˜åœ¨ä¸¤æ•°ä¹‹å’Œä¸ºç»™å®šç›®æ ‡å€¼ã€‚è¦è¯´è¿™ä¸ªå¯å¤ªç†Ÿäº†ï¼Œç”¨åŒæŒ‡é’ˆè§£å†³ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">findTarget</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> k</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> stack </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> list </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">TreeNode</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> sum</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        list</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> list</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> list</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> list</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sum </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> k</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sum </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> k</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>æ€»ç»“</h5></div><div class="admonition-content"><p>èƒŒä¸‹ä¸­åºéå†è¿­ä»£æ–¹å¼ä»£ç ï¼Œè¿™æ¬¡åšé¢˜æ—¶å°±å› ä¸ºæŠŠç¬¬ä¸€ä¸ªwhileå¾ªç¯ä¸­çš„<code>||</code> å†™æˆäº†<code>&amp;&amp;</code>å¯¼è‡´å‡ºé”™ï¼åˆ«ä¸€ä¸Šæ¥å°±æŠŠrootå‹å…¥æ ˆï¼Œè¿™ä¸æ˜¯å±‚åºéå†ï¼</p></div></div>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Inorder Traversal" term="Inorder Traversal"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç®—æ³•å¸¸ç”¨æ•°æ®ç»“æ„(1)-å•è°ƒæ ˆ]]></title>
        <id>/2021/09/07/OrderedStack</id>
        <link href="https://kayhaw.github.io/blog/2021/09/07/OrderedStack"/>
        <updated>2021-09-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[å•è°ƒæ ˆç›¸å…³ç®—æ³•é¢˜]]></summary>
        <content type="html"><![CDATA[<p>ç®—æ³•å¸¸ç”¨æ•°æ®ç»“æ„(1)-å•è°ƒæ ˆ</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="å®šä¹‰">å®šä¹‰<a class="hash-link" href="#å®šä¹‰" title="Direct link to heading">â€‹</a></h2><p>å•è°ƒæ ˆå°±æ˜¯å…ƒç´ å•è°ƒé€’å¢æˆ–é€’å‡çš„æ ˆã€‚ä»¥å•è°ƒé€’å¢æ ˆä¸ºä¾‹ï¼Œå¦‚æœå½“å‰å…¥æ ˆå…ƒç´ å¤§äºæ ˆé¡¶å…ƒç´ ï¼Œåˆ™è¿›è¡Œæ­£å¸¸å…¥æ ˆï¼Œå¦åˆ™å¾ªç¯å¼¹å‡ºæ ˆå†…å…ƒç´ ï¼Œç›´åˆ°æ ˆä¸ºç©ºæˆ–è€…æ ˆé¡¶å…ƒç´ å°äºå…¥æ ˆå…ƒç´ ï¼Œç„¶åå†æ­£å¸¸å…¥æ ˆ</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ç”¨ä¾‹">ç”¨ä¾‹<a class="hash-link" href="#ç”¨ä¾‹" title="Direct link to heading">â€‹</a></h2><p>ä¸‹é¢ä»‹ç»å‡ ç§å•è°ƒæ ˆçš„ç”¨ä¾‹</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº">ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº<a class="hash-link" href="#ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº" title="Direct link to heading">â€‹</a></h3><p>å…ˆçœ‹ä¸€é“ç®€å•çš„ç®—æ³•é¢˜ï¼š<a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock/" target="_blank" rel="noopener noreferrer">ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</a>ï¼ŒåŸé¢˜æè¿°å¦‚ä¸‹ï¼š</p><blockquote><p>ç»™å®šä¸€ä¸ªæ•°ç»„pricesï¼Œå®ƒçš„ç¬¬iä¸ªå…ƒç´ prices<!-- -->[i]<!-- -->è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬iå¤©çš„ä»·æ ¼ã€‚ä½ åªèƒ½é€‰æ‹©æŸä¸€å¤©ä¹°å…¥è¿™åªè‚¡ç¥¨ï¼Œå¹¶é€‰æ‹©åœ¨æœªæ¥çš„æŸä¸€ä¸ªä¸åŒçš„æ—¥å­å–å‡ºè¯¥è‚¡ç¥¨ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚è¿”å›ä½ å¯ä»¥ä»è¿™ç¬”äº¤æ˜“ä¸­è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚å¦‚æœä½ ä¸èƒ½è·å–ä»»ä½•åˆ©æ¶¦ï¼Œè¿”å›0ã€‚æ¯”å¦‚è¾“å…¥æ•°ç»„ä¸º<!-- -->[7,1,5,3,6,4]<!-- -->ï¼Œè¾“å‡ºæœ€å¤§åˆ©æ¶¦5</p></blockquote><p>ä½¿ç”¨å•è°ƒæ ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„åŸºæœ¬æ€è·¯ï¼šç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å¢æ ˆï¼Œéå†pricesæ•°ç»„å°†å…¶å…ƒç´ prices<!-- -->[i]<!-- -->å‹å…¥è¯¥å•è°ƒæ ˆï¼Œç„¶åæ ˆé¡¶å…ƒç´ å‡å»æ ˆåº•å…ƒç´ å¾—åˆ°ç›®å‰å¯è·å¾—çš„æœ€å¤§åˆ©æ¶¦ï¼Œå–æ‰€æœ‰è½®åˆ©æ¶¦çš„æœ€å¤§å€¼å³ä¸ºæ‰€æ±‚ç­”æ¡ˆï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">maxProfit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> prices</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> stack </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> maxProfit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> price </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> prices</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> price </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">peek</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">price</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxProfit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">maxProfit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getFirst</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> maxProfit</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>æç¤º</h5></div><div class="admonition-content"><ol><li>äº‹å…ˆæŠŠç¬¬ä¸€å¤©ä»·æ ¼ç›´æ¥å‹å…¥æ ˆ</li><li>whileå¾ªç¯è¦è¿›è¡Œæ ˆçš„éç©ºåˆ¤æ–­ï¼Œå¦åˆ™å½“å‰æ˜¯å†å²æœ€ä½ä»·çš„è¯ï¼Œpeekæ–¹æ³•è¿”å›nullå’Œpriceæ¯”è¾ƒ</li></ol></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºii">ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºII<a class="hash-link" href="#ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºii" title="Direct link to heading">â€‹</a></h3><p>è¿›é˜¶ä¸€ä¸‹ï¼Œ<a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii/" target="_blank" rel="noopener noreferrer">ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºII</a>ï¼ŒåŸé¢˜æè¿°å¦‚ä¸‹ï¼š</p><blockquote><p>ç»™å®šä¸€ä¸ªæ•°ç»„pricesï¼Œå…¶ä¸­prices<!-- -->[i]<!-- -->æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬iå¤©çš„ä»·æ ¼ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ å¯ä»¥å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰ã€‚æ³¨æ„ï¼šä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚</p></blockquote>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="OrderedStack" term="OrderedStack"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[äºŒå‰æ ‘åŸºæœ¬ç®—æ³•]]></title>
        <id>/2021/09/06/BiTreeBasicAlgorithms</id>
        <link href="https://kayhaw.github.io/blog/2021/09/06/BiTreeBasicAlgorithms"/>
        <updated>2021-09-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[äºŒå‰æ ‘åŸºæœ¬ç®—æ³•]]></summary>
        <content type="html"><![CDATA[<p>å­¦å®Œäº†äºŒå‰æ ‘åŸºç¡€çš„éå†æ“ä½œï¼Œå†è®°å½•ä¸‹å…¶ä»–äºŒå‰æ ‘ç›¸å…³çš„åŸºæœ¬ç®—æ³•</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦">äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦<a class="hash-link" href="#äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦" title="Direct link to heading">â€‹</a></h2><p><a href="https://leetcode-cn.com/problems/maximum-depth-of-binary-tree/" target="_blank" rel="noopener noreferrer">äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</a>æ˜¯æŒ‡ä»æ ¹èŠ‚ç‚¹åˆ°<strong>æœ€è¿œå¶å­èŠ‚ç‚¹</strong>ä¸Šçš„èŠ‚ç‚¹æ•°</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="é€’å½’æ–¹å¼">é€’å½’æ–¹å¼<a class="hash-link" href="#é€’å½’æ–¹å¼" title="Direct link to heading">â€‹</a></h3><p>åŸºäºè¿™ä¹ˆä¸€ä¸ªåŸºæœ¬æ€è·¯ï¼šä¸€æ£µäºŒå‰æ ‘æœ€å¤§æ·±åº¦ç­‰äºå®ƒå·¦å³å­æ ‘æœ€å¤§æ·±åº¦çš„è¾ƒå¤§å€¼åŠ 1ã€‚ç„¶åè¦ç¡®è®¤é€’å½’ç»ˆæ­¢æ¡ä»¶ï¼Œå°±æ˜¯æœ€ç®€å•ç©ºæ ‘ï¼Œæ­¤æ—¶è¿”å›æ·±åº¦ä¸º0ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">maxDepth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// æ³¨æ„è¿™é‡Œä¸è¦å†™æˆ1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">maxDepth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">maxDepth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="éé€’å½’æ–¹å¼">éé€’å½’æ–¹å¼<a class="hash-link" href="#éé€’å½’æ–¹å¼" title="Direct link to heading">â€‹</a></h3><p>è¿™é‡Œå°±è¦ç”¨åˆ°ä¹‹å‰æ€»ç»“çš„äºŒå‰æ ‘å±‚åºéå†æ€è·¯ï¼Œå› ä¸ºäºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦å°±æ˜¯å…¶å±‚åºéå†æ—¶çš„æœ€å¤§å±‚æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">maxDepth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// æ°¸è¿œä¸è¦å¿˜è®°å¤„ç†ç©ºæ ‘æƒ…å†µ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Queue</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> queue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">TreeNode</span><span class="token plain"> tmp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> maxDepth </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxDepth</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> len</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tmp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">poll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> maxDepth</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="å¯¹ç§°äºŒå‰æ ‘">å¯¹ç§°äºŒå‰æ ‘<a class="hash-link" href="#å¯¹ç§°äºŒå‰æ ‘" title="Direct link to heading">â€‹</a></h2><p>å½“ä¸€ä¸ªäºŒå‰æ ‘æ˜¯é•œåƒå¯¹ç§°çš„ç§°ä¹‹ä¸ºå¯¹ç§°äºŒå‰æ ‘ï¼Œæ¯”å¦‚</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   / \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2   2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> / \ / \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3  4 4  3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="é€’å½’æ–¹å¼-1">é€’å½’æ–¹å¼<a class="hash-link" href="#é€’å½’æ–¹å¼-1" title="Direct link to heading">â€‹</a></h3><p>å¯¹äºä¸€é¢—äºŒå‰æ ‘çš„å·¦å³å­æ ‘ï¼Œå½“å·¦å³å­æ ‘æ ¹èŠ‚ç‚¹çš„å€¼ç›¸åŒï¼Œå¹¶ä¸”å·¦å³å­æ ‘é•œåƒå¯¹ç§°æ—¶ï¼Œè¯¥æ ‘æ˜¯å¯¹ç§°çš„ã€‚å·¦å³å­æ ‘é•œåƒå¯¹ç§°çš„æ¡ä»¶ï¼š</p><ul><li>å·¦å­æ ‘çš„å³å­æ ‘ä¸å³å­æ ‘çš„å·¦å­æ ‘å¯¹ç§°</li><li>å³å­æ ‘çš„å·¦å­æ ‘ä¸å·¦å­æ ‘çš„å³å­æ ‘å¯¹ç§°</li></ul><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isSymmetric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">check</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">check</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">TreeNode</span><span class="token plain"> q</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> q </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> q </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> q</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">check</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> q</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">check</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> q</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="è¿­ä»£æ–¹å¼">è¿­ä»£æ–¹å¼<a class="hash-link" href="#è¿­ä»£æ–¹å¼" title="Direct link to heading">â€‹</a></h3><p>ä¸éš¾å‘ç°å¯¹ç§°äºŒå‰æ ‘å±‚åºéå†æ—¶çš„ç»“æœæ˜¯å›æ–‡çš„ã€‚ä¸ºäº†ç®€åŒ–åˆ¤æ–­ï¼Œåœ¨å±‚åºéå†ç»™é˜Ÿåˆ—æ·»åŠ å·¦å³å­èŠ‚ç‚¹æ—¶ï¼ŒæŒ‰ç…§left.leftã€right.rightã€left.rightã€right.leftçš„é¡ºåºæ’å…¥ï¼Œè¿™æ ·ä¸¤ä¸¤ä¸€å¯¹çš„èŠ‚ç‚¹å€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">check</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">TreeNode</span><span class="token plain"> q</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Queue</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> queue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">q</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">TreeNode</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">poll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">TreeNode</span><span class="token plain"> u </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">poll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> u </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// return true;         ä¸€å¼€å§‹ç›´æ¥returnï¼Œé”™è¯¯ï¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> u </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> u</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">u</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">u</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isSymmetric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">check</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>æç¤º</h5></div><div class="admonition-content"><p>è¿˜å¯ä»¥é€šè¿‡ä¸­åºéå†ç»“æœæ˜¯å¦å›æ–‡æ¥åˆ¤æ–­</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="ç¿»è½¬äºŒå‰æ ‘">ç¿»è½¬äºŒå‰æ ‘<a class="hash-link" href="#ç¿»è½¬äºŒå‰æ ‘" title="Direct link to heading">â€‹</a></h2><p>ç®€å•æ¥è¯´å°±æ˜¯æŠŠäºŒå‰æ ‘çš„å·¦å³å­æ ‘éƒ½å¯¹è°ƒä¸€ä¸‹</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="é€’å½’æ–¹å¼-2">é€’å½’æ–¹å¼<a class="hash-link" href="#é€’å½’æ–¹å¼-2" title="Direct link to heading">â€‹</a></h3><p>é¦–å…ˆé€’å½’ç»ˆæ­¢æ¡ä»¶æ˜¯ä¼ å…¥æ ¹èŠ‚ç‚¹å‚æ•°ä¸ºnullï¼Œæ­¤æ—¶è¿”å›nullï¼Œå…¶ä»–æƒ…å†µå°±å¯¹å·¦å³å­æ ‘é€’å½’è°ƒç”¨æ–¹æ³•è¿›è¡Œç¿»è½¬ï¼Œæœ€åæŠŠå·¦å³å­æ ‘äº¤æ¢ä¸€ä¸‹</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">TreeNode</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">invertTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">TreeNode</span><span class="token plain"> left </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">invertTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">TreeNode</span><span class="token plain"> right </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">invertTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> right</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> left</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="è¿­ä»£æ–¹å¼-1">è¿­ä»£æ–¹å¼<a class="hash-link" href="#è¿­ä»£æ–¹å¼-1" title="Direct link to heading">â€‹</a></h3><p>è¿˜æ˜¯ä½¿ç”¨å±‚åºéå†ï¼Œæ¯æ¬¡å–å‡ºä¸€ä¸ªèŠ‚ç‚¹äº¤æ¢å…¶å·¦å³å­èŠ‚ç‚¹ã€‚è¿™é‡Œä¸éœ€è¦ç»Ÿè®¡å±‚æ•°ï¼Œæ‰€ä»¥æ²¡æœ‰ç”¨forå¾ªç¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">TreeNode</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">invertTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Queue</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> queue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">TreeNode</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">poll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tmp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ç¡®ä¿é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹éƒ½æ˜¯énull</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>æ€»ç»“</h5></div><div class="admonition-content"><p>æ¯ä¸€ç§ç®—æ³•çš„éé€’å½’å®ç°éƒ½ç”¨åˆ°äº†å±‚åºéå†çš„è¿­ä»£å®ç°ï¼Œè¯´æ˜è¿™å¥—ä»£ç æ¨¡æ¿è¦çœŸçš„åˆ»åœ¨éª¨å­é‡Œå•Šï¼Œæ€è€ƒè¿™ä¹ˆå‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>è¦ä¸è¦åœ¨whileå¾ªç¯ä¸­ä½¿ç”¨forå¾ªç¯ï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Ÿ</li><li>è¦ä¸è¦æŠŠnullä¹Ÿæ’å…¥é˜Ÿåˆ—ä¸­ï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Ÿ</li></ul></div></div>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="BiTree" term="BiTree"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[äºŒå‰æ ‘éå†]]></title>
        <id>/2021/09/04/BiTreeTraversal</id>
        <link href="https://kayhaw.github.io/blog/2021/09/04/BiTreeTraversal"/>
        <updated>2021-09-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[äºŒå‰æ ‘å‰ã€ä¸­ã€åã€å±‚åºéå†]]></summary>
        <content type="html"><![CDATA[<p>äºŒå‰æ ‘çš„4ç§éå†æ–¹å¼ï¼Œå°†éå†ç»“æœä»¥åˆ—è¡¨å½¢å¼è¿”å›</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="å‰åºéå†">å‰åºéå†<a class="hash-link" href="#å‰åºéå†" title="Direct link to heading">â€‹</a></h2><p>æŒ‰ç…§è®¿é—®æ ¹èŠ‚ç‚¹-å·¦å­æ ‘-å³å­æ ‘çš„é¡ºåºéå†äºŒå‰æ ‘</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="é€’å½’æ–¹å¼">é€’å½’æ–¹å¼<a class="hash-link" href="#é€’å½’æ–¹å¼" title="Direct link to heading">â€‹</a></h3><p>é€’å½’æ–¹æ³•æµç¨‹</p><ol><li>å…ˆåˆ¤æ–­rootæ˜¯å¦ä¸ºnullï¼Œæ˜¯åˆ™ç›´æ¥è¿”å›</li><li>rootæ·»åŠ åˆ°ç»“æœåˆ—è¡¨res</li><li>é€’å½’è°ƒç”¨preorderæ–¹æ³•ï¼Œå°†<strong>å·¦</strong>èŠ‚ç‚¹ã€resä½œä¸ºå‚æ•°</li><li>é€’å½’è°ƒç”¨preorderæ–¹æ³•ï¼Œå°†<strong>å³</strong>èŠ‚ç‚¹ã€resä½œä¸ºå‚æ•°
æ³¨æ„é€’å½’æ–¹æ³•éœ€è¦æŠŠç»“æœåˆ—è¡¨resä½œä¸ºå‚æ•°å¸¦ä¸Šï¼Œå¹¶ä¸”reså¿…é¡»ä½œä¸ºå¼•ç”¨ä¼ å…¥ï¼Œè€Œä¸æ˜¯å¤åˆ¶å€¼</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Solution</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">preorderTraversal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">preorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">preorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">preorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">preorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="è¿­ä»£æ–¹å¼">è¿­ä»£æ–¹å¼<a class="hash-link" href="#è¿­ä»£æ–¹å¼" title="Direct link to heading">â€‹</a></h3><p>æœ¬è´¨ä¸Šè‡ªå·±ä½¿ç”¨æ ˆé‡æ–°èµ°ä¸€éé€’å½’æ–¹æ³•</p><ol><li>å½“æ ˆä¸ä¸ºç©º<strong>æˆ–è€…</strong>å½“å‰è¾¾åˆ°èŠ‚ç‚¹nodeä¸ä¸ºnullæ—¶</li><li>å½“nodeä¸ä¸ºç©ºæ—¶ï¼Œä¸€ç›´å¾€å·¦å­èŠ‚ç‚¹èµ°åˆ°åº•ï¼Œæ¯èµ°ä¸€æ­¥å°±æŠŠnodeä¿å­˜åˆ°resåˆ—è¡¨ï¼Œå¹¶ä¸”å‹å…¥æ ˆ</li><li>nodeä¸ºç©ºè¡¨ç¤ºå·²ç»èµ°åˆ°äº†æŸæ£µå­æ ‘çš„æœ€å·¦èŠ‚ç‚¹ï¼Œå°†è¯¥å­æ ‘çš„rootèŠ‚ç‚¹ä»æ ˆä¸­å¼¹å‡ºï¼Œç„¶åè®¿é—®è¯¥å­æ ‘çš„å³å­æ ‘ï¼Œå›åˆ°æ­¥éª¤1</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Solution</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">preorderTraversal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> stack </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">TreeNode</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="ä¸­åºéå†">ä¸­åºéå†<a class="hash-link" href="#ä¸­åºéå†" title="Direct link to heading">â€‹</a></h2><p>æŒ‰ç…§è®¿é—®å·¦å­æ ‘-æ ¹èŠ‚ç‚¹-å³å­æ ‘çš„é¡ºåºéå†äºŒå‰æ ‘</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="é€’å½’æ–¹å¼-1">é€’å½’æ–¹å¼<a class="hash-link" href="#é€’å½’æ–¹å¼-1" title="Direct link to heading">â€‹</a></h3><p>æ ¹æ®è®¿é—®é¡ºåºé€»è¾‘ä¿®æ”¹ä»£ç ï¼ŒæŠŠåŠ å…¥resåˆ—è¡¨çš„é‚£ä¸€è¡Œä»£ç æŒªåˆ°é€’å½’è®¿é—®å·¦ã€å³å­æ ‘çš„ä¸­é—´å³å¯</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Solution</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">inorderTraversal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">preorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">preorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// res.add(root.val);     è¿™æ˜¯å‰åºéå†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">preorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™æ˜¯ä¸­åºéå†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">preorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="è¿­ä»£æ–¹å¼-1">è¿­ä»£æ–¹å¼<a class="hash-link" href="#è¿­ä»£æ–¹å¼-1" title="Direct link to heading">â€‹</a></h3><p>åœ¨å‰åºéå†è¿­ä»£æ–¹å¼çš„åŸºç¡€ä¸Šä¿®æ”¹ä¹Ÿå¾ˆç®€å•ï¼Œå½“èµ°å®ŒæŸæ£µå­æ ‘çš„å·¦å­æ ‘åï¼Œä»æ ˆä¸­å¼¹å‡ºçš„rootèŠ‚ç‚¹å°±æ˜¯è¦è®¿é—®çš„èŠ‚ç‚¹ï¼Œå°†å…¶åŠ å…¥resåˆ—è¡¨å³å¯</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Solution</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">inorderTraversal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> stack </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">TreeNode</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// res.add(node.val);   // è¿™æ˜¯å‰åºéå†çš„ä½ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™æ˜¯ä¸­åºéå†çš„ä½ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="ååºéå†">ååºéå†<a class="hash-link" href="#ååºéå†" title="Direct link to heading">â€‹</a></h2><p>æŒ‰ç…§è®¿é—®å·¦å­æ ‘-å³å­æ ‘-æ ¹èŠ‚ç‚¹çš„é¡ºåºéå†äºŒå‰æ ‘</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="é€’å½’æ–¹å¼-2">é€’å½’æ–¹å¼<a class="hash-link" href="#é€’å½’æ–¹å¼-2" title="Direct link to heading">â€‹</a></h3><p>æ ¹æ®è®¿é—®é¡ºåºé€»è¾‘ä¿®æ”¹ä»£ç ï¼ŒæŠŠåŠ å…¥resåˆ—è¡¨çš„é‚£ä¸€è¡Œä»£ç æŒªåˆ°é€’å½’è®¿é—®å·¦ã€å³å­æ ‘çš„ä¸­é—´å³å¯</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Solution</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">inorderTraversal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">preorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">preorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// res.add(root.val);     è¿™æ˜¯å‰åºéå†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">preorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// res.add(root.val);     è¿™æ˜¯ä¸­åºéå†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">preorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™æ˜¯ååºéå†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="è¿­ä»£æ–¹å¼-2">è¿­ä»£æ–¹å¼<a class="hash-link" href="#è¿­ä»£æ–¹å¼-2" title="Direct link to heading">â€‹</a></h3><p>ååºéå†çš„è¿­ä»£æ–¹å¼å¯ä¸æ˜¯åƒä¹‹å‰é‚£æ ·æŠŠè®¿é—®ä»£ç æŒªåˆ°æœ€åã€‚ç›¸æ¯”ä¸å‰åºã€ä¸­åºéå†ï¼Œååºéå†è¦æ±‚è®¿é—®å®Œå·¦å³å­æ ‘åè®¿é—®rootèŠ‚ç‚¹ï¼Œåœ¨è¿­ä»£æ–¹å¼ä¸­ï¼Œæ ˆå¼¹å‡ºrootèŠ‚ç‚¹åï¼Œå¹¶ä¸èƒ½ç¡®å®šè¿™ä¸ªrootèŠ‚ç‚¹çš„å³å­æ ‘æ˜¯ä¸æ˜¯è¢«è®¿é—®å®Œäº†ï¼Œæ­¤æ—¶å¯ä»¥ç»†åˆ†ä¸º3ç§æƒ…å†µï¼š</p><ol><li>root.rightä¸ºç©ºï¼Œç›´æ¥å°†rootèŠ‚ç‚¹æ·»åŠ åˆ°resåˆ—è¡¨</li><li>root.rightä¸ä¸ºç©ºï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»ä»å³å­æ ‘è®¿é—®å›æ¥äº†ï¼Œæ­¤æ—¶ä¹Ÿå°†rootèŠ‚ç‚¹æ·»åŠ åˆ°resåˆ—è¡¨</li><li>root.rightä¸ä¸ºç©ºï¼Œå¹¶ä¸”è¿˜æ²¡æœ‰è®¿é—®è¿‡å³å­æ ‘ï¼Œæ­¤æ—¶rootå…¥æ ˆç„¶åè®¿é—®å³å­æ ‘
ä¸ºäº†åˆ¤æ–­æ˜¯å¦å·²ç»ä»å³å­æ ‘è®¿é—®å›æ¥ï¼Œä½¿ç”¨prevè¡¨ç¤ºä¸Šæ¬¡ä¸€éå†å®Œå­æ ‘çš„rootèŠ‚ç‚¹ã€‚</li></ol><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Solution</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">postorderTraversal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Deque</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> stack </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">TreeNode</span><span class="token plain"> prev </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                root </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            root </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// å·¦å­æ ‘éå†å®Œï¼Œå¼¹å‡ºæ ¹èŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> prev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                prev </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                root </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// rootå·¦å³å­æ ‘éå†å®Œï¼Œç½®ä¸ºnullårootä¼šæˆä¸ºå…¶ä¸Šä¸€å±‚æ ¹èŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">// éå†å³å­æ ‘ï¼Œæ³¨æ„rootèŠ‚ç‚¹é‡æ–°å…¥æ ˆ</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                root </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>ååºéå†è¿˜æœ‰ä¸€ç§å€Ÿé‰´ä¸¤æ¬¡ç¿»è½¬æ€æƒ³çš„æ–¹å¼ï¼Œä»¥å‰åºéå†è¿­ä»£ä¸ºåŸºç¡€è¿›è¡Œé•œåƒç¿»è½¬ï¼Œå³è®¿é—®é¡ºåºä¸ºæ ¹èŠ‚ç‚¹-å³å­æ ‘-å·¦å­æ ‘ï¼Œå°†è¿”å›ç»“æœå†ä¸€æ¬¡ç¿»è½¬å³ä¸ºååºéå†çš„è®¿é—®ç»“æœï¼Œè™½ç„¶ç»“æœä¸€æ ·ä½†æ˜¯æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ç§å‰åºéå†</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="å±‚åºéå†">å±‚åºéå†<a class="hash-link" href="#å±‚åºéå†" title="Direct link to heading">â€‹</a></h2><p>å±‚åºéå†æŒ‰ç…§æ¯ä¸€å±‚ä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹éå†å¹¶è¿”å›ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæœ¬è´¨æ€æƒ³æ˜¯ä½¿ç”¨é˜Ÿåˆ—è¿›è¡Œå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œæ¯æ¬¡ä»é˜Ÿåˆ—å–å‡ºä¸€ä¸ªèŠ‚ç‚¹åï¼Œå°†å…¶éç©ºå·¦å³å­èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—ã€‚ä¸ºäº†åŒºåˆ†å±‚ä¸å±‚ï¼Œä¸€å¼€å§‹æ·»åŠ ä¸€ä¸ªé¢å¤–nullèŠ‚ç‚¹ä½œä¸ºæ ‡è¯†</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">levelOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Queue</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> queue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> level </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">peek</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">TreeNode</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">poll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">poll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">// åˆ é™¤nullæ ‡å¿—ç„¶åé˜Ÿå°¾é‡æ–°åŠ ä¸Š</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸€å¼€å§‹ç›´æ¥é‡æ–°æ’å…¥nullå¯¼è‡´æ­»å¾ªç¯</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">level</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä¸€ç§æ›´ç®€æ´çš„æ–¹å¼æ˜¯éå†ä¹‹å‰ä½¿ç”¨å½“å‰é˜Ÿåˆ—é•¿åº¦ï¼Œ<strong>æ³¨æ„ä¸èƒ½ä½¿ç”¨isEmptyæ¥åˆ¤æ–­æ˜¯å¦å±‚åºéå†å®Œï¼Œå› ä¸ºéå†è¿‡ç¨‹ä¸­ä¼šæ·»åŠ ä¸‹ä¸€å±‚èŠ‚ç‚¹</strong></p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">levelOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TreeNode</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Queue</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TreeNode</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> queue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> levelSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Integer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> level </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">levelSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> levelSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">TreeNode</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">poll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            level</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">offer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">level</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>æ€»ç»“</h5></div><div class="admonition-content"><p>äºŒå‰æ ‘å‰ã€ä¸­ã€ååºé€’å½’éå†å¾ˆç®€å•ï¼Œä¸»è¦æ˜¯è¦è®°ä½è¿­ä»£éå†æ€è·¯ã€‚å‰ã€ä¸­åºè¿­ä»£éå†åªæ˜¯è®¿é—®ä»£ç æŒªäº†ä¸‹ä½ç½®ï¼Œååºè¿­ä»£éå†ä¼šæ›´å¤æ‚äº›ï¼Œç†æ¸…æ€è·¯åè¦æŠŠè¿™äº›ä»£ç æ¨¡æ¿éƒ½åˆ»åœ¨éª¨å­é‡Œï¼Œä»¥ä¸‹æ˜¯åŠ›æ‰£é¢˜ç›®åœ°å€ï¼Œè¦æ±‚åƒèƒŒä¹¦ä¸€æ ·é©¬ä¸Šå†™å‡ºæ¥ğŸ‘Š</p><ul><li><a href="https://leetcode-cn.com/problems/binary-tree-preorder-traversal/" target="_blank" rel="noopener noreferrer">å‰åºéå†</a></li><li><a href="https://leetcode-cn.com/problems/binary-tree-inorder-traversal/" target="_blank" rel="noopener noreferrer">ä¸­åºéå†</a></li><li><a href="https://leetcode-cn.com/problems/binary-tree-postorder-traversal/" target="_blank" rel="noopener noreferrer">ååºéå†</a></li><li><a href="https://leetcode-cn.com/problems/binary-tree-level-order-traversal/" target="_blank" rel="noopener noreferrer">å±‚åºéå†</a></li></ul></div></div>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="BiTree" term="BiTree"/>
        <category label="Traversal" term="Traversal"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring Bootå­¦ä¹ (1)]]></title>
        <id>/2021/08/01/SpringBootå‚æ•°æ³¨è§£</id>
        <link href="https://kayhaw.github.io/blog/2021/08/01/SpringBootå‚æ•°æ³¨è§£"/>
        <updated>2021-08-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Spring Bootå¸¸ç”¨å‚æ•°æ³¨è§£ä½¿ç”¨]]></summary>
        <content type="html"><![CDATA[<p>ä¸Šæ‰‹Spring Bootå¾ˆç®€å•ï¼Œå†™å¥½ç±»æ‰“ä¸Š@Controllerã€@Serviceæ³¨è§£ï¼Œå‰è€…å†ç”¨@AutowireæŠŠåè€…å¯¼å…¥ï¼Œç„¶ååªåœ¨Serviceç±»ä¸­å†™ä¸šåŠ¡é€»è¾‘ä»£ç å³å¯ã€‚ä¸ºäº†æ–¹ä¾¿è·å–å‰ç«¯å‚æ•°å¹¶ç®€åŒ–ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Controlleræ–¹æ³•å½¢å‚åˆ—è¡¨ä¸­åŠ ä¸Šå‚æ•°æ³¨è§£ï¼Œè®©Spring Bootè‡ªåŠ¨æŠŠå‰ç«¯å‚æ•°å°è£…æˆå¯¹åº”çš„å¯¹è±¡ã€‚é‚£ä¹ˆï¼ŒSpring Bootæä¾›çš„å¸¸ç”¨å‚æ•°æ³¨è§£æœ‰å“ªäº›å‘¢ï¼Ÿ</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="pathvariableè·å–è·¯å¾„å˜é‡">@PathVariableï¼šè·å–è·¯å¾„å˜é‡<a class="hash-link" href="#pathvariableè·å–è·¯å¾„å˜é‡" title="Direct link to heading">â€‹</a></h2><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@GetMapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/car/{id}/owner/{username}"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getCar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@PathVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"id"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@PathVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"username"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@PathVariable</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> kv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>æœ¬åœ°æµ‹è¯•æ—¶ï¼Œæµè§ˆå™¨è¾“å…¥åœ°å€ä¸º<code>localhost:8080/car/123/owner/kayhaw</code>ï¼Œæ­¤æ—¶åœ¨getCaræ–¹æ³•ä¸­å¾—åˆ°å‚æ•°idå€¼ä¸º123ï¼Œnameå€¼ä¸ºkayhawã€‚å…¶ä¸­ï¼Œè·¯å¾„å˜é‡çš„åç§°æ˜¾ç¤ºæŒ‡å®šä¸º<code>id</code>å’Œ<code>username</code>ï¼Œ<strong>è‹¥ä¸æ˜¾ç¤ºæŒ‡å®šåˆ™è·¯å¾„å˜é‡åç­‰äºæ–¹æ³•å½¢å‚å</strong>ï¼Œåœ¨å¼€å‘ä¸­éœ€è¦æ³¨æ„@GetMappingæ³¨è§£çš„è·¯å¾„å˜é‡å ä½ç¬¦åè¦å’Œè·¯å¾„å˜é‡åä¿æŒä¸€è‡´ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨@PathVariableæ³¨è§£ç±»çš„æºç æ³¨é‡Šä¸­æåˆ°</p><blockquote><p>If the method parameter is java.util.Map Map<!-- -->&lt;<!-- -->String, String<!-- -->&gt;<!-- --> then the map is populated with all path variable names and values.</p></blockquote><p>å› æ­¤å¯ä»¥ä½¿ç”¨ä¸€ä¸ªMapå¯¹è±¡æ¥å­˜å‚¨æ‰€æœ‰è·¯å¾„å˜é‡ååŠå…¶å€¼ï¼Œæ­¤æ—¶mapå¯¹è±¡çš„keyå€¼æ˜¯@GetMappingä¸­è·¯å¾„å˜é‡å ä½ç¬¦çš„åç§°</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="requestheaderè·å–è¯·æ±‚å¤´">@RequestHeaderï¼šè·å–è¯·æ±‚å¤´ã€‚<a class="hash-link" href="#requestheaderè·å–è¯·æ±‚å¤´" title="Direct link to heading">â€‹</a></h2><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@GetMapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/car/{id}/owner/{username}"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getCar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@RequestHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"User-Agent"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token class-name">Pragma</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@RequestHeader</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> header</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@RequestHeader</span><span class="token plain"> </span><span class="token class-name">HttpHeaders</span><span class="token plain"> headers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä½¿ç”¨æ–¹æ³•å’Œ@PathVariableç±»ä¼¼ï¼Œæ— è¯·æ±‚å¤´å‚æ•°åé»˜è®¤ä¸ºæ–¹æ³•å½¢å‚åã€‚åŒæ—¶ï¼Œåœ¨@RequestHeaderæºç ä¸­ä¹Ÿæåˆ°</p><blockquote><p>If the method parameter is java.util.Map Map<!-- -->&lt;<!-- -->String, String<!-- -->&gt;<!-- -->, org.springframework.util.MultiValueMap MultiValueMap<!-- -->&lt;<!-- -->String, String<!-- -->&gt;<!-- -->, or org.springframework.http.HttpHeaders HttpHeaders then the map is populated with all header names and values.</p></blockquote><p>å› æ­¤å¯ä»¥å°†æ–¹æ³•å½¢å‚ç±»å‹è®¾ç½®ä¸ºMapæˆ–HttpHeaderså¯¹è±¡æ¥ä¸€æ¬¡æ€§è·å–è¯·æ±‚å¤´æ‰€æœ‰ä¿¡æ¯</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="requestparamè·å–è¯·æ±‚å‚æ•°">@RequestParamï¼šè·å–è¯·æ±‚å‚æ•°<a class="hash-link" href="#requestparamè·å–è¯·æ±‚å‚æ•°" title="Direct link to heading">â€‹</a></h2><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@GetMapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/car/{id}/owner/{username}"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getCar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@RequestParam</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"age"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">Integer</span><span class="token plain"> age</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@RequestParam</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"inters"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> inters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@RequestParam</span><span class="token plain"> </span><span class="token class-name">MultiValueMap</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>æœ¬åœ°æµ‹è¯•åœ¨æµè§ˆå™¨è¾“å…¥åœ°å€ä¸º<code>localhost:8080/car/123/owner/kayhaw?age=17&amp;inters=123,3121</code>ï¼Œæ­¤æ—¶è·å–ageå€¼ä¸º17ï¼Œintersåˆ—è¡¨ä¸º<!-- -->[123, 3121]<!-- -->ã€‚åŒæ ·åœ°ï¼Œåœ¨@RequestParamæºç æ³¨é‡Šä¸­æåˆ°</p><blockquote><p>If the method parameter is <code>java.util.Map Map&lt;String, String&gt;</code> or <code>org.springframework.util.MultiValueMap MultiValueMap&lt;String, String&gt;</code> and a parameter name is not specified, then the map parameter is populated with all request parameter names and values.</p></blockquote><p>æ³¨æ„è¿™é‡Œå‡ºç°äº†Springè‡ªå®šä¹‰å®¹å™¨ç±»MultiValueMapï¼Œå®ƒçš„valueå€¼æ˜¯ArrayListå¯¹è±¡ã€‚<strong>æ³¨æ„åŒ¹é…è¯·æ±‚å‚æ•°åæ˜¯åŒºåˆ†å¤§å°å†™çš„</strong></p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>è­¦å‘Š</h5></div><div class="admonition-content"><p>å½“æˆ‘æŠŠ<code>RequestParam("age")</code>æ”¹æˆ<code>@RequestParam("AGE")</code>æ—¶ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥<code>localhost:8080/car/123/owner/kayhaw?AGE=17&amp;inters=123,3121</code>ï¼Œè·³è½¬æ—¶ä¼šè‡ªåŠ¨æŠŠå¤§å†™çš„AGEæ”¹æˆå°å†™çš„ageç„¶åå‘é€è¯·æ±‚ï¼Œå¯¼è‡´æŠ¥é”™ã€‚</p></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>æç¤º</h5></div><div class="admonition-content"><p>Spring Bootæ¥å—å€¼ä¸ºæ•°ç»„çš„è¯·æ±‚å‚æ•°ï¼Œè¯·æ±‚å‚æ•°çš„å†™æ³•æ˜¯<code>name=kay&amp;name=haw</code>æˆ–è€…<code>name=kay,haw</code></p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="cookievalueè·å–cookie">@CookieValueï¼šè·å–Cookie<a class="hash-link" href="#cookievalueè·å–cookie" title="Direct link to heading">â€‹</a></h2><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@GetMapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/car/{id}/owner/{username}"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getCar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@CookieValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"id"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@CookieValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"id"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">Cookie</span><span class="token plain"> _id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>CookieValueæ³¨è§£ä¿®é¥°çš„å‚æ•°ç±»å‹å¯ä»¥æ˜¯Cookieç±»æˆ–è€…Cookieå€¼å¯¹åº”ç±»å‹</p><blockquote><p>The method parameter may be declared as type <code>javax.servlet.http.Cookie</code> or as cookie value type (String, int, etc.).</p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="requestbodyè·å–è¯·æ±‚ä½“">@RequestBodyï¼šè·å–è¯·æ±‚ä½“<a class="hash-link" href="#requestbodyè·å–è¯·æ±‚ä½“" title="Direct link to heading">â€‹</a></h2><p>è·å–è¯·æ±‚ä½“å†…å®¹ï¼Œæ ¹æ®è¯·æ±‚çš„å†…å®¹ç±»å‹ç”±HttpMessageConverterå¤„ç†è½¬æ¢ï¼Œè¯¥æ³¨è§£åªæœ‰ä¸€ä¸ªrequiredå‚æ•°ï¼Œé»˜è®¤ä¸ºtrueè¡¨ç¤ºè¯·æ±‚ä½“ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="requestattributeè·å–requestå±æ€§">@RequestAttributeï¼šè·å–Requestå±æ€§<a class="hash-link" href="#requestattributeè·å–requestå±æ€§" title="Direct link to heading">â€‹</a></h2><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@Controller</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">RequestController</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™é‡Œä¸è¦åŠ @ResponseBodyæ³¨è§£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@GetMapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/goto"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">goToPage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HttpServletRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setAttribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"msg"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"success"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setAttribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"code"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"forward:success"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@ResponseBody</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@GetMapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/success"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">success</span><span class="token punctuation" style="color:#393A34">(</span><span class="token annotation punctuation" style="color:#393A34">@RequestAttribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"msg"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                       </span><span class="token annotation punctuation" style="color:#393A34">@RequestAttribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"code"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">Integer</span><span class="token plain"> code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token class-name">HttpServletRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Object</span><span class="token plain"> msg1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAttribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"msg"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> map </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"reqBody_msg"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"reqAttri_msg"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"code"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä½¿ç”¨æ–¹æ³•å’Œ@RequestParamç±»ä¼¼ï¼Œå½“ä¸æŒ‡å®šå±æ€§åæ—¶é»˜è®¤ä¸ºå½¢å‚åã€‚ä½†æ˜¯ï¼Œ@RequestAttributeä¸æ”¯æŒåœ¨å½¢å‚ç±»å‹ä¸ºMapè‡ªåŠ¨è½¬åŒ–çš„åŠŸèƒ½ï¼Œå› æ­¤<code>@RequestAttribute Map&lt;String, String&gt; attMap</code>ä¼šæŠ¥é”™æ‰¾ä¸åˆ°attMapå±æ€§ã€‚è¦æƒ³è·å–æ‰€æœ‰è¯·æ±‚å±æ€§å°è£…å¯¹è±¡ï¼Œå£°æ˜ä¸€ä¸ª<code>HttpServletRequest</code>å½¢å‚ï¼Œç„¶åè°ƒç”¨å…¶getAttributeæ–¹æ³•</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>è¯·æ±‚å‚æ•°(Parameter)å’Œè¯·æ±‚å±æ€§(Attribute)çš„å¼‚åŒ</h5></div><div class="admonition-content"><ol><li>å‰è€…æ˜¯ä»webç”¨æˆ·ç«¯åˆ°webæœåŠ¡ç«¯ä¼ é€’çš„æ•°æ®ï¼Œåè€…æ˜¯webæœåŠ¡ç«¯å†…éƒ¨ä¼ é€’çš„æ•°æ®ï¼Œåœ¨å…·æœ‰è½¬å‘å…³ç³»ä¹‹é—´çš„Webç»„ä»¶å…±äº«</li><li>è¯·æ±‚å‚æ•°åªæœ‰getteræ–¹æ³•æ²¡æœ‰setteræ–¹æ³•ä¸”è¿”å›å€¼ä¸ºStringç±»å‹ï¼Œè¯·æ±‚å±æ€§getterã€setteræ–¹æ³•éƒ½æœ‰ï¼Œå‚æ•°ç±»å‹ä¸ºObject</li><li>getParameterç”¨äºå®¢æˆ·ç«¯é‡å®šå‘æ—¶æ¥æ”¶æ•°æ®ï¼ŒgetAttributeç”¨æˆ·æœåŠ¡å™¨ç«¯é‡å®šå‘æ—¶ï¼Œå³åœ¨servletä¸­ä½¿ç”¨äº†forwardå‡½æ•°ï¼ŒgetAttributeåªèƒ½è·å–ç”¨setAttributeè®¾ç½®çš„å€¼</li></ol></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="matrixvariableè·å–çŸ©é˜µå˜é‡">@MatrixVariableï¼šè·å–çŸ©é˜µå˜é‡<a class="hash-link" href="#matrixvariableè·å–çŸ©é˜µå˜é‡" title="Direct link to heading">â€‹</a></h2><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@ResponseBody</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@GetMapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/car/{path}"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">carsSell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@MatrixVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"low"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pathVar </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"path"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">Integer</span><span class="token plain"> low</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@MatrixVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"brand"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> brand</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@MatrixVariable</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@PathVariable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"path"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"%d, %s, %s\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> low</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> brand</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">map</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>æœ¬åœ°æµ‹è¯•æµè§ˆå™¨åœ°å€æ è¾“å…¥<code>http://localhost:8080/car/abc;low=12;brand=aodi,byd,yadi</code>ï¼Œè·¯å¾„å˜é‡å’ŒçŸ©é˜µå˜é‡ä¹‹é—´ä½¿ç”¨åˆ†å·éš”å¼€ï¼Œå€¼ä¸ºåˆ—è¡¨ä½¿ç”¨é€—å·éš”å¼€ã€‚<strong>çŸ©é˜µå˜é‡å¿…é¡»å’Œè·¯å¾„å˜é‡ç»‘å®š</strong>ï¼Œå½“å¤šä¸ªè·¯å¾„å˜é‡åçš„çŸ©é˜µå˜é‡é‡åæ—¶ï¼Œå¯ä»¥é€šè¿‡pathVarå‚æ•°æŒ‡å®šè·¯å¾„å˜é‡æ¥è·å–å¯¹åº”çš„çŸ©é˜µå˜é‡ã€‚<strong>æ³¨æ„ï¼Œå½“çŸ©é˜µå˜é‡ç»‘å®šçš„å‚æ•°ç±»å‹ä¸ºMapæˆ–MultiValueMapæ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šè¦è·å–çš„çŸ©é˜µå˜é‡åï¼Œæ­¤æ—¶mapåŒ…å«æ‰€æœ‰çŸ©é˜µå˜é‡ä¿¡æ¯ï¼›å¦‚æœæŒ‡å®šäº†çŸ©é˜µå˜é‡åï¼Œä¼šå°è¯•æŠŠåé¢çš„å€¼è½¬ä¸ºMapç±»å‹</strong></p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>æ³¨æ„</h5></div><div class="admonition-content"><p>SpringBooté»˜è®¤ç¦ç”¨çŸ©é˜µå˜é‡åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹ä¸¤ç§æ–¹å¼å¼€å¯ï¼Œä¸¤è€…éƒ½æ˜¯å°†UrlPathHelperç»„ä»¶çš„removeSemicolonContentå±æ€§è®¾ç½®ä¸ºfalse(é»˜è®¤ä¸ºtrueè¡¨ç¤ºç§»é™¤è·¯å¾„å˜é‡åˆ†å·åçš„å†…å®¹)</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">æ–¹å¼ä¸€ï¼šå®ç°WebMvcConfigurerå¹¶é‡å†™æ–¹æ³•</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@Configuration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">proxyBeanMethods </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">WebConfig</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">WebMvcConfigurer</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">configurePathMatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">PathMatchConfigurer</span><span class="token plain"> configurer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">UrlPathHelper</span><span class="token plain"> urlPathHelper </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">UrlPathHelper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        urlPathHelper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setRemoveSemicolonContent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configurer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setUrlPathHelper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">urlPathHelper</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">æ–¹å¼äºŒï¼šè‡ªå®šä¹‰ä¸€ä¸ªWebMvcConfigurerç»„ä»¶</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@Configuration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">proxyBeanMethods </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">WebConfig</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@Bean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">WebMvcConfigurer</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">webMvcConfigurer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WebMvcConfigurer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">configurePathMatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">PathMatchConfigurer</span><span class="token plain"> configurer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">UrlPathHelper</span><span class="token plain"> urlPathHelper </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">UrlPathHelper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        urlPathHelper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setRemoveSemicolonContent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configurer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setUrlPathHelper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">urlPathHelper</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Spring Boot" term="Spring Boot"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring Bootæºç åˆ†æ(1)]]></title>
        <id>/2021/08/01/SpringBootæºç åˆ†æ01</id>
        <link href="https://kayhaw.github.io/blog/2021/08/01/SpringBootæºç åˆ†æ01"/>
        <updated>2021-08-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[doDispatch]]></summary>
        <content type="html"><![CDATA[<p>ç®€å•åœ°åˆ†æä¸€ä¸‹HTTPè¯·æ±‚æ˜¯æ€ä¹ˆè½åˆ°DispatcherServletçš„doDispatchæ–¹æ³•å¤´ä¸Š</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>ç‰ˆæœ¬è¯´æ˜</h5></div><div class="admonition-content"><p>åŸºäºSpring Boot 2.4.3ï¼Œå¯¹åº”Spring MVC 5.3.4</p></div></div><p>é¦–å…ˆç»™å‡ºDispatcherServletç±»çš„ç»§æ‰¿å…³ç³»å›¾ï¼Œæˆ‘ä»¬ä¸»è¦å…³å¿ƒHttpServletâ¡ï¸HttpServletBeanâ¡ï¸FrameworkServletâ¡ï¸DispatcherServletè¿™ä¸€æ¡ç»§æ‰¿å…³ç³»çº¿</p><p><img loading="lazy" alt="DispatcherServlet.png" src="/assets/images/DispatcherServlet-d5326e5b6ba2d6d0784b57bd2362185f.png" width="2378" height="1024" class="img_E7b_"></p><p>HttpServletä½œä¸ºæŠ½è±¡ç±»ï¼Œå£°æ˜å®šä¹‰äº†doGetã€doPostã€doPutç­‰æ–¹æ³•å¤„ç†HTTPè¯·æ±‚(ä»¥ä¸‹ç»Ÿç§°ä¸ºdoXxxæ–¹æ³•)ï¼Œç„¶è€Œå®ƒçš„ååº”ä¸€å¾‹æ˜¯â€œä¸å¥½æ„æ€ï¼Œæˆ‘æ˜¯åºŸç‰©ï¼Œä¸æ”¯æŒå¤„ç†xxxè¿™ä¸ªHTTPæ–¹æ³•â€ã€‚å› æ­¤ï¼Œéœ€è¦å…¶å­ç±»æ¥é‡å†™doXxxæ–¹æ³•æ¥å¤„ç†è¯·æ±‚</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">javax/servlet/http/HttpServlet.java</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doGet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HttpServletRequest</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">HttpServletResponse</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">ServletException</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">String</span><span class="token plain"> msg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lStrings</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"http.method_get_not_supported"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">sendMethodNotAllowed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">req</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sendMethodNotAllowed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HttpServletRequest</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">HttpServletResponse</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> protocol </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getProtocol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Note: Tomcat reports "" for HTTP/0.9 although some implementations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//       may report HTTP/0.9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">endsWith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"0.9"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> protocol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">endsWith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"1.0"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sendError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SC_BAD_REQUEST</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sendError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HttpServletResponseSC_METHOD_NOT_ALLOWED</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>æŒ–å‘</h5></div><div class="admonition-content"><p>æ³¨æ„åˆ°javax/servlet/http/HttpServlet.javaæ¥è‡ªtomcat-embed-core-9.0.43-sources.jaråŒ…ï¼Œå†å¾€å¤–ä¸€å±‚æ€è€ƒï¼Œwebå®¹å™¨æ˜¯æ€ä¹ˆè°ƒç”¨è¿™äº›doXxxæ–¹æ³•çš„ï¼Ÿ</p></div></div><p>ç„¶è€Œä½œä¸ºHttpServletçš„å­ç±»ï¼ŒHttpServletBeanå¹¶æ²¡æœ‰é‡å†™doXxxæ–¹æ³•ï¼Œå®ƒæ˜¯HttpServletçš„ç®€å•æ‰©å±•ï¼Œç”¨äºå¤„ç†web.xmlä¸­çš„serlveté…ç½®å‚æ•°</p><p>æ¥ç€æ¥åˆ°HttpServletBeançš„å­ç±»FrameworkServletï¼Œå®ƒç»ˆäºé‡å†™äº†æ¥è‡ªçˆ·çˆ·HttpServletçš„doXxxæ–¹æ³•ï¼Œå¹¶ä¸”å®ç°å¾ˆç®€å•ï¼Œéƒ½è°ƒç”¨processRequestæ–¹æ³•ä»£ä¸ºå¤„ç†</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">org/springframework/web/servlet/FrameworkServlet.java</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  * Delegate GET requests to processRequest/doService.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  * &lt;p&gt;Will also be invoked by HttpServlet's default implementation of {@code doHead},</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  * with a {@code NoBodyResponse} that just captures the content length.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  * @see #doService</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  * @see #doHead</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doGet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HttpServletRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">HttpServletResponse</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">ServletException</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">processRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>åœ¨processRequestæ–¹æ³•ä¸­ï¼Œå®ƒåˆé€šè¿‡doServiceæ–¹æ³•å¤„ç†è¯·æ±‚å¹¶æ•è·å¤„ç†æ—¶æŠ›å‡ºçš„å¼‚å¸¸ï¼Œç„¶åè®°å½•ç»“æœã€å‘å¸ƒä¸€ä¸ªè¯·æ±‚å·²å¤„ç†äº‹ä»¶</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">org/springframework/web/servlet/FrameworkServlet.java</div><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">processRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HttpServletRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">HttpServletResponse</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">ServletException</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸€äº›åˆå§‹åŒ–ä»£ç </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">doService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ServletException</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token class-name">IOException</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    failureCause </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Throwable</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    failureCause </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">NestedServletException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Request processing failed"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">resetContextHolders</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> previousLocaleContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> previousAttributes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requestAttributes </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      requestAttributes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">requestCompleted</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">logResult</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> failureCause</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> asyncManager</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">publishRequestHandledEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> startTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> failureCause</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å¯doServiceè¿˜æ˜¯ä¸ä¸­ç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå› æ­¤è¿˜æ˜¯éœ€è¦FrameworkServletçš„å­ç±»æ¥å®ç°doServiceæ–¹æ³•ã€‚ç»ˆäºï¼Œè½®åˆ°DispatcherServletå‡ºåœºäº†</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">abstract</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HttpServletRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">HttpServletResponse</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä½œä¸ºFrameworkServletçš„å­ç±»ï¼ŒDispatcherServletç±»å®ç°äº†doSeriveæ–¹æ³•ï¼Œå¹¶ä¸”å®ƒåˆå°†å¤„ç†è¯·æ±‚åˆäº¤ç»™è‡ªå®¶çš„doDispatchæ–¹æ³•å»åšã€‚è‡³æ­¤ï¼Œè¯·æ±‚å¤„ç†åˆ°è¾¾äº†æœ€æ ¸å¿ƒçš„ä¸€ç«™</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>æ€»ç»“</h5></div><div class="admonition-content"><p>è¯·æ±‚å¤„ç†ä¸»è¦æ¶‰åŠ4ä¸ªç±»HttpServletã€HttpServletBeanã€FrameworkServletå’ŒDispatcherServletã€‚çœ‹èµ·æ¥ä¸€å±‚å¥—ä¸€å±‚ï¼Œåˆæ˜¯å­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œåˆæ˜¯å­ç±»å®ç°çˆ¶ç±»æŠ½è±¡æ–¹æ³•ï¼Œä½†æ˜¯æ¯ä¸€å±‚éƒ½å¹²äº†ä¸€ç‚¹äº‹ï¼šæ¯”å¦‚HttpServletBeanç±»å¤„ç†web.xmlä¸­çš„servleté…ç½®å‚æ•°ï¼ŒFrameworkServletæ˜¯å‘å¸ƒè¯·æ±‚å¤„ç†çš„ç»“æœäº‹ä»¶ï¼Œæœ€åDispatcherServletå¹²æœ€é‡è¦çš„æ´»ã€‚ä¸€ä¸ªåºå¤§å¤æ‚çš„ç³»ç»Ÿæ¡†æ¶ä¸èƒ½é€šè¿‡ä¸€ä¸ªç±»æŠŠæ‰€æœ‰äº‹éƒ½å¹²å®Œäº†ï¼Œé‚£æ ·ä»£ç è‡ƒè‚¿å¹¶ä¸”ç´§è€¦åˆã€‚é€šè¿‡ç±»ç»§æ‰¿ï¼Œæ¯ä¸€å±‚å¹²ä¸€ç‚¹äº‹ï¼Œæœ€åå½¢æˆä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿ</p></div></div>]]></content>
        <author>
            <name>ä½•è½²</name>
            <uri>https://github.com/kayhaw</uri>
        </author>
        <category label="Spring Boot" term="Spring Boot"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[deploy]]></title>
        <id>/2021/06/22/deploy</id>
        <link href="https://kayhaw.github.io/blog/2021/06/22/deploy"/>
        <updated>2021-06-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[åœ¨github pageä¸Šéƒ¨ç½²docusaurus]]></summary>
        <content type="html"><![CDATA[<h1>deploy</h1><p>åœ¨github pageä¸Šéƒ¨ç½²docusaurus</p>]]></content>
    </entry>
</feed>